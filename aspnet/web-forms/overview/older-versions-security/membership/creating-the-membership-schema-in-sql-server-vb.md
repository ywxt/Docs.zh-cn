---
uid: web-forms/overview/older-versions-security/membership/creating-the-membership-schema-in-sql-server-vb
title: 在 SQL Server (VB) 中创建成员身份架构 |Microsoft Docs
author: rick-anderson
description: 本教程首先会检查才能使用 SqlMembershipProvider 向数据库添加必要的架构的方法。 之后，我们 wi...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 112a674d-716f-41a6-99b8-4074d65a54c0
msc.legacyurl: /web-forms/overview/older-versions-security/membership/creating-the-membership-schema-in-sql-server-vb
msc.type: authoredcontent
ms.openlocfilehash: 62a6113c9ddad1722160c7092308939cf7883588
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/16/2018
ms.locfileid: "41832046"
---
<a name="creating-the-membership-schema-in-sql-server-vb"></a><span data-ttu-id="c550a-104">在 SQL Server (VB) 中创建成员身份架构</span><span class="sxs-lookup"><span data-stu-id="c550a-104">Creating the Membership Schema in SQL Server (VB)</span></span>
====================
<span data-ttu-id="c550a-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c550a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c550a-106">[下载代码](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_04_VB.zip)或[下载 PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial04_MembershipSetup_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c550a-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_04_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial04_MembershipSetup_vb.pdf)</span></span>

> <span data-ttu-id="c550a-107">本教程首先会检查才能使用 SqlMembershipProvider 向数据库添加必要的架构的方法。</span><span class="sxs-lookup"><span data-stu-id="c550a-107">This tutorial starts by examining techniques for adding the necessary schema to the database in order to use the SqlMembershipProvider.</span></span> <span data-ttu-id="c550a-108">接下来，我们将检查在架构中键的表，并讨论其用途和重要性。</span><span class="sxs-lookup"><span data-stu-id="c550a-108">Following that, we will examine the key tables in the schema and discuss their purpose and importance.</span></span> <span data-ttu-id="c550a-109">本教程结尾介绍了如何告诉成员资格框架应使用哪个提供程序的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-109">This tutorial ends with a look at how to tell an ASP.NET application which provider the Membership framework should use.</span></span>


## <a name="introduction"></a><span data-ttu-id="c550a-110">介绍</span><span class="sxs-lookup"><span data-stu-id="c550a-110">Introduction</span></span>

<span data-ttu-id="c550a-111">使用窗体身份验证来标识网站访问者检查前面的两个教程。</span><span class="sxs-lookup"><span data-stu-id="c550a-111">The previous two tutorials examined using forms authentication to identify website visitors.</span></span> <span data-ttu-id="c550a-112">窗体身份验证框架简化开发人员可以将用户登录到网站并通过使用身份验证票证的页面访问跨记住它们。</span><span class="sxs-lookup"><span data-stu-id="c550a-112">The forms authentication framework makes it easy for developers to log a user into a website and to remember them across page visits through the use of authentication tickets.</span></span> <span data-ttu-id="c550a-113">`FormsAuthentication`类包括用于生成票证，并将其添加到访问者的 cookie 的方法。</span><span class="sxs-lookup"><span data-stu-id="c550a-113">The `FormsAuthentication` class includes methods for generating the ticket and adding it to the visitor's cookies.</span></span> <span data-ttu-id="c550a-114">`FormsAuthenticationModule`检查所有传入请求，对于有效的身份验证票证，创建并将关联`GenericPrincipal`和一个`FormsIdentity`与当前请求的对象。</span><span class="sxs-lookup"><span data-stu-id="c550a-114">The `FormsAuthenticationModule` examines all incoming requests and, for those with a valid authentication ticket, creates and associates a `GenericPrincipal` and a `FormsIdentity` object with the current request.</span></span> <span data-ttu-id="c550a-115">窗体身份验证是只是一种机制中，然后在后续请求中，分析该票证，以确定用户的标识进行日志记录时授予访问者的身份验证票证。</span><span class="sxs-lookup"><span data-stu-id="c550a-115">Forms authentication is merely a mechanism for granting an authentication ticket to a visitor when logging in and, on subsequent requests, parsing that ticket to determine the user's identity.</span></span> <span data-ttu-id="c550a-116">Web 应用程序以支持用户帐户，我们仍需要实现用户存储区并添加了用于验证凭据，注册新的用户，以及其他用户帐户相关的任务的许多功能。</span><span class="sxs-lookup"><span data-stu-id="c550a-116">For a web application to support user accounts, we still need to implement a user store and add functionality to validate credentials, register new users, and the myriad of other user account-related tasks.</span></span>

<span data-ttu-id="c550a-117">ASP.NET 2.0 中，开发人员之前上实现所有这些用户帐户相关的任务的挂钩。</span><span class="sxs-lookup"><span data-stu-id="c550a-117">Prior to ASP.NET 2.0, developers were on the hook for implementing all of these user account-related tasks.</span></span> <span data-ttu-id="c550a-118">幸运的是 ASP.NET 团队识别这种缺陷，并引入了使用 ASP.NET 2.0 成员资格框架。</span><span class="sxs-lookup"><span data-stu-id="c550a-118">Fortunately the ASP.NET team recognized this shortcoming and introduced the Membership framework with ASP.NET 2.0.</span></span> <span data-ttu-id="c550a-119">成员资格框架是一组.NET Framework 中提供了完成核心用户帐户相关任务的编程接口的类。</span><span class="sxs-lookup"><span data-stu-id="c550a-119">The Membership framework is a set of classes in the .NET Framework that provide a programmatic interface for accomplishing core user account-related tasks.</span></span> <span data-ttu-id="c550a-120">此框架构建之上[提供程序模型](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)，它允许开发人员插入标准化 API 的自定义的实现。</span><span class="sxs-lookup"><span data-stu-id="c550a-120">This framework is built atop the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to plug a customized implementation into a standardized API.</span></span>

<span data-ttu-id="c550a-121">如中所述<a id="Tutorial1"> </a> [*安全基础知识和 ASP.NET 支持*](../introduction/security-basics-and-asp-net-support-vb.md)教程中，.NET Framework 附带了两个内置成员资格提供程序： [ `ActiveDirectoryMembershipProvider` ](https://msdn.microsoft.com/library/system.web.security.activedirectorymembershipprovider.aspx)并[ `SqlMembershipProvider` ](https://msdn.microsoft.com/library/system.web.security.sqlmembershipprovider.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c550a-121">As discussed in the <a id="Tutorial1"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with two built-in Membership providers: [`ActiveDirectoryMembershipProvider`](https://msdn.microsoft.com/library/system.web.security.activedirectorymembershipprovider.aspx) and [`SqlMembershipProvider`](https://msdn.microsoft.com/library/system.web.security.sqlmembershipprovider.aspx).</span></span> <span data-ttu-id="c550a-122">正如其名，`SqlMembershipProvider`使用 Microsoft SQL Server 数据库作为用户存储区。</span><span class="sxs-lookup"><span data-stu-id="c550a-122">As its name implies, the `SqlMembershipProvider` uses a Microsoft SQL Server database as the user store.</span></span> <span data-ttu-id="c550a-123">若要使用此提供程序的应用程序中，我们需要告知哪些数据库作为存储使用的提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-123">In order to use this provider in an application, we need to tell the provider what database to use as the store.</span></span> <span data-ttu-id="c550a-124">如您所料，`SqlMembershipProvider`需要用户存储数据库具有某些数据库表、 视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="c550a-124">As you might imagine, the `SqlMembershipProvider` expects the user store database to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="c550a-125">我们需要将此预期的架构添加到所选数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-125">We need to add this expected schema to the selected database.</span></span>

<span data-ttu-id="c550a-126">本教程首先会检查将必要的架构添加到数据库，若要使用的技术`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-126">This tutorial starts by examining techniques for adding the necessary schema to the database in order to use the `SqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-127">接下来，我们将检查在架构中键的表，并讨论其用途和重要性。</span><span class="sxs-lookup"><span data-stu-id="c550a-127">Following that, we will examine the key tables in the schema and discuss their purpose and importance.</span></span> <span data-ttu-id="c550a-128">本教程结尾介绍了如何告诉成员资格框架应使用哪个提供程序的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-128">This tutorial ends with a look at how to tell an ASP.NET application which provider the Membership framework should use.</span></span>

<span data-ttu-id="c550a-129">让我们进入正题！</span><span class="sxs-lookup"><span data-stu-id="c550a-129">Let's get started!</span></span>

## <a name="step-1-deciding-where-to-place-the-user-store"></a><span data-ttu-id="c550a-130">步骤 1： 决定在何处放置在用户存储</span><span class="sxs-lookup"><span data-stu-id="c550a-130">Step 1: Deciding Where to Place the User Store</span></span>

<span data-ttu-id="c550a-131">ASP.NET 应用程序的数据通常存储在多个数据库中的表。</span><span class="sxs-lookup"><span data-stu-id="c550a-131">An ASP.NET application's data is commonly stored in a number of tables in a database.</span></span> <span data-ttu-id="c550a-132">在实现时`SqlMembershipProvider`我们必须决定是否将该成员身份架构部署的应用程序数据与同一数据库中或另一个数据库中的数据库架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-132">When implementing the `SqlMembershipProvider` database schema we must decide whether to place the Membership schema in the same database as the application data or in an alternate database.</span></span>

<span data-ttu-id="c550a-133">我建议作为应用程序数据在同一数据库中查找成员身份架构，原因如下：</span><span class="sxs-lookup"><span data-stu-id="c550a-133">I recommend locating the Membership schema in the same database as the application data for the following reasons:</span></span>

- <span data-ttu-id="c550a-134">**可维护性**其数据被封装在一个数据库中的应用程序是更轻松地理解、 维护和部署比具有两个独立数据库的应用程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-134">**Maintainability** � an application whose data is encapsulated in one database is easier to understand, maintain, and deploy than an application that has two separate databases.</span></span>
- <span data-ttu-id="c550a-135">**关系完整性**通过为应用程序表它在同一数据库中查找与成员资格相关的表，可能要建立[外键约束](http://en.wikipedia.org/wiki/Foreign_key)中的主键之间与成员资格相关的表和相关的应用程序表。</span><span class="sxs-lookup"><span data-stu-id="c550a-135">**Relational Integrity** � by locating the Membership-related tables in the same database as the application tables it is possible to establish [foreign key constraints](http://en.wikipedia.org/wiki/Foreign_key) between the primary keys in the Membership-related tables and related application tables.</span></span>

<span data-ttu-id="c550a-136">只能分离到单独的数据库的用户存储和应用程序数据是有意义，如果有多个应用程序每个使用单独的数据库，但需要共享常见的用户存储区。</span><span class="sxs-lookup"><span data-stu-id="c550a-136">Decoupling the user store and application data into separate databases only makes sense if you have multiple applications that each use separate databases, but need to share a common user store.</span></span>

### <a name="creating-a-database"></a><span data-ttu-id="c550a-137">创建数据库</span><span class="sxs-lookup"><span data-stu-id="c550a-137">Creating a Database</span></span>

<span data-ttu-id="c550a-138">因为第二个教程不需要数据库构建应用程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-138">The application we have been building since the second tutorial has not yet needed a database.</span></span> <span data-ttu-id="c550a-139">我们需要一个现在，但是，为用户存储区。</span><span class="sxs-lookup"><span data-stu-id="c550a-139">We need one now, however, for the user store.</span></span> <span data-ttu-id="c550a-140">让我们创建一个，然后向其中添加所需的架构`SqlMembershipProvider`提供程序 （请参阅步骤 2）。</span><span class="sxs-lookup"><span data-stu-id="c550a-140">Let's create one and then add to it the schema required by the `SqlMembershipProvider` provider (see Step 2).</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-141">我们将使用在本教程系列[Microsoft SQL Server 2005 Express Edition](https://msdn.microsoft.com/sql/Aa336346.aspx)数据库来存储我们的应用程序表和`SqlMembershipProvider`架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-141">Throughout this tutorial series we will be using a [Microsoft SQL Server 2005 Express Edition](https://msdn.microsoft.com/sql/Aa336346.aspx) database to store our application tables and the `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="c550a-142">做出此决定是以下两个原因： 首先，由于其成本-免费-Express Edition 是 SQL Server 2005; 的最可读性也可访问版本第二，可将 SQL Server 2005 Express Edition 数据库放在 web 应用程序的直接`App_Data`文件夹中，使其容易做到打包在数据库和 web 应用程序一起在一个 ZIP 文件并重新部署它而无需任何特殊安装说明或配置选项。</span><span class="sxs-lookup"><span data-stu-id="c550a-142">This decision was made for two reasons: first, due to its cost - free - the Express Edition is the most readably accessible version of SQL Server 2005; second, SQL Server 2005 Express Edition databases can be placed directly in the web application's `App_Data` folder, making it a cinch to package the database and web application together in one ZIP file and to redeploy it without any special setup instructions or configuration options.</span></span> <span data-ttu-id="c550a-143">如果您希望使用非-Express Edition 版本的 SQL Server 跟着介绍一起操作，可以自由。</span><span class="sxs-lookup"><span data-stu-id="c550a-143">If you'd prefer to follow along using a non-Express Edition version of SQL Server, feel free.</span></span> <span data-ttu-id="c550a-144">这些步骤都几乎完全相同。</span><span class="sxs-lookup"><span data-stu-id="c550a-144">The steps are virtually identical.</span></span> <span data-ttu-id="c550a-145">`SqlMembershipProvider`架构将使用任何版本的 Microsoft SQL Server 2000 和最多。</span><span class="sxs-lookup"><span data-stu-id="c550a-145">The `SqlMembershipProvider` schema will work with any version of Microsoft SQL Server 2000 and up.</span></span>

<span data-ttu-id="c550a-146">从解决方案资源管理器，右键单击`App_Data`文件夹，然后选择添加新项。</span><span class="sxs-lookup"><span data-stu-id="c550a-146">From the Solution Explorer, right-click on the `App_Data` folder and choose to Add New Item.</span></span> <span data-ttu-id="c550a-147">(如果没有看到`App_Data`文件夹在项目中，右键单击解决方案资源管理器中的项目，选择添加 ASP.NET 文件夹，然后选取`App_Data`。)从添加新项对话框中，选择要添加新的 SQL 数据库名为`SecurityTutorials.mdf`。</span><span class="sxs-lookup"><span data-stu-id="c550a-147">(If you do not see an `App_Data` folder in your project, right-click on the project in Solution Explorer, select Add ASP.NET Folder, and pick `App_Data`.) From the Add New Item dialog box, choose to add a new SQL Database named `SecurityTutorials.mdf`.</span></span> <span data-ttu-id="c550a-148">在本教程中我们将添加`SqlMembershipProvider`架构到此数据库; 在后续教程中我们将创建其他要捕获应用程序数据的表。</span><span class="sxs-lookup"><span data-stu-id="c550a-148">In this tutorial we will add the `SqlMembershipProvider` schema to this database; in subsequent tutorials we will create additional tables to capture our application data.</span></span>


<span data-ttu-id="c550a-149">[![添加名为 SecurityTutorials.mdf 数据库添加到 App_Data 文件夹的新 SQL 数据库](creating-the-membership-schema-in-sql-server-vb/_static/image2.png)](creating-the-membership-schema-in-sql-server-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-149">[![Add a New SQL Database Named SecurityTutorials.mdf Database to the App_Data Folder](creating-the-membership-schema-in-sql-server-vb/_static/image2.png)](creating-the-membership-schema-in-sql-server-vb/_static/image1.png)</span></span>

<span data-ttu-id="c550a-150">**图 1**： 添加新的 SQL 数据库命名`SecurityTutorials.mdf`数据库复制到`App_Data`文件夹 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-150">**Figure 1**: Add a New SQL Database Named `SecurityTutorials.mdf` Database to the `App_Data` Folder ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image3.png))</span></span>


<span data-ttu-id="c550a-151">添加到数据库`App_Data`文件夹自动包括在数据库资源管理器视图。</span><span class="sxs-lookup"><span data-stu-id="c550a-151">Adding a database to the `App_Data` folder automatically includes it in the Database Explorer view.</span></span> <span data-ttu-id="c550a-152">（在非-Express Edition 版本的 Visual Studio 中，数据库资源管理器被称为服务器资源管理器。）转到数据库资源管理器并展开刚添加`SecurityTutorials`数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-152">(In the non-Express Edition version of Visual Studio, the Database Explorer is called the Server Explorer.) Go to the Database Explorer and expand the just-added `SecurityTutorials` database.</span></span> <span data-ttu-id="c550a-153">如果你没有在屏幕上看到数据库资源管理器，转到视图菜单，选择数据库资源管理器，或按 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="c550a-153">If you do not see the Database Explorer on screen, go to the View menu and choose Database Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="c550a-154">如图 2 所示，`SecurityTutorials`数据库为空-它包含任何表、 没有视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="c550a-154">As Figure 2 shows, the `SecurityTutorials` database is empty - it contains no tables, no views, and no stored procedures.</span></span>


<span data-ttu-id="c550a-155">[![SecurityTutorials 数据库是当前为空](creating-the-membership-schema-in-sql-server-vb/_static/image5.png)](creating-the-membership-schema-in-sql-server-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-155">[![The SecurityTutorials Database is Currently Empty](creating-the-membership-schema-in-sql-server-vb/_static/image5.png)](creating-the-membership-schema-in-sql-server-vb/_static/image4.png)</span></span>

<span data-ttu-id="c550a-156">**图 2**:`SecurityTutorials`数据库是当前为空 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-156">**Figure 2**: The `SecurityTutorials` Database is Currently Empty ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image6.png))</span></span>


## <a name="step-2-adding-thesqlmembershipproviderschema-to-the-database"></a><span data-ttu-id="c550a-157">步骤 2： 添加`SqlMembershipProvider`到数据库的架构</span><span class="sxs-lookup"><span data-stu-id="c550a-157">Step 2: Adding the`SqlMembershipProvider`Schema to the Database</span></span>

<span data-ttu-id="c550a-158">`SqlMembershipProvider`需要一组特定的表、 视图和存储的过程以安装在用户存储数据库中。</span><span class="sxs-lookup"><span data-stu-id="c550a-158">The `SqlMembershipProvider` requires a particular set of tables, views, and stored procedures to be installed in the user store database.</span></span> <span data-ttu-id="c550a-159">可以使用添加这些必要的数据库对象[`aspnet_regsql.exe`工具](https://msdn.microsoft.com/library/ms229862.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c550a-159">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="c550a-160">此文件位于`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\`文件夹。</span><span class="sxs-lookup"><span data-stu-id="c550a-160">This file is located in the `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\` folder.</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-161">`aspnet_regsql.exe`工具提供命令行功能和图形用户界面。</span><span class="sxs-lookup"><span data-stu-id="c550a-161">The `aspnet_regsql.exe` tool offers both command line functionality and a graphical user interface.</span></span> <span data-ttu-id="c550a-162">图形界面是更多用户友好，我们将检查在本教程中。</span><span class="sxs-lookup"><span data-stu-id="c550a-162">The graphical interface is more user friendly and is what we will examine in this tutorial.</span></span> <span data-ttu-id="c550a-163">当在命令行接口非常有用的加法`SqlMembershipProvider`架构需要自动执行，例如生成脚本或自动测试方案。</span><span class="sxs-lookup"><span data-stu-id="c550a-163">The command line interface is useful when the addition of the `SqlMembershipProvider` schema needs to be automated, such as in build scripts or automated testing scenarios.</span></span>

<span data-ttu-id="c550a-164">`aspnet_regsql.exe`工具用于添加或删除*ASP.NET 应用程序服务*到指定的 SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-164">The `aspnet_regsql.exe` tool is used to add or remove *ASP.NET application services* to a specified SQL Server database.</span></span> <span data-ttu-id="c550a-165">ASP.NET 应用程序服务包含的架构`SqlMembershipProvider`和`SqlRoleProvider`，以及其他 ASP.NET 2.0 框架的基于 SQL 的提供程序的架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-165">The ASP.NET application services encompass the schemas for the `SqlMembershipProvider` and `SqlRoleProvider`, along with the schemas for the SQL-based providers for other ASP.NET 2.0 frameworks.</span></span> <span data-ttu-id="c550a-166">我们需要提供的信息的两个位`aspnet_regsql.exe`工具：</span><span class="sxs-lookup"><span data-stu-id="c550a-166">We need to provide two bits of information to the `aspnet_regsql.exe` tool:</span></span>

- <span data-ttu-id="c550a-167">是否要添加或删除应用程序服务和</span><span class="sxs-lookup"><span data-stu-id="c550a-167">Whether we want to add or remove application services, and</span></span>
- <span data-ttu-id="c550a-168">从其中添加或删除应用程序服务架构的数据库</span><span class="sxs-lookup"><span data-stu-id="c550a-168">The database from which to add or remove the application services schema</span></span>

<span data-ttu-id="c550a-169">数据库若要使用，显示提示`aspnet_regsql.exe`工具会询问我们提供的数据库的安全凭据连接到数据库所驻留的服务器名称和数据库名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-169">In prompting for the database to use, the `aspnet_regsql.exe` tool asks us to provide the name of the server the database resides on, the security credentials for connecting to the database, and the database name.</span></span> <span data-ttu-id="c550a-170">如果使用的非 Express Edition 的 SQL Server，您应该已经知道此信息，因为它是使用 ASP.NET 网页通过数据库时，必须提供通过连接字符串的相同信息。</span><span class="sxs-lookup"><span data-stu-id="c550a-170">If you are using the non-Express Edition of SQL Server, you should already know this information, as it is the same information you must provide through a connection string when working with the database through an ASP.NET web page.</span></span> <span data-ttu-id="c550a-171">使用中的 SQL Server 2005 Express Edition 数据库时确定的服务器和数据库名称`App_Data`文件夹，但是，是稍微要复杂。</span><span class="sxs-lookup"><span data-stu-id="c550a-171">Determining the server and database name when using a SQL Server 2005 Express Edition database in the `App_Data` folder, however, is a bit more involved.</span></span>

<span data-ttu-id="c550a-172">以下部分介绍了简单的方法，用于指定 SQL Server 2005 Express Edition 数据库中的服务器和数据库名称`App_Data`文件夹。</span><span class="sxs-lookup"><span data-stu-id="c550a-172">The following section examines a straightforward way for specifying the server and database name for a SQL Server 2005 Express Edition database in the `App_Data` folder.</span></span> <span data-ttu-id="c550a-173">如果不使用 SQL Server 2005 Express Edition 可随时跳到安装应用程序服务部分。</span><span class="sxs-lookup"><span data-stu-id="c550a-173">If you are not using SQL Server 2005 Express Edition feel free to skip ahead to the Installing the Application Services section.</span></span>

### <a name="determining-the-server-and-database-name-for-a-sql-server-2005-express-edition-database-in-theappdatafolder"></a><span data-ttu-id="c550a-174">确定服务器和 SQL Server 2005 Express Edition 数据库中的数据库名称`App_Data`文件夹</span><span class="sxs-lookup"><span data-stu-id="c550a-174">Determining the Server and Database Name for a SQL Server 2005 Express Edition Database in the`App_Data`Folder</span></span>

<span data-ttu-id="c550a-175">若要使用`aspnet_regsql.exe`我们需要知道服务器和数据库名称的工具。</span><span class="sxs-lookup"><span data-stu-id="c550a-175">In order to use the `aspnet_regsql.exe` tool we need to know the server and database names.</span></span> <span data-ttu-id="c550a-176">服务器名称是`localhost\InstanceName`。</span><span class="sxs-lookup"><span data-stu-id="c550a-176">The server name is `localhost\InstanceName`.</span></span> <span data-ttu-id="c550a-177">最有可能*InstanceName*是`SQLExpress`。</span><span class="sxs-lookup"><span data-stu-id="c550a-177">Most likely, the *InstanceName* is `SQLExpress`.</span></span> <span data-ttu-id="c550a-178">但是，如果已手动安装 SQL Server 2005 Express Edition （即，未安装它会自动安装 Visual Studio 时），则可能选择不同的实例名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-178">However, if you installed SQL Server 2005 Express Edition manually (that is, you did not install it automatically while installing Visual Studio), then it is possible that you selected a different instance name.</span></span>

<span data-ttu-id="c550a-179">数据库名称是有点棘手，来确定。</span><span class="sxs-lookup"><span data-stu-id="c550a-179">The database name is a bit trickier to determine.</span></span> <span data-ttu-id="c550a-180">中的数据库在`App_Data`文件夹通常具有的数据库名称，包括[全局唯一标识符](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)以及数据库文件的路径。</span><span class="sxs-lookup"><span data-stu-id="c550a-180">Databases in the `App_Data` folder typically have a database name that includes a [globally unique identifier](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) along with the path to the database file.</span></span> <span data-ttu-id="c550a-181">我们需要确定此数据库名称，以便进行添加应用程序服务架构通过`aspnet_regsql.exe`。</span><span class="sxs-lookup"><span data-stu-id="c550a-181">We need to determine this database name in order to add the application services schema through `aspnet_regsql.exe`.</span></span>

<span data-ttu-id="c550a-182">若要确定数据库名称的最简单方法是通过 SQL Server Management Studio 对其进行检查。</span><span class="sxs-lookup"><span data-stu-id="c550a-182">The easiest way to ascertain the database name is to examine it through SQL Server Management Studio.</span></span> <span data-ttu-id="c550a-183">SQL Server Management Studio 提供一个图形界面，用于管理 SQL Server 2005 数据库，但不随附 Express Edition 的 SQL Server 2005。</span><span class="sxs-lookup"><span data-stu-id="c550a-183">SQL Server Management Studio provides a graphical interface for managing SQL Server 2005 databases, but it does not ship with the Express Edition of SQL Server 2005.</span></span> <span data-ttu-id="c550a-184">值得高兴的是[您可以下载](https://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&amp;displaylang=en)免费 Express Edition 的 SQL Server Management Studio。</span><span class="sxs-lookup"><span data-stu-id="c550a-184">The good news is that [you can download](https://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&amp;displaylang=en) the free Express Edition of SQL Server Management Studio.</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-185">如果还必须安装在您的桌面上，则可能安装 Management Studio 的完整版本的 SQL Server 2005 的非-Express Edition 版本。</span><span class="sxs-lookup"><span data-stu-id="c550a-185">If you also have a non-Express Edition version of SQL Server 2005 installed on your desktop then the full version of Management Studio is likely installed.</span></span> <span data-ttu-id="c550a-186">完整版本可用于确定数据库名称，如下所述的 Express Edition 按照相同的步骤。</span><span class="sxs-lookup"><span data-stu-id="c550a-186">You can use the full version to determine the database name, following the same steps as outlined below for the Express Edition.</span></span>

<span data-ttu-id="c550a-187">首先关闭 Visual Studio，以确保数据库文件上的 Visual Studio 所规定的任何锁都会关闭。</span><span class="sxs-lookup"><span data-stu-id="c550a-187">Start by closing Visual Studio to ensure that any locks imposed by Visual Studio on the database file are closed.</span></span> <span data-ttu-id="c550a-188">接下来，启动 SQL Server Management Studio 并连接到`localhost\InstanceName`SQL Server 2005 Express edition 数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-188">Next, launch SQL Server Management Studio and connect to the `localhost\InstanceName` database for SQL Server 2005 Express Edition.</span></span> <span data-ttu-id="c550a-189">如前文所述，您很可能是实例名称`SQLExpress`。</span><span class="sxs-lookup"><span data-stu-id="c550a-189">As noted earlier, chances are the instance name is `SQLExpress`.</span></span> <span data-ttu-id="c550a-190">对于身份验证选项中，选择 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="c550a-190">For the Authentication option, select Windows Authentication.</span></span>


<span data-ttu-id="c550a-191">[![连接到 SQL Server 2005 Express Edition 实例](creating-the-membership-schema-in-sql-server-vb/_static/image8.png)](creating-the-membership-schema-in-sql-server-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-191">[![Connect to the SQL Server 2005 Express Edition Instance](creating-the-membership-schema-in-sql-server-vb/_static/image8.png)](creating-the-membership-schema-in-sql-server-vb/_static/image7.png)</span></span>

<span data-ttu-id="c550a-192">**图 3**： 连接到 SQL Server 2005 Express Edition 实例 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-192">**Figure 3**: Connect to the SQL Server 2005 Express Edition Instance ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image9.png))</span></span>


<span data-ttu-id="c550a-193">连接到 SQL Server 2005 Express Edition 实例后，Management Studio 的数据库、 安全设置、 服务器对象和等等的显示文件夹。</span><span class="sxs-lookup"><span data-stu-id="c550a-193">After connecting to the SQL Server 2005 Express Edition instance, Management Studio displays folders for the Databases, the Security settings, the Server Objects, and so on.</span></span> <span data-ttu-id="c550a-194">如果展开数据库选项卡将会看到`SecurityTutorials.mdf`数据库是*不*我们需要先附加该数据库中的数据库实例的注册。</span><span class="sxs-lookup"><span data-stu-id="c550a-194">If you expand the Databases tab you will see that the `SecurityTutorials.mdf` database is *not* registered in the database instance - we need to attach the database first.</span></span>

<span data-ttu-id="c550a-195">右键单击数据库文件夹并从上下文菜单中选择附加。</span><span class="sxs-lookup"><span data-stu-id="c550a-195">Right-click on the Databases folder and choose Attach from the context menu.</span></span> <span data-ttu-id="c550a-196">这将显示附加数据库对话框。</span><span class="sxs-lookup"><span data-stu-id="c550a-196">This will display the Attach Databases dialog box.</span></span> <span data-ttu-id="c550a-197">从此处，单击添加按钮，浏览到`SecurityTutorials.mdf`数据库，然后单击确定。</span><span class="sxs-lookup"><span data-stu-id="c550a-197">From here, click the Add button, browse to the `SecurityTutorials.mdf` database, and click OK.</span></span> <span data-ttu-id="c550a-198">图 4 显示了后的附加数据库对话框`SecurityTutorials.mdf`选择数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-198">Figure 4 shows the Attach Databases dialog box after the `SecurityTutorials.mdf` database has been selected.</span></span> <span data-ttu-id="c550a-199">图 5 显示 Management Studio 对象资源管理器后已成功附加该数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-199">Figure 5 shows Management Studio's Object Explorer after the database has been successfully attached.</span></span>


<span data-ttu-id="c550a-200">[![附加 SecurityTutorials.mdf 数据库](creating-the-membership-schema-in-sql-server-vb/_static/image11.png)](creating-the-membership-schema-in-sql-server-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-200">[![Attach the SecurityTutorials.mdf Database](creating-the-membership-schema-in-sql-server-vb/_static/image11.png)](creating-the-membership-schema-in-sql-server-vb/_static/image10.png)</span></span>

<span data-ttu-id="c550a-201">**图 4**： 将附加`SecurityTutorials.mdf`数据库 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-201">**Figure 4**: Attach the `SecurityTutorials.mdf` Database ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image12.png))</span></span>


<span data-ttu-id="c550a-202">[![SecurityTutorials.mdf 数据库显示在数据库文件夹中](creating-the-membership-schema-in-sql-server-vb/_static/image14.png)](creating-the-membership-schema-in-sql-server-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-202">[![The SecurityTutorials.mdf Database Appears in the Databases Folder](creating-the-membership-schema-in-sql-server-vb/_static/image14.png)](creating-the-membership-schema-in-sql-server-vb/_static/image13.png)</span></span>

<span data-ttu-id="c550a-203">**图 5**:`SecurityTutorials.mdf`数据库会显示在数据库文件夹 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-203">**Figure 5**: The `SecurityTutorials.mdf` Database Appears in the Databases Folder ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image15.png))</span></span>


<span data-ttu-id="c550a-204">如图 5 所示，`SecurityTutorials.mdf`数据库都有一个相当 abstruse 名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-204">As Figure 5 shows, the `SecurityTutorials.mdf` database has a rather abstruse name.</span></span> <span data-ttu-id="c550a-205">让我们将其更改为更容易记住 （和更方便地键入） 名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-205">Let's change it to a more memorable (and easier to type) name.</span></span> <span data-ttu-id="c550a-206">右键单击数据库，从上下文菜单中，选择重命名并将其重命名`SecurityTutorialsDatabase`。</span><span class="sxs-lookup"><span data-stu-id="c550a-206">Right-click on the database, choose Rename from the context menu, and rename it `SecurityTutorialsDatabase`.</span></span> <span data-ttu-id="c550a-207">这不会更改文件名，只是数据库名称来标识自身到 SQL Server 将使用。</span><span class="sxs-lookup"><span data-stu-id="c550a-207">This does not change the filename, just the name the database uses to identify itself to SQL Server.</span></span>


<span data-ttu-id="c550a-208">[![数据库重命名为 SecurityTutorialsDatabase](creating-the-membership-schema-in-sql-server-vb/_static/image17.png)](creating-the-membership-schema-in-sql-server-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-208">[![Rename the Database to SecurityTutorialsDatabase](creating-the-membership-schema-in-sql-server-vb/_static/image17.png)](creating-the-membership-schema-in-sql-server-vb/_static/image16.png)</span></span>

<span data-ttu-id="c550a-209">**图 6**： 重命名为数据库`SecurityTutorialsDatabase`([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-209">**Figure 6**: Rename the Database to `SecurityTutorialsDatabase`([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image18.png))</span></span>


<span data-ttu-id="c550a-210">现在我们知道的名称服务器和数据库名称`SecurityTutorials.mdf`数据库文件：`localhost\InstanceName`和`SecurityTutorialsDatabase`分别。</span><span class="sxs-lookup"><span data-stu-id="c550a-210">At this point we know the server and database names for the `SecurityTutorials.mdf` database file: `localhost\InstanceName` and `SecurityTutorialsDatabase`, respectively.</span></span> <span data-ttu-id="c550a-211">我们现已准备好安装应用程序服务通过`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="c550a-211">We are now ready to install the application services through the `aspnet_regsql.exe` tool.</span></span>

### <a name="installing-the-application-services"></a><span data-ttu-id="c550a-212">安装应用程序服务</span><span class="sxs-lookup"><span data-stu-id="c550a-212">Installing the Application Services</span></span>

<span data-ttu-id="c550a-213">若要启动`aspnet_regsql.exe`工具中，转到开始菜单并选择运行。</span><span class="sxs-lookup"><span data-stu-id="c550a-213">To launch the `aspnet_regsql.exe` tool, go to the start menu and choose Run.</span></span> <span data-ttu-id="c550a-214">输入`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\aspnet_regsql.exe`到文本框中单击确定。</span><span class="sxs-lookup"><span data-stu-id="c550a-214">Enter `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\aspnet_regsql.exe` into the textbox and click OK.</span></span> <span data-ttu-id="c550a-215">或者，可以使用 Windows 资源管理器深入查看相应的文件夹，双击`aspnet_regsql.exe`文件。</span><span class="sxs-lookup"><span data-stu-id="c550a-215">Alternatively, you can use Windows Explorer to drill down to the appropriate folder and double-click the `aspnet_regsql.exe` file.</span></span> <span data-ttu-id="c550a-216">这两种方法将 net 相同的结果。</span><span class="sxs-lookup"><span data-stu-id="c550a-216">Either approach will net the same results.</span></span>

<span data-ttu-id="c550a-217">运行`aspnet_regsql.exe`工具而无需任何命令行参数启动 ASP.NET SQL Server 安装向导的图形用户界面。</span><span class="sxs-lookup"><span data-stu-id="c550a-217">Running the `aspnet_regsql.exe` tool without any command line arguments launches the ASP.NET SQL Server Setup Wizard graphical user interface.</span></span> <span data-ttu-id="c550a-218">该向导可以轻松地添加或删除指定数据库上的 ASP.NET 应用程序服务。</span><span class="sxs-lookup"><span data-stu-id="c550a-218">The wizard makes it easy to add or remove the ASP.NET application services on a specified database.</span></span> <span data-ttu-id="c550a-219">图 7 中所示向导的第一个屏幕描述了该工具的用途。</span><span class="sxs-lookup"><span data-stu-id="c550a-219">The first screen of the wizard, shown in Figure 7, describes the purpose of the tool.</span></span>


<span data-ttu-id="c550a-220">[![使用 ASP.NET SQL Server 安装程序向导简化添加的成员身份架构](creating-the-membership-schema-in-sql-server-vb/_static/image20.png)](creating-the-membership-schema-in-sql-server-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-220">[![Use the ASP.NET SQL Server Setup Wizard Makes to Add the Membership Schema](creating-the-membership-schema-in-sql-server-vb/_static/image20.png)](creating-the-membership-schema-in-sql-server-vb/_static/image19.png)</span></span>

<span data-ttu-id="c550a-221">**图 7**： 使用 ASP.NET SQL Server 安装程序向导生成要添加的成员身份架构 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-221">**Figure 7**: Use the ASP.NET SQL Server Setup Wizard Makes to Add the Membership Schema ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image21.png))</span></span>


<span data-ttu-id="c550a-222">在向导的第二步询问我们是否要添加的应用程序服务或将其删除。</span><span class="sxs-lookup"><span data-stu-id="c550a-222">The second step in the wizard asks us whether we want to add the application services or remove them.</span></span> <span data-ttu-id="c550a-223">由于我们想要添加表、 视图和存储的过程所需`SqlMembershipProvider`，选择为应用程序服务选项配置 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="c550a-223">Since we want to add the tables, views, and stored procedures necessary for the `SqlMembershipProvider`, choose the Configure SQL Server for application services option.</span></span> <span data-ttu-id="c550a-224">更高版本，如果你想要从数据库中删除此架构，重新运行此向导中，但改为选择从现有的数据库选项的删除应用程序服务信息。</span><span class="sxs-lookup"><span data-stu-id="c550a-224">Later, if you want to remove this schema from your database, re-run this wizard, but instead choose the Remove application services information from an existing database option.</span></span>


<span data-ttu-id="c550a-225">[![选择配置 SQL Server 的应用程序服务选项](creating-the-membership-schema-in-sql-server-vb/_static/image23.png)](creating-the-membership-schema-in-sql-server-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-225">[![Choose the Configure SQL Server for Application Services Option](creating-the-membership-schema-in-sql-server-vb/_static/image23.png)](creating-the-membership-schema-in-sql-server-vb/_static/image22.png)</span></span>

<span data-ttu-id="c550a-226">**图 8**： 为应用程序服务选项中选择配置 SQL Server ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-226">**Figure 8**: Choose the Configure SQL Server for Application Services Option ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image24.png))</span></span>


<span data-ttu-id="c550a-227">第三个步骤将提示输入数据库信息： 服务器名称、 身份验证信息和数据库名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-227">The third step prompts for the database information: the server name, authentication information, and the database name.</span></span> <span data-ttu-id="c550a-228">如果你已根据本教程中，并添加了`SecurityTutorials.mdf`数据库复制到`App_Data`，附加到`localhost\InstanceName`，和它重命名为`SecurityTutorialsDatabase`，然后使用以下值：</span><span class="sxs-lookup"><span data-stu-id="c550a-228">If you have been following along with this tutorial and have added the `SecurityTutorials.mdf` database to `App_Data`, attached it to `localhost\InstanceName`, and renamed it to `SecurityTutorialsDatabase`, then use the following values:</span></span>

- <span data-ttu-id="c550a-229">服务器： `localhost\InstanceName`</span><span class="sxs-lookup"><span data-stu-id="c550a-229">Server: `localhost\InstanceName`</span></span>
- <span data-ttu-id="c550a-230">Windows 身份验证</span><span class="sxs-lookup"><span data-stu-id="c550a-230">Windows authentication</span></span>
- <span data-ttu-id="c550a-231">数据库： `SecurityTutorialsDatabase`</span><span class="sxs-lookup"><span data-stu-id="c550a-231">Database: `SecurityTutorialsDatabase`</span></span>


<span data-ttu-id="c550a-232">[![输入数据库信息](creating-the-membership-schema-in-sql-server-vb/_static/image26.png)](creating-the-membership-schema-in-sql-server-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-232">[![Enter the Database Information](creating-the-membership-schema-in-sql-server-vb/_static/image26.png)](creating-the-membership-schema-in-sql-server-vb/_static/image25.png)</span></span>

<span data-ttu-id="c550a-233">**图 9**： 输入数据库信息 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-233">**Figure 9**: Enter the Database Information ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image27.png))</span></span>


<span data-ttu-id="c550a-234">输入数据库信息后，单击下一步。</span><span class="sxs-lookup"><span data-stu-id="c550a-234">After entering the database information, click Next.</span></span> <span data-ttu-id="c550a-235">最后一个步骤总结了将采取的步骤。</span><span class="sxs-lookup"><span data-stu-id="c550a-235">The final step summarizes the steps that will be taken.</span></span> <span data-ttu-id="c550a-236">单击下一步以安装应用程序服务并在完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="c550a-236">Click Next to install the application services and then Finish to complete the wizard.</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-237">如果您使用 Management Studio 将数据库附加和重命名数据库文件，请确保以分离数据库，然后重新打开 Visual Studio 之前关闭 Management Studio。</span><span class="sxs-lookup"><span data-stu-id="c550a-237">If you used Management Studio to attach the database and rename the database file, be sure to detach the database and close Management Studio before reopening Visual Studio.</span></span> <span data-ttu-id="c550a-238">若要分离`SecurityTutorialsDatabase`数据库，右键单击数据库名称，然后从任务菜单中，选择分离。</span><span class="sxs-lookup"><span data-stu-id="c550a-238">To detach the `SecurityTutorialsDatabase` database, right-click on the database name and, from the Tasks menu, choose Detach.</span></span>

<span data-ttu-id="c550a-239">在向导完成，返回到 Visual Studio 并导航到数据库资源管理器。</span><span class="sxs-lookup"><span data-stu-id="c550a-239">Upon completion of the wizard, return to Visual Studio and navigate to the Database Explorer.</span></span> <span data-ttu-id="c550a-240">展开表文件夹。</span><span class="sxs-lookup"><span data-stu-id="c550a-240">Expand the Tables folder.</span></span> <span data-ttu-id="c550a-241">您应看到其名称以前缀开头的表的一系列`aspnet_`。</span><span class="sxs-lookup"><span data-stu-id="c550a-241">You should see a series of tables whose names start with the prefix `aspnet_`.</span></span> <span data-ttu-id="c550a-242">同样，可以在视图和存储过程文件夹下找到各种视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="c550a-242">Likewise, a variety of views and stored procedures can be found under the Views and Stored Procedures folders.</span></span> <span data-ttu-id="c550a-243">这些数据库对象组成的应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-243">These database objects make up the application services schema.</span></span> <span data-ttu-id="c550a-244">我们将检查在步骤 3 中的成员身份和角色特定数据库对象。</span><span class="sxs-lookup"><span data-stu-id="c550a-244">We will examine the membership- and role-specific database objects in Step 3.</span></span>


<span data-ttu-id="c550a-245">[![各种表、 视图和存储的过程已添加到数据库](creating-the-membership-schema-in-sql-server-vb/_static/image29.png)](creating-the-membership-schema-in-sql-server-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-245">[![A Variety of Tables, Views, and Stored Procedures Have Been Added to the Database](creating-the-membership-schema-in-sql-server-vb/_static/image29.png)](creating-the-membership-schema-in-sql-server-vb/_static/image28.png)</span></span>

<span data-ttu-id="c550a-246">**图 10**: 不同的表、 视图和存储过程已添加到数据库 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-246">**Figure 10**: A Variety of Tables, Views, and Stored Procedures Have Been Added to the Database ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image30.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c550a-247">`aspnet_regsql.exe`工具的图形用户界面安装整个应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-247">The `aspnet_regsql.exe` tool's graphical user interface installs the entire application services schema.</span></span> <span data-ttu-id="c550a-248">但在执行时`aspnet_regsql.exe`可以从命令行中指定特定的应用程序服务组件安装 （或删除）。</span><span class="sxs-lookup"><span data-stu-id="c550a-248">But when executing `aspnet_regsql.exe` from the command-line you can specify what particular application services components to install (or remove).</span></span> <span data-ttu-id="c550a-249">因此，如果你想要添加只是表，视图，并存储所需的过程`SqlMembershipProvider`并`SqlRoleProvider`提供程序，运行`aspnet_regsql.exe`从命令行。</span><span class="sxs-lookup"><span data-stu-id="c550a-249">Therefore, if you want to add just the tables, views, and stored procedures necessary for the `SqlMembershipProvider` and `SqlRoleProvider` providers, run `aspnet_regsql.exe` from the command-line.</span></span> <span data-ttu-id="c550a-250">或者，你可以手动运行相应的 T-SQL 的子集创建由脚本`aspnet_regsql.exe`。</span><span class="sxs-lookup"><span data-stu-id="c550a-250">Alternatively, you can manually run the appropriate subset of T-SQL create scripts used by `aspnet_regsql.exe`.</span></span> <span data-ttu-id="c550a-251">这些脚本位于`WINDIR%\Microsoft.Net\Framework\v2.0.50727\`具有类似名称的文件夹`InstallCommon.sql`， `InstallMembership.sql`， `InstallRoles.sql`， `InstallProfile.sql`， `InstallSqlState.sql`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="c550a-251">These scripts are located in the `WINDIR%\Microsoft.Net\Framework\v2.0.50727\` folder with names like `InstallCommon.sql`, `InstallMembership.sql`, `InstallRoles.sql`, `InstallProfile.sql`, `InstallSqlState.sql`, and so on.</span></span>

<span data-ttu-id="c550a-252">现在我们已创建了所需的数据库对象`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-252">At this point we have created the database objects needed by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-253">但是，我们仍需要指示成员资格框架，它应使用`SqlMembershipProvider`(而不是，说，则`ActiveDirectoryMembershipProvider`)，`SqlMembershipProvider`应使用`SecurityTutorials`数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-253">However, we still need to instruct the Membership framework that it should use the `SqlMembershipProvider` (versus, say, the `ActiveDirectoryMembershipProvider`) and that the `SqlMembershipProvider` should use the `SecurityTutorials` database.</span></span> <span data-ttu-id="c550a-254">我们将介绍如何指定要使用哪些提供程序以及如何自定义在步骤 4 中所选提供程序的设置。</span><span class="sxs-lookup"><span data-stu-id="c550a-254">We'll look at how to specify what provider to use and how to customize the selected provider's settings in Step 4.</span></span> <span data-ttu-id="c550a-255">但首先，让我们更深入地看一下刚刚创建的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="c550a-255">But first, let's take a deeper look at the database objects that were just created.</span></span>

## <a name="step-3-a-look-at-the-schemas-core-tables"></a><span data-ttu-id="c550a-256">步骤 3： 查看架构的核心表</span><span class="sxs-lookup"><span data-stu-id="c550a-256">Step 3: A Look at the Schema's Core Tables</span></span>

<span data-ttu-id="c550a-257">在使用 ASP.NET 应用程序中的成员身份和角色框架，提供程序封装实现详细信息。</span><span class="sxs-lookup"><span data-stu-id="c550a-257">When working with the Membership and Roles frameworks in an ASP.NET application, the implementation details are encapsulated by the provider.</span></span> <span data-ttu-id="c550a-258">将来我们将与之通过.NET Framework 的这些框架的教程`Membership`和`Roles`类。</span><span class="sxs-lookup"><span data-stu-id="c550a-258">In future tutorials we will interface with these frameworks via the .NET Framework's `Membership` and `Roles` classes.</span></span> <span data-ttu-id="c550a-259">使用这些高级 Api 时我们不需要考虑自己的低级别的详细信息，如哪些查询执行或通过修改哪些表`SqlMembershipProvider`和`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-259">When using these high-level APIs we do not need to concern ourselves with the low-level details, like what queries are executed or what tables are modified by the `SqlMembershipProvider` and `SqlRoleProvider`.</span></span>

<span data-ttu-id="c550a-260">鉴于此，我们可以更有信心地使用成员资格和角色框架而无需具有探讨了在步骤 2 中创建的数据库架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-260">Given this, we could confidently use the Membership and Roles frameworks without having explored the database schema created in Step 2.</span></span> <span data-ttu-id="c550a-261">但是，创建用于存储应用程序数据的表时我们可能需要创建向用户或角色相关的实体。</span><span class="sxs-lookup"><span data-stu-id="c550a-261">However, when creating the tables to store application data we may need to create entities that relate to users or roles.</span></span> <span data-ttu-id="c550a-262">它有助于已熟悉`SqlMembershipProvider`和`SqlRoleProvider`架构时建立外键的应用程序数据的表和步骤 2 中创建这些表之间的约束。</span><span class="sxs-lookup"><span data-stu-id="c550a-262">It helps to have a familiarity with the `SqlMembershipProvider` and `SqlRoleProvider` schemas when establishing foreign key constraints between the application data tables and those tables created in Step 2.</span></span> <span data-ttu-id="c550a-263">此外，在某些极少数情况下我们可能需要与用户和角色将存储在数据库级别的直接 (而不是通过`Membership`或`Roles`类)。</span><span class="sxs-lookup"><span data-stu-id="c550a-263">Moreover, in certain rare circumstances we may need to interface with the user and role stores directly at the database level (instead of through the `Membership` or `Roles` classes).</span></span>

### <a name="partitioning-the-user-store-into-applications"></a><span data-ttu-id="c550a-264">分区到应用程序的用户存储</span><span class="sxs-lookup"><span data-stu-id="c550a-264">Partitioning the User Store Into Applications</span></span>

<span data-ttu-id="c550a-265">成员资格和角色框架经过专门设计，以便可以在许多不同的应用程序之间共享单个用户和角色应用商店。</span><span class="sxs-lookup"><span data-stu-id="c550a-265">The Membership and Roles frameworks are designed such that a single user and role store can be shared among many different applications.</span></span> <span data-ttu-id="c550a-266">使用成员资格或角色框架的 ASP.NET 应用程序必须指定要使用哪些应用程序分区。</span><span class="sxs-lookup"><span data-stu-id="c550a-266">An ASP.NET application that uses the Membership or Roles frameworks must specify what application partition to use.</span></span> <span data-ttu-id="c550a-267">简单地说，多个 web 应用程序可以使用相同的用户和角色存储区。</span><span class="sxs-lookup"><span data-stu-id="c550a-267">In short, multiple web applications can use the same user and role stores.</span></span> <span data-ttu-id="c550a-268">图 11 显示了被分区为三个应用程序的用户和角色存储： HRSite、 CustomerSite 和 SalesSite。</span><span class="sxs-lookup"><span data-stu-id="c550a-268">Figure 11 depicts user and role stores that are partitioned into three applications: HRSite, CustomerSite, and SalesSite.</span></span> <span data-ttu-id="c550a-269">以下三个 web 应用程序每个具有其自己的唯一用户和角色，但它们都以物理方式将他们的用户帐户和角色信息存储在同一个数据库表中。</span><span class="sxs-lookup"><span data-stu-id="c550a-269">These three web applications each have their own unique users and roles, yet they all physically store their user account and role information in the same database tables.</span></span>


<span data-ttu-id="c550a-270">[![用户帐户可能跨多个应用程序分区](creating-the-membership-schema-in-sql-server-vb/_static/image32.png)](creating-the-membership-schema-in-sql-server-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c550a-270">[![User Accounts May Be Partitioned Across Multiple Applications](creating-the-membership-schema-in-sql-server-vb/_static/image32.png)](creating-the-membership-schema-in-sql-server-vb/_static/image31.png)</span></span>

<span data-ttu-id="c550a-271">**图 11**： 用户帐户可能会将分区跨多个应用程序 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="c550a-271">**Figure 11**: User Accounts May Be Partitioned Across Multiple Applications ([Click to view full-size image](creating-the-membership-schema-in-sql-server-vb/_static/image33.png))</span></span>


<span data-ttu-id="c550a-272">`aspnet_Applications`表是定义这些分区的内容。</span><span class="sxs-lookup"><span data-stu-id="c550a-272">The `aspnet_Applications` table is what defines these partitions.</span></span> <span data-ttu-id="c550a-273">此表中的行表示每个应用程序使用数据库来存储用户帐户信息。</span><span class="sxs-lookup"><span data-stu-id="c550a-273">Each application that uses the database to store user account information is represented by a row in this table.</span></span> <span data-ttu-id="c550a-274">`aspnet_Applications`表具有四列： `ApplicationId`， `ApplicationName`， `LoweredApplicationName`，和`Description`。`ApplicationId`</span><span class="sxs-lookup"><span data-stu-id="c550a-274">The `aspnet_Applications` table has four columns: `ApplicationId`, `ApplicationName`, `LoweredApplicationName`, and `Description`.`ApplicationId`</span></span> <span data-ttu-id="c550a-275">类型[ `uniqueidentifier` ](https://msdn.microsoft.com/library/ms187942.aspx)是表的主键;`ApplicationName`提供每个应用程序的唯一用户友好名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-275">is of type [`uniqueidentifier`](https://msdn.microsoft.com/library/ms187942.aspx) and is the table's primary key; `ApplicationName` provides a unique human-friendly name for each application.</span></span>

<span data-ttu-id="c550a-276">其他成员身份和角色相关的表链接回`ApplicationId`字段中`aspnet_Applications`。</span><span class="sxs-lookup"><span data-stu-id="c550a-276">The other Membership- and Role-related tables link back to the `ApplicationId` field in `aspnet_Applications`.</span></span> <span data-ttu-id="c550a-277">例如，`aspnet_Users`表，其中包含每个用户帐户记录，具有`ApplicationId`外键字段; 此外，还可以`aspnet_Roles`表。</span><span class="sxs-lookup"><span data-stu-id="c550a-277">For example, the `aspnet_Users` table, which contains a record for each user account, has an `ApplicationId` foreign key field; ditto for the `aspnet_Roles` table.</span></span> <span data-ttu-id="c550a-278">`ApplicationId`这些表中的字段指定的应用程序分区的用户帐户或所属角色。</span><span class="sxs-lookup"><span data-stu-id="c550a-278">The `ApplicationId` field in these tables specifies the application partition the user account or role belongs to.</span></span>

### <a name="storing-user-account-information"></a><span data-ttu-id="c550a-279">存储用户帐户信息</span><span class="sxs-lookup"><span data-stu-id="c550a-279">Storing User Account Information</span></span>

<span data-ttu-id="c550a-280">用户帐户信息存放在两个表：`aspnet_Users`和`aspnet_Membership`。</span><span class="sxs-lookup"><span data-stu-id="c550a-280">User account information is housed in two tables: `aspnet_Users` and `aspnet_Membership`.</span></span> <span data-ttu-id="c550a-281">`aspnet_Users`表包含保存的基本用户帐户信息的字段。</span><span class="sxs-lookup"><span data-stu-id="c550a-281">The `aspnet_Users` table contains fields that hold the essential user account information.</span></span> <span data-ttu-id="c550a-282">最相关的三个列有：</span><span class="sxs-lookup"><span data-stu-id="c550a-282">The three most pertinent columns are:</span></span>

- `UserId`
- `UserName`
- `ApplicationId`

<span data-ttu-id="c550a-283">`UserId` 为主键 (和类型的`uniqueidentifier`)。</span><span class="sxs-lookup"><span data-stu-id="c550a-283">`UserId` is the primary key (and of type `uniqueidentifier`).</span></span> <span data-ttu-id="c550a-284">`UserName` 类型`nvarchar(256)`以及密码，使用户的凭据。</span><span class="sxs-lookup"><span data-stu-id="c550a-284">`UserName` is of type `nvarchar(256)` and, along with the password, makes up the user's credentials.</span></span> <span data-ttu-id="c550a-285">(用户的密码存储在`aspnet_Membership`表。)`ApplicationId`链接到特定应用程序中的用户帐户`aspnet_Applications`。</span><span class="sxs-lookup"><span data-stu-id="c550a-285">(A user's password is stored in the `aspnet_Membership` table.) `ApplicationId` links the user account to a particular application in `aspnet_Applications`.</span></span> <span data-ttu-id="c550a-286">没有复合[`UNIQUE`约束](https://msdn.microsoft.com/library/ms191166.aspx)上`UserName`和`ApplicationId`列。</span><span class="sxs-lookup"><span data-stu-id="c550a-286">There is a composite [`UNIQUE` constraint](https://msdn.microsoft.com/library/ms191166.aspx) on the `UserName` and `ApplicationId` columns.</span></span> <span data-ttu-id="c550a-287">这可确保在给定应用程序中每个用户名是唯一的但它允许对同一`UserName`要在不同的应用程序中使用。</span><span class="sxs-lookup"><span data-stu-id="c550a-287">This ensures that in a given application each UserName is unique, yet it allows for the same `UserName` to be used in different applications.</span></span>

<span data-ttu-id="c550a-288">`aspnet_Membership`表包括其他用户帐户信息，如用户的密码、 电子邮件地址、 上次登录日期和时间，等。</span><span class="sxs-lookup"><span data-stu-id="c550a-288">The `aspnet_Membership` table includes additional user account information, like the user's password, email address, the last login date and time, and so forth.</span></span> <span data-ttu-id="c550a-289">中的记录之间没有一对一的对应关系`aspnet_Users`和`aspnet_Membership`表。</span><span class="sxs-lookup"><span data-stu-id="c550a-289">There is a one-to-one correspondence between records in the `aspnet_Users` and `aspnet_Membership` tables.</span></span> <span data-ttu-id="c550a-290">此关系确保通过`UserId`字段中`aspnet_Membership`，它可作为表的主键。</span><span class="sxs-lookup"><span data-stu-id="c550a-290">This relationship is ensured by the `UserId` field in `aspnet_Membership`, which serves as the table's primary key.</span></span> <span data-ttu-id="c550a-291">像`aspnet_Users`表中，`aspnet_Membership`包括`ApplicationId`会绑定到特定应用程序分区的此信息的字段。</span><span class="sxs-lookup"><span data-stu-id="c550a-291">Like the `aspnet_Users` table, `aspnet_Membership` includes an `ApplicationId` field that ties this information to a particular application partition.</span></span>

### <a name="securing-passwords"></a><span data-ttu-id="c550a-292">保护密码</span><span class="sxs-lookup"><span data-stu-id="c550a-292">Securing Passwords</span></span>

<span data-ttu-id="c550a-293">密码信息存储在`aspnet_Membership`表。</span><span class="sxs-lookup"><span data-stu-id="c550a-293">Password information is stored in the `aspnet_Membership` table.</span></span> <span data-ttu-id="c550a-294">`SqlMembershipProvider`允许密码存储在数据库中使用以下三种方法之一：</span><span class="sxs-lookup"><span data-stu-id="c550a-294">The `SqlMembershipProvider` allows for passwords to be stored in the database using one of the following three techniques:</span></span>

- <span data-ttu-id="c550a-295">**清除**-将密码存储在数据库作为纯文本。</span><span class="sxs-lookup"><span data-stu-id="c550a-295">**Clear** - the password is stored in the database as plain-text.</span></span> <span data-ttu-id="c550a-296">我强烈建议不要使用此选项。</span><span class="sxs-lookup"><span data-stu-id="c550a-296">I strongly discourage using this option.</span></span> <span data-ttu-id="c550a-297">如果数据库被泄露-是由黑客捡后门或心怀不满的员工有权访问数据库的每个单个用户的凭据有用于接管。</span><span class="sxs-lookup"><span data-stu-id="c550a-297">If the database is compromised - be it by a hacker who finds a back door or a disgruntled employee who has database access - every single user's credentials are there for the taking.</span></span>
- <span data-ttu-id="c550a-298">**哈希处理**-密码进行哈希处理使用单向哈希算法和随机生成的 salt 值。</span><span class="sxs-lookup"><span data-stu-id="c550a-298">**Hashed** - passwords are hashed using a one-way hash algorithm and a randomly generated salt value.</span></span> <span data-ttu-id="c550a-299">此哈希的值 （连同 salt) 存储在数据库中。</span><span class="sxs-lookup"><span data-stu-id="c550a-299">This hashed value (along with the salt) is stored in the database.</span></span>
- <span data-ttu-id="c550a-300">**加密**-在数据库中存储密码的加密的版本。</span><span class="sxs-lookup"><span data-stu-id="c550a-300">**Encrypted** - an encrypted version of the password is stored in the database.</span></span>

<span data-ttu-id="c550a-301">使用密码存储方法取决于`SqlMembershipProvider`中指定设置`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="c550a-301">The password storage technique used depends on the `SqlMembershipProvider` settings specified in `Web.config`.</span></span> <span data-ttu-id="c550a-302">我们将查看自定义`SqlMembershipProvider`步骤 4 中的设置。</span><span class="sxs-lookup"><span data-stu-id="c550a-302">We will look at customizing the `SqlMembershipProvider` settings in Step 4.</span></span> <span data-ttu-id="c550a-303">默认行为是密码的存储哈希。</span><span class="sxs-lookup"><span data-stu-id="c550a-303">The default behavior is to store the hash of the password.</span></span>

<span data-ttu-id="c550a-304">负责存储密码的列`Password`， `PasswordFormat`，和`PasswordSalt`。</span><span class="sxs-lookup"><span data-stu-id="c550a-304">The columns responsible for storing the password are `Password`, `PasswordFormat`, and `PasswordSalt`.</span></span> <span data-ttu-id="c550a-305">`PasswordFormat` 是类型的字段`int`其值指示用于存储密码的技术： 清除为 0; 1 表示哈希; 2 表示加密。</span><span class="sxs-lookup"><span data-stu-id="c550a-305">`PasswordFormat` is a field of type `int` whose value indicates the technique used for storing the password: 0 for Clear; 1 for Hashed; 2 for Encrypted.</span></span> <span data-ttu-id="c550a-306">`PasswordSalt` 分配随机生成的字符串而不考虑使用; 的密码存储方法值`PasswordSalt`计算密码的哈希值时，才使用。</span><span class="sxs-lookup"><span data-stu-id="c550a-306">`PasswordSalt` is assigned a randomly generated string regardless of the password storage technique used; the value of `PasswordSalt` is only used when computing the hash of the password.</span></span> <span data-ttu-id="c550a-307">最后，`Password`列包含实际的密码数据，无论是纯文本密码，密码或加密的密码的哈希。</span><span class="sxs-lookup"><span data-stu-id="c550a-307">Finally, the `Password` column contains the actual password data, be it the plain-text password, the hash of the password, or the encrypted password.</span></span>

<span data-ttu-id="c550a-308">表 1 说明了什么这三列可能如下所示的各种存储技术存储密码 MySecret 时 ！</span><span class="sxs-lookup"><span data-stu-id="c550a-308">Table 1 illustrates what these three columns might look like for the various storage techniques when storing the password MySecret!</span></span> <span data-ttu-id="c550a-309">.</span><span class="sxs-lookup"><span data-stu-id="c550a-309">.</span></span>

| <span data-ttu-id="c550a-310">**存储技术&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="c550a-310">**Storage Technique&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="c550a-311">**密码&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="c550a-311">**Password&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="c550a-312">**PasswordFormat&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="c550a-312">**PasswordFormat&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="c550a-313">**PasswordSalt&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="c550a-313">**PasswordSalt&lt;\_o3a\_p /&gt;**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="c550a-314">清除</span><span class="sxs-lookup"><span data-stu-id="c550a-314">Clear</span></span> | <span data-ttu-id="c550a-315">MySecret ！</span><span class="sxs-lookup"><span data-stu-id="c550a-315">MySecret!</span></span> | <span data-ttu-id="c550a-316">0</span><span class="sxs-lookup"><span data-stu-id="c550a-316">0</span></span> | <span data-ttu-id="c550a-317">tTnkPlesqissc2y2SMEygA==</span><span class="sxs-lookup"><span data-stu-id="c550a-317">tTnkPlesqissc2y2SMEygA==</span></span> |
| <span data-ttu-id="c550a-318">哈希处理</span><span class="sxs-lookup"><span data-stu-id="c550a-318">Hashed</span></span> | <span data-ttu-id="c550a-319">2oXm6sZHWbTHFgjgkGQsc2Ec9ZM=</span><span class="sxs-lookup"><span data-stu-id="c550a-319">2oXm6sZHWbTHFgjgkGQsc2Ec9ZM=</span></span> | <span data-ttu-id="c550a-320">1</span><span class="sxs-lookup"><span data-stu-id="c550a-320">1</span></span> | <span data-ttu-id="c550a-321">wFgjUfhdUFOCKQiI61vtiQ==</span><span class="sxs-lookup"><span data-stu-id="c550a-321">wFgjUfhdUFOCKQiI61vtiQ==</span></span> |
| <span data-ttu-id="c550a-322">加密</span><span class="sxs-lookup"><span data-stu-id="c550a-322">Encrypted</span></span> | <span data-ttu-id="c550a-323">62RZgDvhxykkqsMchZ0Yly7HS6onhpaoCYaRxV8g0F4CW56OXUU3e7Inza9j9BKp</span><span class="sxs-lookup"><span data-stu-id="c550a-323">62RZgDvhxykkqsMchZ0Yly7HS6onhpaoCYaRxV8g0F4CW56OXUU3e7Inza9j9BKp</span></span> | <span data-ttu-id="c550a-324">2</span><span class="sxs-lookup"><span data-stu-id="c550a-324">2</span></span> | <span data-ttu-id="c550a-325">LSRzhGS/aa/oqAXGLHJNBw==</span><span class="sxs-lookup"><span data-stu-id="c550a-325">LSRzhGS/aa/oqAXGLHJNBw==</span></span> |

<span data-ttu-id="c550a-326">**表 1**： 存储密码 MySecret 时与密码相关的字段的示例值 ！</span><span class="sxs-lookup"><span data-stu-id="c550a-326">**Table 1**: Example Values for the Password-Related Fields When Storing the Password MySecret!</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-327">特定的加密或通过使用哈希算法`SqlMembershipProvider`中的设置确定`<machineKey>`元素。</span><span class="sxs-lookup"><span data-stu-id="c550a-327">The particular encryption or hashing algorithm used by the `SqlMembershipProvider` is determined by the settings in the `<machineKey>` element.</span></span> <span data-ttu-id="c550a-328">我们讨论了在步骤 3 中的此配置元素<a id="Tutorial3"> </a> [*窗体身份验证配置和高级主题*](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)教程。</span><span class="sxs-lookup"><span data-stu-id="c550a-328">We discussed this configuration element in Step 3 of the <a id="Tutorial3"></a>[*Forms Authentication Configuration and Advanced Topics*](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md) tutorial.</span></span>

### <a name="storing-roles-and-role-associations"></a><span data-ttu-id="c550a-329">存储角色和角色关联</span><span class="sxs-lookup"><span data-stu-id="c550a-329">Storing Roles and Role Associations</span></span>

<span data-ttu-id="c550a-330">角色框架允许开发人员可以定义一组角色，并指定哪些用户属于哪些角色。</span><span class="sxs-lookup"><span data-stu-id="c550a-330">The Roles framework allows developers to define a set of roles and specify what users belong to what roles.</span></span> <span data-ttu-id="c550a-331">通过两个表在数据库中捕获此信息：`aspnet_Roles`和`aspnet_UsersInRoles`。</span><span class="sxs-lookup"><span data-stu-id="c550a-331">This information is captured in the database through two tables: `aspnet_Roles` and `aspnet_UsersInRoles`.</span></span> <span data-ttu-id="c550a-332">在每个记录`aspnet_Roles`表表示为特定应用程序角色。</span><span class="sxs-lookup"><span data-stu-id="c550a-332">Each record in the `aspnet_Roles` table represents a role for a particular application.</span></span> <span data-ttu-id="c550a-333">更喜欢`aspnet_Users`表，`aspnet_Roles`表具有与我们的介绍相关的三列：</span><span class="sxs-lookup"><span data-stu-id="c550a-333">Much like the `aspnet_Users` table, the `aspnet_Roles` table has three columns pertinent to our discussion:</span></span>

- `RoleId`
- `RoleName`
- `ApplicationId`

<span data-ttu-id="c550a-334">`RoleId` 为主键 (和类型的`uniqueidentifier`)。</span><span class="sxs-lookup"><span data-stu-id="c550a-334">`RoleId` is the primary key (and of type `uniqueidentifier`).</span></span> <span data-ttu-id="c550a-335">`RoleName` 的类型为 `nvarchar(256)`。</span><span class="sxs-lookup"><span data-stu-id="c550a-335">`RoleName` is of type `nvarchar(256)`.</span></span> <span data-ttu-id="c550a-336">并`ApplicationId`链接到特定应用程序中的用户帐户`aspnet_Applications`。</span><span class="sxs-lookup"><span data-stu-id="c550a-336">And `ApplicationId` links the user account to a particular application in `aspnet_Applications`.</span></span> <span data-ttu-id="c550a-337">没有复合`UNIQUE`约束`RoleName`和`ApplicationId`确保给定的应用程序中的每个角色名称唯一的列。</span><span class="sxs-lookup"><span data-stu-id="c550a-337">There is a composite `UNIQUE` constraint on the `RoleName` and `ApplicationId` columns, ensuring that in a given application each role name is unique.</span></span>

<span data-ttu-id="c550a-338">`aspnet_UsersInRoles`表可作为用户和角色之间的映射。</span><span class="sxs-lookup"><span data-stu-id="c550a-338">The `aspnet_UsersInRoles` table serves as a mapping between users and roles.</span></span> <span data-ttu-id="c550a-339">只有两个列的`UserId`和`RoleId`-和一起构成复合主键。</span><span class="sxs-lookup"><span data-stu-id="c550a-339">There are only two columns - `UserId` and `RoleId` - and together they make up a composite primary key.</span></span>

## <a name="step-4-specifying-the-provider-and-customizing-its-settings"></a><span data-ttu-id="c550a-340">步骤 4： 指定提供程序和自定义其设置</span><span class="sxs-lookup"><span data-stu-id="c550a-340">Step 4: Specifying the Provider and Customizing Its Settings</span></span>

<span data-ttu-id="c550a-341">所有支持-如的成员身份和角色框架的提供程序模型的框架缺少本身的实现详细信息，并改为该责任委托给提供程序类。</span><span class="sxs-lookup"><span data-stu-id="c550a-341">All of the frameworks that support the provider model - such as the Membership and Roles frameworks - lack implementation details themselves and instead delegate that responsibility to a provider class.</span></span> <span data-ttu-id="c550a-342">在成员资格框架的情况下`Membership`类定义用于管理用户帐户的 API，但它不会直接与任何用户存储区交互。</span><span class="sxs-lookup"><span data-stu-id="c550a-342">In the case of the Membership framework, the `Membership` class defines the API for managing user accounts, but it does not interact directly with any user store.</span></span> <span data-ttu-id="c550a-343">而是`Membership`类的方法移交到配置的提供程序的请求，我们将使用`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-343">Rather, the `Membership` class's methods hand off the request to the configured provider - we will be using the `SqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-344">当我们调用中的方法之一`Membership`类，如何成员资格框架知道委托调用`SqlMembershipProvider`？</span><span class="sxs-lookup"><span data-stu-id="c550a-344">When we invoke one of the methods in the `Membership` class, how does the Membership framework know to delegate the call to the `SqlMembershipProvider`?</span></span>

<span data-ttu-id="c550a-345">`Membership`类具有[`Providers`属性](https://msdn.microsoft.com/library/system.web.security.membership.providers.aspx)通过成员资格框架包含对所有已注册的提供程序类可供使用的引用。</span><span class="sxs-lookup"><span data-stu-id="c550a-345">The `Membership` class has a [`Providers` property](https://msdn.microsoft.com/library/system.web.security.membership.providers.aspx) that contains a reference to all of the registered provider classes available for use by the Membership framework.</span></span> <span data-ttu-id="c550a-346">每个已注册的提供程序具有关联的名称和类型。</span><span class="sxs-lookup"><span data-stu-id="c550a-346">Each registered provider has an associated name and type.</span></span> <span data-ttu-id="c550a-347">名称提供了引用中的特定提供程序的用户友好方法`Providers`集合，而类型标识提供程序类。</span><span class="sxs-lookup"><span data-stu-id="c550a-347">The name offers a human-friendly way to reference a particular provider in the `Providers` collection, while the type identifies the provider class.</span></span> <span data-ttu-id="c550a-348">此外，每个已注册的提供程序可能包括配置设置。</span><span class="sxs-lookup"><span data-stu-id="c550a-348">Moreover, each registered provider may include configuration settings.</span></span> <span data-ttu-id="c550a-349">成员资格框架的配置设置包括`PasswordFormat`和`requiresUniqueEmail`，此外还有许多其他。</span><span class="sxs-lookup"><span data-stu-id="c550a-349">Configuration settings for the Membership framework include `PasswordFormat` and `requiresUniqueEmail`, among many others.</span></span> <span data-ttu-id="c550a-350">使用配置设置的完整列表，请参阅表 2 `SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-350">See Table 2 for a complete list of configuration settings used by the `SqlMembershipProvider`.</span></span>

<span data-ttu-id="c550a-351">`Providers`通过 web 应用程序的配置设置指定属性的内容。</span><span class="sxs-lookup"><span data-stu-id="c550a-351">The `Providers` property's contents are specified through the web application's configuration settings.</span></span> <span data-ttu-id="c550a-352">默认情况下，所有 web 应用程序都具有名为提供程序`AspNetSqlMembershipProvider`类型的`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-352">By default, all web applications have a provider named `AspNetSqlMembershipProvider` of type `SqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-353">此默认成员资格提供程序中注册`machine.config`(位于`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span><span class="sxs-lookup"><span data-stu-id="c550a-353">This default Membership provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-vb/samples/sample1.xml)]

<span data-ttu-id="c550a-354">为所示，标记[`<membership>`元素](https://msdn.microsoft.com/library/1b9hw62f.aspx)定义成员资格框架时的配置设置[`<providers>`子元素](https://msdn.microsoft.com/library/6d4936ht.aspx)指定的已注册提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-354">As the markup above shows, the [`<membership>` element](https://msdn.microsoft.com/library/1b9hw62f.aspx) defines the configuration settings for the Membership framework while the [`<providers>` child element](https://msdn.microsoft.com/library/6d4936ht.aspx) specifies the registered providers.</span></span> <span data-ttu-id="c550a-355">提供程序可能会添加或删除使用[ `<add>` ](https://msdn.microsoft.com/library/whae3t94.aspx)或[ `<remove>` ](https://msdn.microsoft.com/library/aykw9a6d.aspx)元素; 使用[ `<clear>` ](https://msdn.microsoft.com/library/t062y6yc.aspx)要删除所有当前元素注册的提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-355">Providers may be added or removed using the [`<add>`](https://msdn.microsoft.com/library/whae3t94.aspx) or [`<remove>`](https://msdn.microsoft.com/library/aykw9a6d.aspx) elements; use the [`<clear>`](https://msdn.microsoft.com/library/t062y6yc.aspx) element to remove all currently registered providers.</span></span> <span data-ttu-id="c550a-356">为所示，标记`machine.config`添加名为提供程序`AspNetSqlMembershipProvider`类型的`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-356">As the markup above shows, `machine.config` adds a provider named `AspNetSqlMembershipProvider` of type `SqlMembershipProvider`.</span></span>

<span data-ttu-id="c550a-357">除了`name`并`type`属性，`<add>`元素包含定义各种配置设置的值的属性。</span><span class="sxs-lookup"><span data-stu-id="c550a-357">In addition to the `name` and `type` attributes, the `<add>` element contains attributes that define the values for various configuring settings.</span></span> <span data-ttu-id="c550a-358">表 2 列出了可用`SqlMembershipProvider`-特定的配置设置，以及每个的说明。</span><span class="sxs-lookup"><span data-stu-id="c550a-358">Table 2 lists the available `SqlMembershipProvider`-specific configuration settings, along with a description of each.</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-359">在表 2 中记下任何默认值是指中定义的默认值`SqlMembershipProvider`类。</span><span class="sxs-lookup"><span data-stu-id="c550a-359">Any default values noted in Table 2 refer to the default values defined in the `SqlMembershipProvider` class.</span></span> <span data-ttu-id="c550a-360">请注意，并非所有的配置设置中`AspNetSqlMembershipProvider`对应的默认值`SqlMembershipProvider`类。</span><span class="sxs-lookup"><span data-stu-id="c550a-360">Note that not all of the configuration settings in `AspNetSqlMembershipProvider` correspond to the default values of the `SqlMembershipProvider` class.</span></span> <span data-ttu-id="c550a-361">例如，如果未指定成员资格提供程序中`requiresUniqueEmail`将默认值设置为 true。</span><span class="sxs-lookup"><span data-stu-id="c550a-361">For example, if not specified in a Membership provider, the `requiresUniqueEmail` setting defaults to true.</span></span> <span data-ttu-id="c550a-362">但是，`AspNetSqlMembershipProvider`通过显式指定的值将覆盖此默认值`false`。</span><span class="sxs-lookup"><span data-stu-id="c550a-362">However, the `AspNetSqlMembershipProvider` overrides this default value by explicitly specifying a value of `false`.</span></span>

| <span data-ttu-id="c550a-363">**设置&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="c550a-363">**Setting&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="c550a-364">**描述&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="c550a-364">**Description&lt;\_o3a\_p /&gt;**</span></span> |
| --- | --- |
| `ApplicationName` | <span data-ttu-id="c550a-365">回想一下，对于要跨多个应用程序分区的单个用户存储允许成员资格框架。</span><span class="sxs-lookup"><span data-stu-id="c550a-365">Recall that the Membership framework allows for a single user store to be partitioned across multiple applications.</span></span> <span data-ttu-id="c550a-366">此设置指示成员资格提供程序所使用的应用程序分区的名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-366">This setting indicates the name of the application partition used by the Membership provider.</span></span> <span data-ttu-id="c550a-367">如果此值未显式指定，其设置为，在运行时，应用程序的虚拟根路径的值。</span><span class="sxs-lookup"><span data-stu-id="c550a-367">If this value is not explicitly specified, it is set, at runtime, to the value of the application's virtual root path.</span></span> |
| `commandTimeout` | <span data-ttu-id="c550a-368">指定 SQL 命令超时值 （以秒为单位）。</span><span class="sxs-lookup"><span data-stu-id="c550a-368">Specifies the SQL command timeout value (in seconds).</span></span> <span data-ttu-id="c550a-369">默认值为 30。</span><span class="sxs-lookup"><span data-stu-id="c550a-369">The default value is 30.</span></span> |
| `connectionStringName` | <span data-ttu-id="c550a-370">中的连接字符串名称`<connectionStrings>`元素要用于连接到用户存储数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-370">The name of the connection string in the `<connectionStrings>` element to use to connect to the user store database.</span></span> <span data-ttu-id="c550a-371">此值是必需的。</span><span class="sxs-lookup"><span data-stu-id="c550a-371">This value is required.</span></span> |
| `description` | <span data-ttu-id="c550a-372">提供已注册的提供程序的用户友好说明。</span><span class="sxs-lookup"><span data-stu-id="c550a-372">Provides a human-friendly description of the registered provider.</span></span> |
| `enablePasswordRetrieval` | <span data-ttu-id="c550a-373">指定用户是否可以检索他们忘记了的密码。</span><span class="sxs-lookup"><span data-stu-id="c550a-373">Specifies whether users may retrieve their forgotten password.</span></span> <span data-ttu-id="c550a-374">默认值为 `false`。</span><span class="sxs-lookup"><span data-stu-id="c550a-374">The default value is `false`.</span></span> |
| `enablePasswordReset` | <span data-ttu-id="c550a-375">指示是否允许用户重置其密码。</span><span class="sxs-lookup"><span data-stu-id="c550a-375">Indicates whether users are allowed to reset their password.</span></span> <span data-ttu-id="c550a-376">默认为 `true`。</span><span class="sxs-lookup"><span data-stu-id="c550a-376">Defaults to `true`.</span></span> |
| `maxInvalidPasswordAttempts` | <span data-ttu-id="c550a-377">最大可能会发生的、 给定用户在指定期间的失败登录尝试次数`passwordAttemptWindow`用户锁定之前。默认值为 5。</span><span class="sxs-lookup"><span data-stu-id="c550a-377">The maximum number of unsuccessful login attempts that may occur for a given user during the specified `passwordAttemptWindow` before the user is locked out. The default value is 5.</span></span> |
| `minRequiredNonalphanumericCharacters` | <span data-ttu-id="c550a-378">最小非字母数字字符，必须出现在用户的密码数。</span><span class="sxs-lookup"><span data-stu-id="c550a-378">The minimum number of non-alphanumeric characters that must appear in a user's password.</span></span> <span data-ttu-id="c550a-379">此值必须是介于 0 和 128;默认值为 1。</span><span class="sxs-lookup"><span data-stu-id="c550a-379">This value must be between 0 and 128; the default is 1.</span></span> |
| `minRequiredPasswordLength` | <span data-ttu-id="c550a-380">最小密码中所需的字符数。</span><span class="sxs-lookup"><span data-stu-id="c550a-380">The minimum number of characters required in a password.</span></span> <span data-ttu-id="c550a-381">此值必须是介于 0 和 128;默认值为 7。</span><span class="sxs-lookup"><span data-stu-id="c550a-381">This value must be between 0 and 128; the default is 7.</span></span> |
| `name` | <span data-ttu-id="c550a-382">已注册的提供程序的名称。</span><span class="sxs-lookup"><span data-stu-id="c550a-382">The name of the registered provider.</span></span> <span data-ttu-id="c550a-383">此值是必需的。</span><span class="sxs-lookup"><span data-stu-id="c550a-383">This value is required.</span></span> |
| `passwordAttemptWindow` | <span data-ttu-id="c550a-384">在此期间的分钟数失败的登录尝试次数进行跟踪。</span><span class="sxs-lookup"><span data-stu-id="c550a-384">The number of minutes during which failed login attempts are tracked.</span></span> <span data-ttu-id="c550a-385">如果一个用户提供登录凭据无效`maxInvalidPasswordAttempts`内，这指定窗口，在被阻止。默认值为 10。</span><span class="sxs-lookup"><span data-stu-id="c550a-385">If a user supplies invalid login credentials `maxInvalidPasswordAttempts` times within this specified window, they are locked out. The default value is 10.</span></span> |
| `PasswordFormat` | <span data-ttu-id="c550a-386">密码存储格式： `Clear`， `Hashed`，或`Encrypted`。</span><span class="sxs-lookup"><span data-stu-id="c550a-386">The password storage format: `Clear`, `Hashed`, or `Encrypted`.</span></span> <span data-ttu-id="c550a-387">默认值为 `Hashed`。</span><span class="sxs-lookup"><span data-stu-id="c550a-387">The default is `Hashed`.</span></span> |
| `passwordStrengthRegularExpression` | <span data-ttu-id="c550a-388">如果提供，此正则表达式用于评估的强度的用户的所选密码创建新帐户时或在更改其密码。</span><span class="sxs-lookup"><span data-stu-id="c550a-388">If provided, this regular expression is used to evaluate the strength of the user's selected password when creating a new account or when changing their password.</span></span> <span data-ttu-id="c550a-389">默认值为一个空字符串。</span><span class="sxs-lookup"><span data-stu-id="c550a-389">The default value is an empty string.</span></span> |
| `requiresQuestionAndAnswer` | <span data-ttu-id="c550a-390">指定用户是否必须回答其安全问题时检索或重置其密码。</span><span class="sxs-lookup"><span data-stu-id="c550a-390">Specifies whether a user must answer his security question when retrieving or resetting his password.</span></span> <span data-ttu-id="c550a-391">默认值为 `true`。</span><span class="sxs-lookup"><span data-stu-id="c550a-391">The default value is `true`.</span></span> |
| `requiresUniqueEmail` | <span data-ttu-id="c550a-392">指示是否在给定的应用程序分区中的所有用户帐户必须都具有唯一的电子邮件地址。</span><span class="sxs-lookup"><span data-stu-id="c550a-392">Indicates whether all user accounts in a given application partition must have a unique email address.</span></span> <span data-ttu-id="c550a-393">默认值为 `true`。</span><span class="sxs-lookup"><span data-stu-id="c550a-393">The default value is `true`.</span></span> |
| `type` | <span data-ttu-id="c550a-394">指定的提供程序类型。</span><span class="sxs-lookup"><span data-stu-id="c550a-394">Specifies the type of the provider.</span></span> <span data-ttu-id="c550a-395">此值是必需的。</span><span class="sxs-lookup"><span data-stu-id="c550a-395">This value is required.</span></span> |

<span data-ttu-id="c550a-396">**表 2**： 成员身份和`SqlMembershipProvider`配置设置</span><span class="sxs-lookup"><span data-stu-id="c550a-396">**Table 2**: Membership and `SqlMembershipProvider` Configuration Settings</span></span>

<span data-ttu-id="c550a-397">除了`AspNetSqlMembershipProvider`，其他成员资格提供程序可能通过将添加到类似标记注册应用程序的应用程序基础上`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="c550a-397">In addition to `AspNetSqlMembershipProvider`, other Membership providers may be registered on an application-by-application basis by adding similar markup to the `Web.config` file.</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-398">角色框架在很大程度相同的方式工作原理： 没有中默认已注册的角色提供程序`machine.config`注册的提供程序可以在应用程序的应用程序的基础上自定义和`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="c550a-398">The Roles framework works in much the same way: there is a default registered role provider in `machine.config` and the registered providers may be customized on an application-by-application basis in `Web.config`.</span></span> <span data-ttu-id="c550a-399">在将来的教程中，我们将检查角色框架和详细信息在其配置标记。</span><span class="sxs-lookup"><span data-stu-id="c550a-399">We will examine the Roles framework and its configuration markup in detail in a future tutorial.</span></span>

### <a name="customizing-thesqlmembershipprovidersettings"></a><span data-ttu-id="c550a-400">自定义`SqlMembershipProvider`设置</span><span class="sxs-lookup"><span data-stu-id="c550a-400">Customizing the`SqlMembershipProvider`Settings</span></span>

<span data-ttu-id="c550a-401">默认值`SqlMembershipProvider`(`AspNetSqlMembershipProvider`) 具有其`connectionStringName`属性设置为`LocalSqlServer`。</span><span class="sxs-lookup"><span data-stu-id="c550a-401">The default `SqlMembershipProvider` (`AspNetSqlMembershipProvider`) has its `connectionStringName` attribute set to `LocalSqlServer`.</span></span> <span data-ttu-id="c550a-402">像`AspNetSqlMembershipProvider`提供程序、 连接字符串名称`LocalSqlServer`中定义`machine.config`。</span><span class="sxs-lookup"><span data-stu-id="c550a-402">Like the `AspNetSqlMembershipProvider` provider, the connection string name `LocalSqlServer` is defined in `machine.config`.</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-vb/samples/sample2.xml)]

<span data-ttu-id="c550a-403">如您所见，此连接字符串定义的数据库位于 SQL 2005 Express Edition |DataDirectory|aspnetdb.mdf。</span><span class="sxs-lookup"><span data-stu-id="c550a-403">As you can see, this connection string defines a SQL 2005 Express Edition database located at |DataDirectory|aspnetdb.mdf.</span></span> <span data-ttu-id="c550a-404">字符串 |DataDirectory |在运行时以指向转换`~/App_Data/`目录中，因此数据库路径 |转换为 DataDirectory|aspnetdb.mdf `~/App_Data` / `aspnet.mdf`。</span><span class="sxs-lookup"><span data-stu-id="c550a-404">The string |DataDirectory| is translated at runtime to point to the `~/App_Data/` directory, so the database path |DataDirectory|aspnetdb.mdf translates to `~/App_Data`/`aspnet.mdf`.</span></span>

<span data-ttu-id="c550a-405">如果我们未指定成员资格提供程序的任何信息在应用程序中的`Web.config`文件，该应用程序使用已注册的默认成员资格提供程序， `AspNetSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-405">If we did not specify any Membership provider information in our application's `Web.config` file, the application uses the default registered Membership provider, `AspNetSqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-406">如果`~/App_Data/aspnet.mdf`数据库不存在，ASP.NET 运行时将自动创建并添加应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="c550a-406">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="c550a-407">但是，我们不想要使用`aspnet.mdf`数据库; 而是，我们想要使用`SecurityTutorials.mdf`我们在步骤 2 中创建的数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-407">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database we created in Step 2.</span></span> <span data-ttu-id="c550a-408">此修改可以在两种方式之一完成：</span><span class="sxs-lookup"><span data-stu-id="c550a-408">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="c550a-409"><strong>为指定值</strong><strong>`LocalSqlServer`</strong><strong>中的连接字符串名称</strong><strong>`Web.config`</strong><strong>。</strong></span><span class="sxs-lookup"><span data-stu-id="c550a-409"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="c550a-410">通过覆盖`LocalSqlServer`中的连接字符串名称值`Web.config`，我们可以使用已注册的默认成员资格提供程序 (`AspNetSqlMembershipProvider`)，并将其正确处理`SecurityTutorials.mdf`数据库。</span><span class="sxs-lookup"><span data-stu-id="c550a-410">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Membership provider (`AspNetSqlMembershipProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="c550a-411">此方法很合适内容与指定的配置设置如果`AspNetSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-411">This approach is fine if you are content with the configuration settings specified by `AspNetSqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-412">有关此技术的详细信息，请参阅[Scott Guthrie](https://weblogs.asp.net/scottgu/)的博客文章[配置为使用 SQL Server 2000 或 SQL Server 2005 ASP.NET 2.0 应用程序服务](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c550a-412">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="c550a-413"><strong>添加新注册的提供程序类型</strong><strong>`SqlMembershipProvider`</strong><strong>并配置其</strong><strong>`connectionStringName`</strong><strong>设置以指向</strong><strong>`SecurityTutorials.mdf`</strong><strong>数据库。</strong></span><span class="sxs-lookup"><span data-stu-id="c550a-413"><strong>Add a new registered provider of type</strong><strong>`SqlMembershipProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="c550a-414">这种方法是在想要自定义其他数据库连接字符串属性的配置属性的情况下很有用。</span><span class="sxs-lookup"><span data-stu-id="c550a-414">This approach is useful in scenarios where you want to customize other configuration properties in addition to the database connection string.</span></span> <span data-ttu-id="c550a-415">在我自己的项目中我一直使用此方法由于其灵活性和可读性。</span><span class="sxs-lookup"><span data-stu-id="c550a-415">In my own projects I always use this approach because of its flexibility and readability.</span></span>

<span data-ttu-id="c550a-416">我们可以添加新的已注册提供程序的引用之前`SecurityTutorials.mdf`数据库中，我们首先需要将适当的连接字符串值中添加`<connectionStrings>`主题中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="c550a-416">Before we can add a new registered provider that references the `SecurityTutorials.mdf` database, we first need to add an appropriate connection string value in the `<connectionStrings>` section in `Web.config`.</span></span> <span data-ttu-id="c550a-417">以下标记添加一个名为的新连接字符串`SecurityTutorialsConnectionString`引用 SQL Server 2005 Express Edition`SecurityTutorials.mdf`数据库中`App_Data`文件夹。</span><span class="sxs-lookup"><span data-stu-id="c550a-417">The following markup adds a new connection string named `SecurityTutorialsConnectionString` that references the SQL Server 2005 Express Edition `SecurityTutorials.mdf` database in the `App_Data` folder.</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-vb/samples/sample3.xml)]

> [!NOTE]
> <span data-ttu-id="c550a-418">如果使用另一个数据库文件，请根据需要更新连接字符串。</span><span class="sxs-lookup"><span data-stu-id="c550a-418">If you are using an alternate database file, update the connection string as needed.</span></span> <span data-ttu-id="c550a-419">有关构成正确的连接字符串的详细信息，请参阅[ConnectionStrings.com](http://www.connectionstrings.com/)。</span><span class="sxs-lookup"><span data-stu-id="c550a-419">For more information on forming the correct connection string, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>

<span data-ttu-id="c550a-420">接下来，添加到以下的成员身份配置标记`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="c550a-420">Next, add the following Membership configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="c550a-421">此标记注册新的提供程序名为`SecurityTutorialsSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-421">This markup registers a new provider named `SecurityTutorialsSqlMembershipProvider`.</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-vb/samples/sample4.xml)]

<span data-ttu-id="c550a-422">除了注册`SecurityTutorialsSqlMembershipProvider`提供程序，上面的标记定义`SecurityTutorialsSqlMembershipProvider`作为默认提供程序 (通过`defaultProvider`属性中`<membership>`元素)。</span><span class="sxs-lookup"><span data-stu-id="c550a-422">In addition to registering the `SecurityTutorialsSqlMembershipProvider` provider, the above markup defines the `SecurityTutorialsSqlMembershipProvider` as the default provider (via the `defaultProvider` attribute in the `<membership>` element).</span></span> <span data-ttu-id="c550a-423">回想一下，成员资格框架可以有多个已注册的提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-423">Recall that the Membership framework can have multiple registered providers.</span></span> <span data-ttu-id="c550a-424">由于`AspNetSqlMembershipProvider`注册中的第一个提供程序为`machine.config`，除非我们指示，否则用作默认提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-424">Since `AspNetSqlMembershipProvider` is registered as the first provider in `machine.config`, it serves as the default provider unless we indicate otherwise.</span></span>

<span data-ttu-id="c550a-425">目前，我们的应用程序具有两个已注册的提供程序：`AspNetSqlMembershipProvider`和`SecurityTutorialsSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-425">Currently, our application has two registered providers: `AspNetSqlMembershipProvider` and `SecurityTutorialsSqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-426">但是，在注册之前`SecurityTutorialsSqlMembershipProvider`我们可能已清除所有以前的提供程序通过添加已注册提供程序[`<clear />`元素](https://msdn.microsoft.com/library/t062y6yc.aspx)之前我们`<add>`元素。</span><span class="sxs-lookup"><span data-stu-id="c550a-426">However, before registering the `SecurityTutorialsSqlMembershipProvider` provider we could have cleared out all previously registered providers by adding a [`<clear />` element](https://msdn.microsoft.com/library/t062y6yc.aspx) immediately before our `<add>` element.</span></span> <span data-ttu-id="c550a-427">这将清除`AspNetSqlMembershipProvider`从列表中注册的提供程序，这意味着`SecurityTutorialsSqlMembershipProvider`是唯一的已注册的成员身份提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-427">This would clear out the `AspNetSqlMembershipProvider` from the list of registered providers, meaning that the `SecurityTutorialsSqlMembershipProvider` would be the only registered Membership provider.</span></span> <span data-ttu-id="c550a-428">如果我们使用这种方法，那么我们不需要将标记`SecurityTutorialsSqlMembershipProvider`作为默认的提供程序，因为它会仅已注册的成员资格提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-428">If we used this approach, then we would not need to mark the `SecurityTutorialsSqlMembershipProvider` as the default provider, since it would be the only registered Membership provider.</span></span> <span data-ttu-id="c550a-429">有关使用的详细信息`<clear />`，请参阅[Using`<clear />`时将添加提供程序](https://weblogs.asp.net/scottgu/archive/2006/11/20/common-gotcha-don-t-forget-to-clear-when-adding-providers.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c550a-429">For more information on using `<clear />`, see [Using `<clear />` When Adding providers](https://weblogs.asp.net/scottgu/archive/2006/11/20/common-gotcha-don-t-forget-to-clear-when-adding-providers.aspx).</span></span>

<span data-ttu-id="c550a-430">请注意，`SecurityTutorialsSqlMembershipProvider`的`connectionStringName`设置刚添加的引用`SecurityTutorialsConnectionString`连接字符串名称，并且其`applicationName`设置已被设置为 SecurityTutorials 的值。</span><span class="sxs-lookup"><span data-stu-id="c550a-430">Note that the `SecurityTutorialsSqlMembershipProvider`'s `connectionStringName` setting references the just-added `SecurityTutorialsConnectionString` connection string name, and that its `applicationName` setting has been set to a value of SecurityTutorials.</span></span> <span data-ttu-id="c550a-431">此外，`requiresUniqueEmail`设置已设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="c550a-431">Additionally, the `requiresUniqueEmail` setting has been set to `true`.</span></span> <span data-ttu-id="c550a-432">所有其他配置选项中的值相等`AspNetSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c550a-432">All other configuration options are identical to the values in `AspNetSqlMembershipProvider`.</span></span> <span data-ttu-id="c550a-433">随意进行任何配置修改在这里，如果您想。</span><span class="sxs-lookup"><span data-stu-id="c550a-433">Feel free to make any configuration modifications here, if you wish.</span></span> <span data-ttu-id="c550a-434">例如，通过要求两个非字母数字字符，而不是一个，或通过增加到八个字符，而不是七个存储帐户的密码长度无法拧紧密码强度。</span><span class="sxs-lookup"><span data-stu-id="c550a-434">For example, you could tighten the password strength by requiring two non-alphanumeric characters instead of one, or by increasing the password length to eight characters instead of seven.</span></span>

> [!NOTE]
> <span data-ttu-id="c550a-435">回想一下，对于要跨多个应用程序分区的单个用户存储允许成员资格框架。</span><span class="sxs-lookup"><span data-stu-id="c550a-435">Recall that the Membership framework allows for a single user store to be partitioned across multiple applications.</span></span> <span data-ttu-id="c550a-436">成员资格提供程序的`applicationName`设置指示提供程序使用时如何使用用户存储区的应用程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-436">The Membership provider's `applicationName` setting indicates what application the provider uses when working with the user store.</span></span> <span data-ttu-id="c550a-437">你显式设置的值很重要`applicationName`配置设置，因为如果`applicationName`未显式设置，它分配给在运行时的 web 应用程序的虚拟根路径。</span><span class="sxs-lookup"><span data-stu-id="c550a-437">It is important that you explicitly set a value for the `applicationName` configuration setting because if the `applicationName` is not explicitly set, it is assigned to the web application's virtual root path at runtime.</span></span> <span data-ttu-id="c550a-438">可良好运行，只要应用程序的虚拟根路径不会更改，但是，如果将移到不同的路径，该应用程序`applicationName`设置也将更改。</span><span class="sxs-lookup"><span data-stu-id="c550a-438">This works fine as long as the application's virtual root path doesn't change, but if you move the application to a different path, the `applicationName` setting will change too.</span></span> <span data-ttu-id="c550a-439">在此情况下，成员资格提供程序将开始使用不同的应用程序分区，比以前使用过。</span><span class="sxs-lookup"><span data-stu-id="c550a-439">When this happens, the Membership provider will start working with a different application partition than was previously used.</span></span> <span data-ttu-id="c550a-440">在移动之前创建的用户帐户将位于不同的应用程序分区和这些用户将不再能够登录到网站。</span><span class="sxs-lookup"><span data-stu-id="c550a-440">User accounts created prior to the move will reside in a different application partition and those users will no longer be able to log into the site.</span></span> <span data-ttu-id="c550a-441">有关此问题的更深入讨论，请参阅[始终设置`applicationName`属性时配置 ASP.NET 2.0 成员身份和其他提供商](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="c550a-441">For a more in-depth discussion on this matter, see [Always Set the `applicationName` Property When Configuring ASP.NET 2.0 Membership and Other providers](https://weblogs.asp.net/scottgu/443634).</span></span>

## <a name="summary"></a><span data-ttu-id="c550a-442">总结</span><span class="sxs-lookup"><span data-stu-id="c550a-442">Summary</span></span>

<span data-ttu-id="c550a-443">现在我们有具有配置的应用程序服务的数据库 (`SecurityTutorials.mdf`) 和已配置的 web 应用程序，以便成员资格框架使用`SecurityTutorialsSqlMembershipProvider`我们刚注册的提供程序。</span><span class="sxs-lookup"><span data-stu-id="c550a-443">At this point we have a database with the configured application services (`SecurityTutorials.mdf`) and have configured our web application so that the Membership framework uses the `SecurityTutorialsSqlMembershipProvider` provider we just registered.</span></span> <span data-ttu-id="c550a-444">此注册的提供程序属于类型`SqlMembershipProvider`并具有其`connectionStringName`设置为适当的连接字符串 (`SecurityTutorialsConnectionString`) 并将其`applicationName`值显式设置。</span><span class="sxs-lookup"><span data-stu-id="c550a-444">This registered provider is of type `SqlMembershipProvider` and has its `connectionStringName` set to the appropriate connection string (`SecurityTutorialsConnectionString`) and its `applicationName` value explicitly set.</span></span>

<span data-ttu-id="c550a-445">现在我们就可以使用我们的应用程序的成员资格框架。</span><span class="sxs-lookup"><span data-stu-id="c550a-445">We are now ready to use the Membership framework from our application.</span></span> <span data-ttu-id="c550a-446">在下一教程中，我们将说明如何创建新的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="c550a-446">In the next tutorial we will examine how to create new user accounts.</span></span> <span data-ttu-id="c550a-447">之后，我们将探索用户，执行基于用户的授权，并将与用户相关的其他信息存储在数据库中进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="c550a-447">Following that we will explore authenticating users, performing user-based authorization, and storing additional user-related information in the database.</span></span>

<span data-ttu-id="c550a-448">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="c550a-448">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c550a-449">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="c550a-449">Further Reading</span></span>

<span data-ttu-id="c550a-450">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="c550a-450">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c550a-451">始终设置`applicationName`属性时配置 ASP.NET 2.0 成员身份和其他提供程序</span><span class="sxs-lookup"><span data-stu-id="c550a-451">Always Set the `applicationName` Property When Configuring ASP.NET 2.0 Membership and Other providers</span></span>](https://weblogs.asp.net/scottgu/443634)
- [<span data-ttu-id="c550a-452">ASP.NET 2.0 应用程序服务配置为使用 SQL Server 2000 或 SQL Server 2005</span><span class="sxs-lookup"><span data-stu-id="c550a-452">Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005</span></span>](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)
- [<span data-ttu-id="c550a-453">下载 SQL Server Management Studio Express Edition</span><span class="sxs-lookup"><span data-stu-id="c550a-453">Download SQL Server Management Studio Express Edition</span></span>](https://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&amp;displaylang=en)
- [<span data-ttu-id="c550a-454">检查 ASP.NET 2.0 s 成员资格、 角色和配置文件</span><span class="sxs-lookup"><span data-stu-id="c550a-454">Examining ASP.NET 2.0�s Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="c550a-455">`<add>` Membership 的 providers 的元素</span><span class="sxs-lookup"><span data-stu-id="c550a-455">The `<add>` Element for providers for Membership</span></span>](https://msdn.microsoft.com/library/whae3t94.aspx)
- [<span data-ttu-id="c550a-456">`<membership>`元素</span><span class="sxs-lookup"><span data-stu-id="c550a-456">The `<membership>` Element</span></span>](https://msdn.microsoft.com/library/1b9hw62f.aspx)
- [<span data-ttu-id="c550a-457">`<providers>`元素的成员身份</span><span class="sxs-lookup"><span data-stu-id="c550a-457">The `<providers>` Element for Membership</span></span>](https://msdn.microsoft.com/library/6d4936ht.aspx)
- [<span data-ttu-id="c550a-458">使用`<clear />`时添加提供程序</span><span class="sxs-lookup"><span data-stu-id="c550a-458">Using `<clear />` When Adding providers</span></span>](https://weblogs.asp.net/scottgu/archive/2006/11/20/common-gotcha-don-t-forget-to-clear-when-adding-providers.aspx)
- [<span data-ttu-id="c550a-459">直接使用 `SqlMembershipProvider`</span><span class="sxs-lookup"><span data-stu-id="c550a-459">Working Directly with the `SqlMembershipProvider`</span></span>](http://aspnet.4guysfromrolla.com/articles/091207-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="c550a-460">在本教程中包含的主题的视频培训</span><span class="sxs-lookup"><span data-stu-id="c550a-460">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="c550a-461">了解 ASP.NET 成员身份</span><span class="sxs-lookup"><span data-stu-id="c550a-461">Understanding ASP.NET Memberships</span></span>](../../../videos/authentication/understanding-aspnet-memberships.md)
- [<span data-ttu-id="c550a-462">配置 SQL 以使用成员身份架构</span><span class="sxs-lookup"><span data-stu-id="c550a-462">Configuring SQL To Work with Membership Schemas</span></span>](../../../videos/authentication/configuring-sql-to-work-with-membership-schemas.md)
- [<span data-ttu-id="c550a-463">更改默认成员身份架构中的成员身份设置</span><span class="sxs-lookup"><span data-stu-id="c550a-463">Changing Membership Settings in the Default Membership Schema</span></span>](../../../videos/authentication/changing-membership-settings-in-the-default-membership-schema.md)

### <a name="about-the-author"></a><span data-ttu-id="c550a-464">关于作者</span><span class="sxs-lookup"><span data-stu-id="c550a-464">About the Author</span></span>

<span data-ttu-id="c550a-465">自 1998 年以来，Scott Mitchell，多部 asp/ASP.NET 书籍的作者及 4GuysFromRolla.com 的已从事 Microsoft Web 技术工作。</span><span class="sxs-lookup"><span data-stu-id="c550a-465">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c550a-466">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="c550a-466">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c550a-467">他最新著作是 *[Sams Teach 自己 ASP.NET 2.0 24 小时内](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="c550a-467">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c550a-468">可以在达到 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或通过他的博客[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="c550a-468">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c550a-469">特别感谢</span><span class="sxs-lookup"><span data-stu-id="c550a-469">Special Thanks To</span></span>

<span data-ttu-id="c550a-470">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="c550a-470">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c550a-471">本教程中的潜在顾客审阅者已 Alicja Maziarz。</span><span class="sxs-lookup"><span data-stu-id="c550a-471">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="c550a-472">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="c550a-472">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c550a-473">如果是这样，给我在行[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com)。</span><span class="sxs-lookup"><span data-stu-id="c550a-473">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c550a-474">[上一页](storing-additional-user-information-cs.md)
> [下一页](creating-user-accounts-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c550a-474">[Previous](storing-additional-user-information-cs.md)
[Next](creating-user-accounts-vb.md)</span></span>
