---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
title: Getting Started with Entity Framework 4.0 数据库和 ASP.NET 4 Web 窗体-第 3 部分 |Microsoft Docs
author: tdykstra
description: Contoso 大学示例 web 应用程序演示如何创建使用实体框架的 ASP.NET Web 窗体应用程序。 示例应用程序是...
ms.author: aspnetcontent
ms.date: 12/03/2010
ms.assetid: ccdc3f8c-2568-40a7-8f8b-3c23d2e05388
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
msc.type: authoredcontent
ms.openlocfilehash: fb06176ef195ea5523a66baa938ed5076e0ebe9d
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/05/2018
ms.locfileid: "37802362"
---
<a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-3"></a><span data-ttu-id="36e7c-104">Getting Started with Entity Framework 4.0 数据库和 ASP.NET 4 Web 窗体-第 3 部分</span><span class="sxs-lookup"><span data-stu-id="36e7c-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 3</span></span>
====================
<span data-ttu-id="36e7c-105">通过[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="36e7c-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="36e7c-106">Contoso 大学示例 web 应用程序演示如何创建使用 Entity Framework 4.0 和 Visual Studio 2010 的 ASP.NET Web 窗体应用程序。</span><span class="sxs-lookup"><span data-stu-id="36e7c-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="36e7c-107">有关教程系列的信息，请参阅[系列中的第一个教程](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="36e7c-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="filtering-ordering-and-grouping-data"></a><span data-ttu-id="36e7c-108">筛选、 排序和分组数据</span><span class="sxs-lookup"><span data-stu-id="36e7c-108">Filtering, Ordering, and Grouping Data</span></span>

<span data-ttu-id="36e7c-109">在上一教程使用了`EntityDataSource`控件来显示和编辑数据。</span><span class="sxs-lookup"><span data-stu-id="36e7c-109">In the previous tutorial you used the `EntityDataSource` control to display and edit data.</span></span> <span data-ttu-id="36e7c-110">在本教程中将筛选、 排序和分组数据。</span><span class="sxs-lookup"><span data-stu-id="36e7c-110">In this tutorial you'll filter, order, and group data.</span></span> <span data-ttu-id="36e7c-111">执行此操作时通过设置属性的`EntityDataSource`控件，语法是不同于其他数据源控件。</span><span class="sxs-lookup"><span data-stu-id="36e7c-111">When you do this by setting properties of the `EntityDataSource` control, the syntax is different from other data source controls.</span></span> <span data-ttu-id="36e7c-112">正如您将看到的但是，您可以使用`QueryExtender`控件以最大程度减少这些差异。</span><span class="sxs-lookup"><span data-stu-id="36e7c-112">As you'll see, however, you can use the `QueryExtender` control to minimize these differences.</span></span>

<span data-ttu-id="36e7c-113">将更改*Students.aspx*页后，可以筛选学生，按名称排序，并对名称的搜索。</span><span class="sxs-lookup"><span data-stu-id="36e7c-113">You'll change the *Students.aspx* page to filter for students, sort by name, and search on name.</span></span> <span data-ttu-id="36e7c-114">此外将更改*Courses.aspx*页后，可以按名称显示为所选的部门和搜索课程的课程。</span><span class="sxs-lookup"><span data-stu-id="36e7c-114">You'll also change the *Courses.aspx* page to display courses for the selected department and search for courses by name.</span></span> <span data-ttu-id="36e7c-115">最后，将添加到学生统计信息*About.aspx*页。</span><span class="sxs-lookup"><span data-stu-id="36e7c-115">Finally, you'll add student statistics to the *About.aspx* page.</span></span>

<span data-ttu-id="36e7c-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span></span>

<span data-ttu-id="36e7c-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span></span>

<span data-ttu-id="36e7c-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span></span>

<span data-ttu-id="36e7c-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span></span>

## <a name="using-the-entitydatasource-where-property-to-filter-data"></a><span data-ttu-id="36e7c-120">使用 EntityDataSource"Where"属性来筛选数据</span><span class="sxs-lookup"><span data-stu-id="36e7c-120">Using the EntityDataSource "Where" Property to Filter Data</span></span>

<span data-ttu-id="36e7c-121">打开*Students.aspx*在上一教程中创建的页。</span><span class="sxs-lookup"><span data-stu-id="36e7c-121">Open the *Students.aspx* page that you created in the previous tutorial.</span></span> <span data-ttu-id="36e7c-122">按当前配置，`GridView`页中的控件显示来自所有名称`People`实体集。</span><span class="sxs-lookup"><span data-stu-id="36e7c-122">As currently configured, the `GridView` control in the page displays all the names from the `People` entity set.</span></span> <span data-ttu-id="36e7c-123">但是，你想要显示仅学生，你可以通过选择查找`Person`具有非 null 注册日期实体。</span><span class="sxs-lookup"><span data-stu-id="36e7c-123">However, you want to show only students, which you can find by selecting `Person` entities that have non-null enrollment dates.</span></span>

<span data-ttu-id="36e7c-124">切换到**设计**查看和选择`EntityDataSource`控件。</span><span class="sxs-lookup"><span data-stu-id="36e7c-124">Switch to **Design** view and select the `EntityDataSource` control.</span></span> <span data-ttu-id="36e7c-125">在中**属性**窗口中，将`Where`属性设置为`it.EnrollmentDate is not null`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-125">In the **Properties** window, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>

<span data-ttu-id="36e7c-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span></span>

<span data-ttu-id="36e7c-127">在中使用的语法`Where`属性的`EntityDataSource`控件是 Entity SQL。</span><span class="sxs-lookup"><span data-stu-id="36e7c-127">The syntax you use in the `Where` property of the `EntityDataSource` control is Entity SQL.</span></span> <span data-ttu-id="36e7c-128">Entity SQL 是类似于 TRANSACT-SQL，但与实体而不是数据库对象一起使用了自定义。</span><span class="sxs-lookup"><span data-stu-id="36e7c-128">Entity SQL is similar to Transact-SQL, but it's customized for use with entities rather than database objects.</span></span> <span data-ttu-id="36e7c-129">在表达式中`it.EnrollmentDate is not null`，word`it`表示查询所返回的实体的引用。</span><span class="sxs-lookup"><span data-stu-id="36e7c-129">In the expression `it.EnrollmentDate is not null`, the word `it` represents a reference to the entity returned by the query.</span></span> <span data-ttu-id="36e7c-130">因此，`it.EnrollmentDate`是指`EnrollmentDate`的属性`Person`实体的`EntityDataSource`控制返回。</span><span class="sxs-lookup"><span data-stu-id="36e7c-130">Therefore, `it.EnrollmentDate` refers to the `EnrollmentDate` property of the `Person` entity that the `EntityDataSource` control returns.</span></span>

<span data-ttu-id="36e7c-131">运行页。</span><span class="sxs-lookup"><span data-stu-id="36e7c-131">Run the page.</span></span> <span data-ttu-id="36e7c-132">学生列表现在包含仅学生。</span><span class="sxs-lookup"><span data-stu-id="36e7c-132">The students list now contains only students.</span></span> <span data-ttu-id="36e7c-133">(没有任何行，其中显示没有注册日期。)</span><span class="sxs-lookup"><span data-stu-id="36e7c-133">(There are no rows displayed where there's no enrollment date.)</span></span>

<span data-ttu-id="36e7c-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span></span>

## <a name="using-the-entitydatasource-orderby-property-to-order-data"></a><span data-ttu-id="36e7c-135">使用订单数据的 EntityDataSource"OrderBy"属性</span><span class="sxs-lookup"><span data-stu-id="36e7c-135">Using the EntityDataSource "OrderBy" Property to Order Data</span></span>

<span data-ttu-id="36e7c-136">你还想在首次显示时按姓名顺序将此列表。</span><span class="sxs-lookup"><span data-stu-id="36e7c-136">You also want this list to be in name order when it's first displayed.</span></span> <span data-ttu-id="36e7c-137">与*Students.aspx*仍在中打开页面**设计**视图中，并使用`EntityDataSource`控件仍处于选中状态，在**属性**窗口中设置**OrderBy**属性设置为`it.LastName`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-137">With the *Students.aspx* page still open in **Design** view, and with the `EntityDataSource` control still selected, in the **Properties** window set the **OrderBy** property to `it.LastName`.</span></span>

<span data-ttu-id="36e7c-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span></span>

<span data-ttu-id="36e7c-139">运行页。</span><span class="sxs-lookup"><span data-stu-id="36e7c-139">Run the page.</span></span> <span data-ttu-id="36e7c-140">学生列表现按姓氏的顺序。</span><span class="sxs-lookup"><span data-stu-id="36e7c-140">The students list is now in order by last name.</span></span>

<span data-ttu-id="36e7c-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span></span>

## <a name="using-a-control-parameter-to-set-the-where-property"></a><span data-ttu-id="36e7c-142">使用控件参数设置的"Where"属性</span><span class="sxs-lookup"><span data-stu-id="36e7c-142">Using a Control Parameter to Set the "Where" Property</span></span>

<span data-ttu-id="36e7c-143">当与其他数据源控件，你可以通过参数值`Where`属性。</span><span class="sxs-lookup"><span data-stu-id="36e7c-143">As with other data source controls, you can pass parameter values to the `Where` property.</span></span> <span data-ttu-id="36e7c-144">上*Courses.aspx*页上，在本教程的第 2 部分中创建，则可以使用此方法以显示与用户从下拉列表中选择的院系的课程。</span><span class="sxs-lookup"><span data-stu-id="36e7c-144">On the *Courses.aspx* page that you created in part 2 of the tutorial, you can use this method to display courses that are associated with the department that a user selects from the drop-down list.</span></span>

<span data-ttu-id="36e7c-145">打开*Courses.aspx* ，并切换到**设计**视图。</span><span class="sxs-lookup"><span data-stu-id="36e7c-145">Open *Courses.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="36e7c-146">添加另一个`EntityDataSource`控制对页上，并将其命名`CoursesEntityDataSource`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-146">Add a second `EntityDataSource` control to the page, and name it `CoursesEntityDataSource`.</span></span> <span data-ttu-id="36e7c-147">将其连接到`SchoolEntities`模型并选择`Courses`作为**EntitySetName**值。</span><span class="sxs-lookup"><span data-stu-id="36e7c-147">Connect it to the `SchoolEntities` model, and select `Courses` as the **EntitySetName** value.</span></span>

<span data-ttu-id="36e7c-148">在中**属性**窗口中，单击中的省略号**其中**属性框。</span><span class="sxs-lookup"><span data-stu-id="36e7c-148">In the **Properties** window, click the ellipsis in the **Where** property box.</span></span> <span data-ttu-id="36e7c-149">(请确保`CoursesEntityDataSource`仍处于选中控件状态在使用之前**属性**窗口。)</span><span class="sxs-lookup"><span data-stu-id="36e7c-149">(Make sure the `CoursesEntityDataSource` control is still selected before using the **Properties** window.)</span></span>

<span data-ttu-id="36e7c-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span></span>

<span data-ttu-id="36e7c-151">**表达式编辑器**显示对话框。</span><span class="sxs-lookup"><span data-stu-id="36e7c-151">The **Expression Editor** dialog box is displayed.</span></span> <span data-ttu-id="36e7c-152">在此对话框中，选择**自动生成 Where 表达式基于提供的参数**，然后单击**添加参数**。</span><span class="sxs-lookup"><span data-stu-id="36e7c-152">In this dialog box, select **Automatically generate the Where expression based on the provided parameters**, and then click **Add Parameter**.</span></span> <span data-ttu-id="36e7c-153">将参数命名`DepartmentID`，选择**控制**作为**参数源**值，然后选择**DepartmentsDropDownList**作为**ControlID**值。</span><span class="sxs-lookup"><span data-stu-id="36e7c-153">Name the parameter `DepartmentID`, select **Control** as the **Parameter source** value, and select **DepartmentsDropDownList** as the **ControlID** value.</span></span>

<span data-ttu-id="36e7c-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span></span>

<span data-ttu-id="36e7c-155">单击**显示高级属性**，然后在**属性**窗口**表达式编辑器**对话框中，更改`Type`属性设置为`Int32`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-155">Click **Show advanced properties**, and in the **Properties** window of the **Expression Editor** dialog box, change the `Type` property to `Int32`.</span></span>

<span data-ttu-id="36e7c-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span></span>

<span data-ttu-id="36e7c-157">完成后，单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="36e7c-157">When you're done, click **OK**.</span></span>

<span data-ttu-id="36e7c-158">下面的下拉列表中，添加`GridView`控制对页面并将其命名`CoursesGridView`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-158">Below the drop-down list, add a `GridView` control to the page and name it `CoursesGridView`.</span></span> <span data-ttu-id="36e7c-159">将其连接到`CoursesEntityDataSource`数据源控件，单击**刷新架构**，单击**编辑列**，并删除`DepartmentID`列。</span><span class="sxs-lookup"><span data-stu-id="36e7c-159">Connect it to the `CoursesEntityDataSource` data source control, click **Refresh Schema**, click **Edit Columns**, and remove the `DepartmentID` column.</span></span> <span data-ttu-id="36e7c-160">`GridView`控件标记将类似于下面的示例。</span><span class="sxs-lookup"><span data-stu-id="36e7c-160">The `GridView` control markup resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample1.aspx)]

<span data-ttu-id="36e7c-161">当用户更改所选的系的下拉列表中时，你想要关联的课程，会自动更改的列表。</span><span class="sxs-lookup"><span data-stu-id="36e7c-161">When the user changes the selected department in the drop-down list, you want the list of associated courses to change automatically.</span></span> <span data-ttu-id="36e7c-162">若要使它发生这种情况中，选择下拉列表中，然后在**属性**窗口中设置`AutoPostBack`属性设置为`True`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-162">To make this happen, select the drop-down list, and in the **Properties** window set the `AutoPostBack` property to `True`.</span></span>

<span data-ttu-id="36e7c-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span></span>

<span data-ttu-id="36e7c-164">现在，完成使用设计器后，切换到**源**查看和替换`ConnectionString`并`DefaultContainer`命名的属性`CoursesEntityDataSource`控件，其`ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`属性。</span><span class="sxs-lookup"><span data-stu-id="36e7c-164">Now that you're finished using the designer, switch to **Source** view and replace the `ConnectionString` and `DefaultContainer` name properties of the `CoursesEntityDataSource` control with the `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="36e7c-165">完成后，该控件的标记将类似下面的示例。</span><span class="sxs-lookup"><span data-stu-id="36e7c-165">When you're done, the markup for the control will look like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample2.aspx)]

<span data-ttu-id="36e7c-166">运行页面，并使用下拉列表选择不同的部门。</span><span class="sxs-lookup"><span data-stu-id="36e7c-166">Run the page and use the drop-down list to select different departments.</span></span> <span data-ttu-id="36e7c-167">提供的所选系的课程将显示在`GridView`控件。</span><span class="sxs-lookup"><span data-stu-id="36e7c-167">Only courses that are offered by the selected department are displayed in the `GridView` control.</span></span>

<span data-ttu-id="36e7c-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span></span>

## <a name="using-the-entitydatasource-groupby-property-to-group-data"></a><span data-ttu-id="36e7c-169">使用对数据进行分组的 EntityDataSource"GroupBy"属性</span><span class="sxs-lookup"><span data-stu-id="36e7c-169">Using the EntityDataSource "GroupBy" Property to Group Data</span></span>

<span data-ttu-id="36e7c-170">假设 Contoso 大学想要在其关于页面上放置一些学生正文统计信息。</span><span class="sxs-lookup"><span data-stu-id="36e7c-170">Suppose Contoso University wants to put some student-body statistics on its About page.</span></span> <span data-ttu-id="36e7c-171">具体而言，它想要按用户注册日期显示学生人数的细分。</span><span class="sxs-lookup"><span data-stu-id="36e7c-171">Specifically, it wants to show a breakdown of numbers of students by the date they enrolled.</span></span>

<span data-ttu-id="36e7c-172">打开*About.aspx*，然后在**源**视图中，替换现有内容`BodyContent`之间使用"学生正文统计信息"来控制`h2`标记：</span><span class="sxs-lookup"><span data-stu-id="36e7c-172">Open *About.aspx*, and in **Source** view, replace the existing contents of the `BodyContent` control with "Student Body Statistics" between `h2` tags:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample3.aspx)]

<span data-ttu-id="36e7c-173">在标题后添加`EntityDataSource`控制并将其命名`StudentStatisticsEntityDataSource`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-173">After the heading, add an `EntityDataSource` control and name it `StudentStatisticsEntityDataSource`.</span></span> <span data-ttu-id="36e7c-174">将其连接到`SchoolEntities`，选择`People`实体集，并保留**选择**框在向导中保持不变。</span><span class="sxs-lookup"><span data-stu-id="36e7c-174">Connect it to `SchoolEntities`, select the `People` entity set, and leave the **Select** box in the wizard unchanged.</span></span> <span data-ttu-id="36e7c-175">在中设置以下属性**属性**窗口：</span><span class="sxs-lookup"><span data-stu-id="36e7c-175">Set the following properties in the **Properties** window:</span></span>

- <span data-ttu-id="36e7c-176">若要筛选为仅学生，设置`Where`属性设置为`it.EnrollmentDate is not null`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-176">To filter for students only, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>
- <span data-ttu-id="36e7c-177">若要按注册日期对结果进行分组，设置`GroupBy`属性设置为`it.EnrollmentDate`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-177">To group the results by the enrollment date, set the `GroupBy` property to `it.EnrollmentDate`.</span></span>
- <span data-ttu-id="36e7c-178">若要选择的注册日期和学生的数量，请设置`Select`属性设置为`it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-178">To select the enrollment date and the number of students, set the `Select` property to `it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`.</span></span>
- <span data-ttu-id="36e7c-179">若要按注册日期对结果进行排序，设置`OrderBy`属性设置为`it.EnrollmentDate`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-179">To order the results by the enrollment date, set the `OrderBy` property to `it.EnrollmentDate`.</span></span>

<span data-ttu-id="36e7c-180">在**源**视图中，替换`ConnectionString`并`DefaultContainer`名称与属性`ContextTypeName`属性。</span><span class="sxs-lookup"><span data-stu-id="36e7c-180">In **Source** view, replace the `ConnectionString` and `DefaultContainer` name properties with a `ContextTypeName` property.</span></span> <span data-ttu-id="36e7c-181">`EntityDataSource`控件标记现在类似于下面的示例。</span><span class="sxs-lookup"><span data-stu-id="36e7c-181">The `EntityDataSource` control markup now resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample4.aspx)]

<span data-ttu-id="36e7c-182">语法`Select`， `GroupBy`，并`Where`属性类似于 TRANSACT-SQL 除`it`指定当前实体的关键字。</span><span class="sxs-lookup"><span data-stu-id="36e7c-182">The syntax of the `Select`, `GroupBy`, and `Where` properties resembles Transact-SQL except for the `it` keyword that specifies the current entity.</span></span>

<span data-ttu-id="36e7c-183">添加以下标记以创建`GridView`控件来显示数据。</span><span class="sxs-lookup"><span data-stu-id="36e7c-183">Add the following markup to create a `GridView` control to display the data.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample5.aspx)]

<span data-ttu-id="36e7c-184">运行页后，可以看到一个列表，显示按注册日期的学生数量。</span><span class="sxs-lookup"><span data-stu-id="36e7c-184">Run the page to see a list showing the number of students by enrollment date.</span></span>

<span data-ttu-id="36e7c-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span></span>

## <a name="using-the-queryextender-control-for-filtering-and-ordering"></a><span data-ttu-id="36e7c-186">用于筛选和排序使用 QueryExtender 控件</span><span class="sxs-lookup"><span data-stu-id="36e7c-186">Using the QueryExtender Control for Filtering and Ordering</span></span>

<span data-ttu-id="36e7c-187">`QueryExtender`控件提供了一种指定标记中筛选和排序方法。</span><span class="sxs-lookup"><span data-stu-id="36e7c-187">The `QueryExtender` control provides a way to specify filtering and sorting in markup.</span></span> <span data-ttu-id="36e7c-188">语法是独立于正在使用数据库管理系统 (DBMS)。</span><span class="sxs-lookup"><span data-stu-id="36e7c-188">The syntax is independent of the database management system (DBMS) you're using.</span></span> <span data-ttu-id="36e7c-189">它还是通常独立于实体框架中，使用的导航属性使用的语法是唯一的实体框架的异常。</span><span class="sxs-lookup"><span data-stu-id="36e7c-189">It's also generally independent of the Entity Framework, with the exception that syntax you use for navigation properties is unique to the Entity Framework.</span></span>

<span data-ttu-id="36e7c-190">在本教程的此部分将使用`QueryExtender`控件与筛选器和订单数据，并按字段中的一个将为导航属性。</span><span class="sxs-lookup"><span data-stu-id="36e7c-190">In this part of the tutorial you'll use a `QueryExtender` control to filter and order data, and one of the order-by fields will be a navigation property.</span></span>

<span data-ttu-id="36e7c-191">(如果想要使用代码而不是标记扩展通过自动生成的查询`EntityDataSource`控件，您可以通过实现处理`QueryCreated`事件。</span><span class="sxs-lookup"><span data-stu-id="36e7c-191">(If you prefer to use code instead of markup to extend the queries that are automatically generated by the `EntityDataSource` control, you can do that by handling the `QueryCreated` event.</span></span> <span data-ttu-id="36e7c-192">这是如何`QueryExtender`控件扩展`EntityDataSource`控件查询的数据源。)</span><span class="sxs-lookup"><span data-stu-id="36e7c-192">This is how the `QueryExtender` control extends `EntityDataSource` control queries also.)</span></span>

<span data-ttu-id="36e7c-193">打开*Courses.aspx*页上，和以前添加的标记，插入以下标记以创建标题，用于输入搜索字符串，搜索按钮、 文本框和一个`EntityDataSource`控件绑定到`Courses`实体集。</span><span class="sxs-lookup"><span data-stu-id="36e7c-193">Open the *Courses.aspx* page, and below the markup you added previously, insert the following markup to create a heading, a text box for entering search strings, a search button, and an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample6.aspx)]

<span data-ttu-id="36e7c-194">请注意，`EntityDataSource`控件的`Include`属性设置为`Department`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-194">Notice that the `EntityDataSource` control's `Include` property is set to `Department`.</span></span> <span data-ttu-id="36e7c-195">在数据库中，`Course`表不包含部门名称; 它包含`DepartmentID`外键列。</span><span class="sxs-lookup"><span data-stu-id="36e7c-195">In the database, the `Course` table does not contain the department name; it contains a `DepartmentID` foreign key column.</span></span> <span data-ttu-id="36e7c-196">如果要查询数据库直接，以获取部门名称以及课程的数据，必须加入`Course`和`Department`表。</span><span class="sxs-lookup"><span data-stu-id="36e7c-196">If you were querying the database directly, to get the department name along with course data, you would have to join the `Course` and `Department` tables.</span></span> <span data-ttu-id="36e7c-197">通过设置`Include`属性设置为`Department`，指定实体框架应执行的相关工作`Department`实体时它获取`Course`实体。</span><span class="sxs-lookup"><span data-stu-id="36e7c-197">By setting the `Include` property to `Department`, you specify that the Entity Framework should do the work of getting the related `Department` entity when it gets a `Course` entity.</span></span> <span data-ttu-id="36e7c-198">`Department`实体然后存储在`Department`导航属性`Course`实体。</span><span class="sxs-lookup"><span data-stu-id="36e7c-198">The `Department` entity is then stored in the `Department` navigation property of the `Course` entity.</span></span> <span data-ttu-id="36e7c-199">(默认情况下`SchoolEntities`由数据模型设计器生成的类时所需时间并将已绑定到该类中，因此，设置的数据源控件检索相关的数据`Include`属性不需要。</span><span class="sxs-lookup"><span data-stu-id="36e7c-199">(By default, the `SchoolEntities` class that was generated by the data model designer retrieves related data when it's needed, and you've bound the data source control to that class, so setting the `Include` property is not necessary.</span></span> <span data-ttu-id="36e7c-200">但是，将其设置可以提高性能的页上，因为否则 Entity Framework 会使分离的数据库调用来检索数据`Course`实体和相关`Department`实体。)</span><span class="sxs-lookup"><span data-stu-id="36e7c-200">However, setting it improves performance of the page, because otherwise the Entity Framework would make separate calls to the database to retrieve data for the `Course` entities and for the related `Department` entities.)</span></span>

<span data-ttu-id="36e7c-201">之后`EntityDataSource`控制您刚创建的插入以下标记来创建`QueryExtender`绑定到的控件`EntityDataSource`控件。</span><span class="sxs-lookup"><span data-stu-id="36e7c-201">After the `EntityDataSource` control you just created, insert the following markup to create a `QueryExtender` control that's bound to that `EntityDataSource` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample7.aspx)]

<span data-ttu-id="36e7c-202">`SearchExpression`元素指定你想要选择其标题与在文本框中输入的值匹配的课程。</span><span class="sxs-lookup"><span data-stu-id="36e7c-202">The `SearchExpression` element specifies that you want to select courses whose titles match the value entered in the text box.</span></span> <span data-ttu-id="36e7c-203">仅在文本框中输入尽可能多的字符进行比较，因为`SearchType`属性指定`StartsWith`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-203">Only as many characters as are entered in the text box will be compared, because the `SearchType` property specifies `StartsWith`.</span></span>

<span data-ttu-id="36e7c-204">`OrderByExpression`元素指定结果集将按部门名称中的课程标题。</span><span class="sxs-lookup"><span data-stu-id="36e7c-204">The `OrderByExpression` element specifies that the result set will be ordered by course title within department name.</span></span> <span data-ttu-id="36e7c-205">请注意，指定院系名称的方式： `Department.Name`。</span><span class="sxs-lookup"><span data-stu-id="36e7c-205">Notice how department name is specified: `Department.Name`.</span></span> <span data-ttu-id="36e7c-206">因为之间的关联`Course`实体和`Department`实体是一对一，`Department`导航属性包含`Department`实体。</span><span class="sxs-lookup"><span data-stu-id="36e7c-206">Because the association between the `Course` entity and the `Department` entity is one-to-one, the `Department` navigation property contains a `Department` entity.</span></span> <span data-ttu-id="36e7c-207">（如果这是一个对多关系，该属性将包含一个集合。）若要获取部门名称，必须指定`Name`属性的`Department`实体。</span><span class="sxs-lookup"><span data-stu-id="36e7c-207">(If this were a one-to-many relationship, the property would contain a collection.) To get the department name, you must specify the `Name` property of the `Department` entity.</span></span>

<span data-ttu-id="36e7c-208">最后，添加`GridView`控件来显示课程列表：</span><span class="sxs-lookup"><span data-stu-id="36e7c-208">Finally, add a `GridView` control to display the list of courses:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample8.aspx)]

<span data-ttu-id="36e7c-209">第一列是显示院系名称的模板字段。</span><span class="sxs-lookup"><span data-stu-id="36e7c-209">The first column is a template field that displays the department name.</span></span> <span data-ttu-id="36e7c-210">数据绑定表达式指定`Department.Name`，就像您在中看到`QueryExtender`控件。</span><span class="sxs-lookup"><span data-stu-id="36e7c-210">The databinding expression specifies `Department.Name`, just as you saw in the `QueryExtender` control.</span></span>

<span data-ttu-id="36e7c-211">运行页。</span><span class="sxs-lookup"><span data-stu-id="36e7c-211">Run the page.</span></span> <span data-ttu-id="36e7c-212">初始显示按部门、 然后按课程标题，按顺序显示所有课程的列表。</span><span class="sxs-lookup"><span data-stu-id="36e7c-212">The initial display shows a list of all courses in order by department and then by course title.</span></span>

<span data-ttu-id="36e7c-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span></span>

<span data-ttu-id="36e7c-214">输入"m"，然后单击**搜索**若要查看其标题以"m"（搜索不是区分） 开头的所有课程。</span><span class="sxs-lookup"><span data-stu-id="36e7c-214">Enter an "m" and click **Search** to see all courses whose titles begin with "m" (the search is not case sensitive).</span></span>

<span data-ttu-id="36e7c-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span></span>

## <a name="using-the-like-operator-to-filter-data"></a><span data-ttu-id="36e7c-216">使用"Like"运算符来筛选数据</span><span class="sxs-lookup"><span data-stu-id="36e7c-216">Using the "Like" Operator to Filter Data</span></span>

<span data-ttu-id="36e7c-217">您可以实现类似的效果`QueryExtender`控件的`StartsWith`， `Contains`，和`EndsWith`使用搜索类型`Like`中的运算符`EntityDataSource`控件的`Where`属性。</span><span class="sxs-lookup"><span data-stu-id="36e7c-217">You can achieve an effect similar to the `QueryExtender` control's `StartsWith`, `Contains`, and `EndsWith` search types by using a `Like` operator in the `EntityDataSource` control's `Where` property.</span></span> <span data-ttu-id="36e7c-218">在本教程的此部分中，您将了解如何使用`Like`运算符按名称搜索的一名学生。</span><span class="sxs-lookup"><span data-stu-id="36e7c-218">In this part of the tutorial, you'll see how to use the `Like` operator to search for a student by name.</span></span>

<span data-ttu-id="36e7c-219">打开*Students.aspx*中**源**视图。</span><span class="sxs-lookup"><span data-stu-id="36e7c-219">Open *Students.aspx* in **Source** view.</span></span> <span data-ttu-id="36e7c-220">之后`GridView`控件，添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="36e7c-220">After the `GridView` control, add the following markup:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample9.aspx)]

<span data-ttu-id="36e7c-221">此标记是类似于什么前面已经看到除`Where`属性值。</span><span class="sxs-lookup"><span data-stu-id="36e7c-221">This markup is similar to what you've seen earlier except for the `Where` property value.</span></span> <span data-ttu-id="36e7c-222">第二部分`Where`表达式定义的子字符串搜索 (`LIKE %FirstMidName% or LIKE %LastName%`) 搜索在文本框中输入的内容的第一个和最后一个名称。</span><span class="sxs-lookup"><span data-stu-id="36e7c-222">The second part of the `Where` expression defines a substring search (`LIKE %FirstMidName% or LIKE %LastName%`) that searches both the first and last names for whatever is entered in the text box.</span></span>

<span data-ttu-id="36e7c-223">运行页。</span><span class="sxs-lookup"><span data-stu-id="36e7c-223">Run the page.</span></span> <span data-ttu-id="36e7c-224">最初会显示所有学生的默认值为因为`StudentName`参数是"%"。</span><span class="sxs-lookup"><span data-stu-id="36e7c-224">Initially you see all of the students because the default value for the `StudentName` parameter is "%".</span></span>

<span data-ttu-id="36e7c-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span></span>

<span data-ttu-id="36e7c-226">在文本框中输入的字母"g"，然后单击**搜索**。</span><span class="sxs-lookup"><span data-stu-id="36e7c-226">Enter the letter "g" in the text box and click **Search**.</span></span> <span data-ttu-id="36e7c-227">请参阅中的第一个或最后一个名称有"g"的学生列表。</span><span class="sxs-lookup"><span data-stu-id="36e7c-227">You see a list of students that have a "g" in either the first or last name.</span></span>

<span data-ttu-id="36e7c-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="36e7c-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span></span>

<span data-ttu-id="36e7c-229">现在显示、 更新、 筛选、 排序，还对各个表中的数据分组。</span><span class="sxs-lookup"><span data-stu-id="36e7c-229">You've now displayed, updated, filtered, ordered, and grouped data from individual tables.</span></span> <span data-ttu-id="36e7c-230">在下一教程中你将开始处理相关数据 （母版-详细信息方案）。</span><span class="sxs-lookup"><span data-stu-id="36e7c-230">In the next tutorial you'll begin to work with related data (master-detail scenarios).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="36e7c-231">[上一页](the-entity-framework-and-aspnet-getting-started-part-2.md)
> [下一页](the-entity-framework-and-aspnet-getting-started-part-4.md)</span><span class="sxs-lookup"><span data-stu-id="36e7c-231">[Previous](the-entity-framework-and-aspnet-getting-started-part-2.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-4.md)</span></span>
