---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
title: ELMAH (C#) 的日志记录错误详细信息 |Microsoft Docs
author: rick-anderson
description: 错误日志记录模块和处理程序 (ELMAH) 提供了另一种方法在生产环境中记录运行时错误。 ELMAH 是免费的开放源代码错误...
ms.author: aspnetcontent
ms.date: 06/09/2009
ms.assetid: 11f6fe44-64ef-4a38-a3b4-35c7bb992352
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
msc.type: authoredcontent
ms.openlocfilehash: 2432b22bd5dec1668fdb134eaeb92e372062ddda
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/05/2018
ms.locfileid: "37834111"
---
<a name="logging-error-details-with-elmah-c"></a><span data-ttu-id="d9025-104">ELMAH (C#) 的日志记录错误详细信息</span><span class="sxs-lookup"><span data-stu-id="d9025-104">Logging Error Details with ELMAH (C#)</span></span>
====================
<span data-ttu-id="d9025-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d9025-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d9025-106">[下载代码](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip)或[下载 PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="d9025-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)</span></span>

> <span data-ttu-id="d9025-107">错误日志记录模块和处理程序 (ELMAH) 提供了另一种方法在生产环境中记录运行时错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-107">Error Logging Modules And Handlers (ELMAH) offers another approach to logging runtime errors in a production environment.</span></span> <span data-ttu-id="d9025-108">ELMAH 是一个免费的开放源代码错误日志记录库，包括错误筛选和查看错误日志在网页上，为 RSS 源，或下载作为以逗号分隔的文件的功能等功能。</span><span class="sxs-lookup"><span data-stu-id="d9025-108">ELMAH is a free, open source error logging library that includes features like error filtering and the ability to view the error log from a web page, as an RSS feed, or to download it as a comma-delimited file.</span></span> <span data-ttu-id="d9025-109">本教程将指导完成下载和配置 ELMAH。</span><span class="sxs-lookup"><span data-stu-id="d9025-109">This tutorial walks through downloading and configuring ELMAH.</span></span>


## <a name="introduction"></a><span data-ttu-id="d9025-110">介绍</span><span class="sxs-lookup"><span data-stu-id="d9025-110">Introduction</span></span>

<span data-ttu-id="d9025-111">[前面的教程](logging-error-details-with-asp-net-health-monitoring-cs.md)检查 ASP。NET 的运行状况监控系统，它提供用于记录了很多 Web 事件框库的扩展。</span><span class="sxs-lookup"><span data-stu-id="d9025-111">The [preceding tutorial](logging-error-details-with-asp-net-health-monitoring-cs.md) examined ASP.NET's health monitoring system, which offers an out of the box library for recording a wide array of Web events.</span></span> <span data-ttu-id="d9025-112">许多开发人员使用的运行状况监视日志并通过电子邮件的未经处理的异常详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-112">Many developers use health monitoring to log and email the details of unhandled exceptions.</span></span> <span data-ttu-id="d9025-113">但是，有与此系统的一些痛点。</span><span class="sxs-lookup"><span data-stu-id="d9025-113">However, there are a few pain points with this system.</span></span> <span data-ttu-id="d9025-114">首先是缺少任何类型的用户界面，用于查看有关已记录事件的信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-114">First and foremost is the lack any sort of user interface for viewing information about the logged events.</span></span> <span data-ttu-id="d9025-115">如果你想要看到的 10 个的最后一个错误，摘要或查看过去一周发生了错误的详细信息，则必须通过数据库任一挤出、 浏览你的电子邮件收件箱，或生成显示的信息的网页`aspnet_WebEvent_Events`表。</span><span class="sxs-lookup"><span data-stu-id="d9025-115">If you want to see a summary of the 10 last errors, or view the details of an error that happened last week, you must either poke through the database, scan through your email Inbox, or build a web page that displays information from the `aspnet_WebEvent_Events` table.</span></span>

<span data-ttu-id="d9025-116">另一个难题是围绕运行状况监视的复杂性。</span><span class="sxs-lookup"><span data-stu-id="d9025-116">Another pain point centers around health monitoring's complexity.</span></span> <span data-ttu-id="d9025-117">由于运行状况监视可用于记录大量不同的事件，并且有多种选项来指导如何以及何时记录事件，正确配置运行状况监控系统可能相当繁琐的任务。</span><span class="sxs-lookup"><span data-stu-id="d9025-117">Because health monitoring can be used to record a plethora of different events, and because there are a variety of options for instructing how and when events are logged, correctly configuring the health monitoring system can be an onerous task.</span></span> <span data-ttu-id="d9025-118">最后，还有一些兼容性问题。</span><span class="sxs-lookup"><span data-stu-id="d9025-118">Finally, there are compatibility issues.</span></span> <span data-ttu-id="d9025-119">因为运行状况监视第一次添加到.NET Framework 2.0 版中，不可用较旧 web 构建的应用程序使用的 ASP.NET 版本 1.x。</span><span class="sxs-lookup"><span data-stu-id="d9025-119">Because health monitoring was first added to the .NET Framework in version 2.0, it is not available for older web applications built using ASP.NET version 1.x.</span></span> <span data-ttu-id="d9025-120">此外，`SqlWebEventProvider`类，我们使用在前面的教程到数据库的日志错误详细信息，仅适用于 Microsoft SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="d9025-120">Moreover, the `SqlWebEventProvider` class, which we used in the preceding tutorial to logs error details to a database, only works with Microsoft SQL Server databases.</span></span> <span data-ttu-id="d9025-121">您需要创建自定义日志提供程序类应需要到备用数据存储，如 XML 文件或 Oracle 数据库中记录错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-121">You will need to create a custom log provider class should you need to log errors to an alternate data store, such as an XML file or Oracle database.</span></span>

<span data-ttu-id="d9025-122">运行状况监控系统的替代方法是错误日志记录模块和处理程序 (ELMAH)，通过创建一个免费、 开源的错误日志记录系统[Atif Aziz](http://www.raboof.com/)。</span><span class="sxs-lookup"><span data-stu-id="d9025-122">An alternative to the health monitoring system is Error Logging Modules And Handlers (ELMAH), a free, open-source error logging system created by [Atif Aziz](http://www.raboof.com/).</span></span> <span data-ttu-id="d9025-123">两个系统之间最明显的区别是 ELAMH 的功能，以显示 RSS 源的形式的错误和从网页和一个特定错误的详细信息的列表。</span><span class="sxs-lookup"><span data-stu-id="d9025-123">The most notable difference between the two systems is ELAMH's ability to display a list of errors and the details of a specific error from a web page and as an RSS feed.</span></span> <span data-ttu-id="d9025-124">ELMAH 是更轻松地配置比运行状况监视，因为它仅记录错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-124">ELMAH is easier to configure than health monitoring because it only logs errors.</span></span> <span data-ttu-id="d9025-125">此外，elmah 却包含支持 ASP.NET 1.x、 ASP.NET 2.0 中，和 ASP.NET 3.5 应用程序，以及与各种日志源提供程序一起提供。</span><span class="sxs-lookup"><span data-stu-id="d9025-125">Furthermore, ELMAH includes support for ASP.NET 1.x, ASP.NET 2.0, and ASP.NET 3.5 applications, and ships with a variety of log source providers.</span></span>

<span data-ttu-id="d9025-126">本教程将指导完成将 ELMAH 添加到 ASP.NET 应用程序所涉及的步骤。</span><span class="sxs-lookup"><span data-stu-id="d9025-126">This tutorial walks through the steps involved in adding ELMAH to an ASP.NET application.</span></span> <span data-ttu-id="d9025-127">让我们进入正题！</span><span class="sxs-lookup"><span data-stu-id="d9025-127">Let's get started!</span></span>

> [!NOTE]
> <span data-ttu-id="d9025-128">运行状况监控系统和 ELMAH 都有其自己的优点和缺点。</span><span class="sxs-lookup"><span data-stu-id="d9025-128">The health monitoring system and ELMAH both have their own sets of pros and cons.</span></span> <span data-ttu-id="d9025-129">我鼓励您尝试这两个系统并决定哪一个最适合你的需求。</span><span class="sxs-lookup"><span data-stu-id="d9025-129">I encourage you to try both systems and decide what one best suits your needs.</span></span>


## <a name="adding-elmah-to-an-aspnet-web-application"></a><span data-ttu-id="d9025-130">将 ELMAH 添加到 ASP.NET Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="d9025-130">Adding ELMAH to an ASP.NET Web Application</span></span>

<span data-ttu-id="d9025-131">将 ELMAH 集成到一个新的或现有的 ASP.NET 应用程序是一个简单、 直接的过程，将在五分钟。</span><span class="sxs-lookup"><span data-stu-id="d9025-131">Integrating ELMAH into a new or existing ASP.NET application is an easy and straightforward process that takes under five minutes.</span></span> <span data-ttu-id="d9025-132">简单地说，它涉及四个简单步骤：</span><span class="sxs-lookup"><span data-stu-id="d9025-132">In a nutshell, it involves four simple steps:</span></span>

1. <span data-ttu-id="d9025-133">下载 ELMAH 并添加`Elmah.dll`到 web 应用程序，程序集</span><span class="sxs-lookup"><span data-stu-id="d9025-133">Download ELMAH and add the `Elmah.dll` assembly to your web application,</span></span>
2. <span data-ttu-id="d9025-134">ELMAH 的 HTTP 模块和处理程序中的注册`Web.config`，</span><span class="sxs-lookup"><span data-stu-id="d9025-134">Register ELMAH's HTTP Modules and Handler in `Web.config`,</span></span>
3. <span data-ttu-id="d9025-135">指定 ELMAH 的配置选项和</span><span class="sxs-lookup"><span data-stu-id="d9025-135">Specify ELMAH's configuration options, and</span></span>
4. <span data-ttu-id="d9025-136">如果需要，创建错误日志中的源基础结构。</span><span class="sxs-lookup"><span data-stu-id="d9025-136">Create the error log source infrastructure, if needed.</span></span>

<span data-ttu-id="d9025-137">让我们演练一下每个四个步骤，一次一个。</span><span class="sxs-lookup"><span data-stu-id="d9025-137">Let's walk through each of these four steps, one at a time.</span></span>

### <a name="step-1-downloading-the-elmah-project-files-and-addingelmahdllto-your-web-application"></a><span data-ttu-id="d9025-138">步骤 1： 下载 ELMAH 项目文件并将添加`Elmah.dll`对 Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="d9025-138">Step 1: Downloading the ELMAH Project Files and Adding`Elmah.dll`To Your Web Application</span></span>

<span data-ttu-id="d9025-139">ELMAH 1.0 BETA 3 (生成 10617)，在本文撰写之际，最新版本包含在适用于本教程中下载。</span><span class="sxs-lookup"><span data-stu-id="d9025-139">ELMAH 1.0 BETA 3 (Build 10617), the most recent version at the time of writing, is included in the download available with this tutorial.</span></span> <span data-ttu-id="d9025-140">或者，也可以访问[ELMAH 网站](https://code.google.com/p/elmah/)以获取最新版本，或要下载的源代码。</span><span class="sxs-lookup"><span data-stu-id="d9025-140">Alternatively, you may visit the [ELMAH website](https://code.google.com/p/elmah/) to get the most recent version or to download the source code.</span></span> <span data-ttu-id="d9025-141">提取 ELMAH 下载到您的桌面上的文件夹并找到 ELMAH 程序集文件 (`Elmah.dll`)。</span><span class="sxs-lookup"><span data-stu-id="d9025-141">Extract the ELMAH download to a folder on your desktop and locate the ELMAH assembly file (`Elmah.dll`).</span></span>

> [!NOTE]
> <span data-ttu-id="d9025-142">`Elmah.dll`文件位于下载的`Bin`文件夹，其中具有不同的.NET Framework 版本和版本和调试版本中的子文件夹。</span><span class="sxs-lookup"><span data-stu-id="d9025-142">The `Elmah.dll` file is located in the download's `Bin` folder, which has subfolders for different .NET Framework versions and for Release and Debug builds.</span></span> <span data-ttu-id="d9025-143">使用合适的框架版本的发布版本。</span><span class="sxs-lookup"><span data-stu-id="d9025-143">Use the Release build for the appropriate framework version.</span></span> <span data-ttu-id="d9025-144">例如，如果您正在构建的 ASP.NET 3.5 web 应用程序，复制`Elmah.dll`文件从`Bin\net-3.5\Release`文件夹。</span><span class="sxs-lookup"><span data-stu-id="d9025-144">For instance, if you are building an ASP.NET 3.5 web application, copy the `Elmah.dll` file from the `Bin\net-3.5\Release` folder.</span></span>


<span data-ttu-id="d9025-145">接下来，打开 Visual Studio 并右键单击网站名称，在解决方案资源管理器并从上下文菜单中选择添加引用添加到你的项目的程序集。</span><span class="sxs-lookup"><span data-stu-id="d9025-145">Next, open Visual Studio and add the assembly to your project by right-clicking on the website name in the Solution Explorer and choosing Add Reference from the context menu.</span></span> <span data-ttu-id="d9025-146">此时会打开添加引用对话框。</span><span class="sxs-lookup"><span data-stu-id="d9025-146">This brings up the Add Reference dialog box.</span></span> <span data-ttu-id="d9025-147">导航到浏览选项卡，然后选择`Elmah.dll`文件。</span><span class="sxs-lookup"><span data-stu-id="d9025-147">Navigate to the Browse tab and choose the `Elmah.dll` file.</span></span> <span data-ttu-id="d9025-148">此操作将添加`Elmah.dll`web 应用程序的文件`Bin`文件夹。</span><span class="sxs-lookup"><span data-stu-id="d9025-148">This action adds the `Elmah.dll` file to the web application's `Bin` folder.</span></span>

> [!NOTE]
> <span data-ttu-id="d9025-149">Web 应用程序项目 (WAP) 类型不会显示`Bin`在解决方案资源管理器中的文件夹。</span><span class="sxs-lookup"><span data-stu-id="d9025-149">The Web Application Project (WAP) type does not show the `Bin` folder in the Solution Explorer.</span></span> <span data-ttu-id="d9025-150">相反，它列出了引用文件夹下的这些项。</span><span class="sxs-lookup"><span data-stu-id="d9025-150">Instead, it lists these items under the References folder.</span></span>


<span data-ttu-id="d9025-151">`Elmah.dll`程序集包括 ELMAH 系统使用的类。</span><span class="sxs-lookup"><span data-stu-id="d9025-151">The `Elmah.dll` assembly includes the classes used by the ELMAH system.</span></span> <span data-ttu-id="d9025-152">这些类分为三个类别之一：</span><span class="sxs-lookup"><span data-stu-id="d9025-152">These classes fall into one of three categories:</span></span>

- <span data-ttu-id="d9025-153">**HTTP 模块**的 HTTP 模块是一个定义的事件处理程序类`HttpApplication`事件，如`Error`事件。</span><span class="sxs-lookup"><span data-stu-id="d9025-153">**HTTP Modules** - an HTTP Module is a class that defines event handlers for `HttpApplication` events, such as the `Error` event.</span></span> <span data-ttu-id="d9025-154">Elmah 却包含多个 HTTP 模块，三个最无关的要：</span><span class="sxs-lookup"><span data-stu-id="d9025-154">ELMAH includes multiple HTTP Modules, the three most germane ones being:</span></span> 

    - <span data-ttu-id="d9025-155">`ErrorLogModule` -将未经处理的异常记录到日志源。</span><span class="sxs-lookup"><span data-stu-id="d9025-155">`ErrorLogModule` - logs unhandled exceptions to a log source.</span></span>
    - <span data-ttu-id="d9025-156">`ErrorMailModule` -电子邮件中发送未经处理的异常的详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-156">`ErrorMailModule` - sends the details of an unhandled exception in an email message.</span></span>
    - <span data-ttu-id="d9025-157">`ErrorFilterModule` -应用开发人员指定筛选器，以确定哪些异常记录以及与将被忽略。</span><span class="sxs-lookup"><span data-stu-id="d9025-157">`ErrorFilterModule` - applies developer-specified filters to determine what exceptions are logged and what ones are ignored.</span></span>
- <span data-ttu-id="d9025-158">**HTTP 处理程序**-HTTP 处理程序是一个类，负责生成特定类型的请求的标记。</span><span class="sxs-lookup"><span data-stu-id="d9025-158">**HTTP Handlers** - an HTTP Handler is a class that is responsible for generating the markup for a particular type of request.</span></span> <span data-ttu-id="d9025-159">Elmah 却包含为网页、 RSS 源，或以逗号分隔的文件 (CSV) 呈现错误详细信息的 HTTP 处理程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-159">ELMAH includes HTTP Handlers that render error details as a web page, as an RSS feed, or as a comma-delimited file (CSV).</span></span>
- <span data-ttu-id="d9025-160">**错误日志源**-现成 ELMAH 可以记录到 Microsoft SQL Server 数据库，到 Microsoft Access 数据库，到 Oracle 数据库的内存，错误到 XML 文件，到 SQLite 数据库，或 Vista DB 数据库。</span><span class="sxs-lookup"><span data-stu-id="d9025-160">**Error Log Sources** - out of the box ELMAH can log errors to memory, to a Microsoft SQL Server database, to a Microsoft Access database, to an Oracle database, to an XML file, to a SQLite database, or to a Vista DB database.</span></span> <span data-ttu-id="d9025-161">运行状况监控系统，如 ELMAH 的体系结构是使用提供程序模型，这意味着你可以创建并无缝集成自己的自定义日志的源提供程序，如果需要生成的。</span><span class="sxs-lookup"><span data-stu-id="d9025-161">Like the health monitoring system, ELMAH's architecture was built using the provider model, meaning that you can create and seamlessly integrate your own custom log source providers, if needed.</span></span>

### <a name="step-2-registering-elmahs-http-module-and-handler"></a><span data-ttu-id="d9025-162">步骤 2： 注册 ELMAH 的 HTTP 模块和处理程序</span><span class="sxs-lookup"><span data-stu-id="d9025-162">Step 2: Registering ELMAH's HTTP Module and Handler</span></span>

<span data-ttu-id="d9025-163">虽然`Elmah.dll`文件包含的 HTTP 模块和处理程序需要自动记录未处理的异常并显示在网页上的错误详细信息，这些必须显式注册 web 应用程序的配置中。</span><span class="sxs-lookup"><span data-stu-id="d9025-163">While the `Elmah.dll` file contains the HTTP Modules and Handler needed to automatically log unhandled exceptions and to display error details from a web page, these must be explicitly registered in the web application's configuration.</span></span> <span data-ttu-id="d9025-164">`ErrorLogModule` HTTP 模块，注册后，订阅`HttpApplication`的`Error`事件。</span><span class="sxs-lookup"><span data-stu-id="d9025-164">The `ErrorLogModule` HTTP Module, once registered, subscribes to the `HttpApplication`'s `Error` event.</span></span> <span data-ttu-id="d9025-165">每当引发此事件`ErrorLogModule`将异常的详细信息记录到指定的日志源。</span><span class="sxs-lookup"><span data-stu-id="d9025-165">Whenever this event is raised the `ErrorLogModule` logs the details of the exception to a specified log source.</span></span> <span data-ttu-id="d9025-166">我们将了解如何在下一节中定义的日志源提供程序"的配置 ELMAH。"</span><span class="sxs-lookup"><span data-stu-id="d9025-166">We'll see how to define the log source provider in the next section, "Configuring ELMAH."</span></span> <span data-ttu-id="d9025-167">`ErrorLogPageFactory` HTTP 处理程序工厂负责生成标记，查看错误日志在网页上的时。</span><span class="sxs-lookup"><span data-stu-id="d9025-167">The `ErrorLogPageFactory` HTTP Handler factory is responsible for generating the markup when viewing the error log from a web page.</span></span>

<span data-ttu-id="d9025-168">注册 HTTP 模块和处理程序的具体语法取决于为该站点提供强大支持的 web 服务器。</span><span class="sxs-lookup"><span data-stu-id="d9025-168">The specific syntax for registering HTTP Modules and Handlers depends upon the web server that is powering the site.</span></span> <span data-ttu-id="d9025-169">为 ASP.NET Development Server 和 Microsoft 的 IIS 6.0 及更早版本，HTTP 模块和处理程序中注册`<httpModules>`并`<httpHandlers>`部分，会出现`<system.web>`元素。</span><span class="sxs-lookup"><span data-stu-id="d9025-169">For the ASP.NET Development Server and Microsoft's IIS version 6.0 and earlier, HTTP Modules and Handlers are registered in the `<httpModules>` and `<httpHandlers>` sections, which appear within the `<system.web>` element.</span></span> <span data-ttu-id="d9025-170">如果使用 IIS 7.0，则他们需要在中注册`<system.webServer>`元素的`<modules>`和`<handlers>`部分。</span><span class="sxs-lookup"><span data-stu-id="d9025-170">If you are using IIS 7.0 then they need to be registered in the `<system.webServer>` element's `<modules>` and `<handlers>` sections.</span></span> <span data-ttu-id="d9025-171">幸运的是，可以定义 HTTP 模块和处理程序中的*同时*放置而不考虑所使用的 web 服务器。</span><span class="sxs-lookup"><span data-stu-id="d9025-171">Fortunately, you can define the HTTP Modules and Handlers in *both* places regardless of the web server being used.</span></span> <span data-ttu-id="d9025-172">此选项是最可移植的一个，因为它允许同一配置，以在而不考虑所使用的 web 服务器在开发和生产环境中使用。</span><span class="sxs-lookup"><span data-stu-id="d9025-172">This option is the most portable one as it allows the same configuration to be used in the development and production environments regardless of the web server being used.</span></span>

<span data-ttu-id="d9025-173">首先，注册`ErrorLogModule`HTTP 模块和`ErrorLogPageFactory`中的 HTTP 处理程序`<httpModules>`并`<httpHandlers>`主题中`<system.web>`。</span><span class="sxs-lookup"><span data-stu-id="d9025-173">Start by registering the `ErrorLogModule` HTTP Module and the `ErrorLogPageFactory` HTTP Handler in the `<httpModules>` and `<httpHandlers>` section in `<system.web>`.</span></span> <span data-ttu-id="d9025-174">如果你的配置已定义这两个元素然后只需包括`<add>`ELMAH 的 HTTP 模块和处理程序的元素。</span><span class="sxs-lookup"><span data-stu-id="d9025-174">If your configuration already defines these two elements then simply include the `<add>` element for ELMAH's HTTP Module and Handler.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample1.xml)]

<span data-ttu-id="d9025-175">接下来，注册 ELMAH 的 HTTP 模块和处理程序中的`<system.webServer>`元素。</span><span class="sxs-lookup"><span data-stu-id="d9025-175">Next, register ELMAH's HTTP Module and Handler in the `<system.webServer>` element.</span></span> <span data-ttu-id="d9025-176">与前面一样，如果此元素不存在在配置中然后将其添加。</span><span class="sxs-lookup"><span data-stu-id="d9025-176">As before, if this element is not already present in your configuration then add it.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample2.xml)]

<span data-ttu-id="d9025-177">默认情况下，IIS 7 会指出如果 HTTP 模块和处理程序注册中`<system.web>`部分。</span><span class="sxs-lookup"><span data-stu-id="d9025-177">By default, IIS 7 complains if HTTP Modules and Handlers are registered in the `<system.web>` section.</span></span> <span data-ttu-id="d9025-178">`validateIntegratedModeConfiguration`属性中`<validation>`元素指示 IIS 7 以取消显示此类错误消息。</span><span class="sxs-lookup"><span data-stu-id="d9025-178">The `validateIntegratedModeConfiguration` attribute in the `<validation>` element instructs IIS 7 to suppress such error messages.</span></span>

<span data-ttu-id="d9025-179">请注意，注册的语法`ErrorLogPageFactory`HTTP 处理程序包括`path`属性设置为`elmah.axd`。</span><span class="sxs-lookup"><span data-stu-id="d9025-179">Note that the syntax for registering the `ErrorLogPageFactory` HTTP Handler includes a `path` attribute, which is set to `elmah.axd`.</span></span> <span data-ttu-id="d9025-180">此特性告知 web 应用程序，如果为一个名为页的请求到达`elmah.axd`则应由处理该请求`ErrorLogPageFactory`HTTP 处理程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-180">This attribute informs the web application that if a request arrives for a page named `elmah.axd` then the request should be processed by the `ErrorLogPageFactory` HTTP Handler.</span></span> <span data-ttu-id="d9025-181">我们将看到`ErrorLogPageFactory`中稍后在本教程中的操作的 HTTP 处理程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-181">We'll see the `ErrorLogPageFactory` HTTP Handler in action later in this tutorial.</span></span>

### <a name="step-3-configuring-elmah"></a><span data-ttu-id="d9025-182">步骤 3： 配置 ELMAH</span><span class="sxs-lookup"><span data-stu-id="d9025-182">Step 3: Configuring ELMAH</span></span>

<span data-ttu-id="d9025-183">有关其配置选项的网站中查找 ELMAH`Web.config`文件中一个名为的自定义配置部分`<elmah>`。</span><span class="sxs-lookup"><span data-stu-id="d9025-183">ELMAH looks for its configuration options in the website's `Web.config` file in a custom configuration section named `<elmah>`.</span></span> <span data-ttu-id="d9025-184">若要使用中的自定义节`Web.config`必须先将定义在`<configSections>`元素。</span><span class="sxs-lookup"><span data-stu-id="d9025-184">In order to use a custom section in `Web.config` it must first be defined in the `<configSections>` element.</span></span> <span data-ttu-id="d9025-185">打开`Web.config`文件，并添加以下标记到`<configSections>`:</span><span class="sxs-lookup"><span data-stu-id="d9025-185">Open the `Web.config` file and add the following markup to the `<configSections>`:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample3.xml)]

> [!NOTE]
> <span data-ttu-id="d9025-186">如果要配置 ELMAH ASP.NET 1.x 应用程序然后删除`requirePermission="false"`属性从`<section>`上面的元素。</span><span class="sxs-lookup"><span data-stu-id="d9025-186">If you are configuring ELMAH for an ASP.NET 1.x application then remove the `requirePermission="false"` attribute from the `<section>` elements above.</span></span>


<span data-ttu-id="d9025-187">上述语法注册自定义`<elmah>`部分和其子章节： `<security>`， `<errorLog>`， `<errorMail>`，和`<errorFilter>`。</span><span class="sxs-lookup"><span data-stu-id="d9025-187">The above syntax registers the custom `<elmah>` section and its subsections: `<security>`, `<errorLog>`, `<errorMail>`, and `<errorFilter>`.</span></span>

<span data-ttu-id="d9025-188">接下来，添加`<elmah>`部分`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="d9025-188">Next, add the `<elmah>` section to `Web.config`.</span></span> <span data-ttu-id="d9025-189">本部分中应出现在相同的级别`<system.web>`元素。</span><span class="sxs-lookup"><span data-stu-id="d9025-189">This section should appear at the same level as the `<system.web>` element.</span></span> <span data-ttu-id="d9025-190">内部`<elmah>`部分中添加`<security>`和`<errorLog>`部分如下所示：</span><span class="sxs-lookup"><span data-stu-id="d9025-190">Inside the `<elmah>` section add the `<security>` and `<errorLog>` sections like so:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample4.xml)]

<span data-ttu-id="d9025-191">`<security>`节的`allowRemoteAccess`属性指示是否允许远程访问。</span><span class="sxs-lookup"><span data-stu-id="d9025-191">The `<security>` section's `allowRemoteAccess` attribute indicates whether remote access is allowed.</span></span> <span data-ttu-id="d9025-192">如果此值设置为 0，然后在错误日志 web 页只能查看本地。</span><span class="sxs-lookup"><span data-stu-id="d9025-192">If this value is set to 0, then the error log web page can only be viewed locally.</span></span> <span data-ttu-id="d9025-193">如果此属性设置为 1 在错误日志 web 页可用于远程和本地访问者。</span><span class="sxs-lookup"><span data-stu-id="d9025-193">If this attribute is set to 1 then the error log web page is enabled for both remote and local visitors.</span></span> <span data-ttu-id="d9025-194">现在，让我们为远程访客禁用错误日志 web 页。</span><span class="sxs-lookup"><span data-stu-id="d9025-194">For now, let's disable the error log web page for remote visitors.</span></span> <span data-ttu-id="d9025-195">我们有机会讨论这样做的安全问题后，我们将更高版本允许远程访问。</span><span class="sxs-lookup"><span data-stu-id="d9025-195">We'll allow remote access later after we have an opportunity to discuss the security concerns of doing so.</span></span>

<span data-ttu-id="d9025-196">`<errorLog>`节定义错误日志源，其中记录错误详细信息; 它是类似于哪些决定`<providers>`运行状况监控系统中的部分。</span><span class="sxs-lookup"><span data-stu-id="d9025-196">The `<errorLog>` section defines the error log source, which dictates where the error details are recorded; it is similar to the `<providers>` section in the health monitoring system.</span></span> <span data-ttu-id="d9025-197">上述语法指定`SqlErrorLog`类作为错误记录到 Microsoft SQL Server 数据库指定的错误日志源`connectionStringName`属性值。</span><span class="sxs-lookup"><span data-stu-id="d9025-197">The above syntax specifies the `SqlErrorLog` class as the error log source, which logs the errors to a Microsoft SQL Server database specified by the `connectionStringName` attribute value.</span></span>

> [!NOTE]
> <span data-ttu-id="d9025-198">ELMAH 附带有其他错误的日志提供程序可用于 XML 文件、 Microsoft Access 数据库、 Oracle 数据库和其他数据存储中记录错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-198">ELMAH ships with additional error log providers that can be used to log errors to an XML file, a Microsoft Access database, an Oracle database, and other data stores.</span></span> <span data-ttu-id="d9025-199">请参阅示例`Web.config`是包含有关如何使用这些备用错误日志提供程序的信息在 ELMAH 下载的文件。</span><span class="sxs-lookup"><span data-stu-id="d9025-199">Refer to the sample `Web.config` file that is included with the ELMAH download for information on how to use these alternate error log providers.</span></span>


### <a name="step-4-creating-the-error-log-source-infrastructure"></a><span data-ttu-id="d9025-200">步骤 4： 创建错误日志源基础结构</span><span class="sxs-lookup"><span data-stu-id="d9025-200">Step 4: Creating the Error Log Source Infrastructure</span></span>

<span data-ttu-id="d9025-201">ELMAH 的`SqlErrorLog`提供程序错误详细信息记录到指定的 Microsoft SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="d9025-201">ELMAH's `SqlErrorLog` provider logs error details to a specified Microsoft SQL Server database.</span></span> <span data-ttu-id="d9025-202">`SqlErrorLog`提供程序需要此数据库有一个名为表`ELMAH_Error`和三个存储过程： `ELMAH_GetErrorsXml`， `ELMAH_GetErrorXml`，和`ELMAH_LogError`。</span><span class="sxs-lookup"><span data-stu-id="d9025-202">The `SqlErrorLog` provider expects this database to have a table named `ELMAH_Error` and three stored procedures: `ELMAH_GetErrorsXml`, `ELMAH_GetErrorXml`, and `ELMAH_LogError`.</span></span> <span data-ttu-id="d9025-203">ELMAH 下载内容还包括名为的文件`SQLServer.sql`在`db`文件夹包含用于创建此表并将这些 T-SQL 存储过程。</span><span class="sxs-lookup"><span data-stu-id="d9025-203">The ELMAH download includes a file named `SQLServer.sql` in the `db` folder that contains the T-SQL for creating this table and these stored procedures.</span></span> <span data-ttu-id="d9025-204">将需要使用在数据库上运行这些语句`SqlErrorLog`提供程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-204">You'll need to run these statements on your database to use the `SqlErrorLog` provider.</span></span>

<span data-ttu-id="d9025-205">**图 1**并**2**后所需的数据库对象显示在 Visual Studio 中的数据库资源管理器`SqlErrorLog`已添加提供程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-205">**Figures 1** and **2** show the Database Explorer in Visual Studio after the database objects needed by the `SqlErrorLog` provider have been added.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image2.png)](logging-error-details-with-elmah-cs/_static/image1.png)

<span data-ttu-id="d9025-206">**图 1**:`SqlErrorLog`提供程序记录到错误`ELMAH_Error`表</span><span class="sxs-lookup"><span data-stu-id="d9025-206">**Figure 1**: The `SqlErrorLog` Provider Logs Errors to the `ELMAH_Error` Table</span></span>

[![](logging-error-details-with-elmah-cs/_static/image4.png)](logging-error-details-with-elmah-cs/_static/image3.png)

<span data-ttu-id="d9025-207">**图 2**:`SqlErrorLog`提供程序使用三个存储的过程</span><span class="sxs-lookup"><span data-stu-id="d9025-207">**Figure 2**: The `SqlErrorLog` Provider Uses Three Stored Procedures</span></span>

## <a name="elmah-in-action"></a><span data-ttu-id="d9025-208">在操作中的 ELMAH</span><span class="sxs-lookup"><span data-stu-id="d9025-208">ELMAH In Action</span></span>

<span data-ttu-id="d9025-209">现在我们已添加到注册的 web 应用程序的 ELMAH `ErrorLogModule` HTTP 模块和`ErrorLogPageFactory`HTTP 处理程序中，指定中的 ELMAH 的配置选项`Web.config`，并添加所需的数据库对象的`SqlErrorLog`错误日志提供程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-209">At this point we have added ELMAH to the web application, registered the `ErrorLogModule` HTTP Module and the `ErrorLogPageFactory` HTTP Handler, specified ELMAH's configuration options in `Web.config`, and added the needed database objects for the `SqlErrorLog` error log provider.</span></span> <span data-ttu-id="d9025-210">我们现已准备好在操作中看到 ELMAH ！</span><span class="sxs-lookup"><span data-stu-id="d9025-210">We are now ready to see ELMAH in action!</span></span> <span data-ttu-id="d9025-211">访问书评网站，请访问生成运行时错误，例如页面`Genre.aspx?ID=foo`，或不存在页，如`NoSuchPage.aspx`。</span><span class="sxs-lookup"><span data-stu-id="d9025-211">Visit the Book Reviews website and visit a page that generates a runtime error, such as `Genre.aspx?ID=foo`, or a non-existent page, such as `NoSuchPage.aspx`.</span></span> <span data-ttu-id="d9025-212">访问这些页面时看到的内容取决于`<customErrors>`配置和是否正在访问本地或远程。</span><span class="sxs-lookup"><span data-stu-id="d9025-212">What you see when visiting these pages depends on the `<customErrors>` configuration and whether you're visiting locally or remotely.</span></span> <span data-ttu-id="d9025-213">(回头[*显示自定义错误页*教程](displaying-a-custom-error-page-cs.md)上本主题复习。)</span><span class="sxs-lookup"><span data-stu-id="d9025-213">(Refer back to the [*Displaying a Custom Error Page* tutorial](displaying-a-custom-error-page-cs.md) for a refresher on this topic.)</span></span>

<span data-ttu-id="d9025-214">ELMAH 不会影响发生未经处理的异常; 时，向用户显示哪些内容它只需记录其详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-214">ELMAH doesn't affect what content is shown to the user when an unhandled exception occurs; it just logs its details.</span></span> <span data-ttu-id="d9025-215">此错误日志是可访问的网页`elmah.axd`根目录中的你的网站，如`http://localhost/BookReviews/elmah.axd`。</span><span class="sxs-lookup"><span data-stu-id="d9025-215">This error log is accessible from the web page `elmah.axd` from the root of your website, such as `http://localhost/BookReviews/elmah.axd`.</span></span> <span data-ttu-id="d9025-216">(此文件不以物理方式存在于项目中，但为传入的请求时`elmah.axd`运行时将调度到`ErrorLogPageFactory`HTTP 处理程序，它将生成发送回浏览器的标记。)</span><span class="sxs-lookup"><span data-stu-id="d9025-216">(This file does not physically exist in your project, but when a request comes in for `elmah.axd` the runtime dispatches it to the `ErrorLogPageFactory` HTTP Handler, which generates the markup sent back to the browser.)</span></span>

> [!NOTE]
> <span data-ttu-id="d9025-217">此外可以使用`elmah.axd`页后，可以指示 ELMAH 生成一个测试错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-217">You can also use the `elmah.axd` page to instruct ELMAH to generate a test error.</span></span> <span data-ttu-id="d9025-218">访问`elmah.axd/test`(作为 in `http://localhost/BookReviews/elmah.axd/test`) 会导致引发异常的类型的 ELMAH `Elmah.TestException`，其中包含错误消息:"这是可以安全地忽略测试异常"。</span><span class="sxs-lookup"><span data-stu-id="d9025-218">Visiting `elmah.axd/test` (as in, `http://localhost/BookReviews/elmah.axd/test`) causes ELMAH to throw an exception of type `Elmah.TestException`, which has the error message: " This is a test exception that can be safely ignored."</span></span>


<span data-ttu-id="d9025-219">**图 3**访问时显示的错误日志`elmah.axd`从开发环境。</span><span class="sxs-lookup"><span data-stu-id="d9025-219">**Figure 3** shows the error log when visiting `elmah.axd` from the development environment.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image6.png)](logging-error-details-with-elmah-cs/_static/image5.png)

<span data-ttu-id="d9025-220">**图 3**:`Elmah.axd`显示在网页上的错误日志</span><span class="sxs-lookup"><span data-stu-id="d9025-220">**Figure 3**: `Elmah.axd` Displays the Error Log from a Web Page</span></span>  
<span data-ttu-id="d9025-221">([单击此项可查看原尺寸图像](logging-error-details-with-elmah-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="d9025-221">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image7.png))</span></span>

<span data-ttu-id="d9025-222">错误日志**图 3**包含六个错误条目。</span><span class="sxs-lookup"><span data-stu-id="d9025-222">The error log in **Figure 3** contains six error entries.</span></span> <span data-ttu-id="d9025-223">每个条目包括 HTTP 状态代码 （404 或 500，对于这些错误）、 类型、 说明、 出现错误，已登录用户的名称以及日期和时间。</span><span class="sxs-lookup"><span data-stu-id="d9025-223">Each entry includes the HTTP status code (404 or 500, for these errors), the type, the description, the name of the logged on user when the error occurred, and the date and time.</span></span> <span data-ttu-id="d9025-224">单击详细信息链接将显示包括错误详细信息黄色屏幕死机中所示相同的错误消息的页面 (请参阅**图 4**) 以及在出现此错误时服务器变量的值 (请参阅**图 5**)。</span><span class="sxs-lookup"><span data-stu-id="d9025-224">Clicking the Details link displays a page that includes the same error message shown in the Error Details Yellow Screen of Death (see **Figure 4**) along with the values of the server variables at the time of the error (see **Figure 5**).</span></span> <span data-ttu-id="d9025-225">此外可以查看在其中保存错误详细信息，其中包括 HTTP POST 标头中的其他信息，例如值的原始 XML。</span><span class="sxs-lookup"><span data-stu-id="d9025-225">You can also view the raw XML in which the error details are saved, which includes additional information such as the values in the HTTP POST header.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image9.png)](logging-error-details-with-elmah-cs/_static/image8.png)

<span data-ttu-id="d9025-226">**图 4**： 查看错误详细信息 YSOD</span><span class="sxs-lookup"><span data-stu-id="d9025-226">**Figure 4**: View the Error Details YSOD</span></span>  
<span data-ttu-id="d9025-227">([单击此项可查看原尺寸图像](logging-error-details-with-elmah-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="d9025-227">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image10.png))</span></span>

[![](logging-error-details-with-elmah-cs/_static/image12.png)](logging-error-details-with-elmah-cs/_static/image11.png)

<span data-ttu-id="d9025-228">**图 5**： 浏览服务器变量集合中错误的时间处的值</span><span class="sxs-lookup"><span data-stu-id="d9025-228">**Figure 5**: Explore the Values of the Server Variables Collection at the Time of the Error</span></span>  
<span data-ttu-id="d9025-229">([单击此项可查看原尺寸图像](logging-error-details-with-elmah-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="d9025-229">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image13.png))</span></span>

<span data-ttu-id="d9025-230">部署到生产网站的 ELMAH 需要：</span><span class="sxs-lookup"><span data-stu-id="d9025-230">Deploying ELMAH to the production website entails:</span></span>

- <span data-ttu-id="d9025-231">复制`Elmah.dll`文件为`Bin`上生产中，文件夹</span><span class="sxs-lookup"><span data-stu-id="d9025-231">Copying the `Elmah.dll` file to the `Bin` folder on production,</span></span>
- <span data-ttu-id="d9025-232">复制到的特定于 ELMAH 的配置设置`Web.config`在生产环境中，使用文件和</span><span class="sxs-lookup"><span data-stu-id="d9025-232">Copying the ELMAH-specific configuration settings to the `Web.config` file used on production, and</span></span>
- <span data-ttu-id="d9025-233">将错误日志源基础结构添加到生产数据库。</span><span class="sxs-lookup"><span data-stu-id="d9025-233">Adding the error log source infrastructure to the production database.</span></span>

<span data-ttu-id="d9025-234">我们已经探讨了技术，可将复制从开发到生产环境在前面的教程。</span><span class="sxs-lookup"><span data-stu-id="d9025-234">We've explored techniques for copying files from development to production in previous tutorials.</span></span> <span data-ttu-id="d9025-235">生产数据库上获取错误日志源基础结构的最简单方法是使用 SQL Server Management Studio 连接到生产数据库并执行可能`SqlServer.sql`脚本文件，这将创建所需的表和存储过程。</span><span class="sxs-lookup"><span data-stu-id="d9025-235">Perhaps the easiest way to get the error log source infrastructure on the production database is to use SQL Server Management Studio to connect to the production database and then execute the `SqlServer.sql` script file, which will create the needed table and stored procedures.</span></span>

### <a name="viewing-the-error-details-page-on-production"></a><span data-ttu-id="d9025-236">在生产环境中查看错误详细信息页</span><span class="sxs-lookup"><span data-stu-id="d9025-236">Viewing the Error Details Page on Production</span></span>

<span data-ttu-id="d9025-237">之后您的网站部署到生产环境，请访问生产网站并生成未经处理的异常。</span><span class="sxs-lookup"><span data-stu-id="d9025-237">After deploying your site to production, visit the production website and generate an unhandled exception.</span></span> <span data-ttu-id="d9025-238">开发环境中，如 ELMAH 产生任何影响上发生未经处理的异常; 时显示的错误页面相反，它只是记录的错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-238">As in the development environment, ELMAH has no affect on the error page displayed when an unhandled exception occurs; instead, it merely logs the error.</span></span> <span data-ttu-id="d9025-239">如果你尝试访问错误日志页 (`elmah.axd`) 从生产环境中，你将看到与禁止访问页中所示**图 6**。</span><span class="sxs-lookup"><span data-stu-id="d9025-239">If you attempt to visit the error log page (`elmah.axd`) from the production environment, you will be greeted with the Forbidden page shown in **Figure 6**.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image15.png)](logging-error-details-with-elmah-cs/_static/image14.png)

<span data-ttu-id="d9025-240">**图 6**： 默认情况下，远程访问者不能查看错误日志 Web 页</span><span class="sxs-lookup"><span data-stu-id="d9025-240">**Figure 6**: By Default, Remote Visitors Cannot View the Error Log Web Page</span></span>  
<span data-ttu-id="d9025-241">([单击此项可查看原尺寸图像](logging-error-details-with-elmah-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="d9025-241">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image16.png))</span></span>

<span data-ttu-id="d9025-242">请记住，ELMAH 配置中`<security>`部分中我们将设置`allowRemoteAccess`属性为 0，这将禁止远程用户查看错误日志。</span><span class="sxs-lookup"><span data-stu-id="d9025-242">Recall that in the ELMAH configuration's `<security>` section we set the `allowRemoteAccess` attribute to 0, which prohibits remote users from viewing the error log.</span></span> <span data-ttu-id="d9025-243">请务必禁止匿名访问者查看错误日志，如安全漏洞或其他敏感信息可能会显示错误详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-243">It's important to prohibit anonymous visitors from viewing the error log, as the error details might reveal security vulnerabilities or other sensitive information.</span></span> <span data-ttu-id="d9025-244">如果您决定将此属性设置为 1 并启用远程访问错误日志，则务必锁定`elmah.axd`路径，因此，只有经过授权的访问者可以访问它。</span><span class="sxs-lookup"><span data-stu-id="d9025-244">If you decide to set this attribute to 1 and enable remote access to the error log then it is important to lock down the `elmah.axd` path so that only authorized visitors can access it.</span></span> <span data-ttu-id="d9025-245">这可以通过添加`<location>`元素`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="d9025-245">This can be achieved by adding a `<location>` element to the `Web.config` file.</span></span>

<span data-ttu-id="d9025-246">下面的配置允许管理员角色才能访问错误日志 web 页只有用户：</span><span class="sxs-lookup"><span data-stu-id="d9025-246">The following configuration permits only users in the Admin role to access the error log web page:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample5.xml)]

> [!NOTE]
> <span data-ttu-id="d9025-247">在添加了管理员角色和-Scott、 Jisun 和 Alice-在系统中的三个用户[*配置网站，使用应用程序服务*教程](configuring-a-website-that-uses-application-services-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="d9025-247">The Admin role and the three users in the system - Scott, Jisun, and Alice - were added in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md).</span></span> <span data-ttu-id="d9025-248">用户 Scott 和 Jisun 是管理员角色的成员。</span><span class="sxs-lookup"><span data-stu-id="d9025-248">Users Scott and Jisun are members of the Admin role.</span></span> <span data-ttu-id="d9025-249">有关身份验证和授权的详细信息，请参阅我[网站安全教程](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="d9025-249">For more information on authentication and authorization, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>


<span data-ttu-id="d9025-250">远程用户; 可以立即查看错误日志在生产环境回头**图 3**， **4**，并**5**错误日志 web 页的屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="d9025-250">The error log on the production environment can now be viewed by remote users; refer back to **Figures 3**, **4**, and **5** for screen shots of the error log web page.</span></span> <span data-ttu-id="d9025-251">但是，如果匿名或非管理员用户尝试查看错误日志页则自动重定向到登录页 (`Login.aspx`)，作为**图 7**显示。</span><span class="sxs-lookup"><span data-stu-id="d9025-251">However, if an anonymous or non-Admin user attempts to view the error log page they are automatically redirected to the login page (`Login.aspx`), as **Figure 7** shows.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image18.png)](logging-error-details-with-elmah-cs/_static/image17.png)

<span data-ttu-id="d9025-252">**图 7**： 未经授权的用户会自动重定向到登录页</span><span class="sxs-lookup"><span data-stu-id="d9025-252">**Figure 7**: Unauthorized Users are Automatically Redirected to the Login Page</span></span>  
<span data-ttu-id="d9025-253">([单击此项可查看原尺寸图像](logging-error-details-with-elmah-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="d9025-253">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image19.png))</span></span>

### <a name="programmatically-logging-errors"></a><span data-ttu-id="d9025-254">以编程方式记录错误</span><span class="sxs-lookup"><span data-stu-id="d9025-254">Programmatically Logging Errors</span></span>

<span data-ttu-id="d9025-255">ELMAH 的`ErrorLogModule`HTTP 模块将自动记录到指定的日志源的未经处理的异常。</span><span class="sxs-lookup"><span data-stu-id="d9025-255">ELMAH's `ErrorLogModule` HTTP Module automatically logs unhandled exceptions to the specified log source.</span></span> <span data-ttu-id="d9025-256">此外，还可以记录错误而无需使用引发未经处理的异常`ErrorSignal`类并将其`Raise`方法。</span><span class="sxs-lookup"><span data-stu-id="d9025-256">Alternatively, you can log an error without having to raise an unhandled exception by using the `ErrorSignal` class and its `Raise` method.</span></span> <span data-ttu-id="d9025-257">`Raise`方法传递`Exception`对象并将其记录该异常被引发了异常且已达到 ASP.NET 运行时无需处理。</span><span class="sxs-lookup"><span data-stu-id="d9025-257">The `Raise` method is passed an `Exception` object and logs it as if that exception had been thrown and had reached the ASP.NET runtime without being handled.</span></span> <span data-ttu-id="d9025-258">这种区别，但该请求将继续正常后执行`Raise`已调用了方法，而引发的未经处理异常中断请求的正常执行，并会导致 ASP.NET 运行时，若要显示已配置错误页。</span><span class="sxs-lookup"><span data-stu-id="d9025-258">The difference, however, is that the request continues executing normally after the `Raise` method has been called, whereas a thrown, unhandled exception interrupts the request's normal execution and causes the ASP.NET runtime to display the configured error page.</span></span>

<span data-ttu-id="d9025-259">`ErrorSignal`类是在其中某项操作，可能会失败，但其失败并不是灾难性的整体操作正在执行的情况下很有用。</span><span class="sxs-lookup"><span data-stu-id="d9025-259">The `ErrorSignal` class is useful in situations where there is some action that may fail, but its failure is not catastrophic to the overall operation being performed.</span></span> <span data-ttu-id="d9025-260">例如，网站可能包含一个窗体，接受用户的输入、 将其存储在数据库中，然后将用户发送一封电子邮件，告知他们他们已处理的信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-260">For instance, a website may contain a form that takes the user's input, stores it in a database, and then sends the user an email informing them that they information was processed.</span></span> <span data-ttu-id="d9025-261">如果信息保存到数据库已成功，但存在错误时发送电子邮件消息，则应发生什么情况？</span><span class="sxs-lookup"><span data-stu-id="d9025-261">What should happen if the information is saved to the database successfully, but there is an error when sending the email message?</span></span> <span data-ttu-id="d9025-262">一种方法是引发异常，并向用户发送到错误页。</span><span class="sxs-lookup"><span data-stu-id="d9025-262">One option would be to throw an exception and send the user to the error page.</span></span> <span data-ttu-id="d9025-263">但是，这可能会让用户迷惑误以为不保存这些输入的信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-263">However, this might confuse the user into thinking that the information they entered was not saved.</span></span> <span data-ttu-id="d9025-264">另一种方法是记录与电子邮件相关的错误，但不是会更改以任何方式的用户的体验。</span><span class="sxs-lookup"><span data-stu-id="d9025-264">Another approach would be to log the email-related error, but not alter the user's experience in any way.</span></span> <span data-ttu-id="d9025-265">这就是`ErrorSignal`类很有用。</span><span class="sxs-lookup"><span data-stu-id="d9025-265">This is where the `ErrorSignal` class is useful.</span></span>

[!code-csharp[Main](logging-error-details-with-elmah-cs/samples/sample6.cs)]

## <a name="error-notification-via-email"></a><span data-ttu-id="d9025-266">通过电子邮件的错误通知</span><span class="sxs-lookup"><span data-stu-id="d9025-266">Error Notification Via Email</span></span>

<span data-ttu-id="d9025-267">到数据库的日志记录错误，以及 ELMAH 还可以配置为通过电子邮件发送给指定收件人的错误详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-267">Along with logging errors to a database, ELMAH can also be configured to email error details to a specified recipient.</span></span> <span data-ttu-id="d9025-268">提供此功能`ErrorMailModule`HTTP 模块中; 因此，必须注册此 HTTP 模块中`Web.config`才能发送错误详细信息通过电子邮件。</span><span class="sxs-lookup"><span data-stu-id="d9025-268">This functionality is provided by the `ErrorMailModule` HTTP Module; therefore, you must register this HTTP Module in `Web.config` in order to send error details via email.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample7.xml)]

<span data-ttu-id="d9025-269">接下来，指定有关中的错误电子邮件的信息`<elmah>`元素的`<errorMail>`部分中，电子邮件的发件人和收件人，其使用者，该值指示是否以异步方式发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="d9025-269">Next, specify information about the error email in the `<elmah>` element's `<errorMail>` section, indicating the email's sender and recipient, the subject, and whether the email is sent asynchronously.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample8.xml)]

<span data-ttu-id="d9025-270">在准备好上述设置，每当出现运行时错误，则 ELMAH 将发送一封电子邮件到support@example.com附带错误详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-270">With the above settings in place, whenever a runtime error occurs ELMAH sends an email to support@example.com with the error details.</span></span> <span data-ttu-id="d9025-271">ELMAH 的错误电子邮件包含错误详细信息 web 页，即错误消息、 堆栈跟踪和服务器变量中显示的相同信息 (回头**图 4**并**5**)。</span><span class="sxs-lookup"><span data-stu-id="d9025-271">ELMAH's error email includes the same information shown in the error details web page, namely the error message, the stack trace, and the server variables (refer back to **Figures 4** and **5**).</span></span> <span data-ttu-id="d9025-272">错误电子邮件还包括异常详细信息黄色屏幕死机内容作为附件 (`YSOD.html`)。</span><span class="sxs-lookup"><span data-stu-id="d9025-272">The error email also includes the Exception Details Yellow Screen of Death content as an attachment (`YSOD.html`).</span></span>

<span data-ttu-id="d9025-273">**图 8**显示了 ELMAH 的错误电子邮件，请访问生成`Genre.aspx?ID=foo`。</span><span class="sxs-lookup"><span data-stu-id="d9025-273">**Figure 8** shows ELMAH's error email generated by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="d9025-274">虽然**图 8**显示仅错误消息和堆栈跟踪，则服务器变量是包含进一步向下电子邮件的正文中。</span><span class="sxs-lookup"><span data-stu-id="d9025-274">While **Figure 8** shows only the error message and stack trace, the server variables are included further down in the email's body.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image21.png)](logging-error-details-with-elmah-cs/_static/image20.png)

<span data-ttu-id="d9025-275">**图 8**： 你可以配置 ELMAH 发送错误详细信息通过电子邮件</span><span class="sxs-lookup"><span data-stu-id="d9025-275">**Figure 8**: You Can Configure ELMAH To Send Error Details Via Email</span></span>  
<span data-ttu-id="d9025-276">([单击此项可查看原尺寸图像](logging-error-details-with-elmah-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="d9025-276">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image22.png))</span></span>

## <a name="only-logging-errors-of-interest"></a><span data-ttu-id="d9025-277">仅记录感兴趣的错误</span><span class="sxs-lookup"><span data-stu-id="d9025-277">Only Logging Errors Of Interest</span></span>

<span data-ttu-id="d9025-278">默认情况下，ELMAH 记录每个未处理的异常，包括 404 和其他 HTTP 错误的详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-278">By default, ELMAH logs the details of every unhandled exception, including 404 and other HTTP errors.</span></span> <span data-ttu-id="d9025-279">您可以指示 ELMAH 忽略这些文件路径或其他类型的使用错误筛选的错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-279">You can instruct ELMAH to ignore these or other types of errors using error filtering.</span></span> <span data-ttu-id="d9025-280">ELMAH 的执行筛选逻辑`ErrorFilterModule`HTTP 模块，将需要在注册`Web.config`若要使用筛选逻辑。</span><span class="sxs-lookup"><span data-stu-id="d9025-280">The filtering logic is performed by ELMAH's `ErrorFilterModule` HTTP Module, which you'll need to register in `Web.config` in order to use the filtering logic.</span></span> <span data-ttu-id="d9025-281">中指定的筛选规则`<errorFilter>`部分。</span><span class="sxs-lookup"><span data-stu-id="d9025-281">The rules for filtering are specified in the `<errorFilter>` section.</span></span>

<span data-ttu-id="d9025-282">以下标记指示 ELMAH，记录 404 错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-282">The following markup instructs ELMAH to not log 404 errors.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample9.xml)]

> [!NOTE]
> <span data-ttu-id="d9025-283">请不要忘记，若要使用错误筛选，必须注册`ErrorFilterModule`HTTP 模块。</span><span class="sxs-lookup"><span data-stu-id="d9025-283">Don't forget, in order to use error filtering you must register the `ErrorFilterModule` HTTP Module.</span></span>


<span data-ttu-id="d9025-284">`<equal>`元素内的`<test>`部分被称为断言。</span><span class="sxs-lookup"><span data-stu-id="d9025-284">The `<equal>` element inside the `<test>` section is referred to as an assertion.</span></span> <span data-ttu-id="d9025-285">如果计算结果为 true 的断言错误则将筛选从 ELMAH 的日志。</span><span class="sxs-lookup"><span data-stu-id="d9025-285">If the assertion evaluates to true then the error is filtered from ELMAH's log.</span></span> <span data-ttu-id="d9025-286">有可用的其他断言，包括： `<greater>`， `<greater-or-equal>`， `<not-equal>`， `<lesser>`， `<lesser-or-equal>`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="d9025-286">There are other assertions available, including: `<greater>`, `<greater-or-equal>`, `<not-equal>`, `<lesser>`, `<lesser-or-equal>`, and so on.</span></span> <span data-ttu-id="d9025-287">您也可以组合使用断言`<and>`和`<or>`布尔运算符。</span><span class="sxs-lookup"><span data-stu-id="d9025-287">You can also combine assertions using the `<and>` and `<or>` Boolean operators.</span></span> <span data-ttu-id="d9025-288">更重要的是，甚至可以包括一个简单的 JavaScript 表达式用作断言，或在 C# 或 Visual Basic 中编写您自己断言。</span><span class="sxs-lookup"><span data-stu-id="d9025-288">What's more, you can even include a simple JavaScript expression as an assertion, or write your own assertions in C# or Visual Basic.</span></span>

<span data-ttu-id="d9025-289">有关筛选功能的 ELMAH 的错误的详细信息，请参阅[错误筛选部分](https://code.google.com/p/elmah/wiki/ErrorFiltering)中[ELMAH wiki](https://code.google.com/p/elmah/w/list)。</span><span class="sxs-lookup"><span data-stu-id="d9025-289">For more information on ELMAH's error filtering capabilities, refer to the [Error Filtering section](https://code.google.com/p/elmah/wiki/ErrorFiltering) in the [ELMAH wiki](https://code.google.com/p/elmah/w/list).</span></span>

## <a name="summary"></a><span data-ttu-id="d9025-290">总结</span><span class="sxs-lookup"><span data-stu-id="d9025-290">Summary</span></span>

<span data-ttu-id="d9025-291">ELMAH 提供了一种简单但功能强大的机制，用于将 ASP.NET web 应用程序中的日志记录错误。</span><span class="sxs-lookup"><span data-stu-id="d9025-291">ELMAH provides a simple, yet powerful mechanism for logging errors in an ASP.NET web application.</span></span> <span data-ttu-id="d9025-292">Microsoft 的运行状况监视系统，如 ELMAH 可以将错误记录到数据库，并可以向开发人员通过电子邮件发送错误详细信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-292">Like Microsoft's health monitoring system, ELMAH can log errors to a database and can send the error details to a developer via email.</span></span> <span data-ttu-id="d9025-293">与不同的运行状况监控系统，elmah 却包含现成支持的更广泛的错误日志数据存储，包括： Microsoft SQL Server、 Microsoft Access、 Oracle、 XML 文件，以及其他几个人。</span><span class="sxs-lookup"><span data-stu-id="d9025-293">Unlike the health monitoring system, ELMAH includes out of the box support for a wider range of error log data stores, including: Microsoft SQL Server, Microsoft Access, Oracle, XML files, and several others.</span></span> <span data-ttu-id="d9025-294">此外，ELMAH 提供了用于查看错误日志和 web 页上，从特定错误的详细信息的内置机制`elmah.axd`。</span><span class="sxs-lookup"><span data-stu-id="d9025-294">Moreover, ELMAH offers a built-in mechanism for viewing the error log and details about a specific error from a web page, `elmah.axd`.</span></span> <span data-ttu-id="d9025-295">`elmah.axd`页还可以呈现为 RSS 源或为逗号分隔值文件 (CSV)，它可以使用 Microsoft Excel 读取的错误信息。</span><span class="sxs-lookup"><span data-stu-id="d9025-295">The `elmah.axd` page can also render error information as an RSS feed or as a comma-separated value file (CSV), which you can read using Microsoft Excel.</span></span> <span data-ttu-id="d9025-296">您可以从使用声明性或以编程方式断言日志筛选器的错误指示 ELMAH。</span><span class="sxs-lookup"><span data-stu-id="d9025-296">You can also instruct ELMAH to filter errors from the log using declarative or programmatic assertions.</span></span> <span data-ttu-id="d9025-297">和 ELMAH 可与 ASP.NET 1.x 版应用程序。</span><span class="sxs-lookup"><span data-stu-id="d9025-297">And ELMAH can be used with ASP.NET version 1.x applications.</span></span>

<span data-ttu-id="d9025-298">每个已部署的应用程序应具有一些机制来自动记录未处理的异常并将通知发送给开发团队。</span><span class="sxs-lookup"><span data-stu-id="d9025-298">Every deployed application should have some mechanism for automatically logging unhandled exceptions and sending notification to the development team.</span></span> <span data-ttu-id="d9025-299">是否使用运行状况监视或 ELMAH 完成这是辅助。</span><span class="sxs-lookup"><span data-stu-id="d9025-299">Whether this is accomplished using health monitoring or ELMAH is secondary.</span></span> <span data-ttu-id="d9025-300">换而言之，并不真正重要得多使用运行状况监视还是 ELMAH;计算两个系统，然后选择最适合你的需求。</span><span class="sxs-lookup"><span data-stu-id="d9025-300">In other words, it doesn't really matter much whether you use health monitoring or ELMAH; evaluate both systems and then choose the one that best fits your needs.</span></span> <span data-ttu-id="d9025-301">从根本上说重要的是某种机制将采取的措施，在生产环境中记录未处理的异常。</span><span class="sxs-lookup"><span data-stu-id="d9025-301">What is fundamentally important is that some mechanism be put in place to log unhandled exceptions in the production environment.</span></span>

<span data-ttu-id="d9025-302">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="d9025-302">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d9025-303">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="d9025-303">Further Reading</span></span>

<span data-ttu-id="d9025-304">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="d9025-304">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d9025-305">ELMAH 的错误日志记录模块和处理程序</span><span class="sxs-lookup"><span data-stu-id="d9025-305">ELMAH - Error Logging Modules and Handlers</span></span>](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)
- <span data-ttu-id="d9025-306">[ELMAH 项目页](https://code.google.com/p/elmah/)（来源为代码、 示例、 wiki）</span><span class="sxs-lookup"><span data-stu-id="d9025-306">[ELMAH Project Page](https://code.google.com/p/elmah/) (source code, samples, wiki)</span></span>
- <span data-ttu-id="d9025-307">[插入 ELMAH 到 Web 应用程序一捕获未经处理的异常](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx)（视频）</span><span class="sxs-lookup"><span data-stu-id="d9025-307">[Plugging ELMAH Into a Web Application to Catch Unhandled Exceptions](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx) (video)</span></span>
- [<span data-ttu-id="d9025-308">安全错误日志页</span><span class="sxs-lookup"><span data-stu-id="d9025-308">Security Error Log Pages</span></span>](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages)
- [<span data-ttu-id="d9025-309">使用 HTTP 模块和处理程序来创建可插入的 ASP.NET 组件</span><span class="sxs-lookup"><span data-stu-id="d9025-309">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="d9025-310">网站安全教程</span><span class="sxs-lookup"><span data-stu-id="d9025-310">Website Security Tutorials</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)

> [!div class="step-by-step"]
> <span data-ttu-id="d9025-311">[上一页](logging-error-details-with-asp-net-health-monitoring-cs.md)
> [下一页](precompiling-your-website-cs.md)</span><span class="sxs-lookup"><span data-stu-id="d9025-311">[Previous](logging-error-details-with-asp-net-health-monitoring-cs.md)
[Next](precompiling-your-website-cs.md)</span></span>
