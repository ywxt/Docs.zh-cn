---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs
title: 核心 IIS 和 ASP.NET 开发服务器 (C#) 之间的差异 |Microsoft Docs
author: rick-anderson
description: 当测试 ASP.NET 应用程序的本地时，很可能使用 ASP.NET 开发 Web 服务器。 但是，生产网站是最有可能 pow...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2009
ms.topic: article
ms.assetid: 13a5a423-9235-4dde-b408-2fd10f791d63
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs
msc.type: authoredcontent
ms.openlocfilehash: 50f3115fd124cf058e70cab71b8c0168d242ff21
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/03/2018
ms.locfileid: "37363411"
---
<a name="core-differences-between-iis-and-the-aspnet-development-server-c"></a><span data-ttu-id="e99b7-104">IIS 和 ASP.NET 开发服务器 (C#) 之间的核心差异</span><span class="sxs-lookup"><span data-stu-id="e99b7-104">Core Differences Between IIS and the ASP.NET Development Server (C#)</span></span>
====================
<span data-ttu-id="e99b7-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e99b7-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e99b7-106">[下载代码](http://download.microsoft.com/download/4/5/F/45F815EC-8B0E-46D3-9FB8-2DC015CCA306/ASPNET_Hosting_Tutorial_06_CS.zip)或[下载 PDF](http://download.microsoft.com/download/E/8/9/E8920AE6-D441-41A7-8A77-9EF8FF970D8B/aspnet_tutorial06_WebServerDiff_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="e99b7-106">[Download Code](http://download.microsoft.com/download/4/5/F/45F815EC-8B0E-46D3-9FB8-2DC015CCA306/ASPNET_Hosting_Tutorial_06_CS.zip) or [Download PDF](http://download.microsoft.com/download/E/8/9/E8920AE6-D441-41A7-8A77-9EF8FF970D8B/aspnet_tutorial06_WebServerDiff_cs.pdf)</span></span>

> <span data-ttu-id="e99b7-107">当测试 ASP.NET 应用程序的本地时，很可能使用 ASP.NET 开发 Web 服务器。</span><span class="sxs-lookup"><span data-stu-id="e99b7-107">When testing an ASP.NET application locally, chances are you are using the ASP.NET Development Web Server.</span></span> <span data-ttu-id="e99b7-108">但是，生产网站是最有可能已通电的 IIS。</span><span class="sxs-lookup"><span data-stu-id="e99b7-108">However, the production website is most likely powered IIS.</span></span> <span data-ttu-id="e99b7-109">有一些区别这些 web 服务器如何处理请求，并且这些差异可以具有重要的结果。</span><span class="sxs-lookup"><span data-stu-id="e99b7-109">There are some differences between how these web servers handle requests, and these differences can have important consequences.</span></span> <span data-ttu-id="e99b7-110">本教程探讨的一些更无关的差异。</span><span class="sxs-lookup"><span data-stu-id="e99b7-110">This tutorial explores some of the more germane differences.</span></span>


## <a name="introduction"></a><span data-ttu-id="e99b7-111">介绍</span><span class="sxs-lookup"><span data-stu-id="e99b7-111">Introduction</span></span>

<span data-ttu-id="e99b7-112">每当用户访问的 ASP.NET 应用程序时其浏览器发送请求到网站。</span><span class="sxs-lookup"><span data-stu-id="e99b7-112">Whenever a user visits an ASP.NET application his browser sends a request to the website.</span></span> <span data-ttu-id="e99b7-113">由 web 服务器软件与 ASP.NET 运行时生成并返回所请求的资源的内容协调选取该请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-113">That request is picked up by the web server software, which coordinates with the ASP.NET runtime to generate and return the content for the requested resource.</span></span> <span data-ttu-id="e99b7-114">[**我**nternet**我**表示**S** ervices (IIS)](http://en.wikipedia.org/wiki/Internet_Information_Services)是一套服务提供的通用的基于 Internet 的功能Windows 服务器。</span><span class="sxs-lookup"><span data-stu-id="e99b7-114">The[**I** nternet **I** nformation **S** ervices (IIS)](http://en.wikipedia.org/wiki/Internet_Information_Services) are a suite of services that provide common Internet-based functionality for Windows servers.</span></span> <span data-ttu-id="e99b7-115">IIS 是 ASP.NET 应用程序在生产环境; 最常使用的 web 服务器它很可能是正在使用 web 宿主提供程序的 ASP.NET 应用程序提供服务的 web 服务器软件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-115">IIS is the most commonly used web server for ASP.NET applications in production environments; it's most likely the web server software being used by your web host provider to serve your ASP.NET application.</span></span> <span data-ttu-id="e99b7-116">IIS 还可作为 web 服务器软件在开发环境中，尽管这需要安装 IIS 并将其正确配置。</span><span class="sxs-lookup"><span data-stu-id="e99b7-116">IIS can also be used as the web server software in the development environment, although this entails installing IIS and properly configuring it.</span></span>


<span data-ttu-id="e99b7-117">ASP.NET 开发服务器是用于开发环境中; 一个替代 web 服务器选项它附带并集成到 Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="e99b7-117">The ASP.NET Development Server is an alternative web server option for the development environment; it ships with and is integrated into Visual Studio.</span></span> <span data-ttu-id="e99b7-118">除非 web 应用程序已配置为使用 IIS，ASP.NET Development Server 自动启动并用作 web 服务器访问网页从 Visual Studio 中的第一个时间。</span><span class="sxs-lookup"><span data-stu-id="e99b7-118">Unless the web application has been configured to use IIS, the ASP.NET Development Server is automatically started and used as the web server the first time you visit a web page from within Visual Studio.</span></span> <span data-ttu-id="e99b7-119">我们回到在中创建的演示 web 应用程序[*确定哪些文件需要将部署到*](determining-what-files-need-to-be-deployed-cs.md)教程是未配置为使用 IIS 这两个文件基于系统的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="e99b7-119">The demo web applications we created back in the [*Determining What Files Need to Be Deployed*](determining-what-files-need-to-be-deployed-cs.md) tutorial were both file system-based web applications that were not configured to use IIS.</span></span> <span data-ttu-id="e99b7-120">因此，当访问 Visual Studio 中从这些网站之一使用 ASP.NET Development Server。</span><span class="sxs-lookup"><span data-stu-id="e99b7-120">Therefore, when visiting either of these websites from within Visual Studio the ASP.NET Development Server is used.</span></span>

<span data-ttu-id="e99b7-121">在理想情况下开发和生产环境将是相同的。</span><span class="sxs-lookup"><span data-stu-id="e99b7-121">In a perfect world the development and production environments would be identical.</span></span> <span data-ttu-id="e99b7-122">但是，如前面的教程中所述不常见的环境可以有不同的配置设置。</span><span class="sxs-lookup"><span data-stu-id="e99b7-122">However, as we discussed in the preceding tutorial it is not uncommon for the environments to have differing configuration settings.</span></span> <span data-ttu-id="e99b7-123">在环境中使用另一个 web 服务器软件添加部署应用程序时必须考虑的另一个变量。</span><span class="sxs-lookup"><span data-stu-id="e99b7-123">Using different web server software in the environments adds another variable that must be taken into consideration when deploying an application.</span></span> <span data-ttu-id="e99b7-124">本教程介绍了 IIS 和 ASP.NET 开发服务器之间的主要差异。</span><span class="sxs-lookup"><span data-stu-id="e99b7-124">This tutorial covers the key differences between IIS and the ASP.NET Development Server.</span></span> <span data-ttu-id="e99b7-125">由于这些差异是的情形，在开发环境中良好运行的代码将引发异常或以不同的方式在生产环境中执行时的行为。</span><span class="sxs-lookup"><span data-stu-id="e99b7-125">Because of these differences there are scenarios where code that runs flawlessly in the development environment throws an exception or behaves differently when executed in production.</span></span>

## <a name="security-context-differences"></a><span data-ttu-id="e99b7-126">安全上下文的差异</span><span class="sxs-lookup"><span data-stu-id="e99b7-126">Security Context Differences</span></span>

<span data-ttu-id="e99b7-127">每当 web 服务器软件处理传入的请求时它将与特定的安全上下文关联该请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-127">Whenever the web server software handles an incoming request it associates that request with a particular security context.</span></span> <span data-ttu-id="e99b7-128">操作系统使用此安全上下文信息以确定哪些操作允许该请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-128">This security context information is used by the operating system to determine what actions are permissible by the request.</span></span> <span data-ttu-id="e99b7-129">例如，ASP.NET 页面可能包含某些消息记录到磁盘上的文件的代码。</span><span class="sxs-lookup"><span data-stu-id="e99b7-129">For example, an ASP.NET page might include code that logs some message to a file on disk.</span></span> <span data-ttu-id="e99b7-130">为了使此 ASP.NET 页后，可以执行不会出错，安全上下文必须具有相应的文件系统级别的权限，即写入该文件上的权限。</span><span class="sxs-lookup"><span data-stu-id="e99b7-130">In order for this ASP.NET page to execute without error, the security context must have the appropriate file system-level permissions, namely write permissions on that file.</span></span>

<span data-ttu-id="e99b7-131">ASP.NET Development Server 将传入请求与当前登录用户的安全上下文相关联。</span><span class="sxs-lookup"><span data-stu-id="e99b7-131">The ASP.NET Development Server associates incoming requests with the security context of the currently logged on user.</span></span> <span data-ttu-id="e99b7-132">如果登录到您的桌面以管理员身份，ASP.NET 开发服务器提供的 ASP.NET 页面将具有相同的访问权限，以管理员身份。</span><span class="sxs-lookup"><span data-stu-id="e99b7-132">If you are logged on to your desktop as an administrator, then the ASP.NET pages served by the ASP.NET Development Server will have the same access rights as an administrator.</span></span> <span data-ttu-id="e99b7-133">但是，由 IIS 处理 ASP.NET 请求是与特定的计算机帐户相关联。</span><span class="sxs-lookup"><span data-stu-id="e99b7-133">However, ASP.NET requests handled by IIS are associated with a specific machine account.</span></span> <span data-ttu-id="e99b7-134">默认情况下，网络服务计算机帐户使用由 IIS 版本 6 和 7，尽管 web 主机提供商可能已配置的唯一帐户，每个客户。</span><span class="sxs-lookup"><span data-stu-id="e99b7-134">By default, the Network Service machine account is used by IIS versions 6 and 7, although your web host provider may have configured a unique account for each customer.</span></span> <span data-ttu-id="e99b7-135">更重要的是，web 主机提供商可能提供到此计算机帐户的有限的权限。</span><span class="sxs-lookup"><span data-stu-id="e99b7-135">What's more, your web host provider has likely given limited permissions to this machine account.</span></span> <span data-ttu-id="e99b7-136">最终结果是，您可能必须在开发环境中正确执行，但在生产环境中生成与授权相关的异常时托管的网页。</span><span class="sxs-lookup"><span data-stu-id="e99b7-136">The net result is that you may have web pages that execute without error in the development environment, but generate authorization-related exceptions when hosted in the production environment.</span></span>

<span data-ttu-id="e99b7-137">我的书评网站中的某人创建存储的最新的日期和时间的磁盘上的文件创建了一个页面在操作中展示此类错误查看*教您自己 ASP.NET 3.5 24 小时内*查看。</span><span class="sxs-lookup"><span data-stu-id="e99b7-137">To show this type of error in action I've created a page in the Book Reviews website that creates a file on disk that stores the most recent date and time someone viewed the *Teach Yourself ASP.NET 3.5 in 24 Hours* review.</span></span> <span data-ttu-id="e99b7-138">若要跟着介绍一起操作，打开`~/Tech/TYASP35.aspx`页上，添加以下代码`Page_Load`事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="e99b7-138">To follow along, open the `~/Tech/TYASP35.aspx` page and add the following code to the `Page_Load` event handler:</span></span>

[!code-csharp[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample1.cs)]

> [!NOTE]
> <span data-ttu-id="e99b7-139">[ `File.WriteAllText`方法](https://msdn.microsoft.com/library/system.io.file.writealltext.aspx)创建一个新文件，如果它不存在，然后向其中写入指定的内容。</span><span class="sxs-lookup"><span data-stu-id="e99b7-139">The [`File.WriteAllText` method](https://msdn.microsoft.com/library/system.io.file.writealltext.aspx) creates a new file if it does not exist and then writes the specified contents to it.</span></span> <span data-ttu-id="e99b7-140">如果该文件已存在，则会覆盖现有内容。</span><span class="sxs-lookup"><span data-stu-id="e99b7-140">If the file already exists, it's existing content is overwritten.</span></span>


<span data-ttu-id="e99b7-141">接下来，请访问*教您自己 ASP.NET 3.5 24 小时内*使用 ASP.NET 开发服务器在开发环境中的通讯簿查看页。</span><span class="sxs-lookup"><span data-stu-id="e99b7-141">Next, visit the *Teach Yourself ASP.NET 3.5 in 24 Hours* book review page in the development environment using the ASP.NET Development Server.</span></span> <span data-ttu-id="e99b7-142">假设你登录到您的计算机使用的帐户有足够的权限来创建和修改的文本文件中 web 应用程序的根目录书评出现与之前相同，但该页是每次访问日期和时间以及用户的 IP 地址存储在`LastTYASP35Access.txt`文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-142">Assuming that you are logged on to your computer with an account that has adequate permissions to create and modify a text file in the web application's root directory the book review appears the same as before, but each time the page is visited the date and time and user's IP address is stored in the `LastTYASP35Access.txt` file.</span></span> <span data-ttu-id="e99b7-143">在浏览器指向此文件;应看到类似于图 1 中所示的消息。</span><span class="sxs-lookup"><span data-stu-id="e99b7-143">Point your browser to this file; you should see a message similar to the one shown in Figure 1.</span></span>


<span data-ttu-id="e99b7-144">[![文本文件包含的最后一个日期和时间访问过书籍评论](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image2.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e99b7-144">[![The Text File Contains the Last Date and Time the Book Review was Visited](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image2.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image1.png)</span></span>

<span data-ttu-id="e99b7-145">**图 1**： 文本文件包含的最后一个日期和时间访问过书籍评论 ([单击以查看实际尺寸的图像](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e99b7-145">**Figure 1**: The Text File Contains the Last Date and Time the Book Review was Visited ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image3.png))</span></span>


<span data-ttu-id="e99b7-146">部署到生产 web 应用程序，然后访问承载*教您自己 ASP.NET 3.5 24 小时内*书籍查看页。</span><span class="sxs-lookup"><span data-stu-id="e99b7-146">Deploy the web application to production and then visit the hosted *Teach Yourself ASP.NET 3.5 in 24 Hours* book review page.</span></span> <span data-ttu-id="e99b7-147">此时你应为 normal 或图 2 所示的错误消息显示书籍查看页。</span><span class="sxs-lookup"><span data-stu-id="e99b7-147">At this point you should either see the book review page as normal or the error message shown in Figure 2.</span></span> <span data-ttu-id="e99b7-148">某些 web 宿主提供程序授予对匿名的 ASP.NET 计算机帐户，在其中用例页面无错误的写入权限。</span><span class="sxs-lookup"><span data-stu-id="e99b7-148">Some web host providers grant write permissions to the anonymous ASP.NET machine account, in which case the page will work without error.</span></span> <span data-ttu-id="e99b7-149">如果，但是，web 主机提供商禁止匿名帐户的写访问权限，然后[`UnauthorizedAccessException`异常](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx)时，将引发`TYASP35.aspx`的页面尝试编写的当前日期和时间`LastTYASP35Access.txt`文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-149">If, however, your web host provider prohibits write access for the anonymous account then an [`UnauthorizedAccessException` exception](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx) is raised when the `TYASP35.aspx` page attempts to write the current date and time to the `LastTYASP35Access.txt` file.</span></span>


<span data-ttu-id="e99b7-150">[![使用 IIS 的默认计算机帐户没有写入到文件系统权限](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image5.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e99b7-150">[![The Default Machine Account Used by IIS Does Not Have Permissions to Write to the File System](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image5.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image4.png)</span></span>

<span data-ttu-id="e99b7-151">**图 2**: 默认计算机帐户由 IIS 不会不有权写入到文件系统 ([单击以查看实际尺寸的图像](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e99b7-151">**Figure 2**: The Default Machine Account Used by IIS Does Not Have Permissions to Write to the File System ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image6.png))</span></span>


<span data-ttu-id="e99b7-152">好消息是大多数 web 主机提供商具有某种权限工具，可在你的网站中指定文件系统权限。</span><span class="sxs-lookup"><span data-stu-id="e99b7-152">The good news is that most web host providers have some sort of permissions tool that allows you to specify file system permissions in your website.</span></span> <span data-ttu-id="e99b7-153">授予匿名 ASP.NET 帐户写入访问权限的根目录，然后重新审视书籍查看页。</span><span class="sxs-lookup"><span data-stu-id="e99b7-153">Grant the anonymous ASP.NET account write access to the root directory and then revisit the book review page.</span></span> <span data-ttu-id="e99b7-154">（如果需要请联系您的 web 主机提供商寻求帮助如何授予到默认的 ASP.NET 帐户的写入权限。）此页应加载没有错误的时间和`LastTYASP35Access.txt`应已成功创建文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-154">(If needed, contact your web host provider for assistance on how to grant write permissions to the default ASP.NET account.) This time the page should load without error and the `LastTYASP35Access.txt` file should be created successfully.</span></span>

<span data-ttu-id="e99b7-155">Take 掉下面是，由于 ASP.NET Development Server 比 IIS 不同的安全上下文下运行，所以有可能，ASP.NET 页的读取或写入到文件系统中，从读取或写入到 Windows 事件日志中，或读取或写入到 Windows 注册表将开发上按预期运行，但会生成生产上的异常。</span><span class="sxs-lookup"><span data-stu-id="e99b7-155">The take away here is that because the ASP.NET Development Server operates under a different security context than IIS, it is possible that your ASP.NET pages that read or write to the file system, read from or write to the Windows Event Log, or read or write to the Windows registry will work as expected on development but generate exceptions when on production.</span></span> <span data-ttu-id="e99b7-156">在构建 web 应用程序将部署到共享 web 托管环境中，不读取或写入事件日志或 Windows 注册表。</span><span class="sxs-lookup"><span data-stu-id="e99b7-156">When building a web application that will be deployed to a shared web hosting environment, do not read or write to the Event Log or the Windows registry.</span></span> <span data-ttu-id="e99b7-157">此外请注意，读取或写入文件系统，因为可能需要授予读取和写入上相应的文件夹的权限在生产环境中任何 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="e99b7-157">Also take note of any ASP.NET pages that read from or write to the file system as you may need to grant read and write privileges on the appropriate folders in the production environment.</span></span>

## <a name="differences-on-serving-static-content"></a><span data-ttu-id="e99b7-158">提供静态内容上的差异</span><span class="sxs-lookup"><span data-stu-id="e99b7-158">Differences On Serving Static Content</span></span>

<span data-ttu-id="e99b7-159">IIS 和 ASP.NET 开发服务器之间的另一个核心区别是它们如何处理对静态内容的请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-159">Another core difference between IIS and the ASP.NET Development Server is how they handle requests for static content.</span></span> <span data-ttu-id="e99b7-160">进入 ASP.NET Development Server，无论是用于 ASP.NET 页、 图像或一个 JavaScript 文件，每个请求由 ASP.NET 运行时处理。</span><span class="sxs-lookup"><span data-stu-id="e99b7-160">Every request that comes into the ASP.NET Development Server, whether for an ASP.NET page, an image, or a JavaScript file, is processed by the ASP.NET runtime.</span></span> <span data-ttu-id="e99b7-161">默认情况下，IIS 仅调用 ASP.NET 运行时对于 ASP.NET 资源，例如 ASP.NET 网页、 Web 服务等传入的请求时。</span><span class="sxs-lookup"><span data-stu-id="e99b7-161">By default, IIS only invokes the ASP.NET runtime when a request comes in for an ASP.NET resource, such as an ASP.NET web page, a Web Service, and so forth.</span></span> <span data-ttu-id="e99b7-162">通过 IIS 而不涉及 ASP.NET 运行时检索的静态内容的图像、 CSS 文件、 JavaScript 文件、 PDF 文件、 ZIP 文件和类似的请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-162">Requests for static content - images, CSS files, JavaScript files, PDF files, ZIP files, and the like - are retrieved by IIS without the involvement of the ASP.NET runtime.</span></span> <span data-ttu-id="e99b7-163">（它是可能会指示 IIS 以便与 ASP.NET 运行时一起使用时提供静态内容; 在本教程，了解详细信息请参阅的"执行基于窗体的身份验证和上使用 IIS 7 的静态文件的 URL 身份验证"部分。）</span><span class="sxs-lookup"><span data-stu-id="e99b7-163">(It is possible to instruct IIS to work with the ASP.NET runtime when serving static content; consult the "Performing Forms-Based Authentication and URL Authentication on Static Files with IIS 7" section in this tutorial for more information.)</span></span>

<span data-ttu-id="e99b7-164">ASP.NET 运行时执行若干步骤来生成请求的内容，包括 （标识请求者） 的身份验证和授权 （如果请求者有权查看请求的内容确定）。</span><span class="sxs-lookup"><span data-stu-id="e99b7-164">The ASP.NET runtime performs a number of steps to generate the requested content, including authentication (identifying the requestor) and authorization (determining if the requestor has permission to view the requested content).</span></span> <span data-ttu-id="e99b7-165">常用形式的身份验证是*基于窗体的身份验证*中的用户标识通过到文本框中输入其凭据 （通常的用户名和密码），在网页上。</span><span class="sxs-lookup"><span data-stu-id="e99b7-165">A popular form of authentication is *forms-based authentication*, in which a user is identified by entering their credentials - usually a username and password - into textboxes on a web page.</span></span> <span data-ttu-id="e99b7-166">在验证其凭据，网站将存储*身份验证票证*上用户的浏览器中，这与每个后续请求发送到网站和内容使用，用于对用户进行身份验证 cookie。</span><span class="sxs-lookup"><span data-stu-id="e99b7-166">Upon validating their credentials, the website stores an *authentication ticket* cookie on the user's browser, which is sent with every subsequent request to the website and is what is used to authenticate the user.</span></span> <span data-ttu-id="e99b7-167">此外，就可以指定*URL 授权*规则，规定哪些用户可以或无法访问特定文件夹。</span><span class="sxs-lookup"><span data-stu-id="e99b7-167">Moreover, it is possible to specify *URL authorization* rules that dictate what users can or cannot access a particular folder.</span></span> <span data-ttu-id="e99b7-168">许多 ASP.NET 网站使用基于窗体的身份验证和授权 URL 来支持用户帐户并定义才可供身份验证的用户或属于某一特定角色的用户访问站点的部分。</span><span class="sxs-lookup"><span data-stu-id="e99b7-168">Many ASP.NET websites use forms-based authentication and URL authorization to support user accounts and to define portions of the site that are only accessible to authenticated users or users that belong to a certain role.</span></span>

> [!NOTE]
> <span data-ttu-id="e99b7-169">有关对 ASP 的全面检查。NET 的基于窗体的身份验证、 URL 授权和其他用户帐户相关的功能，请确保在签出我[网站安全教程](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="e99b7-169">For a thorough examination of ASP.NET's forms-based authentication, URL authorization, and other user account-related features, be sure to check out my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>


<span data-ttu-id="e99b7-170">请考虑可支持使用基于窗体的授权的用户帐户和具有的文件夹，使用 URL 授权配置为仅允许经过身份验证的用户的网站。</span><span class="sxs-lookup"><span data-stu-id="e99b7-170">Consider a website that supports user accounts using forms-based authorization and has a folder that, using URL authorization, is configured to only allow authenticated users.</span></span> <span data-ttu-id="e99b7-171">假设此文件夹包含 ASP.NET 页的 PDF 文件和其目的是，仅身份验证的用户可以查看这些 PDF 文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-171">Imagine that this folder contains ASP.NET pages and PDF files and that the intent is that only authenticated users can view these PDF files.</span></span>

<span data-ttu-id="e99b7-172">如果访问者尝试通过直接在其浏览器地址栏中输入 URL 来查看其中一个 PDF 文件，会发生什么情况？</span><span class="sxs-lookup"><span data-stu-id="e99b7-172">What happens if a visitor attempts to view one of these PDF files by entering the URL directly in his browser's Address bar?</span></span> <span data-ttu-id="e99b7-173">若要了解，让我们在书评站点中创建一个新的文件夹、 添加一些 PDF 文件，和将站点配置为使用 URL 授权，禁止匿名用户访问此文件夹。</span><span class="sxs-lookup"><span data-stu-id="e99b7-173">To find out, let's create a new folder in the Book Reviews site, add some PDF files, and configure the site to use URL authorization to prohibit anonymous users from visiting this folder.</span></span> <span data-ttu-id="e99b7-174">如果下载演示应用程序，您将看到我创建一个名为文件夹`PrivateDocs`并添加从 PDF 我[网站安全教程](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)（如何配适 ！）。</span><span class="sxs-lookup"><span data-stu-id="e99b7-174">If you download the demo application you'll see that I created a folder called `PrivateDocs` and added a PDF from my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md) (how fitting!).</span></span> <span data-ttu-id="e99b7-175">`PrivateDocs`文件夹还包含`Web.config`指定 URL 授权规则以拒绝匿名用户的文件：</span><span class="sxs-lookup"><span data-stu-id="e99b7-175">The `PrivateDocs` folder also contains a `Web.config` file that specifies the URL authorization rules to deny anonymous users:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample2.xml)]

<span data-ttu-id="e99b7-176">最后，我配置了 web 应用程序使用基于窗体的身份验证通过更新`Web.config`的根目录中的文件替换为：</span><span class="sxs-lookup"><span data-stu-id="e99b7-176">Finally, I configured the web application to use forms-based authentication by updating the `Web.config` file in the root directory, replacing:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample3.xml)]

<span data-ttu-id="e99b7-177">替换为：</span><span class="sxs-lookup"><span data-stu-id="e99b7-177">With:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample4.xml)]

<span data-ttu-id="e99b7-178">使用 ASP.NET 开发服务器，请访问网站和直接 URL 输入到浏览器地址栏中的 PDF 文件之一。</span><span class="sxs-lookup"><span data-stu-id="e99b7-178">Using the ASP.NET Development Server, visit the site and enter the direct URL to one of the PDF files in your browser's Address bar.</span></span> <span data-ttu-id="e99b7-179">如果您下载与本教程中的 URL 应如下所示关联的网站： `http://localhost:portNumber/PrivateDocs/aspnet_tutorial01_Basics_vb.pdf`</span><span class="sxs-lookup"><span data-stu-id="e99b7-179">If you downloaded the website associated with this tutorial the URL should look something like: `http://localhost:portNumber/PrivateDocs/aspnet_tutorial01_Basics_vb.pdf`</span></span>

<span data-ttu-id="e99b7-180">在地址栏中输入此 URL 会导致浏览器将请求发送到 ASP.NET 开发服务器的文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-180">Entering this URL into the Address bar causes the browser to send a request to the ASP.NET Development Server for the file.</span></span> <span data-ttu-id="e99b7-181">ASP.NET Development Server 移交给 ASP.NET 运行时进行处理的请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-181">The ASP.NET Development Server hands off the request to the ASP.NET runtime for processing.</span></span> <span data-ttu-id="e99b7-182">因为我们尚未登录，并且`Web.config`中`PrivateDocs`文件夹配置为拒绝匿名访问，ASP.NET 运行时自动重我们定向到登录页上， `Login.aspx` （参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="e99b7-182">Because we have not yet logged in, and because the `Web.config` in the `PrivateDocs` folder is configured to deny anonymous access, the ASP.NET runtime automatically redirects us to the login page, `Login.aspx` (see Figure 3).</span></span> <span data-ttu-id="e99b7-183">当将用户重定向到登录页，ASP.NET 包括`ReturnUrl`查询字符串参数，用于指示页面用户正在尝试查看。</span><span class="sxs-lookup"><span data-stu-id="e99b7-183">When redirecting the user to the log in page, ASP.NET includes a `ReturnUrl` querystring parameter that indicates the page the user was attempting to view.</span></span> <span data-ttu-id="e99b7-184">在用户成功登录后可以返回到此页。</span><span class="sxs-lookup"><span data-stu-id="e99b7-184">After successfully logging in the user can be returned to this page.</span></span>


<span data-ttu-id="e99b7-185">[![未经授权的用户会自动重定向到登录页](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image8.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e99b7-185">[![Unauthorized Users are Automatically Redirected to the Login Page](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image8.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image7.png)</span></span>

<span data-ttu-id="e99b7-186">**图 3**： 未经授权的用户会自动重定向到登录页 ([单击以查看实际尺寸的图像](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e99b7-186">**Figure 3**: Unauthorized Users are Automatically Redirected to the Login Page ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image9.png))</span></span>


<span data-ttu-id="e99b7-187">现在让我们了解此生产上的行为方式。</span><span class="sxs-lookup"><span data-stu-id="e99b7-187">Now let's see how this behaves on production.</span></span> <span data-ttu-id="e99b7-188">部署应用程序和直接 URL 输入到一个在 Pdf`PrivateDocs`在生产环境中的文件夹。</span><span class="sxs-lookup"><span data-stu-id="e99b7-188">Deploy your application and enter the direct URL to one of the PDFs in the `PrivateDocs` folder in production.</span></span> <span data-ttu-id="e99b7-189">这会提示你的浏览器发送请求的 IIS 的文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-189">This prompts your browser to send a request IIS for the file.</span></span> <span data-ttu-id="e99b7-190">因为请求静态文件时，IIS 检索并返回该文件而无需调用 ASP.NET 运行时。</span><span class="sxs-lookup"><span data-stu-id="e99b7-190">Because a static file is requested, IIS retrieves and returns the file without invoking the ASP.NET runtime.</span></span> <span data-ttu-id="e99b7-191">因此，执行; 没有 URL 授权检查据推测专用 PDF 内容都可以了解到的文件的直接 URL 的任何人访问。</span><span class="sxs-lookup"><span data-stu-id="e99b7-191">As a result, there was no URL authorization check performed; the contents of the supposedly private PDF are accessible to anyone who knows the direct URL to the file.</span></span>


<span data-ttu-id="e99b7-192">[![匿名用户可以通过直接 URL 输入到文件下载私有 PDF 文件](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image11.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e99b7-192">[![Anonymous Users Can Download the Private PDF Files By Entering the Direct URL to the File](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image11.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image10.png)</span></span>

<span data-ttu-id="e99b7-193">**图 4**： 匿名用户可以下载专用 PDF 文件的输入直接 URL 到文件 ([单击以查看实际尺寸的图像](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e99b7-193">**Figure 4**: Anonymous Users Can Download the Private PDF Files By Entering the Direct URL to the File ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image12.png))</span></span>


### <a name="performing-forms-based-authentication-and-url-authentication-on-static-files-with-iis-7"></a><span data-ttu-id="e99b7-194">对静态文件与 IIS 7 执行基于窗体的身份验证和 URL 身份验证</span><span class="sxs-lookup"><span data-stu-id="e99b7-194">Performing Forms-Based Authentication and URL Authentication on Static Files with IIS 7</span></span>

<span data-ttu-id="e99b7-195">有几个可以用来防止未经授权的用户的静态内容的方法。</span><span class="sxs-lookup"><span data-stu-id="e99b7-195">There are a couple of techniques you can use to protect static content from unauthorized users.</span></span> <span data-ttu-id="e99b7-196">IIS 7 引入*集成的管道*，其中结婚 IIS 的工作流与 ASP.NET 运行时的工作流。</span><span class="sxs-lookup"><span data-stu-id="e99b7-196">IIS 7 introduced the *integrated pipeline*, which marries IIS's workflow with the ASP.NET runtime's workflow.</span></span> <span data-ttu-id="e99b7-197">简单地说，您可以指示要调用 ASP.NET 运行时的身份验证和授权模块 （包括静态内容，如 PDF 文件） 的所有传入请求的 IIS。</span><span class="sxs-lookup"><span data-stu-id="e99b7-197">In a nutshell, you can instruct IIS to invoke the ASP.NET runtime's authentication and authorization modules all incoming requests (including static content like PDF files).</span></span> <span data-ttu-id="e99b7-198">与 web 主机提供商联系以了解如何配置网站以使用集成的管道。</span><span class="sxs-lookup"><span data-stu-id="e99b7-198">Contact your web host provider to find out how to configure your website to use the integrated pipeline.</span></span>

<span data-ttu-id="e99b7-199">集成的管道配置 IIS 以使用后添加以下标记到`Web.config`的根目录中的文件：</span><span class="sxs-lookup"><span data-stu-id="e99b7-199">Once IIS has been configured to use the integrated pipeline add the following markup to the `Web.config` file in the root directory:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample5.xml)]

<span data-ttu-id="e99b7-200">此标记指示 IIS 7 以使用基于 ASP.NET 的身份验证和授权模块。</span><span class="sxs-lookup"><span data-stu-id="e99b7-200">This markup instructs IIS 7 to use the ASP.NET-based authentication and authorization modules.</span></span> <span data-ttu-id="e99b7-201">重新部署你的应用程序，然后重新访问的 PDF 文件。</span><span class="sxs-lookup"><span data-stu-id="e99b7-201">Re-deploy your application and then re-visit the PDF file.</span></span> <span data-ttu-id="e99b7-202">当 IIS 将处理该请求这次它使 ASP.NET 运行时的身份验证和授权逻辑能够检查请求。</span><span class="sxs-lookup"><span data-stu-id="e99b7-202">This time when IIS handles the request it gives the ASP.NET runtime's authentication and authorization logic an opportunity to inspect the request.</span></span> <span data-ttu-id="e99b7-203">因为只有经过身份验证的用户有权查看中的内容`PrivateDocs`文件夹中，匿名访问者将自动重定向到登录页 （回头参考图 3 中）。</span><span class="sxs-lookup"><span data-stu-id="e99b7-203">Because only authenticated users are authorized to view the contents in the `PrivateDocs` folder, the anonymous visitor is automatically redirected to the login page (refer back to Figure 3).</span></span>

> [!NOTE]
> <span data-ttu-id="e99b7-204">如果您的 web 主机提供商仍在使用 IIS 6，则无法使用集成的管道功能。</span><span class="sxs-lookup"><span data-stu-id="e99b7-204">If your web host provider is still using IIS 6 then you cannot use the integrated pipeline feature.</span></span> <span data-ttu-id="e99b7-205">一种解决办法是将私有文档放入禁止 HTTP 访问的文件夹 (如`App_Data`)，然后创建页后，可以服务于这些文档。</span><span class="sxs-lookup"><span data-stu-id="e99b7-205">One workaround is to put your private documents in a folder that prohibits HTTP access (such as `App_Data`) and then create a page to serve these documents.</span></span> <span data-ttu-id="e99b7-206">此页可能会调用`GetPDF.aspx`，并传递 PDF 通过查询字符串参数的名称。</span><span class="sxs-lookup"><span data-stu-id="e99b7-206">This page might be called `GetPDF.aspx`, and is passed the name of the PDF through a querystring parameter.</span></span> <span data-ttu-id="e99b7-207">`GetPDF.aspx`页会首先验证用户有权查看该文件并且，如果是这样，将使用[ `Response.WriteFile(filePath)` ](https://msdn.microsoft.com/library/system.web.httpresponse.writefile.aspx)方法以返回到请求的客户端发送请求的 PDF 文件的内容。</span><span class="sxs-lookup"><span data-stu-id="e99b7-207">The `GetPDF.aspx` page would first verify that the user has permission to view the file and, if so, would use the [`Response.WriteFile(filePath)`](https://msdn.microsoft.com/library/system.web.httpresponse.writefile.aspx) method to send the contents of the requested PDF file back to the requesting client.</span></span> <span data-ttu-id="e99b7-208">如果不希望启用集成的管道，此方法将也适用于 IIS 7。</span><span class="sxs-lookup"><span data-stu-id="e99b7-208">This technique would also work for IIS 7 if you did not wish to enable the integrated pipeline.</span></span>


## <a name="summary"></a><span data-ttu-id="e99b7-209">总结</span><span class="sxs-lookup"><span data-stu-id="e99b7-209">Summary</span></span>

<span data-ttu-id="e99b7-210">使用 Microsoft 的 IIS web 服务器软件被托管在生产环境中的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="e99b7-210">Web applications in a production environment are hosted using Microsoft's IIS web server software.</span></span> <span data-ttu-id="e99b7-211">在开发环境中，但是，应用程序可能位于使用 IIS 或 ASP.NET 开发服务器。</span><span class="sxs-lookup"><span data-stu-id="e99b7-211">In the development environment, however, the application may be hosted using IIS or the ASP.NET Development Server.</span></span> <span data-ttu-id="e99b7-212">理想情况下，相同的 web 服务器软件应在这两个环境中由于使用不同的软件的组合中添加另一个变量。</span><span class="sxs-lookup"><span data-stu-id="e99b7-212">Ideally, the same web server software should be used in both environments because using different software adds another variable in the mix.</span></span> <span data-ttu-id="e99b7-213">但是，易于使用的 ASP.NET Development Server 使其成为一个理想选择开发环境中。</span><span class="sxs-lookup"><span data-stu-id="e99b7-213">However, the ease of use of the ASP.NET Development Server makes it an attractive choice in the development environment.</span></span> <span data-ttu-id="e99b7-214">值得高兴的是，只有几个基本差异 IIS 和 ASP.NET 开发服务器之间，如果已经知道这些差异的您可以采取措施来帮助确保应用程序工作原理和功能相同的方式而不考虑环境。</span><span class="sxs-lookup"><span data-stu-id="e99b7-214">The good news is that there are only a few fundamental differences between IIS and the ASP.NET Development Server, and if you are aware of these differences you can take steps to help ensure that the application works and functions the same way regardless of the environment.</span></span>

<span data-ttu-id="e99b7-215">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="e99b7-215">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="e99b7-216">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="e99b7-216">Further Reading</span></span>

<span data-ttu-id="e99b7-217">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="e99b7-217">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e99b7-218">使用 IIS 7.0 ASP.NET 集成</span><span class="sxs-lookup"><span data-stu-id="e99b7-218">ASP.NET Integration with IIS 7.0</span></span>](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis)
- <span data-ttu-id="e99b7-219">[与所有类型的内容在 IIS 7 上使用 ASP.NET 论坛身份验证](https://blogs.iis.net/bills/archive/2007/05/19/using-asp-net-forms-authentication-with-all-types-of-content-with-iis7-video.aspx)（视频）</span><span class="sxs-lookup"><span data-stu-id="e99b7-219">[Using ASP.NET Forums Authentication With All Types of Content on IIS 7](https://blogs.iis.net/bills/archive/2007/05/19/using-asp-net-forms-authentication-with-all-types-of-content-with-iis7-video.aspx) (Video)</span></span>
- [<span data-ttu-id="e99b7-220">Visual Web Developer 中的 web 服务器</span><span class="sxs-lookup"><span data-stu-id="e99b7-220">Web Servers in Visual Web Developer</span></span>](https://msdn.microsoft.com/library/58wxa9w5.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="e99b7-221">[上一页](common-configuration-differences-between-development-and-production-cs.md)
> [下一页](deploying-a-database-cs.md)</span><span class="sxs-lookup"><span data-stu-id="e99b7-221">[Previous](common-configuration-differences-between-development-and-production-cs.md)
[Next](deploying-a-database-cs.md)</span></span>
