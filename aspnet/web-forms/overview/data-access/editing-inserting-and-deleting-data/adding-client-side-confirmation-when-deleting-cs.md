---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs
title: 删除 (C#) 时添加客户端确认 |Microsoft Docs
author: rick-anderson
description: 在我们到目前为止已创建的接口，用户可以数据意外删除时它们应单击编辑按钮，单击删除按钮。 在此，t...
ms.author: aspnetcontent
ms.date: 07/17/2006
ms.assetid: f6e2a12a-2b5e-48fd-8db3-1e94a500c19a
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs
msc.type: authoredcontent
ms.openlocfilehash: 6cf3bfed1b445e95f24aa31fe3948cf8eba375fa
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/05/2018
ms.locfileid: "37842229"
---
<a name="adding-client-side-confirmation-when-deleting-c"></a><span data-ttu-id="ba730-104">删除 (C#) 时添加客户端的确认</span><span class="sxs-lookup"><span data-stu-id="ba730-104">Adding Client-Side Confirmation When Deleting (C#)</span></span>
====================
<span data-ttu-id="ba730-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ba730-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ba730-106">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_22_CS.exe)或[下载 PDF](adding-client-side-confirmation-when-deleting-cs/_static/datatutorial22cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ba730-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_22_CS.exe) or [Download PDF](adding-client-side-confirmation-when-deleting-cs/_static/datatutorial22cs1.pdf)</span></span>

> <span data-ttu-id="ba730-107">在我们到目前为止已创建的接口，用户可以数据意外删除时它们应单击编辑按钮，单击删除按钮。</span><span class="sxs-lookup"><span data-stu-id="ba730-107">In the interfaces we've created so far, a user can accidentally delete data by clicking the Delete button when they meant to click the Edit button.</span></span> <span data-ttu-id="ba730-108">在本教程中我们将添加一个客户端的确认对话框，单击删除按钮时出现的。</span><span class="sxs-lookup"><span data-stu-id="ba730-108">In this tutorial we'll add a client-side confirmation dialog box that appears when the Delete button is clicked.</span></span>


## <a name="introduction"></a><span data-ttu-id="ba730-109">介绍</span><span class="sxs-lookup"><span data-stu-id="ba730-109">Introduction</span></span>

<span data-ttu-id="ba730-110">在过去的几个教程通过我们已看到了如何使用我们的应用程序体系结构、 对象、 数据源和数据 Web 控件配合使用来提供插入、 编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="ba730-110">Over the past several tutorials we ve seen how to use our application architecture, ObjectDataSource, and the data Web controls in concert to provide inserting, editing, and deleting capabilities.</span></span> <span data-ttu-id="ba730-111">删除接口我们 ve 检查到目前为止已组成一个删除按钮，单击、 导致回发和调用 ObjectDataSource 的`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="ba730-111">The deleting interfaces we ve examined thus far have been composed of a Delete button that, when clicked, causes a postback and invokes the ObjectDataSource s `Delete()` method.</span></span> <span data-ttu-id="ba730-112">`Delete()`方法调用的业务逻辑层，将传播到数据访问层，发出的实际调用的配置的方法`DELETE`到数据库的语句。</span><span class="sxs-lookup"><span data-stu-id="ba730-112">The `Delete()` method then invokes the configured method from the Business Logic Layer, which propagates the call down to the Data Access Layer, issuing the actual `DELETE` statement to the database.</span></span>

<span data-ttu-id="ba730-113">虽然此用户界面可用于删除记录的 GridView、 detailsview 和 FormView 控件之间的访问者，但是它缺乏任何类型的确认，当用户单击删除按钮。</span><span class="sxs-lookup"><span data-stu-id="ba730-113">While this user interface enables visitors to delete records through the GridView, DetailsView, or FormView controls, it lacks any sort of confirmation when the user clicks the Delete button.</span></span> <span data-ttu-id="ba730-114">如果用户意外地单击删除按钮时它们应单击编辑，它们是要更新的记录将改为删除。</span><span class="sxs-lookup"><span data-stu-id="ba730-114">If a user accidentally clicks the Delete button when they meant to click Edit, the record they meant to update will instead be deleted.</span></span> <span data-ttu-id="ba730-115">为了帮助避免此情形，在本教程中我们将添加一个客户端的确认对话框，单击删除按钮时出现的。</span><span class="sxs-lookup"><span data-stu-id="ba730-115">To help prevent this, in this tutorial we'll add a client-side confirmation dialog box that appears when the Delete button is clicked.</span></span>

<span data-ttu-id="ba730-116">JavaScript`confirm(string)`函数将其字符串输入的参数显示为模式对话框，配备了两个按钮的确定和取消 （参见图 1） 内的文本。</span><span class="sxs-lookup"><span data-stu-id="ba730-116">The JavaScript `confirm(string)` function displays its string input parameter as the text inside a modal dialog box that comes equipped with two buttons - OK and Cancel (see Figure 1).</span></span> <span data-ttu-id="ba730-117">`confirm(string)`函数将返回一个布尔值，具体取决于单击哪个按钮 (`true`，如果用户单击确定，并`false`如果他们单击取消)。</span><span class="sxs-lookup"><span data-stu-id="ba730-117">The `confirm(string)` function returns a Boolean value depending on what button is clicked (`true`, if the user clicks OK, and `false` if they click Cancel).</span></span>


![JavaScript confirm(string) 方法显示在安装结束时，客户端的消息框](adding-client-side-confirmation-when-deleting-cs/_static/image1.png)

<span data-ttu-id="ba730-119">**图 1**: JavaScript`confirm(string)`方法显示一个模式，客户端的消息框</span><span class="sxs-lookup"><span data-stu-id="ba730-119">**Figure 1**: The JavaScript `confirm(string)` Method Displays a Modal, Client-Side Messagebox</span></span>


<span data-ttu-id="ba730-120">在窗体提交，如果值为`false`返回，则从客户端事件处理程序已取消提交窗体。</span><span class="sxs-lookup"><span data-stu-id="ba730-120">During a form submission, if a value of `false` is returned from a client-side event handler then the form submission is cancelled.</span></span> <span data-ttu-id="ba730-121">使用此功能，我们可以让删除按钮的客户端`onclick`事件处理程序返回的值对的调用`confirm("Are you sure you want to delete this product?")`。</span><span class="sxs-lookup"><span data-stu-id="ba730-121">Using this feature, we can have the Delete button s client-side `onclick` event handler return the value of a call to `confirm("Are you sure you want to delete this product?")`.</span></span> <span data-ttu-id="ba730-122">如果用户单击取消，`confirm(string)`将返回 false，从而导致取消提交窗体。</span><span class="sxs-lookup"><span data-stu-id="ba730-122">If the user clicks Cancel, `confirm(string)` will return false, thereby causing the form submission to cancel.</span></span> <span data-ttu-id="ba730-123">无回发时，删除结束-赢得 t 的删除按钮被单击的产品。</span><span class="sxs-lookup"><span data-stu-id="ba730-123">With no postback, the product whose Delete button was clicked won t be deleted.</span></span> <span data-ttu-id="ba730-124">如果，但是，用户单击确定确认对话框中的，回发将继续减弱，将删除该产品。</span><span class="sxs-lookup"><span data-stu-id="ba730-124">If, however, the user clicks OK in the confirmation dialog box, the postback will continue unabated and the product will be deleted.</span></span> <span data-ttu-id="ba730-125">请查阅[使用 JavaScript s`confirm()`方法控制窗体提交到](http://www.webreference.com/programming/javascript/confirm/)有关此技术的详细信息。</span><span class="sxs-lookup"><span data-stu-id="ba730-125">Consult [Using JavaScript s `confirm()` Method to Control Form Submission](http://www.webreference.com/programming/javascript/confirm/) for more information on this technique.</span></span>

<span data-ttu-id="ba730-126">会稍有添加所需的客户端脚本不同，如果使用的模板与使用 CommandField 相比。</span><span class="sxs-lookup"><span data-stu-id="ba730-126">Adding the necessary client-side script differs slightly if using templates than when using a CommandField.</span></span> <span data-ttu-id="ba730-127">因此，在本教程中我们将看 FormView 和 GridView 示例。</span><span class="sxs-lookup"><span data-stu-id="ba730-127">Therefore, in this tutorial we will look at both a FormView and GridView example.</span></span>

> [!NOTE]
> <span data-ttu-id="ba730-128">使用客户端确认技术，所讨论在本教程中，假定您的用户正在使用支持 JavaScript 的浏览器访问，并且必须启用 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="ba730-128">Using client-side confirmation techniques, like the ones discussed in this tutorial, assumes that your users are visiting with browsers that support JavaScript and that they have JavaScript enabled.</span></span> <span data-ttu-id="ba730-129">如果这些假设任一特定用户，则返回 true，单击删除按钮将立即导致回发 （不显示确认消息框）。</span><span class="sxs-lookup"><span data-stu-id="ba730-129">If either of these assumptions are not true for a particular user, clicking the Delete button will immediately cause a postback (not displaying a confirm messagebox).</span></span>


## <a name="step-1-creating-a-formview-that-supports-deletion"></a><span data-ttu-id="ba730-130">步骤 1： 创建 FormView 支持删除</span><span class="sxs-lookup"><span data-stu-id="ba730-130">Step 1: Creating a FormView That Supports Deletion</span></span>

<span data-ttu-id="ba730-131">首先，通过添加到 FormView`ConfirmationOnDelete.aspx`页中`EditInsertDelete`文件夹中，将其绑定到通过产品信息会提取新 ObjectDataSource`ProductsBLL`类的`GetProducts()`方法。</span><span class="sxs-lookup"><span data-stu-id="ba730-131">Start by adding a FormView to the `ConfirmationOnDelete.aspx` page in the `EditInsertDelete` folder, binding it to a new ObjectDataSource that pulls back the product information via the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="ba730-132">此外配置对象数据源，以便`ProductsBLL`类 s`DeleteProduct(productID)`方法映射到 ObjectDataSource 的`Delete()`方法; 确保下拉列表设置为 （无） INSERT 和 UPDATE 选项卡。</span><span class="sxs-lookup"><span data-stu-id="ba730-132">Also configure the ObjectDataSource so that the `ProductsBLL` class s `DeleteProduct(productID)` method is mapped to the ObjectDataSource s `Delete()` method; ensure that the INSERT and UPDATE tabs drop-down lists are set to (None).</span></span> <span data-ttu-id="ba730-133">最后，检查 FormView s 智能标记中的启用分页复选框。</span><span class="sxs-lookup"><span data-stu-id="ba730-133">Finally, check the Enable Paging checkbox in the FormView s smart tag.</span></span>

<span data-ttu-id="ba730-134">这些步骤之后，新 ObjectDataSource s 声明性标记将如下所示：</span><span class="sxs-lookup"><span data-stu-id="ba730-134">After these steps, the new ObjectDataSource s declarative markup will look like the following:</span></span>


[!code-aspx[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample1.aspx)]

<span data-ttu-id="ba730-135">如我们在过去的示例未使用乐观并发，请花费片刻时间来清除 ObjectDataSource 的`OldValuesParameterFormatString`属性。</span><span class="sxs-lookup"><span data-stu-id="ba730-135">As in our past examples that did not use optimistic concurrency, take a moment to clear out the ObjectDataSource s `OldValuesParameterFormatString` property.</span></span>

<span data-ttu-id="ba730-136">因为它已绑定到 ObjectDataSource 控件，仅支持删除 FormView 的`ItemTemplate`提供仅删除按钮，缺少的新建和更新按钮。</span><span class="sxs-lookup"><span data-stu-id="ba730-136">Since it has been bound to an ObjectDataSource control that only supports deleting, the FormView s `ItemTemplate` offers only the Delete button, lacking the New and Update buttons.</span></span> <span data-ttu-id="ba730-137">FormView s 声明性标记，但是，包含多余`EditItemTemplate`和`InsertItemTemplate`，可以删除的。</span><span class="sxs-lookup"><span data-stu-id="ba730-137">The FormView s declarative markup, however, includes a superfluous `EditItemTemplate` and `InsertItemTemplate`, which can be removed.</span></span> <span data-ttu-id="ba730-138">请花费片刻时间自定义`ItemTemplate`就是显示数据字段的产品的一个子集。</span><span class="sxs-lookup"><span data-stu-id="ba730-138">Take a moment to customize the `ItemTemplate` so that is shows only a subset of the product data fields.</span></span> <span data-ttu-id="ba730-139">我已配置我的显示中的产品的名称`<h3>`标题上方 （以及删除按钮） 其供应商和类别名称。</span><span class="sxs-lookup"><span data-stu-id="ba730-139">I ve configured mine to show the product s name in an `<h3>` heading above its supplier and category names (along with the Delete button).</span></span>


[!code-aspx[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample2.aspx)]

<span data-ttu-id="ba730-140">这些更改，我们有一个完全正常运行的 web 页面，允许用户一次通过产品一个切换能够只需单击删除按钮删除产品。</span><span class="sxs-lookup"><span data-stu-id="ba730-140">With these changes, we have a fully functional web page that allows a user to toggle through the products one at a time, with the ability to delete a product by simply clicking the Delete button.</span></span> <span data-ttu-id="ba730-141">图 2 显示了我们的进度的屏幕截图为止时的浏览器查看。</span><span class="sxs-lookup"><span data-stu-id="ba730-141">Figure 2 shows a screen shot of our progress thus far when viewed through a browser.</span></span>


<span data-ttu-id="ba730-142">[![FormView 显示单个产品的信息](adding-client-side-confirmation-when-deleting-cs/_static/image3.png)](adding-client-side-confirmation-when-deleting-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="ba730-142">[![The FormView Shows Information About a Single Product](adding-client-side-confirmation-when-deleting-cs/_static/image3.png)](adding-client-side-confirmation-when-deleting-cs/_static/image2.png)</span></span>

<span data-ttu-id="ba730-143">**图 2**： 根据 FormView 显示信息有关单个产品 ([单击以查看实际尺寸的图像](adding-client-side-confirmation-when-deleting-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="ba730-143">**Figure 2**: The FormView Shows Information About a Single Product ([Click to view full-size image](adding-client-side-confirmation-when-deleting-cs/_static/image4.png))</span></span>


## <a name="step-2-calling-the-confirmstring-function-from-the-delete-buttons-client-side-onclick-event"></a><span data-ttu-id="ba730-144">步骤 2： 从删除按钮的客户端 onclick 事件中调用 confirm(string) 函数</span><span class="sxs-lookup"><span data-stu-id="ba730-144">Step 2: Calling the confirm(string) Function from the Delete Buttons Client-Side onclick Event</span></span>

<span data-ttu-id="ba730-145">使用 FormView 创建，最后一步是配置此类删除按钮，当它访问者，JavaScript 单击 s`confirm(string)`调用函数。</span><span class="sxs-lookup"><span data-stu-id="ba730-145">With the FormView created, the final step is to configure the Delete button such that when it s clicked by the visitor, the JavaScript `confirm(string)` function is invoked.</span></span> <span data-ttu-id="ba730-146">将客户端侧脚本添加到按钮、 LinkButton 或 ImageButton 的客户端`onclick`事件，可以使用`OnClientClick property`，这是 ASP.NET 2.0 中新增。</span><span class="sxs-lookup"><span data-stu-id="ba730-146">Adding client-side script to a Button, LinkButton, or ImageButton s client-side `onclick` event can be accomplished through the use of the `OnClientClick property`, which is new to ASP.NET 2.0.</span></span> <span data-ttu-id="ba730-147">由于我们想要具有的值`confirm(string)`函数返回，只需将此属性设置为： `return confirm('Are you certain that you want to delete this product?');`</span><span class="sxs-lookup"><span data-stu-id="ba730-147">Since we want to have the value of the `confirm(string)` function returned, simply set this property to: `return confirm('Are you certain that you want to delete this product?');`</span></span>

<span data-ttu-id="ba730-148">此更改后删除 LinkButton s 声明性语法应如下所示：</span><span class="sxs-lookup"><span data-stu-id="ba730-148">After this change the Delete LinkButton s declarative syntax should look something like:</span></span>


[!code-aspx[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample3.aspx)]

<span data-ttu-id="ba730-149">该 s 都在这里就简单 ！</span><span class="sxs-lookup"><span data-stu-id="ba730-149">That s all there is to it!</span></span> <span data-ttu-id="ba730-150">图 3 所示为正在运行的此确认的屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="ba730-150">Figure 3 shows a screen shot of this confirmation in action.</span></span> <span data-ttu-id="ba730-151">单击删除按钮将显示确认对话框。</span><span class="sxs-lookup"><span data-stu-id="ba730-151">Clicking the Delete button brings up the confirm dialog box.</span></span> <span data-ttu-id="ba730-152">如果用户单击取消时，会取消回发并不会删除该产品。</span><span class="sxs-lookup"><span data-stu-id="ba730-152">If the user clicks Cancel, the postback is cancelled and the product is not deleted.</span></span> <span data-ttu-id="ba730-153">如果，但是，用户单击确定，在回发继续和 ObjectDataSource 的`Delete()`调用方法时，通过在要删除的数据库记录。</span><span class="sxs-lookup"><span data-stu-id="ba730-153">If, however, the user clicks OK, the postback continues and the ObjectDataSource s `Delete()` method is invoked, culminating in the database record being deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="ba730-154">将字符串传递到`confirm(string)`用撇号 （而不是引号） 分隔的 JavaScript 函数。</span><span class="sxs-lookup"><span data-stu-id="ba730-154">The string passed into the `confirm(string)` JavaScript function is delimited with apostrophes (rather than quotation marks).</span></span> <span data-ttu-id="ba730-155">在 JavaScript 中，可以使用任一字符分隔的字符串。</span><span class="sxs-lookup"><span data-stu-id="ba730-155">In JavaScript, strings can be delimited using either character.</span></span> <span data-ttu-id="ba730-156">这样的分隔符的字符串传递到此处使用撇号`confirm(string)`不会产生歧义引入使用用于分隔符`OnClientClick`属性值。</span><span class="sxs-lookup"><span data-stu-id="ba730-156">We use apostrophes here so that the delimiters for the string passed into `confirm(string)` do not introduce an ambiguity with the delimiters used for the `OnClientClick` property value.</span></span>


<span data-ttu-id="ba730-157">[![一条确认信息是现在显示时单击删除按钮](adding-client-side-confirmation-when-deleting-cs/_static/image6.png)](adding-client-side-confirmation-when-deleting-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ba730-157">[![A Confirmation is Now Displayed When Clicking the Delete Button](adding-client-side-confirmation-when-deleting-cs/_static/image6.png)](adding-client-side-confirmation-when-deleting-cs/_static/image5.png)</span></span>

<span data-ttu-id="ba730-158">**图 3**: 确认是现在显示时单击删除按钮 ([单击以查看实际尺寸的图像](adding-client-side-confirmation-when-deleting-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="ba730-158">**Figure 3**: A Confirmation is Now Displayed When Clicking the Delete Button ([Click to view full-size image](adding-client-side-confirmation-when-deleting-cs/_static/image7.png))</span></span>


## <a name="step-3-configuring-the-onclientclick-property-for-the-delete-button-in-a-commandfield"></a><span data-ttu-id="ba730-159">步骤 3： 在 CommandField 中配置删除按钮的 OnClientClick 属性</span><span class="sxs-lookup"><span data-stu-id="ba730-159">Step 3: Configuring the OnClientClick Property for the Delete Button in a CommandField</span></span>

<span data-ttu-id="ba730-160">确认对话框中使用时的按钮、 LinkButton 或 ImageButton 直接在模板中，可以通过只需配置是与之关联其`OnClientClick`属性以返回结果的 JavaScript`confirm(string)`函数。</span><span class="sxs-lookup"><span data-stu-id="ba730-160">When working with a Button, LinkButton, or ImageButton directly in a template, a confirmation dialog box can be associated with it by simply configuring its `OnClientClick` property to return the results of the JavaScript `confirm(string)` function.</span></span> <span data-ttu-id="ba730-161">但是，CommandField-这将删除按钮的字段添加到 GridView 或 DetailsView-没有`OnClientClick`可以以声明方式设置的属性。</span><span class="sxs-lookup"><span data-stu-id="ba730-161">However, the CommandField - which adds a field of Delete buttons to a GridView or DetailsView - does not have an `OnClientClick` property that can be set declaratively.</span></span> <span data-ttu-id="ba730-162">相反，我们必须以编程方式引用在相应的 GridView 或 DetailsView s 中的删除按钮`DataBound`事件处理程序，然后将设置其`OnClientClick`那里属性。</span><span class="sxs-lookup"><span data-stu-id="ba730-162">Instead, we must programmatically reference the Delete button in the GridView or DetailsView s appropriate `DataBound` event handler, and then set its `OnClientClick` property there.</span></span>

> [!NOTE]
> <span data-ttu-id="ba730-163">设置删除按钮 s 时`OnClientClick`中的相应属性`DataBound`事件处理程序，我们有权访问数据被绑定到当前记录。</span><span class="sxs-lookup"><span data-stu-id="ba730-163">When setting the Delete button s `OnClientClick` property in the appropriate `DataBound` event handler, we have access to the data was bound to the current record.</span></span> <span data-ttu-id="ba730-164">这意味着我们可以扩展的确认消息包括有关的特定记录的详细信息如下所述，"确实要删除的 Chai 产品？"</span><span class="sxs-lookup"><span data-stu-id="ba730-164">This means we can extend the confirmation message to include details about the particular record, such as, "Are you sure you want to delete the Chai product?"</span></span> <span data-ttu-id="ba730-165">此类自定义，也可以在模板中使用数据绑定语法。</span><span class="sxs-lookup"><span data-stu-id="ba730-165">Such customization is also possible in templates using databinding syntax.</span></span>


<span data-ttu-id="ba730-166">做法是设置到`OnClientClick`CommandField，let s 中删除按钮的属性向页添加 GridView。</span><span class="sxs-lookup"><span data-stu-id="ba730-166">To practice setting the `OnClientClick` property for the Delete button(s) in a CommandField, let s add a GridView to the page.</span></span> <span data-ttu-id="ba730-167">配置为使用相同的 ObjectDataSource 控件 FormView 使用此 GridView。</span><span class="sxs-lookup"><span data-stu-id="ba730-167">Configure this GridView to use the same ObjectDataSource control that the FormView uses.</span></span> <span data-ttu-id="ba730-168">此外限制 GridView 的 BoundFields 将只包括产品的名称、 类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="ba730-168">Also limit the GridView s BoundFields to only include the product s name, category, and supplier.</span></span> <span data-ttu-id="ba730-169">最后，检查从 GridView s 智能标记启用删除复选框。</span><span class="sxs-lookup"><span data-stu-id="ba730-169">Lastly, check the Enable Deleting checkbox from the GridView s smart tag.</span></span> <span data-ttu-id="ba730-170">这将为 GridView s 添加 CommandField`Columns`集合，其`ShowDeleteButton`属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="ba730-170">This will add a CommandField to the GridView s `Columns` collection with its `ShowDeleteButton` property set to `true`.</span></span>

<span data-ttu-id="ba730-171">进行这些更改后，您的 GridView s 声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="ba730-171">After making these changes, your GridView s declarative markup should look like the following:</span></span>


[!code-aspx[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample4.aspx)]

<span data-ttu-id="ba730-172">CommandField 包含单个删除 LinkButton 实例可以以编程方式访问从 GridView 的`RowDataBound`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ba730-172">The CommandField contains a single Delete LinkButton instance that can be accessed programmatically from the GridView s `RowDataBound` event handler.</span></span> <span data-ttu-id="ba730-173">一旦引用，我们可以设置其`OnClientClick`属性相应地。</span><span class="sxs-lookup"><span data-stu-id="ba730-173">Once referenced, we can set its `OnClientClick` property accordingly.</span></span> <span data-ttu-id="ba730-174">创建事件处理程序`RowDataBound`事件使用以下代码：</span><span class="sxs-lookup"><span data-stu-id="ba730-174">Create an event handler for the `RowDataBound` event using the following code:</span></span>


[!code-csharp[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample5.cs)]

<span data-ttu-id="ba730-175">此事件处理程序适用于数据行 （那些将具有删除按钮），并开始通过以编程方式引用删除按钮。</span><span class="sxs-lookup"><span data-stu-id="ba730-175">This event handler works with data rows (those that will have the Delete button) and begins by programmatically referencing the Delete button.</span></span> <span data-ttu-id="ba730-176">在常规使用以下模式：</span><span class="sxs-lookup"><span data-stu-id="ba730-176">In general use the following pattern:</span></span>


[!code-csharp[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample6.cs)]

<span data-ttu-id="ba730-177">*ButtonType*是 CommandField-按钮、 LinkButton 或 ImageButton 正在使用的按钮的类型。</span><span class="sxs-lookup"><span data-stu-id="ba730-177">*ButtonType* is the type of button being used by the CommandField - Button, LinkButton, or ImageButton.</span></span> <span data-ttu-id="ba730-178">默认情况下，CommandField 使用 Linkbutton，但这可以通过 CommandField s 自定义`ButtonType property`。</span><span class="sxs-lookup"><span data-stu-id="ba730-178">By default, the CommandField uses LinkButtons, but this can be customized via the CommandField s `ButtonType property`.</span></span> <span data-ttu-id="ba730-179">*CommandFieldIndex*是中的 GridView s CommandField 的序号索引`Columns`集合，而*controlIndex*是 CommandField s 中的删除按钮的索引`Controls`集合。</span><span class="sxs-lookup"><span data-stu-id="ba730-179">The *commandFieldIndex* is the ordinal index of the CommandField within the GridView s `Columns` collection, whereas the *controlIndex* is the index of the Delete button within the CommandField s `Controls` collection.</span></span> <span data-ttu-id="ba730-180">*ControlIndex*值取决于在 CommandField 中按钮 s 的位置相对于其他按钮。</span><span class="sxs-lookup"><span data-stu-id="ba730-180">The *controlIndex* value depends on the button s position relative to other buttons in the CommandField.</span></span> <span data-ttu-id="ba730-181">例如，如果 CommandField 中显示的唯一按钮是删除按钮，使用的索引为 0。</span><span class="sxs-lookup"><span data-stu-id="ba730-181">For example, if the only button displayed in the CommandField is the Delete button, use an index of 0.</span></span> <span data-ttu-id="ba730-182">不过，如果有 s 位于删除按钮，一个编辑按钮使用的索引 2。</span><span class="sxs-lookup"><span data-stu-id="ba730-182">If, however, there s an Edit button that precedes the Delete button, use an index of 2.</span></span> <span data-ttu-id="ba730-183">使用索引为 2 的原因是因为两个控件添加的删除按钮之前 CommandField: 编辑按钮和 LiteralControl s 用来添加编辑和删除按钮之间的一些空间。</span><span class="sxs-lookup"><span data-stu-id="ba730-183">The reason an index of 2 is used is because two controls are added by the CommandField before the Delete button: the Edit button and a LiteralControl that s used to add some space between the Edit and Delete buttons.</span></span>

<span data-ttu-id="ba730-184">特定示例中，CommandField 使用 Linkbutton 和，最左侧的字段中，具有*commandFieldIndex*为 0。</span><span class="sxs-lookup"><span data-stu-id="ba730-184">For our particular example, the CommandField uses LinkButtons and, being the left-most field, has a *commandFieldIndex* of 0.</span></span> <span data-ttu-id="ba730-185">由于没有任何其他按钮，但在 CommandField 删除按钮，我们使用*controlIndex*为 0。</span><span class="sxs-lookup"><span data-stu-id="ba730-185">Since there are no other buttons but the Delete button in the CommandField, we use a *controlIndex* of 0.</span></span>

<span data-ttu-id="ba730-186">在引用中 CommandField 删除按钮之后, 我们接下来获取绑定到当前的 GridView 行的产品有关的信息。</span><span class="sxs-lookup"><span data-stu-id="ba730-186">After referencing the Delete button in the CommandField, we next grab information about the product bound to the current GridView row.</span></span> <span data-ttu-id="ba730-187">最后，我们将设置删除按钮的`OnClientClick`适当的 javascript 中，其中包括产品的名称的属性。</span><span class="sxs-lookup"><span data-stu-id="ba730-187">Finally, we set the Delete button s `OnClientClick` property to the appropriate JavaScript, which includes the product s name.</span></span> <span data-ttu-id="ba730-188">由于 JavaScript 字符串传递到`confirm(string)`使用的撇号我们必须转义产品的名称中出现的任何撇号分隔函数。</span><span class="sxs-lookup"><span data-stu-id="ba730-188">Since the JavaScript string passed into the `confirm(string)` function is delimited using apostrophes we must escape any apostrophes that appear within the product s name.</span></span> <span data-ttu-id="ba730-189">任何撇号产品的名称中使用的转义具体而言，"`\'`"。</span><span class="sxs-lookup"><span data-stu-id="ba730-189">In particular, any apostrophes in the product s name are escaped with "`\'`".</span></span>

<span data-ttu-id="ba730-190">完成这些更改中，单击删除按钮 GridView 显示一个自定义的确认对话框中 （见图 4） 中。</span><span class="sxs-lookup"><span data-stu-id="ba730-190">With these changes complete, clicking on a Delete button in the GridView displays a customized confirmation dialog box (see Figure 4).</span></span> <span data-ttu-id="ba730-191">作为与确认 messagebox 从 FormView，如果用户单击取消按钮在回发被取消时，从而防止发生删除操作。</span><span class="sxs-lookup"><span data-stu-id="ba730-191">As with the confirmation messagebox from the FormView, if the user clicks Cancel the postback is cancelled, thereby preventing the deletion from occurring.</span></span>

> [!NOTE]
> <span data-ttu-id="ba730-192">此外可以使用此方法以编程方式访问在 DetailsView 中 CommandField 删除按钮。</span><span class="sxs-lookup"><span data-stu-id="ba730-192">This technique can also be used to programmatically access the Delete button in the CommandField in a DetailsView.</span></span> <span data-ttu-id="ba730-193">对于 DetailsView，但是，d 你创建的事件处理程序`DataBound`事件，因为 DetailsView 没有`RowDataBound`事件。</span><span class="sxs-lookup"><span data-stu-id="ba730-193">For the DetailsView, however, you d create an event handler for the `DataBound` event, since the DetailsView does not have a `RowDataBound` event.</span></span>


<span data-ttu-id="ba730-194">[![单击 GridView s 删除按钮将显示一个自定义的确认对话框](adding-client-side-confirmation-when-deleting-cs/_static/image9.png)](adding-client-side-confirmation-when-deleting-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="ba730-194">[![Clicking the GridView s Delete Button Displays a Customized Confirmation Dialog Box](adding-client-side-confirmation-when-deleting-cs/_static/image9.png)](adding-client-side-confirmation-when-deleting-cs/_static/image8.png)</span></span>

<span data-ttu-id="ba730-195">**图 4**： 单击删除按钮的 GridView s 显示自定义确认对话框 ([单击以查看实际尺寸的图像](adding-client-side-confirmation-when-deleting-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="ba730-195">**Figure 4**: Clicking the GridView s Delete Button Displays a Customized Confirmation Dialog Box ([Click to view full-size image](adding-client-side-confirmation-when-deleting-cs/_static/image10.png))</span></span>


## <a name="using-templatefields"></a><span data-ttu-id="ba730-196">使用 Templatefield</span><span class="sxs-lookup"><span data-stu-id="ba730-196">Using TemplateFields</span></span>

<span data-ttu-id="ba730-197">CommandField 的缺点之一是其按钮必须通过索引来访问和生成的对象，必须强制转换为相应的按钮类型 （按钮、 LinkButton 或 ImageButton）。</span><span class="sxs-lookup"><span data-stu-id="ba730-197">One of the disadvantages of the CommandField is that its buttons must be accessed through indexing and that the resulting object must be cast to the appropriate button type (Button, LinkButton, or ImageButton).</span></span> <span data-ttu-id="ba730-198">使用"幻数"和硬编码类型邀请直到运行时将不能发现的问题。</span><span class="sxs-lookup"><span data-stu-id="ba730-198">Using "magic numbers" and hard-coded types invites problems that cannot be discovered until runtime.</span></span> <span data-ttu-id="ba730-199">例如，如果你或其他开发人员将新的按钮添加到在某个时间点以后 （例如编辑按钮） 或更改 CommandField`ButtonType`属性，现有的代码仍将编译没有错误，但访问的页面可能会引发异常或意外的行为，具体取决于如何编写您的代码和所做的更改。</span><span class="sxs-lookup"><span data-stu-id="ba730-199">For example, if you, or another developer, adds new buttons to the CommandField at some point in the future (such as an Edit button) or changes the `ButtonType` property, the existing code will still compile without error, but visiting the page may cause an exception or unexpected behavior, depending on how your code was written and what changes were made.</span></span>

<span data-ttu-id="ba730-200">另一种方法是将 GridView 和 DetailsView 的命令转换为 Templatefield。</span><span class="sxs-lookup"><span data-stu-id="ba730-200">An alternative approach is to convert the GridView and DetailsView s CommandFields into TemplateFields.</span></span> <span data-ttu-id="ba730-201">这将生成与 TemplateField `ItemTemplate` CommandField 中每个按钮具有 LinkButton （或按钮或 ImageButton）。</span><span class="sxs-lookup"><span data-stu-id="ba730-201">This will generate a TemplateField with an `ItemTemplate` that has a LinkButton (or Button or ImageButton) for each button in the CommandField.</span></span> <span data-ttu-id="ba730-202">这些按钮`OnClientClick`属性可以以声明方式分配，如我们看到的 FormView，或可以以编程方式访问在相应`DataBound`事件处理程序使用以下模式：</span><span class="sxs-lookup"><span data-stu-id="ba730-202">These buttons `OnClientClick` properties can be assigned declaratively, as we saw with the FormView, or can be programmatically accessed in the appropriate `DataBound` event handler using the following pattern:</span></span>


[!code-csharp[Main](adding-client-side-confirmation-when-deleting-cs/samples/sample7.cs)]

<span data-ttu-id="ba730-203">其中*controlID*是按钮 s 的值`ID`属性。</span><span class="sxs-lookup"><span data-stu-id="ba730-203">Where *controlID* is the value of the button s `ID` property.</span></span> <span data-ttu-id="ba730-204">虽然此模式仍需要硬编码的类型强制转换，它无需为编制索引，允许布局更改不会导致运行时错误。</span><span class="sxs-lookup"><span data-stu-id="ba730-204">While this pattern still requires a hard-coded type for the cast, it removes the need for indexing, allowing for the layout to change without resulting in a runtime error.</span></span>

## <a name="summary"></a><span data-ttu-id="ba730-205">总结</span><span class="sxs-lookup"><span data-stu-id="ba730-205">Summary</span></span>

<span data-ttu-id="ba730-206">JavaScript`confirm(string)`函数是用于控制窗体提交工作流的常用的技术。</span><span class="sxs-lookup"><span data-stu-id="ba730-206">The JavaScript `confirm(string)` function is a commonly used technique for controlling form submission workflow.</span></span> <span data-ttu-id="ba730-207">执行时，该函数显示模式，客户端的对话框，其中包含两个按钮，确定和取消。</span><span class="sxs-lookup"><span data-stu-id="ba730-207">When executed, the function displays a modal, client-side dialog box that includes two buttons, OK and Cancel.</span></span> <span data-ttu-id="ba730-208">如果用户单击确定，`confirm(string)`函数返回`true`; 单击取消返回`false`。</span><span class="sxs-lookup"><span data-stu-id="ba730-208">If the user clicks OK, the `confirm(string)` function returns `true`; clicking Cancel returns `false`.</span></span> <span data-ttu-id="ba730-209">此功能，结合一个浏览器的行为来取消提交窗体，如果在提交过程中的事件处理程序返回`false`，可以用于删除一条记录时显示确认消息框。</span><span class="sxs-lookup"><span data-stu-id="ba730-209">This functionality, coupled with a browser s behavior to cancel a form submission if an event handler during the submission process returns `false`, can be used to display a confirmation messagebox when deleting a record.</span></span>

<span data-ttu-id="ba730-210">`confirm(string)`函数可与一个按钮 Web 控件的客户端相关联`onclick`事件处理程序通过控件的`OnClientClick`属性。</span><span class="sxs-lookup"><span data-stu-id="ba730-210">The `confirm(string)` function can be associated with a Button Web control s client-side `onclick` event handler through the control s `OnClientClick` property.</span></span> <span data-ttu-id="ba730-211">使用模板-FormView 的模板之一或在 detailsview GridView-TemplateField 中的删除按钮时设置此属性可以是以声明方式或以编程方式，在本教程中所示。</span><span class="sxs-lookup"><span data-stu-id="ba730-211">When working with a Delete button in a template - either in one of the FormView s templates or in a TemplateField in the DetailsView or GridView - this property can be set either declaratively or programmatically, as we saw in this tutorial.</span></span>

<span data-ttu-id="ba730-212">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="ba730-212">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ba730-213">关于作者</span><span class="sxs-lookup"><span data-stu-id="ba730-213">About the Author</span></span>

<span data-ttu-id="ba730-214">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="ba730-214">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ba730-215">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="ba730-215">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ba730-216">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="ba730-216">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ba730-217">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ba730-217">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ba730-218">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="ba730-218">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ba730-219">[上一页](implementing-optimistic-concurrency-cs.md)
> [下一页](limiting-data-modification-functionality-based-on-the-user-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ba730-219">[Previous](implementing-optimistic-concurrency-cs.md)
[Next](limiting-data-modification-functionality-based-on-the-user-cs.md)</span></span>
