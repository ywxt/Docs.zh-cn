---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs
title: 概述插入、 更新和删除数据 (C#) |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将了解如何将映射 ObjectDataSource 的 insert （），update （），和 delete （） 方法添加到的 BLL 方法类，以及如何配置...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: b651dc58-93c7-4f83-a74e-3b99f6d60848
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 4e1b47782bd24824707266d1ed61e24789cc7a49
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/03/2018
ms.locfileid: "37369833"
---
<a name="an-overview-of-inserting-updating-and-deleting-data-c"></a><span data-ttu-id="356d0-103">插入、 更新和删除数据 (C#) 的概述</span><span class="sxs-lookup"><span data-stu-id="356d0-103">An Overview of Inserting, Updating, and Deleting Data (C#)</span></span>
====================
<span data-ttu-id="356d0-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="356d0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="356d0-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_16_CS.exe)或[下载 PDF](an-overview-of-inserting-updating-and-deleting-data-cs/_static/datatutorial16cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="356d0-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_16_CS.exe) or [Download PDF](an-overview-of-inserting-updating-and-deleting-data-cs/_static/datatutorial16cs1.pdf)</span></span>

> <span data-ttu-id="356d0-106">在本教程中我们将了解如何将映射 ObjectDataSource 的 insert （），update （），和 delete （） 方法添加到的 BLL 方法类，以及如何配置 GridView、 DetailsView 和 FormView 控件，以提供数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-106">In this tutorial we'll see how to map an ObjectDataSource's Insert(), Update(), and Delete() methods to the methods of BLL classes, as well as how to configure the GridView, DetailsView, and FormView controls to provide data modification capabilities.</span></span>


## <a name="introduction"></a><span data-ttu-id="356d0-107">介绍</span><span class="sxs-lookup"><span data-stu-id="356d0-107">Introduction</span></span>

<span data-ttu-id="356d0-108">通过过去的几个教程，我们探讨了如何在 ASP.NET 页使用 GridView、 DetailsView 和 FormView 控件中显示数据。</span><span class="sxs-lookup"><span data-stu-id="356d0-108">Over the past several tutorials we've examined how to display data in an ASP.NET page using the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="356d0-109">这些控件只需使用提供给它们的数据。</span><span class="sxs-lookup"><span data-stu-id="356d0-109">These controls simply work with data supplied to them.</span></span> <span data-ttu-id="356d0-110">通常情况下，这些控件访问通过使用数据源控件，如 ObjectDataSource 的数据。</span><span class="sxs-lookup"><span data-stu-id="356d0-110">Commonly, these controls access data through the use of a data source control, such as the ObjectDataSource.</span></span> <span data-ttu-id="356d0-111">我们已经看到如何 ObjectDataSource 充当 ASP.NET 页面和基础数据之间的代理。</span><span class="sxs-lookup"><span data-stu-id="356d0-111">We've seen how the ObjectDataSource acts as a proxy between the ASP.NET page and the underlying data.</span></span> <span data-ttu-id="356d0-112">当需要显示数据的 GridView 时，它将调用其 ObjectDataSource 的`Select()`方法，它调用的方法从我们的业务逻辑层 (BLL)，该调用中相应数据访问层的 (DAL) 的方法 TableAdapter，将发送`SELECT`到 Northwind 数据库的查询。</span><span class="sxs-lookup"><span data-stu-id="356d0-112">When a GridView needs to display data, it invokes its ObjectDataSource's `Select()` method, which in turn invokes a method from our Business Logic Layer (BLL), which calls a method in the appropriate Data Access Layer's (DAL) TableAdapter, which in turn sends a `SELECT` query to the Northwind database.</span></span>

<span data-ttu-id="356d0-113">请记住，当我们在 DAL 中创建 Tableadapter[我们第一篇教程](../introduction/creating-a-data-access-layer-cs.md)、 Visual Studio 自动添加方法用于插入、 更新和删除数据从基础数据库表。</span><span class="sxs-lookup"><span data-stu-id="356d0-113">Recall that when we created the TableAdapters in the DAL in [our first tutorial](../introduction/creating-a-data-access-layer-cs.md), Visual Studio automatically added methods for inserting, updating, and deleting data from the underlying database table.</span></span> <span data-ttu-id="356d0-114">此外，在[创建业务逻辑层](../introduction/creating-a-business-logic-layer-cs.md)我们设计中向下名为 BLL 方法应用到这些数据修改 DAL 方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-114">Moreover, in [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) we designed methods in the BLL that called down into these data modification DAL methods.</span></span>

<span data-ttu-id="356d0-115">除了其`Select()`方法，还具有 ObjectDataSource `Insert()`， `Update()`，和`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-115">In addition to its `Select()` method, the ObjectDataSource also has `Insert()`, `Update()`, and `Delete()` methods.</span></span> <span data-ttu-id="356d0-116">如`Select()`方法，这三种方法可以映射到基础对象中的方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-116">Like the `Select()` method, these three methods can be mapped to methods in an underlying object.</span></span> <span data-ttu-id="356d0-117">当配置为插入、 更新或删除数据，GridView、 DetailsView 和 FormView 控件用于修改基础数据提供用户界面。</span><span class="sxs-lookup"><span data-stu-id="356d0-117">When configured to insert, update, or delete data, the GridView, DetailsView, and FormView controls provide a user interface for modifying the underlying data.</span></span> <span data-ttu-id="356d0-118">此用户界面调用`Insert()`， `Update()`，和`Delete()`方法的 ObjectDataSource，然后调用基础对象的关联的方法 （请参阅图 1）。</span><span class="sxs-lookup"><span data-stu-id="356d0-118">This user interface calls the `Insert()`, `Update()`, and `Delete()` methods of the ObjectDataSource, which then invoke the underlying object's associated methods (see Figure 1).</span></span>


<span data-ttu-id="356d0-119">[![ObjectDataSource 的 insert （）、 update （） 和 delete （） 方法提供为代理到 BLL](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image2.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-119">[![The ObjectDataSource's Insert(), Update(), and Delete() Methods Serve as a Proxy into the BLL](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image2.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image1.png)</span></span>

<span data-ttu-id="356d0-120">**图 1**: ObjectDataSource `Insert()`， `Update()`，和`Delete()`方法充当代理，BLL ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-120">**Figure 1**: The ObjectDataSource's `Insert()`, `Update()`, and `Delete()` Methods Serve as a Proxy into the BLL ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image3.png))</span></span>


<span data-ttu-id="356d0-121">在本教程中我们将了解如何将映射的 ObjectDataSource `Insert()`， `Update()`，和`Delete()`BLL，以及如何配置 GridView、 DetailsView 和 FormView 控件，以提供数据修改中类方法的方法功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-121">In this tutorial we'll see how to map the ObjectDataSource's `Insert()`, `Update()`, and `Delete()` methods to methods of classes in the BLL, as well as how to configure the GridView, DetailsView, and FormView controls to provide data modification capabilities.</span></span>

## <a name="step-1-creating-the-insert-update-and-delete-tutorials-web-pages"></a><span data-ttu-id="356d0-122">步骤 1： 创建 Insert、 Update 和 Delete 教程网页</span><span class="sxs-lookup"><span data-stu-id="356d0-122">Step 1: Creating the Insert, Update, and Delete Tutorials Web Pages</span></span>

<span data-ttu-id="356d0-123">我们开始探索如何插入、 更新和删除数据之前，我们先来看一段时间来在我们的网站项目，我们需要为本教程下, 一步的几个源表创建的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="356d0-123">Before we start exploring how to insert, update, and delete data, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="356d0-124">首先，通过添加一个名为的新文件夹`EditInsertDelete`。</span><span class="sxs-lookup"><span data-stu-id="356d0-124">Start by adding a new folder named `EditInsertDelete`.</span></span> <span data-ttu-id="356d0-125">接下来，将以下 ASP.NET 页面添加到该文件夹，并确保将与每个页面相关联`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="356d0-125">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `DataModificationEvents.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`


![将 ASP.NET 页添加的数据修改相关教程](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image4.png)

<span data-ttu-id="356d0-127">**图 2**： 添加 ASP.NET 页的数据修改相关教程</span><span class="sxs-lookup"><span data-stu-id="356d0-127">**Figure 2**: Add the ASP.NET Pages for the Data Modification-Related Tutorials</span></span>


<span data-ttu-id="356d0-128">在其他文件夹中，喜欢`Default.aspx`在`EditInsertDelete`文件夹将在其部分中列出的教程。</span><span class="sxs-lookup"><span data-stu-id="356d0-128">Like in the other folders, `Default.aspx` in the `EditInsertDelete` folder will list the tutorials in its section.</span></span> <span data-ttu-id="356d0-129">请记住，`SectionLevelTutorialListing.ascx`用户控件提供了此功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-129">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="356d0-130">因此，此用户控件添加到`Default.aspx`通过从解决方案资源管理器中拖到页面的设计视图上拖动。</span><span class="sxs-lookup"><span data-stu-id="356d0-130">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>


<span data-ttu-id="356d0-131">[![将 SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image6.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-131">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image6.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image5.png)</span></span>

<span data-ttu-id="356d0-132">**图 3**： 添加`SectionLevelTutorialListing.ascx`到用户控件`Default.aspx`([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-132">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image7.png))</span></span>


<span data-ttu-id="356d0-133">最后，将页面添加到条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="356d0-133">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="356d0-134">具体而言，自定义格式设置后添加以下标记`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="356d0-134">Specifically, add the following markup after the Customized Formatting `<siteMapNode>`:</span></span>


[!code-xml[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample1.xml)]

<span data-ttu-id="356d0-135">更新后`Web.sitemap`，花点时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="356d0-135">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="356d0-136">在左侧菜单现在包含用于编辑、 插入和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="356d0-136">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>


![站点图现在包括项的编辑、 插入和删除教程](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image8.png)

<span data-ttu-id="356d0-138">**图 4**： 站点图现在包括项的编辑、 插入和删除教程</span><span class="sxs-lookup"><span data-stu-id="356d0-138">**Figure 4**: The Site Map Now Includes Entries for the Editing, Inserting, and Deleting Tutorials</span></span>


## <a name="step-2-adding-and-configuring-the-objectdatasource-control"></a><span data-ttu-id="356d0-139">步骤 2： 添加并配置 ObjectDataSource 控件</span><span class="sxs-lookup"><span data-stu-id="356d0-139">Step 2: Adding and Configuring the ObjectDataSource Control</span></span>

<span data-ttu-id="356d0-140">由于 GridView、 DetailsView 和在其数据修改功能和布局的每个不同的 FormView，让我们逐个检查每个。</span><span class="sxs-lookup"><span data-stu-id="356d0-140">Since the GridView, DetailsView, and FormView each differ in their data modification capabilities and layout, let's examine each one individually.</span></span> <span data-ttu-id="356d0-141">而不是必须使用其自己的对象数据源的每个控件，但是，我们将创建所有三个控件示例可以共享单个对象数据源。</span><span class="sxs-lookup"><span data-stu-id="356d0-141">Rather than have each control using its own ObjectDataSource, however, let's just create a single ObjectDataSource that all three control examples can share.</span></span>

<span data-ttu-id="356d0-142">打开`Basics.aspx`页上，从工具箱拖到设计器中，拖动对象数据源并单击其智能标记中的配置数据源链接。</span><span class="sxs-lookup"><span data-stu-id="356d0-142">Open the `Basics.aspx` page, drag an ObjectDataSource from the Toolbox onto the Designer, and click the Configure Data Source link from its smart tag.</span></span> <span data-ttu-id="356d0-143">由于`ProductsBLL`是唯一的 BLL 类提供编辑、 插入和删除方法，配置对象数据源以使用此类。</span><span class="sxs-lookup"><span data-stu-id="356d0-143">Since the `ProductsBLL` is the only BLL class that provides editing, inserting, and deleting methods, configure the ObjectDataSource to use this class.</span></span>


<span data-ttu-id="356d0-144">[![配置对象数据源以使用 ProductsBLL 类](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image10.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-144">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image10.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image9.png)</span></span>

<span data-ttu-id="356d0-145">**图 5**： 配置为使用 ObjectDataSource`ProductsBLL`类 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-145">**Figure 5**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image11.png))</span></span>


<span data-ttu-id="356d0-146">我们可以在下一屏幕中指定的哪些方法`ProductsBLL`类映射到的 ObjectDataSource `Select()`， `Insert()`， `Update()`，和`Delete()`通过选择相应的选项卡并从下拉列表中选择该方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-146">In the next screen we can specify what methods of the `ProductsBLL` class are mapped to the ObjectDataSource's `Select()`, `Insert()`, `Update()`, and `Delete()` by selecting the appropriate tab and choosing the method from the drop-down list.</span></span> <span data-ttu-id="356d0-147">图 6 中，现在应该很熟悉，映射的 ObjectDataSource`Select()`方法`ProductsBLL`类的`GetProducts()`方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-147">Figure 6, which should look familiar by now, maps the ObjectDataSource's `Select()` method to the `ProductsBLL` class's `GetProducts()` method.</span></span> <span data-ttu-id="356d0-148">`Insert()`， `Update()`，和`Delete()`方法可以通过从顶部列表中选择相应的选项卡配置。</span><span class="sxs-lookup"><span data-stu-id="356d0-148">The `Insert()`, `Update()`, and `Delete()` methods can be configured by selecting the appropriate tab from the list along the top.</span></span>


<span data-ttu-id="356d0-149">[![具有对象数据源返回的所有产品](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image13.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-149">[![Have the ObjectDataSource Return All of the Products](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image13.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image12.png)</span></span>

<span data-ttu-id="356d0-150">**图 6**： 具有对象数据源返回所有产品的 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-150">**Figure 6**: Have the ObjectDataSource Return All of the Products ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image14.png))</span></span>


<span data-ttu-id="356d0-151">图 7、 8 和 9 显示 ObjectDataSource 的更新、 插入和删除选项卡。</span><span class="sxs-lookup"><span data-stu-id="356d0-151">Figures 7, 8, and 9 show the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span> <span data-ttu-id="356d0-152">配置这些选项卡，以便`Insert()`， `Update()`，并`Delete()`方法调用`ProductsBLL`类的`UpdateProduct`， `AddProduct`，和`DeleteProduct`方法，分别。</span><span class="sxs-lookup"><span data-stu-id="356d0-152">Configure these tabs so that the `Insert()`, `Update()`, and `Delete()` methods invoke the `ProductsBLL` class's `UpdateProduct`, `AddProduct`, and `DeleteProduct` methods, respectively.</span></span>


<span data-ttu-id="356d0-153">[![将 ObjectDataSource 的 update （） 方法映射到 ProductBLL 类的 UpdateProduct 方法](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image16.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-153">[![Map the ObjectDataSource's Update() Method to the ProductBLL Class's UpdateProduct Method](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image16.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image15.png)</span></span>

<span data-ttu-id="356d0-154">**图 7**： 映射的 ObjectDataSource`Update()`方法`ProductBLL`类的`UpdateProduct`方法 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-154">**Figure 7**: Map the ObjectDataSource's `Update()` Method to the `ProductBLL` Class's `UpdateProduct` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image17.png))</span></span>


<span data-ttu-id="356d0-155">[![将 ObjectDataSource 的 insert （） 方法映射到 ProductBLL 类的 AddProduct 方法](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image19.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-155">[![Map the ObjectDataSource's Insert() Method to the ProductBLL Class's AddProduct Method](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image19.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image18.png)</span></span>

<span data-ttu-id="356d0-156">**图 8**： 映射的 ObjectDataSource`Insert()`方法`ProductBLL`类的添加`Product`方法 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-156">**Figure 8**: Map the ObjectDataSource's `Insert()` Method to the `ProductBLL` Class's Add `Product` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image20.png))</span></span>


<span data-ttu-id="356d0-157">[![将 ObjectDataSource 的 delete （） 方法映射到 ProductBLL 类的 DeleteProduct 方法](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image22.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-157">[![Map the ObjectDataSource's Delete() Method to the ProductBLL Class's DeleteProduct Method](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image22.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image21.png)</span></span>

<span data-ttu-id="356d0-158">**图 9**： 映射的 ObjectDataSource`Delete()`方法`ProductBLL`类的`DeleteProduct`方法 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-158">**Figure 9**: Map the ObjectDataSource's `Delete()` Method to the `ProductBLL` Class's `DeleteProduct` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image23.png))</span></span>


<span data-ttu-id="356d0-159">您可能已经注意到更新、 插入和删除选项卡中的下拉列表已选择这些方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-159">You may have noticed that the drop-down lists in the UPDATE, INSERT, and DELETE tabs already had these methods selected.</span></span> <span data-ttu-id="356d0-160">这得归功于我们利用`DataObjectMethodAttribute`修饰的方法`ProducstBLL`。</span><span class="sxs-lookup"><span data-stu-id="356d0-160">This is thanks to our use of the `DataObjectMethodAttribute` that decorates the methods of `ProducstBLL`.</span></span> <span data-ttu-id="356d0-161">例如，DeleteProduct 方法具有以下签名：</span><span class="sxs-lookup"><span data-stu-id="356d0-161">For example, the DeleteProduct method has the following signature:</span></span>


[!code-csharp[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample2.cs)]

<span data-ttu-id="356d0-162">`DataObjectMethodAttribute`属性指示每个方法的用途，它是用于选择、 插入、 更新或删除和它是否是默认值。</span><span class="sxs-lookup"><span data-stu-id="356d0-162">The `DataObjectMethodAttribute` attribute indicates the purpose of each method whether it is for selecting, inserting, updating, or deleting and whether or not it's the default value.</span></span> <span data-ttu-id="356d0-163">如果您省略这些属性，创建您的 BLL 类时，你将需要手动从更新中，选择方法插入和删除选项卡。</span><span class="sxs-lookup"><span data-stu-id="356d0-163">If you omitted these attributes when creating your BLL classes, you'll need to manually select the methods from the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="356d0-164">之后，确保相应`ProductsBLL`方法映射到的 ObjectDataSource `Insert()`， `Update()`，和`Delete()`方法，单击完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="356d0-164">After ensuring that the appropriate `ProductsBLL` methods are mapped to the ObjectDataSource's `Insert()`, `Update()`, and `Delete()` methods, click Finish to complete the wizard.</span></span>

## <a name="examining-the-objectdatasources-markup"></a><span data-ttu-id="356d0-165">检查 ObjectDataSource 的标记</span><span class="sxs-lookup"><span data-stu-id="356d0-165">Examining the ObjectDataSource's Markup</span></span>

<span data-ttu-id="356d0-166">配置后其向导通过对象数据源，请转到源视图来检查生成的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="356d0-166">After configuring the ObjectDataSource through its wizard, go to the Source view to examine the generated declarative markup.</span></span> <span data-ttu-id="356d0-167">`<asp:ObjectDataSource>`标记指定的基础对象和要调用的方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-167">The `<asp:ObjectDataSource>` tag specifies the underlying object and the methods to invoke.</span></span> <span data-ttu-id="356d0-168">此外，还有`DeleteParameters`， `UpdateParameters`，并`InsertParameters`，它将映射到的输入参数的`ProductsBLL`类的`AddProduct`， `UpdateProduct`，和`DeleteProduct`方法：</span><span class="sxs-lookup"><span data-stu-id="356d0-168">Additionally, there are `DeleteParameters`, `UpdateParameters`, and `InsertParameters` that map to the input parameters for the `ProductsBLL` class's `AddProduct`, `UpdateProduct`, and `DeleteProduct` methods:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample3.aspx)]

<span data-ttu-id="356d0-169">ObjectDataSource 包括其关联的方法，就像一系列的输入参数的每个参数`SelectParameter`s 是的存在时配置 ObjectDataSource 调用 select 方法所需的输入的参数 (如`GetProductsByCategoryID(categoryID)`).</span><span class="sxs-lookup"><span data-stu-id="356d0-169">The ObjectDataSource includes a parameter for each of the input parameters for its associated methods, just like a list of `SelectParameter` s is present when the ObjectDataSource is configured to call a select method that expects an input parameter (such as `GetProductsByCategoryID(categoryID)`).</span></span> <span data-ttu-id="356d0-170">我们稍后将看到，这些值`DeleteParameters`， `UpdateParameters`，并`InsertParameters`将自动设置的 GridView、 DetailsView 和 FormView 调用 ObjectDataSource 的之前`Insert()`， `Update()`，或`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-170">As we'll see shortly, values for these `DeleteParameters`, `UpdateParameters`, and `InsertParameters` are set automatically by the GridView, DetailsView, and FormView prior to invoking the ObjectDataSource's `Insert()`, `Update()`, or `Delete()` method.</span></span> <span data-ttu-id="356d0-171">这些值在我们将讨论在将来的教程中还可以根据需要以编程方式设置。</span><span class="sxs-lookup"><span data-stu-id="356d0-171">These values can also be set programmatically as needed, as we'll discuss in a future tutorial.</span></span>

<span data-ttu-id="356d0-172">使用该向导将配置为 ObjectDataSource 的一个副作用是 Visual Studio 将设置[OldValuesParameterFormatString 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.oldvaluesparameterformatstring(VS.80).aspx)到`original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="356d0-172">One side effect of using the wizard to configure to ObjectDataSource is that Visual Studio sets the [OldValuesParameterFormatString property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.oldvaluesparameterformatstring(VS.80).aspx) to `original_{0}`.</span></span> <span data-ttu-id="356d0-173">此属性的值用于包含正在编辑的数据的原始值，并可在两个方案中：</span><span class="sxs-lookup"><span data-stu-id="356d0-173">This property value is used to include the original values of the data being edited and is useful in two scenarios:</span></span>

- <span data-ttu-id="356d0-174">如果在编辑记录时，用户就能够更改主键值。</span><span class="sxs-lookup"><span data-stu-id="356d0-174">If, when editing a record, users are able to change the primary key value.</span></span> <span data-ttu-id="356d0-175">在这种情况下，新的主键值和原始的主键值必须提供，以便使用原始的主键值的记录可以找到并将相应地更新其值。</span><span class="sxs-lookup"><span data-stu-id="356d0-175">In this case, both the new primary key value and the original primary key value must be provided so that the record with the original primary key value can be found and have its value updated accordingly.</span></span>
- <span data-ttu-id="356d0-176">当使用乐观并发。</span><span class="sxs-lookup"><span data-stu-id="356d0-176">When using optimistic concurrency.</span></span> <span data-ttu-id="356d0-177">乐观并发是一种技术，以确保两个用户同时使用不会覆盖彼此发生的变化，并且是以后的教程主题。</span><span class="sxs-lookup"><span data-stu-id="356d0-177">Optimistic concurrency is a technique to ensure that two simultaneous users don't overwrite one another's changes, and is the topic for a future tutorial.</span></span>

<span data-ttu-id="356d0-178">`OldValuesParameterFormatString`属性指示的基础对象的更新和删除方法的原始值中的输入参数的名称。</span><span class="sxs-lookup"><span data-stu-id="356d0-178">The `OldValuesParameterFormatString` property indicates the name of the input parameters in the underlying object's update and delete methods for the original values.</span></span> <span data-ttu-id="356d0-179">我们将探讨乐观并发，我们将讨论此属性，更详细地介绍其用途。</span><span class="sxs-lookup"><span data-stu-id="356d0-179">We'll discuss this property and its purpose in greater detail when we explore optimistic concurrency.</span></span> <span data-ttu-id="356d0-180">我将其启动现在，但是，因为我们 BLL 方法不需要原始值，因此很重要，我们删除此属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-180">I bring it up now, however, because our BLL's methods do not expect the original values and therefore it's important that we remove this property.</span></span> <span data-ttu-id="356d0-181">离开`OldValuesParameterFormatString`属性设置为默认值之外的任何内容 (`{0}`) 会导致错误，当尝试调用 ObjectDataSource 的数据 Web 控件`Update()`或`Delete()`方法因为 ObjectDataSource 将尝试将这两`UpdateParameters`或`DeleteParameters`以及原始值参数指定。</span><span class="sxs-lookup"><span data-stu-id="356d0-181">Leaving the `OldValuesParameterFormatString` property set to anything other than the default (`{0}`) will cause an error when a data Web control attempts to invoke the ObjectDataSource's `Update()` or `Delete()` methods because the ObjectDataSource will attempt to pass in both the `UpdateParameters` or `DeleteParameters` specified as well as original value parameters.</span></span>

<span data-ttu-id="356d0-182">如果这不是十分清楚此时，必须查明，别担心，我们将在以后的教程中检查此属性和它的实用。</span><span class="sxs-lookup"><span data-stu-id="356d0-182">If this isn't terribly clear at this juncture, don't worry, we'll examine this property and its utility in a future tutorial.</span></span> <span data-ttu-id="356d0-183">现在，只是一定要完全从声明性语法中删除此属性声明或将值设置为默认值 ({0})。</span><span class="sxs-lookup"><span data-stu-id="356d0-183">For now, just be certain to either remove this property declaration entirely from the declarative syntax or set the value to the default value ({0}).</span></span>

> [!NOTE]
> <span data-ttu-id="356d0-184">如果只需清除`OldValuesParameterFormatString`属性值从属性窗口在设计视图中，该属性仍将存在于声明性语法，但将设置为空字符串。</span><span class="sxs-lookup"><span data-stu-id="356d0-184">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but be set to an empty string.</span></span> <span data-ttu-id="356d0-185">此操作，遗憾的是，仍会导致上面讨论的相同问题。</span><span class="sxs-lookup"><span data-stu-id="356d0-185">This, unfortunately, will still result in the same problem discussed above.</span></span> <span data-ttu-id="356d0-186">因此，删除该属性完全声明性语法中，或从属性窗口中，将值设置为默认情况下， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="356d0-186">Therefore, either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>


## <a name="step-3-adding-a-data-web-control-and-configuring-it-for-data-modification"></a><span data-ttu-id="356d0-187">步骤 3： 添加数据 Web 控件并将其配置针对数据修改</span><span class="sxs-lookup"><span data-stu-id="356d0-187">Step 3: Adding a Data Web Control and Configuring It for Data Modification</span></span>

<span data-ttu-id="356d0-188">ObjectDataSource 具有已添加到页并配置后，我们就可以将数据 Web 控件添加到页后，可以同时显示的数据，并提供一个使最终用户对其进行修改。</span><span class="sxs-lookup"><span data-stu-id="356d0-188">Once the ObjectDataSource has been added to the page and configured, we're ready to add data Web controls to the page to both display the data and provide a means for the end user to modify it.</span></span> <span data-ttu-id="356d0-189">我们将介绍的 GridView、 DetailsView 和 FormView 分开，因为这些数据 Web 控件在其数据修改功能和配置不同。</span><span class="sxs-lookup"><span data-stu-id="356d0-189">We'll look at the GridView, DetailsView, and FormView separately, as these data Web controls differ in their data modification capabilities and configuration.</span></span>

<span data-ttu-id="356d0-190">我们将看到这篇文章的其余部分中添加非常基本的编辑、 插入和删除通过 GridView、 DetailsView，支持和 FormView 控件是非常简单，检查几个复选框。</span><span class="sxs-lookup"><span data-stu-id="356d0-190">As we'll see in the remainder of this article, adding very basic editing, inserting, and deleting support through the GridView, DetailsView, and FormView controls is really as simple as checking a couple of checkboxes.</span></span> <span data-ttu-id="356d0-191">有许多细微问题和在现实世界中的边缘情况，请提供此类不是只需指向和单击更为复杂的功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-191">There are many subtleties and edge cases in the real-world that make providing such functionality more involved than just point and click.</span></span> <span data-ttu-id="356d0-192">本教程中，但是，主要依靠证明简单数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-192">This tutorial, however, focuses solely on proving simplistic data modification capabilities.</span></span> <span data-ttu-id="356d0-193">将来的教程将探讨会实际设置中出现的问题。</span><span class="sxs-lookup"><span data-stu-id="356d0-193">Future tutorials will examine concerns that will undoubtedly arise in a real-world setting.</span></span>

## <a name="deleting-data-from-the-gridview"></a><span data-ttu-id="356d0-194">从 GridView 中删除数据</span><span class="sxs-lookup"><span data-stu-id="356d0-194">Deleting Data from the GridView</span></span>

<span data-ttu-id="356d0-195">首先，从工具箱拖到设计器中拖动 GridView。</span><span class="sxs-lookup"><span data-stu-id="356d0-195">Start by dragging a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="356d0-196">接下来，将对象数据源绑定到 GridView，GridView 的智能标记中的下拉列表中选择。</span><span class="sxs-lookup"><span data-stu-id="356d0-196">Next, bind the ObjectDataSource to the GridView by selecting it from the drop-down list in the GridView's smart tag.</span></span> <span data-ttu-id="356d0-197">此时将为 GridView 的声明性标记：</span><span class="sxs-lookup"><span data-stu-id="356d0-197">At this point the GridView's declarative markup will be:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample4.aspx)]

<span data-ttu-id="356d0-198">将 GridView 绑定到通过其智能标记 ObjectDataSource 有两个好处：</span><span class="sxs-lookup"><span data-stu-id="356d0-198">Binding the GridView to the ObjectDataSource through its smart tag has two benefits:</span></span>

- <span data-ttu-id="356d0-199">为每个对象数据源返回的字段自动创建 BoundFields 和 CheckBoxFields。</span><span class="sxs-lookup"><span data-stu-id="356d0-199">BoundFields and CheckBoxFields are automatically created for each of the fields returned by the ObjectDataSource.</span></span> <span data-ttu-id="356d0-200">此外，BoundField 和 CheckBoxField 的属性会根据设置的基础字段元数据。</span><span class="sxs-lookup"><span data-stu-id="356d0-200">Moreover, the BoundField and CheckBoxField's properties are set based on the underlying field's metadata.</span></span> <span data-ttu-id="356d0-201">例如， `ProductID`， `CategoryName`，并`SupplierName`字段都标记为只读的中`ProductsDataTable`，因此不应是可更新编辑时。</span><span class="sxs-lookup"><span data-stu-id="356d0-201">For example, the `ProductID`, `CategoryName`, and `SupplierName` fields are marked as read-only in the `ProductsDataTable` and therefore shouldn't be updatable when editing.</span></span> <span data-ttu-id="356d0-202">若要容纳此，则这些 BoundFields[只读属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.readonly(VS.80).aspx)设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="356d0-202">To accommodate this, these BoundFields' [ReadOnly properties](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.readonly(VS.80).aspx) are set to `true`.</span></span>
- <span data-ttu-id="356d0-203">[DataKeyNames 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.datakeynames(VS.80).aspx)分配给基础对象的主键字段。</span><span class="sxs-lookup"><span data-stu-id="356d0-203">The [DataKeyNames property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.datakeynames(VS.80).aspx) is assigned to the primary key field(s) of the underlying object.</span></span> <span data-ttu-id="356d0-204">这是必不可少的时使用 GridView 编辑或删除数据，此属性指示的字段 （或组的字段），它唯一标识每条记录。</span><span class="sxs-lookup"><span data-stu-id="356d0-204">This is essential when using the GridView for editing or deleting data, as this property indicates the field (or set of fields) that unique identifies each record.</span></span> <span data-ttu-id="356d0-205">有关详细信息`DataKeyNames`属性，将回指[母版/详细信息使用详细信息 DetailView 的可选母版 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="356d0-205">For more information on the `DataKeyNames` property, refer back to the [Master/Detail Using a Selectable Master GridView with a Details DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial.</span></span>

<span data-ttu-id="356d0-206">虽然可将 GridView 绑定到通过属性窗口或声明性语法 ObjectDataSource，这样做需要你手动添加相应 BoundField 和`DataKeyNames`标记。</span><span class="sxs-lookup"><span data-stu-id="356d0-206">While the GridView can be bound to the ObjectDataSource through the Properties window or declarative syntax, doing so requires you to manually add the appropriate BoundField and `DataKeyNames` markup.</span></span>

<span data-ttu-id="356d0-207">GridView 控件为行级编辑和删除提供内置支持。</span><span class="sxs-lookup"><span data-stu-id="356d0-207">The GridView control provides built-in support for row-level editing and deleting.</span></span> <span data-ttu-id="356d0-208">配置一个 GridView，支持删除添加删除按钮的列。</span><span class="sxs-lookup"><span data-stu-id="356d0-208">Configuring a GridView to support deleting adds a column of Delete buttons.</span></span> <span data-ttu-id="356d0-209">当最终用户单击特定行的删除按钮时，才会进行回发和 GridView 将执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="356d0-209">When the end user clicks the Delete button for a particular row, a postback ensues and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="356d0-210">ObjectDataSource 的`DeleteParameters`分配值</span><span class="sxs-lookup"><span data-stu-id="356d0-210">The ObjectDataSource's `DeleteParameters` value(s) are assigned</span></span>
2. <span data-ttu-id="356d0-211">ObjectDataSource 的`Delete()`调用方法时，删除指定的记录</span><span class="sxs-lookup"><span data-stu-id="356d0-211">The ObjectDataSource's `Delete()` method is invoked, deleting the specified record</span></span>
3. <span data-ttu-id="356d0-212">GridView 重新绑定本身到对象数据源通过调用其`Select()`方法</span><span class="sxs-lookup"><span data-stu-id="356d0-212">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>

<span data-ttu-id="356d0-213">分配给的值`DeleteParameters`的值`DataKeyNames`其删除按钮被单击的行的字段。</span><span class="sxs-lookup"><span data-stu-id="356d0-213">The values assigned to the `DeleteParameters` are the values of the `DataKeyNames` field(s) for the row whose Delete button was clicked.</span></span> <span data-ttu-id="356d0-214">因此很重要的 GridView 的`DataKeyNames`属性正确设置。</span><span class="sxs-lookup"><span data-stu-id="356d0-214">Therefore it's vital that a GridView's `DataKeyNames` property be correctly set.</span></span> <span data-ttu-id="356d0-215">如果缺失，`DeleteParameters`将分配`null`值在步骤 1，又不会导致任何删除在步骤 2 中的记录。</span><span class="sxs-lookup"><span data-stu-id="356d0-215">If it's missing, the `DeleteParameters` will be assigned a `null` value in Step 1, which in turn will not result in any deleted records in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="356d0-216">`DataKeys`集合存储在 GridView 的控件状态，也就是说，`DataKeys`值将记住在回发之间，即使已禁用的 GridView 的视图状态。</span><span class="sxs-lookup"><span data-stu-id="356d0-216">The `DataKeys` collection is stored in the GridView s control state, meaning that the `DataKeys` values will be remembered across postback even if the GridView s view state has been disabled.</span></span> <span data-ttu-id="356d0-217">但是，它是非常重要的 Gridview 支持编辑或删除 （默认行为） 的视图状态保持启用状态。</span><span class="sxs-lookup"><span data-stu-id="356d0-217">However, it is very important that view state remains enabled for GridViews that support editing or deleting (the default behavior).</span></span> <span data-ttu-id="356d0-218">如果设置 GridView s`EnableViewState`属性设置为`false`、 编辑和删除行为将适用于单个用户，能够正常工作，但如果删除数据的并发用户，存在这些并发的用户可能意外的可能性删除或编辑记录该它们无效 t 计划。</span><span class="sxs-lookup"><span data-stu-id="356d0-218">If you set the GridView s `EnableViewState` property to `false`, the editing and deleting behavior will work fine for a single user, but if there are concurrent users deleting data, there exists the possibility that these concurrent users may accidentally delete or edit records that they didn t intend.</span></span> <span data-ttu-id="356d0-219">请参阅我博客文章[警告： 禁用并发问题与 ASP.NET 2.0 Gridview/DetailsView/FormViews 该支持编辑和/或删除和其视图状态](http://scottonwriting.net/sowblog/archive/2006/10/03/163215.aspx)，有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="356d0-219">See my blog entry, [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/archive/2006/10/03/163215.aspx), for more information.</span></span>


<span data-ttu-id="356d0-220">此相同的警告也适用于 DetailsViews 和 FormViews。</span><span class="sxs-lookup"><span data-stu-id="356d0-220">This same warning also applies to DetailsViews and FormViews.</span></span>

<span data-ttu-id="356d0-221">若要将删除的功能添加到 GridView，只需转到其智能标记，并选中启用删除复选框。</span><span class="sxs-lookup"><span data-stu-id="356d0-221">To add deleting capabilities to a GridView, simply go to its smart tag and check the Enable Deleting checkbox.</span></span>


![检查删除复选框启用](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image24.png)

<span data-ttu-id="356d0-223">**图 10**： 检查删除复选框启用</span><span class="sxs-lookup"><span data-stu-id="356d0-223">**Figure 10**: Check the Enable Deleting Checkbox</span></span>


<span data-ttu-id="356d0-224">从智能标记的启用删除复选框将 CommandField 添加到 GridView。</span><span class="sxs-lookup"><span data-stu-id="356d0-224">Checking the Enable Deleting checkbox from the smart tag adds a CommandField to the GridView.</span></span> <span data-ttu-id="356d0-225">CommandField 呈现按钮，用于执行一个或多个以下任务使用 GridView 中的列： 选择的记录，编辑记录，并删除一条记录。</span><span class="sxs-lookup"><span data-stu-id="356d0-225">The CommandField renders a column in the GridView with buttons for performing one or more of the following tasks: selecting a record, editing a record, and deleting a record.</span></span> <span data-ttu-id="356d0-226">我们以前看到的那样在操作选择中的记录 CommandField[母版/详细信息使用详细信息 DetailView 的可选母版 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="356d0-226">We previously saw the CommandField in action with selecting records in the [Master/Detail Using a Selectable Master GridView with a Details DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial.</span></span>

<span data-ttu-id="356d0-227">CommandField 包含大量`ShowXButton`指示哪些系列按钮显示在 CommandField 属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-227">The CommandField contains a number of `ShowXButton` properties that indicate what series of buttons are displayed in the CommandField.</span></span> <span data-ttu-id="356d0-228">通过选中启用删除复选框 CommandField 其`ShowDeleteButton`属性是`true`已添加到 GridView 的列集合。</span><span class="sxs-lookup"><span data-stu-id="356d0-228">By checking the Enable Deleting checkbox a CommandField whose `ShowDeleteButton` property is `true` has been added to the GridView's Columns collection.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample5.aspx)]

<span data-ttu-id="356d0-229">现在，无论您相信与否，我们已经完成了将删除支持添加到 GridView ！</span><span class="sxs-lookup"><span data-stu-id="356d0-229">At this point, believe it or not, we're done with adding deleting support to the GridView!</span></span> <span data-ttu-id="356d0-230">如图 11 所示，当访问此页上通过浏览器删除按钮的列存在。</span><span class="sxs-lookup"><span data-stu-id="356d0-230">As Figure 11 shows, when visiting this page through a browser a column of Delete buttons is present.</span></span>


<span data-ttu-id="356d0-231">[![CommandField 添加删除按钮的列](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image26.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-231">[![The CommandField Adds a Column of Delete Buttons](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image26.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image25.png)</span></span>

<span data-ttu-id="356d0-232">**图 11**: CommandField 添加了列的删除按钮 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-232">**Figure 11**: The CommandField Adds a Column of Delete Buttons ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image27.png))</span></span>


<span data-ttu-id="356d0-233">如果您生成本教程中从零开始，自行时测试此页上，单击删除按钮将引发异常。</span><span class="sxs-lookup"><span data-stu-id="356d0-233">If you've been building this tutorial from the ground up on your own, when testing this page clicking the Delete button will raise an exception.</span></span> <span data-ttu-id="356d0-234">继续阅读以了解有关生成这些异常的原因以及如何解决这些问题。</span><span class="sxs-lookup"><span data-stu-id="356d0-234">Continue reading to learn as to why these exceptions were raised and how to fix them.</span></span>

> [!NOTE]
> <span data-ttu-id="356d0-235">如果您一直使用此教程随附的下载，具有已被考虑这些问题。</span><span class="sxs-lookup"><span data-stu-id="356d0-235">If you're following along using the download accompanying this tutorial, these problems have already been accounted for.</span></span> <span data-ttu-id="356d0-236">但是，我鼓励您通读下面列出，以帮助识别可能出现的问题和合适的解决方法的详细信息。</span><span class="sxs-lookup"><span data-stu-id="356d0-236">However, I encourage you to read through the details listed below to help identify problems that may arise and suitable workarounds.</span></span>


<span data-ttu-id="356d0-237">如果在尝试删除某个产品时，获取的异常的消息是类似于"*ObjectDataSource ObjectDataSource1 找不到非泛型方法具有参数的 DeleteProduct: 产品 id，原始\_ProductID*，"您可能忘记删除`OldValuesParameterFormatString`ObjectDataSource 中的属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-237">If, when attempting to delete a product, you get an exception whose message is similar to "*ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'DeleteProduct' that has parameters: productID, original\_ProductID*," you likely forgot to remove the `OldValuesParameterFormatString` property from the ObjectDataSource.</span></span> <span data-ttu-id="356d0-238">与`OldValuesParameterFormatString`属性指定，ObjectDataSource 尝试传递中均`productID`并`original_ProductID`输入参数`DeleteProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-238">With the `OldValuesParameterFormatString` property specified, the ObjectDataSource attempts to pass in both `productID` and `original_ProductID` input parameters to the `DeleteProduct` method.</span></span> <span data-ttu-id="356d0-239">`DeleteProduct`但是，仅接受一个输入的参数，因此异常。</span><span class="sxs-lookup"><span data-stu-id="356d0-239">`DeleteProduct`, however, only accepts a single input parameter, hence the exception.</span></span> <span data-ttu-id="356d0-240">删除`OldValuesParameterFormatString`属性 (或将其设置为`{0}`) 指示对象数据源，不尝试将原始的输入参数中。</span><span class="sxs-lookup"><span data-stu-id="356d0-240">Removing the `OldValuesParameterFormatString` property (or setting it to `{0}`) instructs the ObjectDataSource to not attempt to pass in the original input parameter.</span></span>


<span data-ttu-id="356d0-241">[![确保 OldValuesParameterFormatString 属性已被清除](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image29.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-241">[![Ensure That the OldValuesParameterFormatString Property Has Been Cleared Out](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image29.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image28.png)</span></span>

<span data-ttu-id="356d0-242">**图 12**： 确保`OldValuesParameterFormatString`属性已被清除出 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-242">**Figure 12**: Ensure That the `OldValuesParameterFormatString` Property Has Been Cleared Out ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image30.png))</span></span>


<span data-ttu-id="356d0-243">即使您已经删除`OldValuesParameterFormatString`属性，您仍将收到异常时尝试删除该消息与产品:"*DELETE 语句与引用约束冲突 FK\_顺序\_详细信息\_产品的*。"Northwind 数据库包含之间的外键约束`Order Details`并`Products`表，这表示如果存在一个或多个记录中为其产品不能从系统删除`Order Details`表。</span><span class="sxs-lookup"><span data-stu-id="356d0-243">Even if you had removed the `OldValuesParameterFormatString` property, you still will get an exception when trying to delete a product with the message: "*The DELETE statement conflicted with the REFERENCE constraint 'FK\_Order\_Details\_Products'*." The Northwind database contains a foreign key constraint between the `Order Details` and `Products` table, meaning that a product cannot be deleted from the system if there are one or more records for it in the `Order Details` table.</span></span> <span data-ttu-id="356d0-244">由于在 Northwind 数据库中的每个产品具有至少一个记录`Order Details`，我们首先删除该产品关联的订单详细信息记录之前，我们不能删除任何产品。</span><span class="sxs-lookup"><span data-stu-id="356d0-244">Since every product in the Northwind database has at least one record in `Order Details`, we cannot delete any products until we first delete the product's associated order details records.</span></span>


<span data-ttu-id="356d0-245">[![外键约束禁止删除产品](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image32.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-245">[![A Foreign Key Constraint Prohibits the Deletion of Products](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image32.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image31.png)</span></span>

<span data-ttu-id="356d0-246">**图 13**： 外键约束禁止删除的产品 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-246">**Figure 13**: A Foreign Key Constraint Prohibits the Deletion of Products ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image33.png))</span></span>


<span data-ttu-id="356d0-247">本教程中，让我们只需删除所有从记录`Order Details`表。</span><span class="sxs-lookup"><span data-stu-id="356d0-247">For our tutorial, let's just delete all of the records from the `Order Details` table.</span></span> <span data-ttu-id="356d0-248">在实际应用程序中我们将需要为：</span><span class="sxs-lookup"><span data-stu-id="356d0-248">In a real-world application we'd need to either:</span></span>

- <span data-ttu-id="356d0-249">具有另一个屏幕来管理订单详细信息</span><span class="sxs-lookup"><span data-stu-id="356d0-249">Have another screen to manage order details information</span></span>
- <span data-ttu-id="356d0-250">增强`DeleteProduct`方法以包括逻辑删除指定的产品的订单详细信息</span><span class="sxs-lookup"><span data-stu-id="356d0-250">Augment the `DeleteProduct` method to include logic to delete the specified product's order details</span></span>
- <span data-ttu-id="356d0-251">修改 TableAdapter 用于包括删除的指定的产品的订单详细信息的 SQL 查询</span><span class="sxs-lookup"><span data-stu-id="356d0-251">Modify the SQL query used by the TableAdapter to include deletion of the specified product's order details</span></span>

<span data-ttu-id="356d0-252">让我们只需删除所有从记录`Order Details`来绕过的外键约束的表。</span><span class="sxs-lookup"><span data-stu-id="356d0-252">Let's just delete all of the records from the `Order Details` table to circumvent the foreign key constraint.</span></span> <span data-ttu-id="356d0-253">转到 Visual Studio 中的服务器资源管理器，右键单击`NORTHWND.MDF`节点，然后选择新查询。</span><span class="sxs-lookup"><span data-stu-id="356d0-253">Go to the Server Explorer in Visual Studio, right-click on the `NORTHWND.MDF` node, and choose New Query.</span></span> <span data-ttu-id="356d0-254">然后，在查询窗口中，运行以下 SQL 语句： `DELETE FROM [Order Details]`</span><span class="sxs-lookup"><span data-stu-id="356d0-254">Then, in the query window, run the following SQL statement: `DELETE FROM [Order Details]`</span></span>


<span data-ttu-id="356d0-255">[![从订单详细信息表中删除所有记录](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image35.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-255">[![Delete All Records from the Order Details Table](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image35.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image34.png)</span></span>

<span data-ttu-id="356d0-256">**图 14**： 删除所有记录`Order Details`表 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-256">**Figure 14**: Delete All Records from the `Order Details` Table ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image36.png))</span></span>


<span data-ttu-id="356d0-257">清除后`Order Details`表单击删除按钮将删除的产品不会出错。</span><span class="sxs-lookup"><span data-stu-id="356d0-257">After clearing out the `Order Details` table clicking on the Delete button will delete the product without error.</span></span> <span data-ttu-id="356d0-258">如果单击删除按钮不会删除该产品，检查以确保的 GridView`DataKeyNames`属性设置为主键字段 (`ProductID`)。</span><span class="sxs-lookup"><span data-stu-id="356d0-258">If clicking on the Delete button does not delete the product, check to ensure that the GridView's `DataKeyNames` property is set to the primary key field (`ProductID`).</span></span>

> [!NOTE]
> <span data-ttu-id="356d0-259">单击删除按钮时才会进行回发和删除该记录。</span><span class="sxs-lookup"><span data-stu-id="356d0-259">When clicking on the Delete button a postback ensues and the record is deleted.</span></span> <span data-ttu-id="356d0-260">这可能会很危险，因为很容易意外地单击错误行的删除按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-260">This can be dangerous since it is easy to accidentally click on the wrong row's Delete button.</span></span> <span data-ttu-id="356d0-261">在将来的教程中我们将了解如何删除一条记录时添加客户端的确认。</span><span class="sxs-lookup"><span data-stu-id="356d0-261">In a future tutorial we'll see how to add a client-side confirmation when deleting a record.</span></span>


## <a name="editing-data-with-the-gridview"></a><span data-ttu-id="356d0-262">编辑数据的 gridview</span><span class="sxs-lookup"><span data-stu-id="356d0-262">Editing Data with the GridView</span></span>

<span data-ttu-id="356d0-263">以及删除 GridView 控件还提供内置的行级编辑支持。</span><span class="sxs-lookup"><span data-stu-id="356d0-263">Along with deleting, the GridView control also provides built-in row-level editing support.</span></span> <span data-ttu-id="356d0-264">配置一个 GridView，支持编辑添加编辑按钮的列。</span><span class="sxs-lookup"><span data-stu-id="356d0-264">Configuring a GridView to support editing adds a column of Edit buttons.</span></span> <span data-ttu-id="356d0-265">从最终用户的角度来看，单击某一行的编辑按钮，将使该行成为可编辑，转换包含的现有值并替换与更新编辑按钮和取消按钮的文本框单元格。</span><span class="sxs-lookup"><span data-stu-id="356d0-265">From the end user's perspective, clicking a row's Edit button causes that row to become editable, turning the cells into textboxes containing the existing values and replacing the Edit button with Update and Cancel buttons.</span></span> <span data-ttu-id="356d0-266">进行其所需的更改后，最终用户可以单击更新按钮提交所做的更改或弃用这些取消按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-266">After making their desired changes, the end user can click the Update button to commit the changes or the Cancel button to discard them.</span></span> <span data-ttu-id="356d0-267">在任一情况下，单击更新或取消按钮后 GridView 返回到其预先编辑状态。</span><span class="sxs-lookup"><span data-stu-id="356d0-267">In either case, after clicking Update or Cancel the GridView returns to its pre-editing state.</span></span>

<span data-ttu-id="356d0-268">从我们角度来看，作为页面开发人员，当最终用户单击特定行的编辑按钮时，回发时，才会和 GridView 将执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="356d0-268">From our perspective as the page developer, when the end user clicks the Edit button for a particular row, a postback ensues and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="356d0-269">GridView 的`EditItemIndex`属性分配给其编辑按钮被单击的行的索引</span><span class="sxs-lookup"><span data-stu-id="356d0-269">The GridView's `EditItemIndex` property is assigned to the index of the row whose Edit button was clicked</span></span>
2. <span data-ttu-id="356d0-270">GridView 重新绑定本身到对象数据源通过调用其`Select()`方法</span><span class="sxs-lookup"><span data-stu-id="356d0-270">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>
3. <span data-ttu-id="356d0-271">匹配的行索引`EditItemIndex`呈现在"编辑模式。"</span><span class="sxs-lookup"><span data-stu-id="356d0-271">The row index that matches the `EditItemIndex` is rendered in "edit mode."</span></span> <span data-ttu-id="356d0-272">在此模式下，编辑按钮被替换为更新和取消按钮和 BoundFields 其`ReadOnly`属性均为 False （默认值） 作为文本框 Web 控件的呈现`Text`属性分配给数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="356d0-272">In this mode, the Edit button is replaced by Update and Cancel buttons and BoundFields whose `ReadOnly` properties are False (the default) are rendered as TextBox Web controls whose `Text` properties are assigned to the data fields' values.</span></span>

<span data-ttu-id="356d0-273">此时标记返回到浏览器中，允许最终用户对行的数据进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="356d0-273">At this point the markup is returned to the browser, allowing the end user to make any changes to the row's data.</span></span> <span data-ttu-id="356d0-274">当用户单击更新按钮时，产生的回发和 GridView 将执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="356d0-274">When the user clicks the Update button, a postback occurs and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="356d0-275">ObjectDataSource 的`UpdateParameters`值分配到 GridView 的编辑界面由最终用户输入的值</span><span class="sxs-lookup"><span data-stu-id="356d0-275">The ObjectDataSource's `UpdateParameters` value(s) are assigned the values entered by the end user into the GridView's editing interface</span></span>
2. <span data-ttu-id="356d0-276">ObjectDataSource 的`Update()`调用方法时，更新指定的记录</span><span class="sxs-lookup"><span data-stu-id="356d0-276">The ObjectDataSource's `Update()` method is invoked, updating the specified record</span></span>
3. <span data-ttu-id="356d0-277">GridView 重新绑定本身到对象数据源通过调用其`Select()`方法</span><span class="sxs-lookup"><span data-stu-id="356d0-277">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>

<span data-ttu-id="356d0-278">分配到的主键值`UpdateParameters`在步骤 1 中来自中指定的值`DataKeyNames`属性，而非主键值来自中编辑过的行的文本框中 Web 控件的文本。</span><span class="sxs-lookup"><span data-stu-id="356d0-278">The primary key values assigned to the `UpdateParameters` in Step 1 come from the values specified in the `DataKeyNames` property, whereas the non-primary key values come from the text in the TextBox Web controls for the edited row.</span></span> <span data-ttu-id="356d0-279">因为与删除，它是重要的 GridView 的`DataKeyNames`属性正确设置。</span><span class="sxs-lookup"><span data-stu-id="356d0-279">As with deleting, it is vital that a GridView's `DataKeyNames` property be correctly set.</span></span> <span data-ttu-id="356d0-280">如果缺失，`UpdateParameters`将分配的主键值`null`在步骤 1，又不会导致任何值更新在步骤 2 中的记录。</span><span class="sxs-lookup"><span data-stu-id="356d0-280">If it's missing, the `UpdateParameters` primary key value will be assigned a `null` value in Step 1, which in turn will not result in any updated records in Step 2.</span></span>

<span data-ttu-id="356d0-281">可以通过只需检查 GridView 的智能标记中的启用编辑复选框激活编辑功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-281">Editing functionality can be activated by simply checking the Enable Editing checkbox in the GridView's smart tag.</span></span>


![检查编辑复选框启用](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image37.png)

<span data-ttu-id="356d0-283">**图 15**： 检查编辑复选框启用</span><span class="sxs-lookup"><span data-stu-id="356d0-283">**Figure 15**: Check the Enable Editing Checkbox</span></span>


<span data-ttu-id="356d0-284">检查启用编辑复选框将添加 CommandField （是否需要） 并设置其`ShowEditButton`属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="356d0-284">Checking the Enable Editing checkbox will add a CommandField (if needed) and set its `ShowEditButton` property to `true`.</span></span> <span data-ttu-id="356d0-285">CommandField 如我们前面看到的包含大量`ShowXButton`指示哪些系列按钮显示在 CommandField 属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-285">As we saw earlier, the CommandField contains a number of `ShowXButton` properties that indicate what series of buttons are displayed in the CommandField.</span></span> <span data-ttu-id="356d0-286">选中启用编辑复选框添加`ShowEditButton`属性设置为现有 CommandField:</span><span class="sxs-lookup"><span data-stu-id="356d0-286">Checking the Enable Editing checkbox adds the `ShowEditButton` property to the existing CommandField:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample6.aspx)]

<span data-ttu-id="356d0-287">这就是一切就是添加基本编辑支持。</span><span class="sxs-lookup"><span data-stu-id="356d0-287">That's all there is to adding rudimentary editing support.</span></span> <span data-ttu-id="356d0-288">编辑界面是相当不成熟 Figure16 所示，每个 BoundField 其`ReadOnly`属性设置为`false`（默认值） 将呈现为一个文本框。</span><span class="sxs-lookup"><span data-stu-id="356d0-288">As Figure16 shows, the editing interface is rather crude each BoundField whose `ReadOnly` property is set to `false` (the default) is rendered as a TextBox.</span></span> <span data-ttu-id="356d0-289">这包括字段，例如`CategoryID`和`SupplierID`，这是与其他表的键。</span><span class="sxs-lookup"><span data-stu-id="356d0-289">This includes fields like `CategoryID` and `SupplierID`, which are keys to other tables.</span></span>


<span data-ttu-id="356d0-290">[![单击 Chai s 编辑按钮以编辑模式显示该行](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image39.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-290">[![Clicking Chai s Edit Button Displays the Row in Edit Mode](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image39.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image38.png)</span></span>

<span data-ttu-id="356d0-291">**图 16**： 单击 Chai s 编辑按钮以编辑模式显示该行 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-291">**Figure 16**: Clicking Chai s Edit Button Displays the Row in Edit Mode ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image40.png))</span></span>


<span data-ttu-id="356d0-292">除了让用户直接编辑外键值，编辑接口的接口缺少以下方面：</span><span class="sxs-lookup"><span data-stu-id="356d0-292">In addition to asking users to edit foreign key values directly, the editing interface's interface is lacking in the following ways:</span></span>

- <span data-ttu-id="356d0-293">如果用户输入`CategoryID`或`SupplierID`不存在在数据库中，`UPDATE`将违反外键约束，从而导致引发异常。</span><span class="sxs-lookup"><span data-stu-id="356d0-293">If the user enters a `CategoryID` or `SupplierID` that does not exist in the database, the `UPDATE` will violate a foreign key constraint, causing an exception to be raised.</span></span>
- <span data-ttu-id="356d0-294">编辑接口不包括任何验证。</span><span class="sxs-lookup"><span data-stu-id="356d0-294">The editing interface doesn't include any validation.</span></span> <span data-ttu-id="356d0-295">如果未提供所需的值 (如`ProductName`)，或输入一个字符串值的地方的数字值 （例如，输入"过多 ！"</span><span class="sxs-lookup"><span data-stu-id="356d0-295">If you don't provide a required value (such as `ProductName`), or enter a string value where a numeric value is expected (such as entering "Too much!"</span></span> <span data-ttu-id="356d0-296">到`UnitPrice`文本框)，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="356d0-296">into the `UnitPrice` textbox), an exception will be thrown.</span></span> <span data-ttu-id="356d0-297">以后的教程将介绍如何向编辑的用户界面添加验证控件。</span><span class="sxs-lookup"><span data-stu-id="356d0-297">A future tutorial will examine how to add validation controls to the editing user interface.</span></span>
- <span data-ttu-id="356d0-298">目前，*所有*GridView 中必须包含产品字段不是只读的。</span><span class="sxs-lookup"><span data-stu-id="356d0-298">Currently, *all* product fields that are not read-only must be included in the GridView.</span></span> <span data-ttu-id="356d0-299">如果我们要从 GridView 中删除字段，说`UnitPrice`时不会设置更新数据的 GridView `UnitPrice` `UpdateParameters`值，更改的数据库记录`UnitPrice`到`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="356d0-299">If we were to remove a field from the GridView, say `UnitPrice`, when updating the data the GridView would not set the `UnitPrice` `UpdateParameters` value, which would change the database record's `UnitPrice` to a `NULL` value.</span></span> <span data-ttu-id="356d0-300">同样，如果必填字段，如`ProductName`，删除从 GridView 中，则更新将具有相同失败"*列 'ProductName' 不允许使用 null*"上面提到的异常。</span><span class="sxs-lookup"><span data-stu-id="356d0-300">Similarly, if a required field, such as `ProductName`, is removed from the GridView, the update will fail with the same "*Column 'ProductName' does not allow nulls*" exception mentioned above.</span></span>
- <span data-ttu-id="356d0-301">编辑界面格式设置差强人意所希望的。</span><span class="sxs-lookup"><span data-stu-id="356d0-301">The editing interface formatting leaves a lot to be desired.</span></span> <span data-ttu-id="356d0-302">`UnitPrice`具有小数点后有 4 所示。</span><span class="sxs-lookup"><span data-stu-id="356d0-302">The `UnitPrice` is shown with four decimal points.</span></span> <span data-ttu-id="356d0-303">理想情况下`CategoryID`和`SupplierID`值将包含在系统中列出的类别和供应商的 Dropdownlist。</span><span class="sxs-lookup"><span data-stu-id="356d0-303">Ideally the `CategoryID` and `SupplierID` values would contain DropDownLists that list the categories and suppliers in the system.</span></span>

<span data-ttu-id="356d0-304">这些是所有的不足之处，我们将不得不接受目前为止，但会在将来的教程中得以解决。</span><span class="sxs-lookup"><span data-stu-id="356d0-304">These are all shortcomings that we'll have to live with for now, but will be addressed in future tutorials.</span></span>

## <a name="inserting-editing-and-deleting-data-with-the-detailsview"></a><span data-ttu-id="356d0-305">插入、 编辑和删除数据与 DetailsView</span><span class="sxs-lookup"><span data-stu-id="356d0-305">Inserting, Editing, and Deleting Data with the DetailsView</span></span>

<span data-ttu-id="356d0-306">正如我们已经看到在之前的教程，DetailsView 控件一次显示一条记录，并如 GridView，允许进行编辑和删除当前显示的记录。</span><span class="sxs-lookup"><span data-stu-id="356d0-306">As we've seen in earlier tutorials, the DetailsView control displays one record at a time and, like the GridView, allows for editing and deleting of the currently displayed record.</span></span> <span data-ttu-id="356d0-307">这两个最终用户体验的编辑和删除 DetailsView 和从 ASP.NET 端工作流中的项目等同于 GridView。</span><span class="sxs-lookup"><span data-stu-id="356d0-307">Both the end user's experience with editing and deleting items from a DetailsView and the workflow from the ASP.NET side is identical to that of the GridView.</span></span> <span data-ttu-id="356d0-308">DetailsView GridView 与不同的是它还提供内置插入支持。</span><span class="sxs-lookup"><span data-stu-id="356d0-308">Where the DetailsView differs from the GridView is that it also provides built-in inserting support.</span></span>

<span data-ttu-id="356d0-309">若要演示的 GridView 的数据修改功能，首先添加到 DetailsView`Basics.aspx`上方现有 GridView 页上，并将其绑定到现有 ObjectDataSource 通过 DetailsView 的智能标记。</span><span class="sxs-lookup"><span data-stu-id="356d0-309">To demonstrate the data modification capabilities of the GridView, start by adding a DetailsView to the `Basics.aspx` page above the existing GridView and bind it to the existing ObjectDataSource through the DetailsView's smart tag.</span></span> <span data-ttu-id="356d0-310">下一步，清除 DetailsView`Height`和`Width`属性，并检查从智能标记启用分页选项。</span><span class="sxs-lookup"><span data-stu-id="356d0-310">Next, clear out the DetailsView's `Height` and `Width` properties, and check the Enable Paging option from the smart tag.</span></span> <span data-ttu-id="356d0-311">若要启用编辑，插入和删除的支持，只需检查智能标记中的启用编辑、 启用插入和启用删除复选框。</span><span class="sxs-lookup"><span data-stu-id="356d0-311">To enable editing, inserting, and deleting support, simply check the Enable Editing, Enable Inserting, and Enable Deleting checkboxes in the smart tag.</span></span>


![配置为支持编辑、 插入和删除 DetailsView](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image41.png)

<span data-ttu-id="356d0-313">**图 17**： 配置为支持编辑、 插入和删除 DetailsView</span><span class="sxs-lookup"><span data-stu-id="356d0-313">**Figure 17**: Configure the DetailsView to Support Editing, Inserting, and Deleting</span></span>


<span data-ttu-id="356d0-314">作为使用 GridView，添加编辑，插入或删除支持向 CommandField DetailsView，如下所示的声明性语法：</span><span class="sxs-lookup"><span data-stu-id="356d0-314">As with the GridView, adding editing, inserting, or deleting support adds a CommandField to the DetailsView, as the following declarative syntax shows:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample7.aspx)]

<span data-ttu-id="356d0-315">请注意，对于 DetailsView CommandField 默认情况下，将显示在列集合的末尾。</span><span class="sxs-lookup"><span data-stu-id="356d0-315">Note that for the DetailsView the CommandField appears at the end of the Columns collection by default.</span></span> <span data-ttu-id="356d0-316">由于 DetailsView 字段呈现为行，CommandField 显示为行与 Insert、 编辑和删除 DetailsView 底部的按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-316">Since the DetailsView's fields are rendered as rows, the CommandField appears as a row with Insert, Edit, and Delete buttons at the bottom of the DetailsView.</span></span>


<span data-ttu-id="356d0-317">[![配置为支持编辑、 插入和删除 DetailsView](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image43.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-317">[![Configure the DetailsView to Support Editing, Inserting, and Deleting](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image43.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image42.png)</span></span>

<span data-ttu-id="356d0-318">**图 18**： 配置为支持编辑、 插入和删除 DetailsView ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-318">**Figure 18**: Configure the DetailsView to Support Editing, Inserting, and Deleting ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image44.png))</span></span>


<span data-ttu-id="356d0-319">单击删除按钮与 GridView 一样启动相同的事件序列： 一个回发;跟填充其 ObjectDataSource 的 DetailsView`DeleteParameters`基于`DataKeyNames`值; 并已完成，但调用其 ObjectDataSource`Delete()`方法，它实际上从数据库中删除该产品。</span><span class="sxs-lookup"><span data-stu-id="356d0-319">Clicking on the Delete button starts the same sequence of events as with the GridView: a postback; followed by the DetailsView populating its ObjectDataSource's `DeleteParameters` based on the `DataKeyNames` values; and completed with a call its ObjectDataSource's `Delete()` method, which actually removes the product from the database.</span></span> <span data-ttu-id="356d0-320">在 DetailsView 中编辑也适用相同的 GridView 的方式。</span><span class="sxs-lookup"><span data-stu-id="356d0-320">Editing in the DetailsView also works in a fashion identical to that of the GridView.</span></span>

<span data-ttu-id="356d0-321">用于插入，最终用户会看到新按钮，单击时，呈现 DetailsView 中"插入模式。"</span><span class="sxs-lookup"><span data-stu-id="356d0-321">For inserting, the end user is presented with a New button that, when clicked, renders the DetailsView in "insert mode."</span></span> <span data-ttu-id="356d0-322">使用"插入模式"新建按钮替换为 Insert 和取消按钮和仅这些 BoundFields 其`InsertVisible`属性设置为`true`（默认值） 显示。</span><span class="sxs-lookup"><span data-stu-id="356d0-322">With "insert mode" the New button is replaced by Insert and Cancel buttons and only those BoundFields whose `InsertVisible` property is set to `true` (the default) are displayed.</span></span> <span data-ttu-id="356d0-323">如标识为自动递增字段，这些数据字段`ProductID`，具有其[InsertVisible 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.insertvisible(VS.80).aspx)设置为`false`DetailsView 绑定到数据源通过智能标记时。</span><span class="sxs-lookup"><span data-stu-id="356d0-323">Those data fields identified as auto-increment fields, such as `ProductID`, have their [InsertVisible property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.insertvisible(VS.80).aspx) set to `false` when binding the DetailsView to the data source through the smart tag.</span></span>

<span data-ttu-id="356d0-324">Visual Studio 时将数据源绑定到 DetailsView 通过智能标记，将设置`InsertVisible`属性设置为`false`仅用于自动递增字段。</span><span class="sxs-lookup"><span data-stu-id="356d0-324">When binding a data source to a DetailsView through the smart tag, Visual Studio sets the `InsertVisible` property to `false` only for auto-increment fields.</span></span> <span data-ttu-id="356d0-325">只读字段，如`CategoryName`并`SupplierName`，除非将"插入模式"用户界面中显示其`InsertVisible`属性显式设置为`false`。</span><span class="sxs-lookup"><span data-stu-id="356d0-325">Read-only fields, like `CategoryName` and `SupplierName`, will be displayed in the "insert mode" user interface unless their `InsertVisible` property is explicitly set to `false`.</span></span> <span data-ttu-id="356d0-326">请花费片刻时间设置这两个字段`InsertVisible`属性设置为`false`，通过 DetailsView 的声明性语法或编辑字段中的智能标记的链接。</span><span class="sxs-lookup"><span data-stu-id="356d0-326">Take a moment to set these two fields' `InsertVisible` properties to `false`, either through the DetailsView's declarative syntax or through the Edit Fields link in the smart tag.</span></span> <span data-ttu-id="356d0-327">图 19 显示设置`InsertVisible`属性设置为`false`编辑字段上单击链接。</span><span class="sxs-lookup"><span data-stu-id="356d0-327">Figure 19 shows setting the `InsertVisible` properties to `false` by clicking on the Edit Fields link.</span></span>


<span data-ttu-id="356d0-328">[![Northwind Traders 现在提供 Acme 茶](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image46.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-328">[![Northwind Traders Now Offers Acme Tea](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image46.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image45.png)</span></span>

<span data-ttu-id="356d0-329">**图 19**: Northwind Traders 现在提供了 Acme 茶 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-329">**Figure 19**: Northwind Traders Now Offers Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image47.png))</span></span>


<span data-ttu-id="356d0-330">设置后`InsertVisible`属性，视图`Basics.aspx`页在浏览器中，单击新建按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-330">After setting the `InsertVisible` properties, view the `Basics.aspx` page in a browser and click the New button.</span></span> <span data-ttu-id="356d0-331">图 20 显示了 DetailsView 时添加新的饮料，Acme 茶，到我们的产品线。</span><span class="sxs-lookup"><span data-stu-id="356d0-331">Figure 20 shows the DetailsView when adding a new beverage, Acme Tea, to our product line.</span></span>


<span data-ttu-id="356d0-332">[![Northwind Traders 现在提供 Acme 茶](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image49.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image48.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-332">[![Northwind Traders Now Offers Acme Tea](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image49.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image48.png)</span></span>

<span data-ttu-id="356d0-333">**图 20**: Northwind Traders 现在提供了 Acme 茶 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image50.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-333">**Figure 20**: Northwind Traders Now Offers Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image50.png))</span></span>


<span data-ttu-id="356d0-334">输入为 Acme 茶的详细信息，并单击插入按钮之后，才会回发和新记录添加到`Products`数据库表。</span><span class="sxs-lookup"><span data-stu-id="356d0-334">After entering the details for Acme Tea and clicking the Insert button, a postback ensues and the new record is added to the `Products` database table.</span></span> <span data-ttu-id="356d0-335">由于此 DetailsView 列出的顺序与它们存在于数据库表中的产品，我们必须页上的最后一个产品才能看到新的产品。</span><span class="sxs-lookup"><span data-stu-id="356d0-335">Since this DetailsView lists the products in order with which they exist in the database table, we must page to the last product in order to see the new product.</span></span>


<span data-ttu-id="356d0-336">[![Acme 茶的详细信息](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image52.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-336">[![Details for Acme Tea](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image52.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image51.png)</span></span>

<span data-ttu-id="356d0-337">**图 21**: Acme 茶的详细信息 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image53.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-337">**Figure 21**: Details for Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image53.png))</span></span>


> [!NOTE]
> <span data-ttu-id="356d0-338">DetailsView [CurrentMode 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.currentmode(VS.80).aspx)指示要显示的界面，可以是下列值之一： `Edit`， `Insert`，或`ReadOnly`。</span><span class="sxs-lookup"><span data-stu-id="356d0-338">The DetailsView's [CurrentMode property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.currentmode(VS.80).aspx) indicates the interface being displayed and can be one of the following values: `Edit`, `Insert`, or `ReadOnly`.</span></span> <span data-ttu-id="356d0-339">[DefaultMode 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode(VS.80).aspx)指示的模式 DetailsView 以在编辑后返回到或插入已完成，可用于显示 DetailsView 的永久处于编辑模式或插入模式。</span><span class="sxs-lookup"><span data-stu-id="356d0-339">The [DefaultMode property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode(VS.80).aspx) indicates the mode the DetailsView returns to after an edit or insert has been completed and is useful for displaying a DetailsView that is permanently in edit or insert mode.</span></span>


<span data-ttu-id="356d0-340">指向并单击插入和编辑 DetailsView 功能会受到与 GridView 相同的限制： 用户必须输入现有`CategoryID`和`SupplierID`通过文本框的值; 接口没有任何验证逻辑; 所有不允许进行产品字段`NULL`值或不具有默认值在数据库级别指定的值必须包含在插入界面中，依次类推。</span><span class="sxs-lookup"><span data-stu-id="356d0-340">The point and click inserting and editing capabilities of the DetailsView suffer from the same limitations as the GridView: the user must enter existing `CategoryID` and `SupplierID` values through a textbox; the interface lacks any validation logic; all product fields that do not allow `NULL` values or don't have a default value specified at the database level must be included in the inserting interface, and so on.</span></span>

<span data-ttu-id="356d0-341">技术我们将介绍用于扩展和增强 GridView 的编辑界面在将来的文章可应用于 DetailsView 控件的编辑和插入界面以及。</span><span class="sxs-lookup"><span data-stu-id="356d0-341">The techniques we will examine for extending and enhancing the GridView's editing interface in future articles can be applied to the DetailsView control's editing and inserting interfaces as well.</span></span>

## <a name="using-the-formview-for-a-more-flexible-data-modification-user-interface"></a><span data-ttu-id="356d0-342">使用 FormView 适用于更灵活的数据修改用户界面</span><span class="sxs-lookup"><span data-stu-id="356d0-342">Using the FormView for a More Flexible Data Modification User Interface</span></span>

<span data-ttu-id="356d0-343">FormView 提供内置支持用于插入、 编辑和删除数据，但因为它使用模板而不是字段没有添加 BoundFields 或 CommandField GridView 和 DetailsView 控件用于提供数据的位置修改接口。</span><span class="sxs-lookup"><span data-stu-id="356d0-343">The FormView offers built-in support for inserting, editing, and deleting data, but because it uses templates instead of fields there's no place to add the BoundFields or the CommandField used by the GridView and DetailsView controls to provide the data modification interface.</span></span> <span data-ttu-id="356d0-344">相反，此接口用于收集用户的 Web 控件添加新项时输入或编辑现有新建，以及编辑、 删除、 插入、 更新和取消按钮必须手动添加到适当的模板。</span><span class="sxs-lookup"><span data-stu-id="356d0-344">Instead, this interface the Web controls for collecting user input when adding a new item or editing an existing one along with the New, Edit, Delete, Insert, Update, and Cancel buttons must be added manually to the appropriate templates.</span></span> <span data-ttu-id="356d0-345">幸运的是，Visual Studio 将自动创建所需的接口绑定到通过其智能标记中的下拉列表的数据源的 FormView 时。</span><span class="sxs-lookup"><span data-stu-id="356d0-345">Fortunately, Visual Studio will automatically create the needed interface when binding the FormView to a data source through the drop-down list in its smart tag.</span></span>

<span data-ttu-id="356d0-346">若要说明了这些方法，首先添加到 FormView`Basics.aspx`页上，并从 FormView 的智能标记，请将其绑定到已创建的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="356d0-346">To illustrate these techniques, start by adding a FormView to the `Basics.aspx` page and, from the FormView's smart tag, bind it to the ObjectDataSource already created.</span></span> <span data-ttu-id="356d0-347">这将生成`EditItemTemplate`， `InsertItemTemplate`，和`ItemTemplate`文本框 Web 控件，用于收集新的用户的输入和按钮 Web 控件与 FormView，用于编辑、 删除、 插入、 更新和取消按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-347">This will generate an `EditItemTemplate`, `InsertItemTemplate`, and `ItemTemplate` for the FormView with TextBox Web controls for collecting the user's input and Button Web controls for the New, Edit, Delete, Insert, Update, and Cancel buttons.</span></span> <span data-ttu-id="356d0-348">此外，FormView 的`DataKeyNames`属性设置为主键字段 (`ProductID`) 的对象数据源返回的对象。</span><span class="sxs-lookup"><span data-stu-id="356d0-348">Additionally, the FormView's `DataKeyNames` property is set to the primary key field (`ProductID`) of the object returned by the ObjectDataSource.</span></span> <span data-ttu-id="356d0-349">最后，检查 FormView 的智能标记中的启用分页选项。</span><span class="sxs-lookup"><span data-stu-id="356d0-349">Lastly, check the Enable Paging option in the FormView's smart tag.</span></span>

<span data-ttu-id="356d0-350">以下显示 FormView 的声明性标记`ItemTemplate`FormView 已绑定到 ObjectDataSource 后。</span><span class="sxs-lookup"><span data-stu-id="356d0-350">The following shows the declarative markup for the FormView's `ItemTemplate` after the FormView has been bound to the ObjectDataSource.</span></span> <span data-ttu-id="356d0-351">默认情况下，每个非布尔值产品字段绑定到`Text`标签 Web 控件时的布尔值的每个字段的属性 (`Discontinued`) 绑定到`Checked`已禁用的复选框 Web 控件的属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-351">By default, each non-Boolean value product field is bound to the `Text` property of a Label Web control while each Boolean value field (`Discontinued`) is bound to the `Checked` property of a disabled CheckBox Web control.</span></span> <span data-ttu-id="356d0-352">为了使新建、 编辑和删除按钮，以触发特定的 FormView 行为单击时，它是命令性，其`CommandName`的值设置为`New`， `Edit`，和`Delete`分别。</span><span class="sxs-lookup"><span data-stu-id="356d0-352">In order for the New, Edit, and Delete buttons to trigger certain FormView behavior when clicked, it is imperative that their `CommandName` values be set to `New`, `Edit`, and `Delete`, respectively.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample8.aspx)]

<span data-ttu-id="356d0-353">图 22 显示了 FormView 的`ItemTemplate`时的浏览器查看。</span><span class="sxs-lookup"><span data-stu-id="356d0-353">Figure 22 shows the FormView's `ItemTemplate` when viewed through a browser.</span></span> <span data-ttu-id="356d0-354">在底部的新建、 编辑和删除按钮将列出每个产品字段。</span><span class="sxs-lookup"><span data-stu-id="356d0-354">Each product field is listed with the New, Edit, and Delete buttons at the bottom.</span></span>


<span data-ttu-id="356d0-355">[![情况下 FormView ItemTemplate 列出了每个产品字段以及新增、 编辑和删除按钮](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image55.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image54.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-355">[![The Defaut FormView ItemTemplate Lists Each Product Field Along with New, Edit, and Delete Buttons](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image55.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image54.png)</span></span>

<span data-ttu-id="356d0-356">**图 22**: 情况下 FormView`ItemTemplate`列出了每个产品字段沿使用新建、 编辑和删除按钮 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image56.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-356">**Figure 22**: The Defaut FormView `ItemTemplate` Lists Each Product Field Along with New, Edit, and Delete Buttons ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image56.png))</span></span>


<span data-ttu-id="356d0-357">使用 GridView 和 DetailsView，单击删除按钮或任何按钮、 LinkButton 或 ImageButton 喜欢其`CommandName`属性设置为删除会导致回发，填充 ObjectDataSource 的`DeleteParameters`根据 FormView 的`DataKeyNames`值，并调用 ObjectDataSource 的`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="356d0-357">Like with the GridView and DetailsView, clicking the Delete button or any Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete causes a postback, populates the ObjectDataSource's `DeleteParameters` based on the FormView's `DataKeyNames` value, and invokes the ObjectDataSource's `Delete()` method.</span></span>

<span data-ttu-id="356d0-358">单击编辑按钮时才会进行回发和将数据重新绑定到`EditItemTemplate`，这是负责呈现编辑界面。</span><span class="sxs-lookup"><span data-stu-id="356d0-358">When the Edit button is clicked a postback ensues and the data is rebound to the `EditItemTemplate`, which is responsible for rendering the editing interface.</span></span> <span data-ttu-id="356d0-359">此界面包含 Web 控件，用于编辑数据以及更新和取消按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-359">This interface includes the Web controls for editing data along with the Update and Cancel buttons.</span></span> <span data-ttu-id="356d0-360">默认值`EditItemTemplate`生成的 Visual Studio 包含的任何自动递增字段的标签 (`ProductID`)、 一个的文本框中的每个非布尔值字段，以及每个布尔值字段对应的复选框。</span><span class="sxs-lookup"><span data-stu-id="356d0-360">The default `EditItemTemplate` generated by Visual Studio contains a Label for any auto-increment fields (`ProductID`), a TextBox for each non-Boolean value field, and a CheckBox for each Boolean value field.</span></span> <span data-ttu-id="356d0-361">此行为是非常类似于 GridView 和 DetailsView 控件中的自动生成 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="356d0-361">This behavior is very similar to the auto-generated BoundFields in the GridView and DetailsView controls.</span></span>

> [!NOTE]
> <span data-ttu-id="356d0-362">使用 FormView 的自动生成的一个小问题`EditItemTemplate`是，它将呈现文本框 Web 控件是只读的如这些字段`CategoryName`和`SupplierName`。</span><span class="sxs-lookup"><span data-stu-id="356d0-362">One small issue with the FormView's auto-generation of the `EditItemTemplate` is that it renders TextBox Web controls for those fields that are read-only, such as `CategoryName` and `SupplierName`.</span></span> <span data-ttu-id="356d0-363">我们将了解如何考虑到这一点很快。</span><span class="sxs-lookup"><span data-stu-id="356d0-363">We'll see how to account for this shortly.</span></span>


<span data-ttu-id="356d0-364">TextBox 控件中`EditItemTemplate`具有其`Text`属性绑定到其相应的数据字段使用的值*双向数据绑定*。</span><span class="sxs-lookup"><span data-stu-id="356d0-364">The TextBox controls in the `EditItemTemplate` have their `Text` property bound to the value of their corresponding data field using *two-way databinding*.</span></span> <span data-ttu-id="356d0-365">双向数据绑定，为由`<%# Bind("dataField") %>`，执行这两个数据绑定和填充 ObjectDataSource 的参数插入或编辑记录时将数据绑定到该模板。</span><span class="sxs-lookup"><span data-stu-id="356d0-365">Two-way databinding, denoted by `<%# Bind("dataField") %>`, performs databinding both when binding data to the template and when populating the ObjectDataSource's parameters for inserting or editing records.</span></span> <span data-ttu-id="356d0-366">也就是说，当用户单击编辑按钮从`ItemTemplate`，则`Bind()`方法将返回指定的数据字段值。</span><span class="sxs-lookup"><span data-stu-id="356d0-366">That is, when the user clicks the Edit button from the `ItemTemplate`, the `Bind()` method returns the specified data field value.</span></span> <span data-ttu-id="356d0-367">用户进行相应更改，然后单击更新后，这些值进行了对应的回发到使用指定的数据字段`Bind()`应用于 ObjectDataSource 的`UpdateParameters`。</span><span class="sxs-lookup"><span data-stu-id="356d0-367">After the user makes their changes and clicks Update, the values posted back that correspond to the data fields specified using `Bind()` are applied to the ObjectDataSource's `UpdateParameters`.</span></span> <span data-ttu-id="356d0-368">或者，单向数据绑定，为由`<%# Eval("dataField") %>`，仅当数据绑定到模板中检索数据字段值并*不*上回发到数据源的参数返回用户输入的值。</span><span class="sxs-lookup"><span data-stu-id="356d0-368">Alternatively, one-way databinding, denoted by `<%# Eval("dataField") %>`, only retrieves the data field values when binding data to the template and does *not* return the user-entered values to the data source's parameters on postback.</span></span>

<span data-ttu-id="356d0-369">下面的声明性标记显示 FormView 的`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-369">The following declarative markup shows the FormView's `EditItemTemplate`.</span></span> <span data-ttu-id="356d0-370">请注意，`Bind()`此处的数据绑定语法中使用方法和更新和取消按钮 Web 控件具有其`CommandName`相应地设置的属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-370">Note that the `Bind()` method is used in the databinding syntax here and that the Update and Cancel Button Web controls have their `CommandName` properties set accordingly.</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample9.aspx)]

<span data-ttu-id="356d0-371">我们`EditItemTemplate`，在此点，如果我们尝试使用它，则引发异常。</span><span class="sxs-lookup"><span data-stu-id="356d0-371">Our `EditItemTemplate`, at this point, will cause an exception to be thrown if we attempt to use it.</span></span> <span data-ttu-id="356d0-372">问题在于`CategoryName`并`SupplierName`作为文本框 Web 控件中呈现字段`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-372">The problem is that the `CategoryName` and `SupplierName` fields are rendered as TextBox Web controls in the `EditItemTemplate`.</span></span> <span data-ttu-id="356d0-373">我们需要将这些文本框更改为标签或一起删除它们。</span><span class="sxs-lookup"><span data-stu-id="356d0-373">We either need to change these TextBoxes to Labels or remove them altogether.</span></span> <span data-ttu-id="356d0-374">让我们只需删除它们完全从`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-374">Let's simply delete them entirely from the `EditItemTemplate`.</span></span>

<span data-ttu-id="356d0-375">图 23 在浏览器中显示 FormView 后为 Chai 已单击编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="356d0-375">Figure 23 shows the FormView in a browser after the Edit button has been clicked for Chai.</span></span> <span data-ttu-id="356d0-376">请注意，`SupplierName`并`CategoryName`字段中所示`ItemTemplate`不再存在，因为我们只需删除它们从`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-376">Note that the `SupplierName` and `CategoryName` fields shown in the `ItemTemplate` are no longer present, as we just removed them from the `EditItemTemplate`.</span></span> <span data-ttu-id="356d0-377">单击更新按钮时 FormView 将继续通过 GridView 和 DetailsView 控件相同的步骤序列。</span><span class="sxs-lookup"><span data-stu-id="356d0-377">When the Update button is clicked the FormView proceeds through the same sequence of steps as the GridView and DetailsView controls.</span></span>


<span data-ttu-id="356d0-378">[![默认情况下 EditItemTemplate 显示为文本框或复选框的每个可编辑产品字段](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image58.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image57.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-378">[![By Default the EditItemTemplate Shows Each Editable Product Field as a TextBox or CheckBox](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image58.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image57.png)</span></span>

<span data-ttu-id="356d0-379">**图 23**： 默认情况下`EditItemTemplate`显示了每个可编辑产品字段为文本框或复选框 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image59.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-379">**Figure 23**: By Default the `EditItemTemplate` Shows Each Editable Product Field as a TextBox or CheckBox ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image59.png))</span></span>


<span data-ttu-id="356d0-380">插入按钮单击 FormView 的时`ItemTemplate`回发时，才会。</span><span class="sxs-lookup"><span data-stu-id="356d0-380">When the Insert button is clicked the FormView's `ItemTemplate` a postback ensues.</span></span> <span data-ttu-id="356d0-381">但是，任何数据不绑定到 FormView 因为一条新记录将被添加。</span><span class="sxs-lookup"><span data-stu-id="356d0-381">However, no data is bound to the FormView because a new record is being added.</span></span> <span data-ttu-id="356d0-382">`InsertItemTemplate`接口包括用于添加新记录以及插入和取消按钮的 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="356d0-382">The `InsertItemTemplate` interface includes the Web controls for adding a new record along with the Insert and Cancel buttons.</span></span> <span data-ttu-id="356d0-383">默认值`InsertItemTemplate`生成的 Visual Studio 包含一个文本框的每个非布尔值字段和每个布尔值字段，类似于自动生成一个复选框`EditItemTemplate`的接口。</span><span class="sxs-lookup"><span data-stu-id="356d0-383">The default `InsertItemTemplate` generated by Visual Studio contains a TextBox for each non-Boolean value field and a CheckBox for each Boolean value field, similar to the auto-generated `EditItemTemplate`'s interface.</span></span> <span data-ttu-id="356d0-384">将文本框控件具有其`Text`属性绑定到使用双向数据绑定其对应数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="356d0-384">The TextBox controls have their `Text` property bound to the value of their corresponding data field using two-way databinding.</span></span>

<span data-ttu-id="356d0-385">下面的声明性标记显示 FormView 的`InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-385">The following declarative markup shows the FormView's `InsertItemTemplate`.</span></span> <span data-ttu-id="356d0-386">请注意，`Bind()`此处的数据绑定语法中使用方法和插入和取消按钮 Web 控件具有其`CommandName`相应地设置的属性。</span><span class="sxs-lookup"><span data-stu-id="356d0-386">Note that the `Bind()` method is used in the databinding syntax here and that the Insert and Cancel Button Web controls have their `CommandName` properties set accordingly.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-cs/samples/sample10.aspx)]

<span data-ttu-id="356d0-387">没有使用 FormView 的自动生成的微妙的地方`InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-387">There's a subtlety with the FormView's auto-generation of the `InsertItemTemplate`.</span></span> <span data-ttu-id="356d0-388">具体而言，甚至为是只读的如这些字段创建文本框 Web 控件`CategoryName`和`SupplierName`。</span><span class="sxs-lookup"><span data-stu-id="356d0-388">Specifically, the TextBox Web controls are created even for those fields that are read-only, such as `CategoryName` and `SupplierName`.</span></span> <span data-ttu-id="356d0-389">与处理方式一样`EditItemTemplate`，我们需要删除从这些文本框`InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="356d0-389">Like with the `EditItemTemplate`, we need to remove these TextBoxes from the `InsertItemTemplate`.</span></span>

<span data-ttu-id="356d0-390">图 24 显示 FormView 的浏览器中，添加一个新的产品 Acme 咖啡时。</span><span class="sxs-lookup"><span data-stu-id="356d0-390">Figure 24 shows the FormView in a browser when adding a new product, Acme Coffee.</span></span> <span data-ttu-id="356d0-391">请注意，`SupplierName`并`CategoryName`字段中所示`ItemTemplate`不再存在，因为我们只需删除它们。</span><span class="sxs-lookup"><span data-stu-id="356d0-391">Note that the `SupplierName` and `CategoryName` fields shown in the `ItemTemplate` are no longer present, as we just removed them.</span></span> <span data-ttu-id="356d0-392">单击插入按钮时，FormView 可继续通过 DetailsView 控件相同的步骤序列，添加新记录到`Products`表。</span><span class="sxs-lookup"><span data-stu-id="356d0-392">When the Insert button is clicked the FormView proceeds through the same sequence of steps as the DetailsView control, adding a new record to the `Products` table.</span></span> <span data-ttu-id="356d0-393">图 25 中 FormView 显示 Acme 咖啡产品的详细信息后已插入。</span><span class="sxs-lookup"><span data-stu-id="356d0-393">Figure 25 shows Acme Coffee product's details in the FormView after it has been inserted.</span></span>


<span data-ttu-id="356d0-394">[![InsertItemTemplate 决定了 FormView 的插入接口](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image61.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image60.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-394">[![The InsertItemTemplate Dictates the FormView's Inserting Interface](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image61.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image60.png)</span></span>

<span data-ttu-id="356d0-395">**图 24**:`InsertItemTemplate`决定了 FormView 的插入接口 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image62.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-395">**Figure 24**: The `InsertItemTemplate` Dictates the FormView's Inserting Interface ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image62.png))</span></span>


<span data-ttu-id="356d0-396">[![在 FormView 中显示的新产品，Acme 咖啡，详细信息](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image64.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image63.png)</span><span class="sxs-lookup"><span data-stu-id="356d0-396">[![The Details for New Product, Acme Coffee, are Displayed in the FormView](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image64.png)](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image63.png)</span></span>

<span data-ttu-id="356d0-397">**图 25**： 在 FormView 中显示的新产品，Acme 咖啡的详细信息 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image65.png))</span><span class="sxs-lookup"><span data-stu-id="356d0-397">**Figure 25**: The Details for New Product, Acme Coffee, are Displayed in the FormView ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-cs/_static/image65.png))</span></span>


<span data-ttu-id="356d0-398">分离只读的通过编辑，并将接口插入三个单独的模板，FormView 允许比 DetailsView 和 GridView 更精细地控制这些接口。</span><span class="sxs-lookup"><span data-stu-id="356d0-398">By separating out the read-only, editing, and inserting interfaces into three separate templates, the FormView allows for a finer degree of control over these interfaces than the DetailsView and GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="356d0-399">DetailsView，FormView 的喜欢`CurrentMode`属性指示要显示的界面并将其`DefaultMode`属性指示的模式 FormView 返回到编辑后或插入已完成。</span><span class="sxs-lookup"><span data-stu-id="356d0-399">Like the DetailsView, the FormView's `CurrentMode` property indicates the interface being displayed and its `DefaultMode` property indicates the mode the FormView returns to after an edit or insert has been completed.</span></span>


## <a name="summary"></a><span data-ttu-id="356d0-400">总结</span><span class="sxs-lookup"><span data-stu-id="356d0-400">Summary</span></span>

<span data-ttu-id="356d0-401">在本教程中，我们探讨插入、 编辑和删除数据使用 GridView、 DetailsView 和 FormView 基础的知识。</span><span class="sxs-lookup"><span data-stu-id="356d0-401">In this tutorial we examined the basics of inserting, editing, and deleting data using the GridView, DetailsView, and FormView.</span></span> <span data-ttu-id="356d0-402">所有这三个这些控件提供一定级别的可利用而无需编写一行代码，借助数据 Web 控件和 ObjectDataSource ASP.NET 页中的内置数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="356d0-402">All three of these controls provide some level of built-in data modification capabilities that can be utilized without writing a single line of code in the ASP.NET page thanks to the data Web controls and the ObjectDataSource.</span></span> <span data-ttu-id="356d0-403">但是，简单的指向和单击技术呈现相当 frail 和简单的数据修改用户界面。</span><span class="sxs-lookup"><span data-stu-id="356d0-403">However, the simple point and click techniques render a fairly frail and naïve data modification user interface.</span></span> <span data-ttu-id="356d0-404">提供验证，注入的编程值、 适当地处理异常、 自定义用户界面和依此类推，我们将需要依赖于一系列的下一步的多个教程通过将讨论的技术。</span><span class="sxs-lookup"><span data-stu-id="356d0-404">To provide validation, inject programmatic values, gracefully handle exceptions, customize the user interface, and so on, we'll need to rely on a bevy of techniques that will be discussed over the next several tutorials.</span></span>

<span data-ttu-id="356d0-405">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="356d0-405">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="356d0-406">关于作者</span><span class="sxs-lookup"><span data-stu-id="356d0-406">About the Author</span></span>

<span data-ttu-id="356d0-407">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="356d0-407">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="356d0-408">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="356d0-408">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="356d0-409">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="356d0-409">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="356d0-410">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="356d0-410">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="356d0-411">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="356d0-411">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="356d0-412">下一篇</span><span class="sxs-lookup"><span data-stu-id="356d0-412">Next</span></span>](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
