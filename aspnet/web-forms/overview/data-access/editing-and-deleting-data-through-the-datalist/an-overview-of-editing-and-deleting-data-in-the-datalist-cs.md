---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs
title: 编辑和删除 DataList (C#) 中的数据的概述 |Microsoft Docs
author: rick-anderson
description: DataList 缺少内置编辑和删除功能，而在本教程中我们将了解如何创建支持编辑和删除 o DataList...
ms.author: aspnetcontent
ms.date: 10/30/2006
ms.assetid: c3b0c86e-fe98-41ee-b26f-ca38cddaa75e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: a9be3e332ec19f78c4dcc2e78d3dd4609c27fddf
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/05/2018
ms.locfileid: "37810480"
---
<a name="an-overview-of-editing-and-deleting-data-in-the-datalist-c"></a><span data-ttu-id="38f84-103">编辑和删除 DataList (C#) 中的数据的概述</span><span class="sxs-lookup"><span data-stu-id="38f84-103">An Overview of Editing and Deleting Data in the DataList (C#)</span></span>
====================
<span data-ttu-id="38f84-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="38f84-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="38f84-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_CS.exe)或[下载 PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/datatutorial36cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="38f84-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_CS.exe) or [Download PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/datatutorial36cs1.pdf)</span></span>

> <span data-ttu-id="38f84-106">DataList 缺少内置编辑和删除功能，而在本教程将介绍如何创建支持编辑和删除其基础数据的 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-106">While the DataList lacks built-in editing and deleting capabilities, in this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span>


## <a name="introduction"></a><span data-ttu-id="38f84-107">介绍</span><span class="sxs-lookup"><span data-stu-id="38f84-107">Introduction</span></span>

<span data-ttu-id="38f84-108">在中[概述的插入、 更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程中我们介绍了如何插入、 更新和删除数据使用的应用程序体系结构、 ObjectDataSource 和 GridView、 DetailsView 和 FormView控件。</span><span class="sxs-lookup"><span data-stu-id="38f84-108">In the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial we looked at how to insert, update, and delete data using the application architecture, an ObjectDataSource, and the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="38f84-109">使用 ObjectDataSource 和以下三个数据 Web 控件，实现简单的数据修改接口是管理单元和涉及只勾选复选框从智能标记。</span><span class="sxs-lookup"><span data-stu-id="38f84-109">With the ObjectDataSource and these three data Web controls, implementing simple data modification interfaces was a snap and involved merely ticking a checkbox from a smart tag.</span></span> <span data-ttu-id="38f84-110">所需编写任何代码。</span><span class="sxs-lookup"><span data-stu-id="38f84-110">No code needed to be written.</span></span>

<span data-ttu-id="38f84-111">遗憾的是，DataList 缺少内置编辑和删除在 GridView 控件中的固有功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-111">Unfortunately, the DataList lacks the built-in editing and deleting capabilities inherent in the GridView control.</span></span> <span data-ttu-id="38f84-112">此缺少的功能是部分由于 DataList 是从以前版本的 ASP.NET，relic 时，声明性数据源控件和无代码数据修改的页都不可用。</span><span class="sxs-lookup"><span data-stu-id="38f84-112">This missing functionality is due in part to the fact that the DataList is a relic from the previous version of ASP.NET, when declarative data source controls and code-free data modification pages were unavailable.</span></span> <span data-ttu-id="38f84-113">虽然 DataList ASP.NET 2.0 中的不提供现成的相同数据修改功能作为 GridView，我们可以使用 ASP.NET 1.x 技术以包含此类功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-113">While the DataList in ASP.NET 2.0 does not offer the same out of the box data modification capabilities as the GridView, we can use ASP.NET 1.x techniques to include such functionality.</span></span> <span data-ttu-id="38f84-114">这种方法需要一小段代码，但 DataList 到位，以帮助在此过程中我们将看到在本教程中，有一些事件和属性。</span><span class="sxs-lookup"><span data-stu-id="38f84-114">This approach requires a bit of code but, as we'll see in this tutorial, the DataList has some events and properties in place to aid in this process.</span></span>

<span data-ttu-id="38f84-115">在本教程中我们将了解如何创建支持编辑和删除其基础数据的 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-115">In this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span> <span data-ttu-id="38f84-116">将来的教程将介绍更高级的编辑和删除方案 （包括输入的字段验证），适当地处理从数据访问或业务逻辑层等引发的异常。</span><span class="sxs-lookup"><span data-stu-id="38f84-116">Future tutorials will examine more advanced editing and deleting scenarios, including input field validation, gracefully handling exceptions raised from the Data Access or Business Logic Layers, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="38f84-117">如 DataList 和 Repeater 控件缺少用于插入、 更新或删除功能的扩展。</span><span class="sxs-lookup"><span data-stu-id="38f84-117">Like the DataList, the Repeater control lacks the out of the box functionality for inserting, updating, or deleting.</span></span> <span data-ttu-id="38f84-118">虽然可以添加此类功能，但是 DataList 包括属性和事件中继器中找不到，简化添加此类功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-118">While such functionality can be added, the DataList includes properties and events not found in the Repeater that simplify adding such capabilities.</span></span> <span data-ttu-id="38f84-119">因此，本教程，并看看编辑和删除的未来的重点严格 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-119">Therefore, this tutorial and future ones that look at editing and deleting will focus strictly on the DataList.</span></span>


## <a name="step-1-creating-the-editing-and-deleting-tutorials-web-pages"></a><span data-ttu-id="38f84-120">步骤 1： 创建编辑和删除教程网页</span><span class="sxs-lookup"><span data-stu-id="38f84-120">Step 1: Creating the Editing and Deleting Tutorials Web Pages</span></span>

<span data-ttu-id="38f84-121">我们开始探索如何更新和删除 DataList 中的数据之前，让 s 先花点时间在我们的网站项目，我们需要为本教程下, 一步的几个源表创建的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="38f84-121">Before we start exploring how to update and delete data from a DataList, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="38f84-122">首先，通过添加一个名为的新文件夹`EditDeleteDataList`。</span><span class="sxs-lookup"><span data-stu-id="38f84-122">Start by adding a new folder named `EditDeleteDataList`.</span></span> <span data-ttu-id="38f84-123">接下来，将以下 ASP.NET 页面添加到该文件夹，并确保将与每个页面相关联`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="38f84-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `BatchUpdate.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`


![为了使教程添加 ASP.NET 页面](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image1.png)

<span data-ttu-id="38f84-125">**图 1**： 为了使教程添加 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="38f84-125">**Figure 1**: Add the ASP.NET Pages for the Tutorials</span></span>


<span data-ttu-id="38f84-126">在其他文件夹中，喜欢`Default.aspx`在`EditDeleteDataList`文件夹在其部分中列出的教程。</span><span class="sxs-lookup"><span data-stu-id="38f84-126">Like in the other folders, `Default.aspx` in the `EditDeleteDataList` folder lists the tutorials in its section.</span></span> <span data-ttu-id="38f84-127">请记住，`SectionLevelTutorialListing.ascx`用户控件提供了此功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="38f84-128">因此，此用户控件添加到`Default.aspx`通过从解决方案资源管理器中拖到页面上的设计视图中拖动。</span><span class="sxs-lookup"><span data-stu-id="38f84-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


<span data-ttu-id="38f84-129">[![将 SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image2.png)</span></span>

<span data-ttu-id="38f84-130">**图 2**： 添加`SectionLevelTutorialListing.ascx`到用户控件`Default.aspx`([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image4.png))</span></span>


<span data-ttu-id="38f84-131">最后，将页面添加到条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="38f84-131">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="38f84-132">具体而言，在母版/详细信息报表后添加以下标记，使用 DataList 和 Repeater `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="38f84-132">Specifically, add the following markup after the Master/Detail Reports with the DataList and Repeater `<siteMapNode>`:</span></span>


[!code-xml[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample1.xml)]

<span data-ttu-id="38f84-133">更新后`Web.sitemap`，花点时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="38f84-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="38f84-134">现在，在左侧菜单的 DataList 编辑和删除教程包括项。</span><span class="sxs-lookup"><span data-stu-id="38f84-134">The menu on the left now includes items for the DataList editing and deleting tutorials.</span></span>


![站点图现在包括项的 DataList 编辑和删除教程](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image5.png)

<span data-ttu-id="38f84-136">**图 3**： 站点图现在包括项的 DataList 编辑和删除教程</span><span class="sxs-lookup"><span data-stu-id="38f84-136">**Figure 3**: The Site Map Now Includes Entries for the DataList Editing and Deleting Tutorials</span></span>


## <a name="step-2-examining-techniques-for-updating-and-deleting-data"></a><span data-ttu-id="38f84-137">步骤 2： 正在检查技术中的更新和删除数据</span><span class="sxs-lookup"><span data-stu-id="38f84-137">Step 2: Examining Techniques for Updating and Deleting Data</span></span>

<span data-ttu-id="38f84-138">编辑和删除使用 GridView 数据是非常简单，因为实际上，GridView 和 ObjectDataSource 协同工作。</span><span class="sxs-lookup"><span data-stu-id="38f84-138">Editing and deleting data with the GridView is so easy because, underneath the covers, the GridView and ObjectDataSource work in concert.</span></span> <span data-ttu-id="38f84-139">如中所述[检查与插入、 更新和删除的事件相关联](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)教程中，单击行的更新按钮时，GridView 自动分配使用双向数据绑定到其字段`UpdateParameters`其对象数据源的集合，然后调用该 ObjectDataSource 的`Update()`方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-139">As discussed in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, when a row s Update button is clicked, the GridView automatically assigns its fields that used two-way databinding to the `UpdateParameters` collection of its ObjectDataSource and then invokes that ObjectDataSource s `Update()` method.</span></span>

<span data-ttu-id="38f84-140">遗憾的是，DataList 不提供任何此内置功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-140">Sadly, the DataList does not provide any of this built-in functionality.</span></span> <span data-ttu-id="38f84-141">我们有责任确保用户 s 的赋值为 ObjectDataSource 的参数，并且其`Update()`调用方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-141">It is our responsibility to ensure that the user s values are assigned to the ObjectDataSource s parameters and that its `Update()` method is called.</span></span> <span data-ttu-id="38f84-142">为了实现我们这个目标，DataList 提供了以下属性和事件：</span><span class="sxs-lookup"><span data-stu-id="38f84-142">To aid us in this endeavor, the DataList provides the following properties and events:</span></span>

- <span data-ttu-id="38f84-143">**[ `DataKeyField`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** 更新或删除时，我们需要能够唯一地标识 DataList 中的每个项。</span><span class="sxs-lookup"><span data-stu-id="38f84-143">**The [`DataKeyField` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** when updating or deleting, we need to be able to uniquely identify each item in the DataList.</span></span> <span data-ttu-id="38f84-144">将此属性设置为显示的数据的主键字段。</span><span class="sxs-lookup"><span data-stu-id="38f84-144">Set this property to the primary key field of the displayed data.</span></span> <span data-ttu-id="38f84-145">执行此操作将填充 DataList s [ `DataKeys`集合](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx)具有指定`DataKeyField`DataList 中的每个项的值。</span><span class="sxs-lookup"><span data-stu-id="38f84-145">Doing so will populate the DataList s [`DataKeys` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) with the specified `DataKeyField` value for each DataList item.</span></span>
- <span data-ttu-id="38f84-146">**[ `EditCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** 触发或按钮时，LinkButton、 ImageButton 其`CommandName`属性设置为单击编辑。</span><span class="sxs-lookup"><span data-stu-id="38f84-146">**The [`EditCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Edit is clicked.</span></span>
- <span data-ttu-id="38f84-147">**[ `CancelCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** 触发或按钮时，LinkButton、 ImageButton 其`CommandName`属性设置为在单击取消。</span><span class="sxs-lookup"><span data-stu-id="38f84-147">**The [`CancelCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Cancel is clicked.</span></span>
- <span data-ttu-id="38f84-148">**[ `UpdateCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** 触发或按钮时，LinkButton、 ImageButton 其`CommandName`属性设置为在单击更新。</span><span class="sxs-lookup"><span data-stu-id="38f84-148">**The [`UpdateCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Update is clicked.</span></span>
- <span data-ttu-id="38f84-149">**[ `DeleteCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** 触发或按钮时，LinkButton、 ImageButton 其`CommandName`属性设置为单击删除。</span><span class="sxs-lookup"><span data-stu-id="38f84-149">**The [`DeleteCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete is clicked.</span></span>

<span data-ttu-id="38f84-150">使用这些属性和事件，有四种方法可用于更新和删除 DataList 中的数据：</span><span class="sxs-lookup"><span data-stu-id="38f84-150">Using these properties and events, there are four approaches we can use to update and delete data from the DataList:</span></span>

1. <span data-ttu-id="38f84-151">**使用 ASP.NET 1.x 技术**DataList ASP.NET 2.0 和 Objectdatasource 之前存在并已能够更新和删除数据完全通过编程方式。</span><span class="sxs-lookup"><span data-stu-id="38f84-151">**Using ASP.NET 1.x Techniques** the DataList existed prior to ASP.NET 2.0 and ObjectDataSources and was able to update and delete data entirely through programmatic means.</span></span> <span data-ttu-id="38f84-152">此方法完全 ditches ObjectDataSource 和要求，我们将数据绑定到 DataList 直接从业务逻辑层，同时在检索数据时要显示和更新或删除一条记录时。</span><span class="sxs-lookup"><span data-stu-id="38f84-152">This technique ditches the ObjectDataSource altogether and requires that we bind the data to the DataList directly from the Business Logic Layer, both in retrieving the data to display and when updating or deleting a record.</span></span>
2. <span data-ttu-id="38f84-153">**用于选择、 更新和删除的页上的单个 ObjectDataSource 控件**DataList 缺少 GridView s 固有编辑和删除功能，而有 s 我们可以 t 没有理由将它们添加我们自己。</span><span class="sxs-lookup"><span data-stu-id="38f84-153">**Using a Single ObjectDataSource Control on the Page for Selecting, Updating, and Deleting** while the DataList lacks the GridView s inherent editing and deleting capabilities, there s no reason we can t add them in ourselves.</span></span> <span data-ttu-id="38f84-154">使用此方法时，我们使用 ObjectDataSource 就像在 GridView 示例中，但必须为 DataList s 创建事件处理程序`UpdateCommand`事件中： 我们在其中设置 ObjectDataSource 的参数和调用其`Update()`方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-154">With this approach, we use an ObjectDataSource just like in the GridView examples, but must create an event handler for the DataList s `UpdateCommand` event where we set the ObjectDataSource s parameters and call its `Update()` method.</span></span>
3. <span data-ttu-id="38f84-155">**使用 ObjectDataSource 控件进行选择，但更新和删除直接针对 BLL**使用选项 2 时，我们需要编写几行代码中`UpdateCommand`事件，将分配参数值，等等。</span><span class="sxs-lookup"><span data-stu-id="38f84-155">**Using an ObjectDataSource Control for Selecting, but Updating and Deleting Directly Against the BLL** when using option 2, we need to write a bit of code in the `UpdateCommand` event, assigning parameter values and so on.</span></span> <span data-ttu-id="38f84-156">相反，我们可以坚持使用 ObjectDataSource 用于选择，但请直接对 BLL （例如，使用选项 1） 的更新和删除调用。</span><span class="sxs-lookup"><span data-stu-id="38f84-156">Instead, we can stick with using the ObjectDataSource for selecting, but make the updating and deleting calls directly against the BLL (like with option 1).</span></span> <span data-ttu-id="38f84-157">在我看来，更新直接与 BLL 交互的数据会导致更具可读性的代码比分配的 ObjectDataSource s`UpdateParameters`并调用其`Update()`方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-157">In my opinion, updating data by interfacing directly with the BLL leads to more readable code than assigning the ObjectDataSource s `UpdateParameters` and calling its `Update()` method.</span></span>
4. <span data-ttu-id="38f84-158">**使用通过多个 Objectdatasource 的声明性方式**以前所有的三种方法需要一小段代码。</span><span class="sxs-lookup"><span data-stu-id="38f84-158">**Using Declarative Means through Multiple ObjectDataSources** the previous three approaches all require a bit of code.</span></span> <span data-ttu-id="38f84-159">如果你 d 而继续使用作为尽可能多的声明性语法，最后一个选项是包含在页上的多个 Objectdatasource。</span><span class="sxs-lookup"><span data-stu-id="38f84-159">If you d rather keep using as much declarative syntax as possible, a final option is to include multiple ObjectDataSources on the page.</span></span> <span data-ttu-id="38f84-160">第一个对象数据源从 BLL 中检索数据，并将其绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-160">The first ObjectDataSource retrieves the data from the BLL and binds it to the DataList.</span></span> <span data-ttu-id="38f84-161">进行更新，添加，但直接在 DataList s 中添加另一个 ObjectDataSource `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-161">For updating, another ObjectDataSource is added, but added directly within the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="38f84-162">若要包含删除的支持，尚未另一个对象数据源，需要在`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-162">To include deleting support, yet another ObjectDataSource would be needed in the `ItemTemplate`.</span></span> <span data-ttu-id="38f84-163">使用此方法时，这些嵌入使用 ObjectDataSource`ControlParameters`若要以声明方式将 ObjectDataSource 的参数绑定到用户输入控件 (而不是无需 DataList s 中以编程方式指定`UpdateCommand`事件处理程序)。</span><span class="sxs-lookup"><span data-stu-id="38f84-163">With this approach, these embedded ObjectDataSource s use `ControlParameters` to declaratively bind the ObjectDataSource s parameters to the user input controls (rather than having to specify them programmatically in the DataList s `UpdateCommand` event handler).</span></span> <span data-ttu-id="38f84-164">这种方法仍需要一小段代码需要调用嵌入的 ObjectDataSource s`Update()`或`Delete()`命令，但需要远小于使用其他的三种方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-164">This approach still requires a bit of code we need to call the embedded ObjectDataSource s `Update()` or `Delete()` command but requires far less than with the other three approaches.</span></span> <span data-ttu-id="38f84-165">此处的缺点是，多个 Objectdatasource 做得很散乱页上，使整体可读性。</span><span class="sxs-lookup"><span data-stu-id="38f84-165">The downside here is that the multiple ObjectDataSources do clutter up the page, detracting from the overall readability.</span></span>

<span data-ttu-id="38f84-166">如果强制只使用其中一种方法，我选择选项 1，因为它提供了最大的灵活性，因为 DataList 最初设计用于满足这种模式。</span><span class="sxs-lookup"><span data-stu-id="38f84-166">If forced to only ever use one of these approaches, I d choose option 1 because it provides the most flexibility and because the DataList was originally designed to accommodate this pattern.</span></span> <span data-ttu-id="38f84-167">DataList 已扩展，可以使用 ASP.NET 2.0 数据源控件，但它没有的所有可扩展性点或官方 ASP.NET 2.0 数据 Web 控件 （GridView、 DetailsView 和 FormView） 的功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-167">While the DataList was extended to work with the ASP.NET 2.0 data source controls, it does not have all of the extensibility points or features of the official ASP.NET 2.0 data Web controls (the GridView, DetailsView, and FormView).</span></span> <span data-ttu-id="38f84-168">选项 2 至 4 并非不值得，不过。</span><span class="sxs-lookup"><span data-stu-id="38f84-168">Options 2 through 4 are not without merit, though.</span></span>

<span data-ttu-id="38f84-169">此软件和将来编辑和删除教程将使用 ObjectDataSource 用于检索数据来显示，并将对 BLL 更新和删除数据 （选项 3） 的调用。</span><span class="sxs-lookup"><span data-stu-id="38f84-169">This and the future editing and deleting tutorials will use an ObjectDataSource for retrieving the data to display and direct calls to the BLL to update and delete data (option 3).</span></span>

## <a name="step-3-adding-the-datalist-and-configuring-its-objectdatasource"></a><span data-ttu-id="38f84-170">步骤 3： 添加 DataList 并配置其对象数据源</span><span class="sxs-lookup"><span data-stu-id="38f84-170">Step 3: Adding the DataList and Configuring its ObjectDataSource</span></span>

<span data-ttu-id="38f84-171">在本教程中我们将创建 DataList，列出产品信息，并为每个产品，提供用户功能编辑名称和价格以及若要完全删除的产品。</span><span class="sxs-lookup"><span data-stu-id="38f84-171">In this tutorial we will create a DataList that lists product information and, for each product, provides the user the ability to edit the name and price and to delete the product altogether.</span></span> <span data-ttu-id="38f84-172">具体而言，我们将检索的记录，以显示使用 ObjectDataSource，但执行更新和删除操作通过直接与 BLL 交互。</span><span class="sxs-lookup"><span data-stu-id="38f84-172">In particular, we will retrieve the records to display using an ObjectDataSource, but perform the update and delete actions by interfacing directly with the BLL.</span></span> <span data-ttu-id="38f84-173">我们担心实现 DataList 的编辑和删除功能之前，让 s 首先获取页后，可以在只读的界面中显示的产品。</span><span class="sxs-lookup"><span data-stu-id="38f84-173">Before we worry about implementing the editing and deleting capabilities to the DataList, let s first get the page to display the products in a read-only interface.</span></span> <span data-ttu-id="38f84-174">因为我们已将检查这些步骤在上一教程中，我将继续执行它们快速。</span><span class="sxs-lookup"><span data-stu-id="38f84-174">Since we ve examined these steps in previous tutorials, I'll proceed through them quickly.</span></span>

<span data-ttu-id="38f84-175">首先打开`Basics.aspx`页中`EditDeleteDataList`文件夹和设计视图中，从向页面添加 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-175">Start by opening the `Basics.aspx` page in the `EditDeleteDataList` folder and, from the Design view, add a DataList to the page.</span></span> <span data-ttu-id="38f84-176">接下来，从 DataList s 智能标记，创建新对象数据源。</span><span class="sxs-lookup"><span data-stu-id="38f84-176">Next, from the DataList s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="38f84-177">由于我们正在与产品数据，将其配置为使用`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="38f84-177">Since we are working with product data, configure it to use the `ProductsBLL` class.</span></span> <span data-ttu-id="38f84-178">若要检索*所有*产品，选择`GetProducts()`选择选项卡中的方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-178">To retrieve *all* products, choose the `GetProducts()` method in the SELECT tab.</span></span>


<span data-ttu-id="38f84-179">[![配置对象数据源以使用 ProductsBLL 类](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-179">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image6.png)</span></span>

<span data-ttu-id="38f84-180">**图 4**： 配置为使用 ObjectDataSource`ProductsBLL`类 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-180">**Figure 4**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image8.png))</span></span>


<span data-ttu-id="38f84-181">[![返回使用 GetProducts() 方法的产品信息](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-181">[![Return the Product Information Using the GetProducts() Method](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image9.png)</span></span>

<span data-ttu-id="38f84-182">**图 5**： 返回产品的信息使用`GetProducts()`方法 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-182">**Figure 5**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image11.png))</span></span>


<span data-ttu-id="38f84-183">DataList，如 GridView，不用于插入新数据;因此，请选择 (None) 选项从插入选项卡中的下拉列表。此外选择 （无） 为 UPDATE 和 DELETE 选项卡由于将通过 BLL 以编程方式执行更新和删除操作。</span><span class="sxs-lookup"><span data-stu-id="38f84-183">The DataList, like the GridView, is not designed for inserting new data; therefore, select the (None) option from the drop-down list in the INSERT tab. Also choose (None) for the UPDATE and DELETE tabs since the updates and deletes will be performed programmatically through the BLL.</span></span>


<span data-ttu-id="38f84-184">[![确认下拉列表中的 ObjectDataSource s 插入、 更新和删除选项卡设置为 （无）](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-184">[![Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image12.png)</span></span>

<span data-ttu-id="38f84-185">**图 6**： 确认 ObjectDataSource 的插入、 更新和删除选项卡中的下拉列表列出了已设置为 （无） ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-185">**Figure 6**: Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None) ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image14.png))</span></span>


<span data-ttu-id="38f84-186">在配置 ObjectDataSource 之后, 单击完成，返回到设计器。</span><span class="sxs-lookup"><span data-stu-id="38f84-186">After configuring the ObjectDataSource, click Finish, returning to the Designer.</span></span> <span data-ttu-id="38f84-187">正如我们已自动完成对象数据源配置，Visual Studio 时看到在过去示例中，创建`ItemTemplate`的下拉列表中，显示每个数据字段。</span><span class="sxs-lookup"><span data-stu-id="38f84-187">As we ve seen in past examples, when completing the ObjectDataSource configuration, Visual Studio automatically creates an `ItemTemplate` for the DropDownList, displaying each of the data fields.</span></span> <span data-ttu-id="38f84-188">将此替换`ItemTemplate`与一个显示产品的名称和价格。</span><span class="sxs-lookup"><span data-stu-id="38f84-188">Replace this `ItemTemplate` with one that displays only the product s name and price.</span></span> <span data-ttu-id="38f84-189">此外，还要设置`RepeatColumns`属性设置为 2。</span><span class="sxs-lookup"><span data-stu-id="38f84-189">Also, set the `RepeatColumns` property to 2.</span></span>

> [!NOTE]
> <span data-ttu-id="38f84-190">如中所述*概述的插入、 更新和删除数据*教程中，修改数据使用我们的体系结构要求，我们删除的 ObjectDataSource 时`OldValuesParameterFormatString`从 ObjectDataSource 的属性声明性标记 (或其重置为其默认值， `{0}`)。</span><span class="sxs-lookup"><span data-stu-id="38f84-190">As discussed in the *Overview of Inserting, Updating, and Deleting Data* tutorial, when modifying data using the ObjectDataSource our architecture requires that we remove the `OldValuesParameterFormatString` property from the ObjectDataSource s declarative markup (or reset it to its default value, `{0}`).</span></span> <span data-ttu-id="38f84-191">在本教程中，但是，我们将使用 ObjectDataSource 仅用于检索数据。</span><span class="sxs-lookup"><span data-stu-id="38f84-191">In this tutorial, however, we are using the ObjectDataSource only for retrieving data.</span></span> <span data-ttu-id="38f84-192">因此，我们不需要修改 ObjectDataSource 的`OldValuesParameterFormatString`属性值 (尽管它不会损害，若要执行此操作)。</span><span class="sxs-lookup"><span data-stu-id="38f84-192">Therefore, we do not need to modify the ObjectDataSource s `OldValuesParameterFormatString` property value (although it doesn t hurt to do so).</span></span>


<span data-ttu-id="38f84-193">替换默认 DataList 后`ItemTemplate`用自定义页面上的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="38f84-193">After replacing the default DataList `ItemTemplate` with a customized one, the declarative markup on your page should look similar to the following:</span></span>


[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample2.aspx)]

<span data-ttu-id="38f84-194">花点时间查看我们通过浏览器的进度。</span><span class="sxs-lookup"><span data-stu-id="38f84-194">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="38f84-195">如图 7 所示，DataList 两列中显示每个产品的产品名称和单位价格。</span><span class="sxs-lookup"><span data-stu-id="38f84-195">As Figure 7 shows, the DataList displays the product name and unit price for each product in two columns.</span></span>


<span data-ttu-id="38f84-196">[![在两个列 DataList 中显示的产品名称和价格](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-196">[![The Products Names and Prices are Displayed in a Two-Column DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image15.png)</span></span>

<span data-ttu-id="38f84-197">**图 7**： 在两个列 DataList 显示产品名称和价格 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-197">**Figure 7**: The Products Names and Prices are Displayed in a Two-Column DataList ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image17.png))</span></span>


> [!NOTE]
> <span data-ttu-id="38f84-198">DataList 具有多个属性所需的更新和删除过程中，并且这些值存储在视图状态。</span><span class="sxs-lookup"><span data-stu-id="38f84-198">The DataList has a number of properties that are required for the updating and deleting process, and these values are stored in view state.</span></span> <span data-ttu-id="38f84-199">因此，如果构建 DataList 支持编辑或删除数据，很重要，启用 DataList 的视图状态。</span><span class="sxs-lookup"><span data-stu-id="38f84-199">Therefore, when building a DataList that supports editing or deleting data, it is essential that the DataList s view state be enabled.</span></span>  
>   
>  <span data-ttu-id="38f84-200">敏锐的读者可能还记得我们能够创建可编辑的 Gridview、 DetailsViews 和 FormViews 时禁用视图状态。</span><span class="sxs-lookup"><span data-stu-id="38f84-200">The astute reader may recall that we were able to disable view state when creating editable GridViews, DetailsViews, and FormViews.</span></span> <span data-ttu-id="38f84-201">这是因为 ASP.NET 2.0 Web 控件可以包括*控制状态*，这类似于视图状态，但认为重要的回发之间保留状态。</span><span class="sxs-lookup"><span data-stu-id="38f84-201">This is because ASP.NET 2.0 Web controls can include *control state*, which is state persisted across postbacks like view state, but deemed essential.</span></span>


<span data-ttu-id="38f84-202">禁用视图状态 GridView 中的只是省略了简单的状态信息，但维护控件状态 （其中包括用于编辑和删除所需的状态）。</span><span class="sxs-lookup"><span data-stu-id="38f84-202">Disabling view state in the GridView merely omits trivial state information, but maintains the control state (which includes the state necessary for editing and deleting).</span></span> <span data-ttu-id="38f84-203">DataList，在 ASP.NET 1.x 的时间范围内，创建不使用控件状态，因此必须将启用视图状态。</span><span class="sxs-lookup"><span data-stu-id="38f84-203">The DataList, having been created in the ASP.NET 1.x timeframe, does not utilize control state and therefore must have view state enabled.</span></span> <span data-ttu-id="38f84-204">请参阅[控件状态 vs。视图状态](https://msdn.microsoft.com/library/1whwt1k7.aspx)有关的控件状态，如果从视图状态的不同用途的详细信息。</span><span class="sxs-lookup"><span data-stu-id="38f84-204">See [Control State vs. View State](https://msdn.microsoft.com/library/1whwt1k7.aspx) for more information on the purpose of control state and how it differs from view state.</span></span>

## <a name="step-4-adding-an-editing-user-interface"></a><span data-ttu-id="38f84-205">步骤 4： 添加用于编辑的用户界面</span><span class="sxs-lookup"><span data-stu-id="38f84-205">Step 4: Adding an Editing User Interface</span></span>

<span data-ttu-id="38f84-206">GridView 控件组成的字段 （BoundFields、 CheckBoxFields、 Templatefield，等） 的集合。</span><span class="sxs-lookup"><span data-stu-id="38f84-206">The GridView control is composed of a collection of fields (BoundFields, CheckBoxFields, TemplateFields, and so on).</span></span> <span data-ttu-id="38f84-207">这些字段可以调整其呈现的标记，具体取决于其模式。</span><span class="sxs-lookup"><span data-stu-id="38f84-207">These fields can adjust their rendered markup depending on their mode.</span></span> <span data-ttu-id="38f84-208">例如，如果处于只读模式，BoundField 其数据字段值显示为文本;在编辑模式下，它将呈现文本框 Web 控件`Text`属性分配数据字段值。</span><span class="sxs-lookup"><span data-stu-id="38f84-208">For example, when in read-only mode, a BoundField displays its data field value as text; when in edit mode, it renders a TextBox Web control whose `Text` property is assigned the data field value.</span></span>

<span data-ttu-id="38f84-209">DataList，另一方面，呈现其使用模板的项。</span><span class="sxs-lookup"><span data-stu-id="38f84-209">The DataList, on the other hand, renders its items using templates.</span></span> <span data-ttu-id="38f84-210">使用呈现只读项`ItemTemplate`通过呈现在编辑模式下的项而`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-210">Read-only items are rendered using the `ItemTemplate` whereas items in edit mode are rendered via the `EditItemTemplate`.</span></span> <span data-ttu-id="38f84-211">此时，我们 DataList 仅具有`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-211">At this point, our DataList has only an `ItemTemplate`.</span></span> <span data-ttu-id="38f84-212">若要支持项目级编辑功能，我们需要添加`EditItemTemplate`，其中包含要为可编辑的项显示的标记。</span><span class="sxs-lookup"><span data-stu-id="38f84-212">To support item-level editing functionality we need to add an `EditItemTemplate` that contains the markup to be displayed for the editable item.</span></span> <span data-ttu-id="38f84-213">对于本教程，我们将用于编辑产品的名称和单位价格来使用 TextBox Web 控件。</span><span class="sxs-lookup"><span data-stu-id="38f84-213">For this tutorial, we'll use TextBox Web controls for editing the product s name and unit price.</span></span>

<span data-ttu-id="38f84-214">`EditItemTemplate`可以 （通过选择编辑模板选项从 DataList s 智能标记） 以声明方式或通过设计器创建。</span><span class="sxs-lookup"><span data-stu-id="38f84-214">The `EditItemTemplate` can be created either declaratively or through the Designer (by selecting the Edit Templates option from the DataList s smart tag).</span></span> <span data-ttu-id="38f84-215">要使用编辑模板选项，请首先单击智能标记中的编辑模板链接，然后选择`EditItemTemplate`从下拉列表中的项。</span><span class="sxs-lookup"><span data-stu-id="38f84-215">To use the Edit Templates option, first click the Edit Templates link in the smart tag and then select the `EditItemTemplate` item from the drop-down list.</span></span>


<span data-ttu-id="38f84-216">[![使用 DataList 的 EditItemTemplate，从而选择启用](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-216">[![Opt to Work with the DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image18.png)</span></span>

<span data-ttu-id="38f84-217">**图 8**： 选择以使用 DataList s `EditItemTemplate` ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-217">**Figure 8**: Opt to Work with the DataList s `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image20.png))</span></span>


<span data-ttu-id="38f84-218">接下来，键入产品名称中: 和价格:，然后将两个 TextBox 控件从工具箱到`EditItemTemplate`设计器上的接口。</span><span class="sxs-lookup"><span data-stu-id="38f84-218">Next, type in Product name: and Price: and then drag two TextBox controls from the Toolbox into the `EditItemTemplate` interface on the Designer.</span></span> <span data-ttu-id="38f84-219">设置文本框`ID`属性设置为`ProductName`和`UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="38f84-219">Set the TextBoxes `ID` properties to `ProductName` and `UnitPrice`.</span></span>


<span data-ttu-id="38f84-220">[![将 TextBox 添加的产品名称和价格](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-220">[![Add a TextBox for the Product s Name and Price](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image21.png)</span></span>

<span data-ttu-id="38f84-221">**图 9**： 添加文本框中的产品名称和价格 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-221">**Figure 9**: Add a TextBox for the Product s Name and Price ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image23.png))</span></span>


<span data-ttu-id="38f84-222">我们需要将绑定到的相应产品数据字段值`Text`两个文本框的属性。</span><span class="sxs-lookup"><span data-stu-id="38f84-222">We need to bind the corresponding product data field values to the `Text` properties of the two TextBoxes.</span></span> <span data-ttu-id="38f84-223">从文本框智能标记中，单击编辑 DataBindings 链接，然后将关联的适当的数据字段`Text`属性，如图 10 中所示。</span><span class="sxs-lookup"><span data-stu-id="38f84-223">From the TextBoxes smart tags, click on the Edit DataBindings link and then associate the appropriate data field with the `Text` property, as shown in Figure 10.</span></span>

> [!NOTE]
> <span data-ttu-id="38f84-224">绑定时`UnitPrice`数据字段为价格文本框 s`Text`字段中，您可能会将其格式化为货币值 (`{0:C}`)，常规数字 (`{0:N}`)，或将其保留为未格式化。</span><span class="sxs-lookup"><span data-stu-id="38f84-224">When binding the `UnitPrice` data field to the price TextBox s `Text` field, you may format it as a currency value (`{0:C}`), a general number (`{0:N}`), or leave it unformatted.</span></span>


![将产品名称和单价数据字段绑定到文本框的 Text 属性](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image24.png)

<span data-ttu-id="38f84-226">**图 10**： 将绑定`ProductName`并`UnitPrice`数据字段到`Text`文本框的属性</span><span class="sxs-lookup"><span data-stu-id="38f84-226">**Figure 10**: Bind the `ProductName` and `UnitPrice` Data Fields to the `Text` Properties of the TextBoxes</span></span>


<span data-ttu-id="38f84-227">请注意，图 10 中的编辑数据绑定对话框的工作原理*不*包括编辑 TemplateField GridView 或 DetailsView 或在 FormView 的模板时存在的双向数据绑定复选框。</span><span class="sxs-lookup"><span data-stu-id="38f84-227">Notice how the Edit DataBindings dialog box in Figure 10 does *not* include the Two-way databinding checkbox that is present when editing a TemplateField in the GridView or DetailsView, or a template in the FormView.</span></span> <span data-ttu-id="38f84-228">允许使用双向数据绑定功能的值输入到输入的 Web 控件，若要自动分配到相应的 ObjectDataSource s`InsertParameters`或`UpdateParameters`插入或更新数据时。</span><span class="sxs-lookup"><span data-stu-id="38f84-228">The two-way databinding feature allowed the value entered into the input Web control to be automatically assigned to the corresponding ObjectDataSource s `InsertParameters` or `UpdateParameters` when inserting or updating data.</span></span> <span data-ttu-id="38f84-229">DataList 不支持双向数据绑定，正如我们将有更高版本上，在本教程中，看到的建立她更改并已准备好更新的数据的用户后，我们将需要以编程方式访问这些文本框`Text`属性并传递到值适当`UpdateProduct`中的方法`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="38f84-229">The DataList does not support two-way databinding as we'll see later on in this tutorial, after the user makes her changes and is ready to update the data, we will need to programmatically access these TextBoxes `Text` properties and pass in their values to the appropriate `UpdateProduct` method in the `ProductsBLL` class.</span></span>

<span data-ttu-id="38f84-230">最后，我们需要添加更新和取消按钮`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-230">Finally, we need to add Update and Cancel buttons to the `EditItemTemplate`.</span></span> <span data-ttu-id="38f84-231">中可以看到[母版/详细信息的详细信息 DataList 使用母版记录项目符号列表](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)教程中，或按钮时，LinkButton、 ImageButton 其`CommandName`属性设置中的 Repeater 或 DataList，单击从Repeater 或 DataList 的`ItemCommand`引发事件。</span><span class="sxs-lookup"><span data-stu-id="38f84-231">As we saw in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial, when a Button, LinkButton, or ImageButton whose `CommandName` property is set is clicked from within a Repeater or DataList, the Repeater or DataList s `ItemCommand` event is raised.</span></span> <span data-ttu-id="38f84-232">有关 DataList，如果`CommandName`属性设置为某个值，也可能会引发其他事件。</span><span class="sxs-lookup"><span data-stu-id="38f84-232">For the DataList, if the `CommandName` property is set to a certain value, an additional event may be raised as well.</span></span> <span data-ttu-id="38f84-233">这两个特殊`CommandName`以及其他属性值包括：</span><span class="sxs-lookup"><span data-stu-id="38f84-233">The special `CommandName` property values include, among others:</span></span>

- <span data-ttu-id="38f84-234">取消引发`CancelCommand`事件</span><span class="sxs-lookup"><span data-stu-id="38f84-234">Cancel raises the `CancelCommand` event</span></span>
- <span data-ttu-id="38f84-235">编辑引发`EditCommand`事件</span><span class="sxs-lookup"><span data-stu-id="38f84-235">Edit raises the `EditCommand` event</span></span>
- <span data-ttu-id="38f84-236">更新引发`UpdateCommand`事件</span><span class="sxs-lookup"><span data-stu-id="38f84-236">Update raises the `UpdateCommand` event</span></span>

<span data-ttu-id="38f84-237">请记住，会引发这些事件*除了*`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="38f84-237">Keep in mind that these events are raised *in addition to* the `ItemCommand` event.</span></span>

<span data-ttu-id="38f84-238">将添加到`EditItemTemplate`两个按钮 Web 控件、 一个其`CommandName`设置为更新和其他设置为取消。</span><span class="sxs-lookup"><span data-stu-id="38f84-238">Add to the `EditItemTemplate` two Button Web controls, one whose `CommandName` is set to Update and the other s set to Cancel.</span></span> <span data-ttu-id="38f84-239">以后将添加这两个按钮 Web 控件在设计器看起来应类似于下面：</span><span class="sxs-lookup"><span data-stu-id="38f84-239">After adding these two Button Web controls the Designer should look similar to the following:</span></span>


<span data-ttu-id="38f84-240">[![添加更新和取消按钮 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-240">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image25.png)</span></span>

<span data-ttu-id="38f84-241">**图 11**： 添加更新和取消按钮添加到`EditItemTemplate`([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-241">**Figure 11**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image27.png))</span></span>


<span data-ttu-id="38f84-242">使用`EditItemTemplate`完整 DataList s 声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="38f84-242">With the `EditItemTemplate` complete your DataList s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample3.aspx)]

## <a name="step-5-adding-the-plumbing-to-enter-edit-mode"></a><span data-ttu-id="38f84-243">步骤 5： 添加探测功能，可进入编辑模式</span><span class="sxs-lookup"><span data-stu-id="38f84-243">Step 5: Adding the Plumbing to Enter Edit Mode</span></span>

<span data-ttu-id="38f84-244">此时我们 DataList 具有用于编辑的界面，通过定义其`EditItemTemplate`; 但是，这里 s 目前没有办法为用户访问我们的页面指示他想要编辑产品的信息。</span><span class="sxs-lookup"><span data-stu-id="38f84-244">At this point our DataList has an editing interface defined via its `EditItemTemplate`; however, there s currently no way for a user visiting our page to indicate that he wants to edit a product s information.</span></span> <span data-ttu-id="38f84-245">我们需要将编辑按钮添加到每个产品，单击时，呈现该 DataList 项处于编辑模式。</span><span class="sxs-lookup"><span data-stu-id="38f84-245">We need to add an Edit button to each product that, when clicked, renders that DataList item in edit mode.</span></span> <span data-ttu-id="38f84-246">首先，通过添加到一个编辑按钮`ItemTemplate`，通过设计器或以声明方式。</span><span class="sxs-lookup"><span data-stu-id="38f84-246">Start by adding an Edit button to the `ItemTemplate`, either through the Designer or declaratively.</span></span> <span data-ttu-id="38f84-247">设置编辑按钮的`CommandName`编辑的属性。</span><span class="sxs-lookup"><span data-stu-id="38f84-247">Be certain to set the Edit button s `CommandName` property to Edit .</span></span>

<span data-ttu-id="38f84-248">已添加此编辑按钮后，需要一段时间来查看通过浏览器页面。</span><span class="sxs-lookup"><span data-stu-id="38f84-248">After you have added this Edit button, take a moment to view the page through a browser.</span></span> <span data-ttu-id="38f84-249">添加此元素后，每个产品列表应包括一个编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="38f84-249">With this addition, each product listing should include an Edit button.</span></span>


<span data-ttu-id="38f84-250">[![添加更新和取消按钮 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-250">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image28.png)</span></span>

<span data-ttu-id="38f84-251">**图 12**： 添加更新和取消按钮添加到`EditItemTemplate`([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-251">**Figure 12**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image30.png))</span></span>


<span data-ttu-id="38f84-252">单击按钮会导致回发，但*不*将置于编辑模式下所列出的产品。</span><span class="sxs-lookup"><span data-stu-id="38f84-252">Clicking the button causes a postback, but does *not* bring the product listing into edit mode.</span></span> <span data-ttu-id="38f84-253">若要使该产品可编辑，我们需要：</span><span class="sxs-lookup"><span data-stu-id="38f84-253">To make the product editable, we need to:</span></span>

1. <span data-ttu-id="38f84-254">设置 DataList s [ `EditItemIndex`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)的索引的`DataListItem`只需单击其编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="38f84-254">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of the `DataListItem` whose Edit button was just clicked.</span></span>
2. <span data-ttu-id="38f84-255">重新绑定到 DataList 的数据。</span><span class="sxs-lookup"><span data-stu-id="38f84-255">Rebind the data to the DataList.</span></span> <span data-ttu-id="38f84-256">DataList 时重新呈现`DataListItem`其`ItemIndex`对应于 DataList s`EditItemIndex`将使用呈现其`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-256">When the DataList is re-rendered, the `DataListItem` whose `ItemIndex` corresponds with the DataList s `EditItemIndex` will render using its `EditItemTemplate`.</span></span>

<span data-ttu-id="38f84-257">由于 DataList s`EditCommand`单击编辑按钮时触发事件，创建`EditCommand`事件处理程序使用以下代码：</span><span class="sxs-lookup"><span data-stu-id="38f84-257">Since the DataList s `EditCommand` event is fired when the Edit button is clicked, create an `EditCommand` event handler with the following code:</span></span>


[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample4.cs)]

<span data-ttu-id="38f84-258">`EditCommand`事件处理程序类型的对象中传递`DataListCommandEventArgs`作为其第二个输入参数，其中包括对引用`DataListItem`的编辑按钮被单击 (`e.Item`)。</span><span class="sxs-lookup"><span data-stu-id="38f84-258">The `EditCommand` event handler is passed in an object of type `DataListCommandEventArgs` as its second input parameter, which includes a reference to the `DataListItem` whose Edit button was clicked (`e.Item`).</span></span> <span data-ttu-id="38f84-259">事件处理程序首先设置 DataList s`EditItemIndex`到`ItemIndex`的可编辑`DataListItem`，然后将数据到 DataList 重新绑定通过调用 DataList 的`DataBind()`方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-259">The event handler first sets the DataList s `EditItemIndex` to the `ItemIndex` of the editable `DataListItem` and then rebinds the data to the DataList by calling the DataList s `DataBind()` method.</span></span>

<span data-ttu-id="38f84-260">添加此事件处理程序后, 重新访问浏览器中的页。</span><span class="sxs-lookup"><span data-stu-id="38f84-260">After adding this event handler, revisit the page in a browser.</span></span> <span data-ttu-id="38f84-261">单击编辑按钮现在可以被单击的产品可编辑 （请参阅图 13）。</span><span class="sxs-lookup"><span data-stu-id="38f84-261">Clicking the Edit button now makes the clicked product editable (see Figure 13).</span></span>


<span data-ttu-id="38f84-262">[![单击可编辑产品建立的编辑按钮](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-262">[![Clicking the Edit Button Makes the Product Editable](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image31.png)</span></span>

<span data-ttu-id="38f84-263">**图 13**： 单击编辑按钮使产品可编辑 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-263">**Figure 13**: Clicking the Edit Button Makes the Product Editable ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image33.png))</span></span>


## <a name="step-6-saving-the-user-s-changes"></a><span data-ttu-id="38f84-264">步骤 6： 保存用户的更改</span><span class="sxs-lookup"><span data-stu-id="38f84-264">Step 6: Saving the User s Changes</span></span>

<span data-ttu-id="38f84-265">单击编辑的产品 s 更新或取消按钮现在; 没有执行任何操作若要将此功能，我们需要为 DataList s 创建事件处理程序添加`UpdateCommand`和`CancelCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="38f84-265">Clicking the edited product s Update or Cancel buttons does nothing at this point; to add this functionality we need to create event handlers for the DataList s `UpdateCommand` and `CancelCommand` events.</span></span> <span data-ttu-id="38f84-266">首先创建`CancelCommand`事件处理程序，单击编辑的产品 s 取消按钮和它执行任务的 DataList 回到其预先编辑状态时，将执行。</span><span class="sxs-lookup"><span data-stu-id="38f84-266">Start by creating the `CancelCommand` event handler, which will execute when the edited product s Cancel button is clicked and it tasked with returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="38f84-267">若要让 DataList 呈现的所有项在只读模式下，我们需要：</span><span class="sxs-lookup"><span data-stu-id="38f84-267">To have the DataList render all of its items in the read-only mode, we need to:</span></span>

1. <span data-ttu-id="38f84-268">设置 DataList s [ `EditItemIndex`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)的索引不存在的`DataListItem`索引。</span><span class="sxs-lookup"><span data-stu-id="38f84-268">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="38f84-269">`-1` 是一个安全的选择，因为`DataListItem`索引开始`0`。</span><span class="sxs-lookup"><span data-stu-id="38f84-269">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
2. <span data-ttu-id="38f84-270">重新绑定到 DataList 的数据。</span><span class="sxs-lookup"><span data-stu-id="38f84-270">Rebind the data to the DataList.</span></span> <span data-ttu-id="38f84-271">由于无`DataListItem` `ItemIndex` es 对应于 DataList 的`EditItemIndex`，将在只读模式下呈现整个 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-271">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="38f84-272">可以使用以下事件处理程序代码中完成以下步骤：</span><span class="sxs-lookup"><span data-stu-id="38f84-272">These steps can be accomplished with the following event handler code:</span></span>


[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample5.cs)]

<span data-ttu-id="38f84-273">添加此元素后，单击取消按钮返回 DataList 为其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="38f84-273">With this addition, clicking the Cancel button returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="38f84-274">我们需要完成的最后一个事件处理程序是`UpdateCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="38f84-274">The last event handler we need to complete is the `UpdateCommand` event handler.</span></span> <span data-ttu-id="38f84-275">此事件处理程序需要：</span><span class="sxs-lookup"><span data-stu-id="38f84-275">This event handler needs to:</span></span>

1. <span data-ttu-id="38f84-276">以编程方式访问的用户输入产品名称和价格，以及编辑的产品的`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="38f84-276">Programmatically access the user-entered product name and price as well as the edited product s `ProductID`.</span></span>
2. <span data-ttu-id="38f84-277">启动更新过程，通过调用适当`UpdateProduct`重载中`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="38f84-277">Initiate the update process by calling the appropriate `UpdateProduct` overload in the `ProductsBLL` class.</span></span>
3. <span data-ttu-id="38f84-278">设置 DataList s [ `EditItemIndex`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)的索引不存在的`DataListItem`索引。</span><span class="sxs-lookup"><span data-stu-id="38f84-278">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="38f84-279">`-1` 是一个安全的选择，因为`DataListItem`索引开始`0`。</span><span class="sxs-lookup"><span data-stu-id="38f84-279">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
4. <span data-ttu-id="38f84-280">重新绑定到 DataList 的数据。</span><span class="sxs-lookup"><span data-stu-id="38f84-280">Rebind the data to the DataList.</span></span> <span data-ttu-id="38f84-281">由于无`DataListItem` `ItemIndex` es 对应于 DataList 的`EditItemIndex`，将在只读模式下呈现整个 DataList。</span><span class="sxs-lookup"><span data-stu-id="38f84-281">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="38f84-282">步骤 1 和 2 负责将用户保存 s 更改;步骤 3 和 4 DataList 后返回到其预先编辑状态更改已保存，并且在中执行的步骤相同`CancelCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="38f84-282">Steps 1 and 2 are responsible for saving the user s changes; steps 3 and 4 return the DataList to its pre-editing state after the changes have been saved and are identical to the steps performed in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="38f84-283">若要获取的更新的产品名称和价格，我们需要使用`FindControl`方法以编程方式引用文本框 Web 控件内`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-283">To get the updated product name and price, we need to use the `FindControl` method to programmatically reference the TextBox Web controls within the `EditItemTemplate`.</span></span> <span data-ttu-id="38f84-284">我们还需要获取已编辑的产品的`ProductID`值。</span><span class="sxs-lookup"><span data-stu-id="38f84-284">We also need to get the edited product s `ProductID` value.</span></span> <span data-ttu-id="38f84-285">当我们最初绑定到 DataList ObjectDataSource 时，Visual Studio 分配 DataList s`DataKeyField`数据源的主键值的属性 (`ProductID`)。</span><span class="sxs-lookup"><span data-stu-id="38f84-285">When we initially bound the ObjectDataSource to the DataList, Visual Studio assigned the DataList s `DataKeyField` property to the primary key value from the data source (`ProductID`).</span></span> <span data-ttu-id="38f84-286">然后可以从 DataList s 检索此值`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="38f84-286">This value can then be retrieved from the DataList s `DataKeys` collection.</span></span> <span data-ttu-id="38f84-287">请花费片刻时间来确保`DataKeyField`确实将属性设置为`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="38f84-287">Take a moment to ensure that the `DataKeyField` property is indeed set to `ProductID`.</span></span>

<span data-ttu-id="38f84-288">下面的代码实现的四个步骤：</span><span class="sxs-lookup"><span data-stu-id="38f84-288">The following code implements the four steps:</span></span>


[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="38f84-289">事件处理程序首先会在编辑产品 s 中读取`ProductID`从`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="38f84-289">The event handler starts by reading in the edited product s `ProductID` from the `DataKeys` collection.</span></span> <span data-ttu-id="38f84-290">下一步，在两个文本框`EditItemTemplate`引用和他们`Text`本地变量中存储属性`productNameValue`和`unitPriceValue`。</span><span class="sxs-lookup"><span data-stu-id="38f84-290">Next, the two TextBoxes in the `EditItemTemplate` are referenced and their `Text` properties stored in local variables, `productNameValue` and `unitPriceValue`.</span></span> <span data-ttu-id="38f84-291">我们使用`Decimal.Parse()`方法来读取的值从`UnitPrice`文本框中，如果输入的值以便具有货币符号，仍可以正确地转换到`Decimal`值。</span><span class="sxs-lookup"><span data-stu-id="38f84-291">We use the `Decimal.Parse()` method to read the value from the `UnitPrice` TextBox so that if the value entered has a currency symbol, it can still be correctly converted into a `Decimal` value.</span></span>

> [!NOTE]
> <span data-ttu-id="38f84-292">中的值`ProductName`和`UnitPrice`文本框仅分配给 productNameValue 和 unitPriceValue 变量，如果文本框的文本属性具有指定的值。</span><span class="sxs-lookup"><span data-stu-id="38f84-292">The values from the `ProductName` and `UnitPrice` TextBoxes are only assigned to the productNameValue and unitPriceValue variables if the TextBoxes Text properties have a value specified.</span></span> <span data-ttu-id="38f84-293">否则为值为`Nothing`使用的变量，这与数据库中更新数据的影响`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="38f84-293">Otherwise, a value of `Nothing` is used for the variables, which has the effect of updating the data with a database `NULL` value.</span></span> <span data-ttu-id="38f84-294">也就是说，我们的代码将转换为空字符串转换为数据库`NULL`是 GridView、 DetailsView 和 FormView 控件中的编辑界面的默认行为的值。</span><span class="sxs-lookup"><span data-stu-id="38f84-294">That is, our code treats converts empty strings to database `NULL` values, which is the default behavior of the editing interface in the GridView, DetailsView, and FormView controls.</span></span>


<span data-ttu-id="38f84-295">在读取值之后,`ProductsBLL`类 s`UpdateProduct`方法调用时，传入 s 产品名称、 价格和`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="38f84-295">After reading the values, the `ProductsBLL` class s `UpdateProduct` method is called, passing in the product s name, price, and `ProductID`.</span></span> <span data-ttu-id="38f84-296">事件处理程序完成通过为使用完全相同的逻辑中作为其预编辑状态返回 DataList`CancelCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="38f84-296">The event handler completes by returning the DataList to its pre-editing state using the exact same logic as in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="38f84-297">与`EditCommand`， `CancelCommand`，和`UpdateCommand`事件处理程序完成，访问者可以编辑名称和产品价格。</span><span class="sxs-lookup"><span data-stu-id="38f84-297">With the `EditCommand`, `CancelCommand`, and `UpdateCommand` event handlers complete, a visitor can edit the name and price of a product.</span></span> <span data-ttu-id="38f84-298">图 14-16 显示运行中的此编辑工作流。</span><span class="sxs-lookup"><span data-stu-id="38f84-298">Figures 14-16 show this editing workflow in action.</span></span>


<span data-ttu-id="38f84-299">[![第一个访问的页面，所有的产品时处于只读模式](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-299">[![When First Visiting the Page, All Products are in Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image34.png)</span></span>

<span data-ttu-id="38f84-300">**图 14**： 当首次访问的页面，所有产品都都在只读模式下 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-300">**Figure 14**: When First Visiting the Page, All Products are in Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image36.png))</span></span>


<span data-ttu-id="38f84-301">[![若要更新的产品名称的价格，请单击编辑按钮](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-301">[![To Update a Product s Name or Price, Click the Edit Button](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image37.png)</span></span>

<span data-ttu-id="38f84-302">**图 15**： 若要更新的产品名称或价格，请单击编辑按钮 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-302">**Figure 15**: To Update a Product s Name or Price, Click the Edit Button ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image39.png))</span></span>


<span data-ttu-id="38f84-303">[![在更改值后，请单击更新返回到只读模式](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="38f84-303">[![After Changing the Value, Click Update to Return to the Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image40.png)</span></span>

<span data-ttu-id="38f84-304">**图 16**： 后更改的值中，单击更新返回到只读模式 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="38f84-304">**Figure 16**: After Changing the Value, Click Update to Return to the Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image42.png))</span></span>


## <a name="step-7-adding-delete-capabilities"></a><span data-ttu-id="38f84-305">步骤 7： 添加删除功能</span><span class="sxs-lookup"><span data-stu-id="38f84-305">Step 7: Adding Delete Capabilities</span></span>

<span data-ttu-id="38f84-306">向 DataList 添加删除功能的步骤是类似于添加编辑功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-306">The steps for adding delete capabilities to a DataList are similar to those for adding editing capabilities.</span></span> <span data-ttu-id="38f84-307">简单地说，我们需要添加到删除按钮`ItemTemplate`，单击时：</span><span class="sxs-lookup"><span data-stu-id="38f84-307">In short, we need to add a Delete button to the `ItemTemplate` that, when clicked:</span></span>

1. <span data-ttu-id="38f84-308">在相应产品 s 中读取`ProductID`通过`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="38f84-308">Reads in the corresponding product s `ProductID` via the `DataKeys` collection.</span></span>
2. <span data-ttu-id="38f84-309">通过调用执行 delete`ProductsBLL`类的`DeleteProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-309">Performs the delete by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>
3. <span data-ttu-id="38f84-310">重新绑定到 DataList 的数据。</span><span class="sxs-lookup"><span data-stu-id="38f84-310">Rebinds the data to the DataList.</span></span>

<span data-ttu-id="38f84-311">让我们来通过添加到删除按钮来启动`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="38f84-311">Let s start by adding a Delete button to the `ItemTemplate`.</span></span>

<span data-ttu-id="38f84-312">当单击按钮时其`CommandName`为编辑，更新或取消按钮将引发 DataList s`ItemCommand`事件与其他事件 (例如，当使用编辑`EditCommand`事件也会产生)。</span><span class="sxs-lookup"><span data-stu-id="38f84-312">When clicked, a Button whose `CommandName` is Edit, Update, or Cancel raises the DataList s `ItemCommand` event along with an additional event (for example, when using Edit the `EditCommand` event is raised as well).</span></span> <span data-ttu-id="38f84-313">同样，任何按钮、 LinkButton 或 DataList 中的 ImageButton 其`CommandName`属性设置为删除的原因`DeleteCommand`激发的事件 (连同`ItemCommand`)。</span><span class="sxs-lookup"><span data-stu-id="38f84-313">Similarly, any Button, LinkButton, or ImageButton in the DataList whose `CommandName` property is set to Delete causes the `DeleteCommand` event to fire (along with `ItemCommand`).</span></span>

<span data-ttu-id="38f84-314">添加中的编辑按钮旁边的删除按钮`ItemTemplate`，并设置其`CommandName`属性设置为删除。</span><span class="sxs-lookup"><span data-stu-id="38f84-314">Add a Delete button next to the Edit button in the `ItemTemplate`, setting its `CommandName` property to Delete.</span></span> <span data-ttu-id="38f84-315">添加后此按钮控制你 DataList 的`ItemTemplate`声明性语法应如下所示：</span><span class="sxs-lookup"><span data-stu-id="38f84-315">After adding this Button control your DataList s `ItemTemplate` declarative syntax should look like:</span></span>


[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample7.aspx)]

<span data-ttu-id="38f84-316">接下来，为 DataList s 创建事件处理程序`DeleteCommand`事件，使用以下代码：</span><span class="sxs-lookup"><span data-stu-id="38f84-316">Next, create an event handler for the DataList s `DeleteCommand` event, using the following code:</span></span>


[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="38f84-317">单击删除按钮会导致回发并触发 DataList 的`DeleteCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="38f84-317">Clicking the Delete button causes a postback and fires the DataList s `DeleteCommand` event.</span></span> <span data-ttu-id="38f84-318">事件处理程序中，单击产品 s`ProductID`值访问从`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="38f84-318">In the event handler, the clicked product s `ProductID` value is accessed from the `DataKeys` collection.</span></span> <span data-ttu-id="38f84-319">接下来，通过调用删除产品`ProductsBLL`类的`DeleteProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="38f84-319">Next, the product is deleted by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>

<span data-ttu-id="38f84-320">在删除该产品之后, 它非常重要，我们重新绑定到 DataList 数据 (`DataList1.DataBind()`)，否则 DataList 将继续显示只删除该产品。</span><span class="sxs-lookup"><span data-stu-id="38f84-320">After deleting the product, it s important that we rebind the data to the DataList (`DataList1.DataBind()`), otherwise the DataList will continue to show the product that was just deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="38f84-321">总结</span><span class="sxs-lookup"><span data-stu-id="38f84-321">Summary</span></span>

<span data-ttu-id="38f84-322">DataList 缺少点，并单击编辑和删除支持通过 GridView 体验感到满意，而使用短少量的代码可增强以包括这些功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-322">While the DataList lacks the point and click editing and deleting support enjoyed by the GridView, with a short bit of code it can be enhanced to include these features.</span></span> <span data-ttu-id="38f84-323">在本教程中我们已了解如何创建的产品可以删除，无法编辑其名称和价格的两个列列表。</span><span class="sxs-lookup"><span data-stu-id="38f84-323">In this tutorial we saw how to create a two-column listing of products that could be deleted and whose name and price could be edited.</span></span> <span data-ttu-id="38f84-324">添加编辑和删除支持是一种包括中的相应 Web 控件`ItemTemplate`和`EditItemTemplate`、 创建相应的事件处理程序、 读取用户输入和主要密钥值，和如何与业务交互逻辑层。</span><span class="sxs-lookup"><span data-stu-id="38f84-324">Adding editing and deleting support is a matter of including the appropriate Web controls in the `ItemTemplate` and `EditItemTemplate`, creating the corresponding event handlers, reading the user-entered and primary key values, and interfacing with the Business Logic Layer.</span></span>

<span data-ttu-id="38f84-325">虽然我们已添加基本编辑和删除 DataList 的功能，它缺乏更高级的功能。</span><span class="sxs-lookup"><span data-stu-id="38f84-325">While we have added basic editing and deleting capabilities to the DataList, it lacks more advanced features.</span></span> <span data-ttu-id="38f84-326">例如，没有任何输入的字段验证-如果用户输入过的价格昂贵，异常将引发`Decimal.Parse`时尝试将转换过昂贵到`Decimal`。</span><span class="sxs-lookup"><span data-stu-id="38f84-326">For example, there is no input field validation - if a user enters a price of Too expensive, an exception will be thrown by `Decimal.Parse` when attempting to convert Too expensive into a `Decimal`.</span></span> <span data-ttu-id="38f84-327">同样，如果在更新数据的业务逻辑或数据访问层中的问题将提供用户在标准错误屏幕。</span><span class="sxs-lookup"><span data-stu-id="38f84-327">Similarly, if there is a problem in updating the data at the Business Logic or Data Access Layers the user will be presented with the standard error screen.</span></span> <span data-ttu-id="38f84-328">而无需任何类型的删除按钮确认消息，是所有很可能发生意外删除产品。</span><span class="sxs-lookup"><span data-stu-id="38f84-328">Without any sort of confirmation on the Delete button, accidentally deleting a product is all too likely.</span></span>

<span data-ttu-id="38f84-329">在将来教程将介绍如何提高编辑的用户体验。</span><span class="sxs-lookup"><span data-stu-id="38f84-329">In future tutorials we'll see how to improve the editing user experience.</span></span>

<span data-ttu-id="38f84-330">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="38f84-330">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="38f84-331">关于作者</span><span class="sxs-lookup"><span data-stu-id="38f84-331">About the Author</span></span>

<span data-ttu-id="38f84-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="38f84-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="38f84-333">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="38f84-333">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="38f84-334">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="38f84-334">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="38f84-335">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="38f84-335">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="38f84-336">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="38f84-336">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="38f84-337">特别感谢</span><span class="sxs-lookup"><span data-stu-id="38f84-337">Special Thanks To</span></span>

<span data-ttu-id="38f84-338">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="38f84-338">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="38f84-339">本教程中的潜在顾客审阅者是 Zack Jones、 Ken Pespisa 和 Randy Schmidt。</span><span class="sxs-lookup"><span data-stu-id="38f84-339">Lead reviewers for this tutorial were Zack Jones, Ken Pespisa, and Randy Schmidt.</span></span> <span data-ttu-id="38f84-340">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="38f84-340">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="38f84-341">如果是这样，给我在行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="38f84-341">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="38f84-342">下一篇</span><span class="sxs-lookup"><span data-stu-id="38f84-342">Next</span></span>](performing-batch-updates-cs.md)
