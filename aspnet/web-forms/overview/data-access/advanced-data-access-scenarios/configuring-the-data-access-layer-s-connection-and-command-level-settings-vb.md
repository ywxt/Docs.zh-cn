---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
title: 配置数据访问层的连接和命令级别的设置 (VB) |Microsoft Docs
author: rick-anderson
description: 类型化数据集内的 Tableadapter 自动负责连接到数据库中，发出的命令，并填充 DataTable 与结果...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/03/2007
ms.topic: article
ms.assetid: d57dfa2b-d627-45cb-b5b1-abbf3159d770
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
msc.type: authoredcontent
ms.openlocfilehash: 85ec20795b337d5457becc5182b148b03e1554fa
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/03/2018
ms.locfileid: "37402062"
---
<a name="configuring-the-data-access-layers-connection--and-command-level-settings-vb"></a><span data-ttu-id="2b010-103">配置数据访问层的连接和命令级别的设置 (VB)</span><span class="sxs-lookup"><span data-stu-id="2b010-103">Configuring the Data Access Layer's Connection- and Command-Level Settings (VB)</span></span>
====================
<span data-ttu-id="2b010-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2b010-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2b010-105">[下载代码](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip)或[下载 PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2b010-105">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip) or [Download PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span></span>

> <span data-ttu-id="2b010-106">类型化数据集内的 Tableadapter 自动负责连接到数据库中，发出的命令，并填充 DataTable 的结果。</span><span class="sxs-lookup"><span data-stu-id="2b010-106">The TableAdapters within a Typed DataSet automatically take care of connecting to the database, issuing commands, and populating a DataTable with the results.</span></span> <span data-ttu-id="2b010-107">但是，如果我们想要处理的这些详细信息，并在本教程中我们将了解如何访问 TableAdapter 中的数据库连接和命令级别设置有情况。</span><span class="sxs-lookup"><span data-stu-id="2b010-107">There are occasions however when we want to take care of these details ourselves, and in this tutorial we learn how to access the database connection- and command-level settings in the TableAdapter.</span></span>


## <a name="introduction"></a><span data-ttu-id="2b010-108">介绍</span><span class="sxs-lookup"><span data-stu-id="2b010-108">Introduction</span></span>

<span data-ttu-id="2b010-109">整个系列教程我们使用了类型化数据集来实现数据访问层和业务对象的分层式体系结构。</span><span class="sxs-lookup"><span data-stu-id="2b010-109">Throughout the tutorial series we have used Typed DataSets to implement the Data Access Layer and business objects of our layered architecture.</span></span> <span data-ttu-id="2b010-110">如中所述[第一篇教程](../introduction/creating-a-data-access-layer-vb.md)，s 数据表用作数据的存储库而 Tableadapter 充当包装与要检索和修改基础数据的数据库进行通信的类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="2b010-110">As discussed in the [first tutorial](../introduction/creating-a-data-access-layer-vb.md), the Typed DataSet s DataTables serve as repositories of data whereas the TableAdapters act as wrappers to communicate with the database to retrieve and modify the underlying data.</span></span> <span data-ttu-id="2b010-111">Tableadapter 封装在处理数据库中所涉及的复杂性，并使我们无需编写代码以连接到数据库中，发出命令，或填充到 DataTable 的结果。</span><span class="sxs-lookup"><span data-stu-id="2b010-111">The TableAdapters encapsulate the complexity involved in working with the database and saves us from having to write code to connect to the database, issue a command, or populate the results into a DataTable.</span></span>

<span data-ttu-id="2b010-112">有些的时候，但是，当我们需要的 TableAdapter burrow 和编写代码，直接使用 ADO.NET 对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-112">There are times, however, when we need to burrow into the depths of the TableAdapter and write code that works directly with the ADO.NET objects.</span></span> <span data-ttu-id="2b010-113">在中[包装事务内的数据库修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)教程中，例如，我们添加方法到 TableAdapter 的开始、 提交和回滚 ADO.NET 的事务。</span><span class="sxs-lookup"><span data-stu-id="2b010-113">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, for example, we added methods to the TableAdapter for beginning, committing, and rolling back ADO.NET transactions.</span></span> <span data-ttu-id="2b010-114">使用这些方法内部，手动创建`SqlTransaction`对象分配给 TableAdapter 的`SqlCommand`对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-114">These methods used an internal, manually-created `SqlTransaction` object that was assigned to the TableAdapter s `SqlCommand` objects.</span></span>

<span data-ttu-id="2b010-115">在本教程中，我们将说明如何访问 TableAdapter 中的数据库连接和命令级别设置。</span><span class="sxs-lookup"><span data-stu-id="2b010-115">In this tutorial we will examine how to access the database connection- and command-level settings in the TableAdapter.</span></span> <span data-ttu-id="2b010-116">具体而言，我们将添加到功能`ProductsTableAdapter`允许访问为基础的连接字符串和命令超时设置。</span><span class="sxs-lookup"><span data-stu-id="2b010-116">In particular, we will add functionality to the `ProductsTableAdapter` that enables access to the underlying connection string and command timeout settings.</span></span>

## <a name="working-with-data-using-adonet"></a><span data-ttu-id="2b010-117">使用 ADO.NET 处理数据</span><span class="sxs-lookup"><span data-stu-id="2b010-117">Working with Data Using ADO.NET</span></span>

<span data-ttu-id="2b010-118">Microsoft.NET Framework 包含大量专门用于处理数据的类。</span><span class="sxs-lookup"><span data-stu-id="2b010-118">The Microsoft .NET Framework contains a plethora of classes designed specifically to work with data.</span></span> <span data-ttu-id="2b010-119">这些类中找到[`System.Data`命名空间](https://msdn.microsoft.com/library/system.data.aspx)，称为*ADO.NET*类。</span><span class="sxs-lookup"><span data-stu-id="2b010-119">These classes, found within the [`System.Data` namespace](https://msdn.microsoft.com/library/system.data.aspx), are referred to as the *ADO.NET* classes.</span></span> <span data-ttu-id="2b010-120">某些 ADO.NET 之下的类绑定到特定*数据提供程序*。</span><span class="sxs-lookup"><span data-stu-id="2b010-120">Some of the classes under the ADO.NET umbrella are tied to a particular *data provider*.</span></span> <span data-ttu-id="2b010-121">可以数据访问接口视为允许将信息 ADO.NET 类和基础数据存储区之间流动的通信通道。</span><span class="sxs-lookup"><span data-stu-id="2b010-121">You can think of a data provider as a communication channel that allows information to flow between the ADO.NET classes and the underlying data store.</span></span> <span data-ttu-id="2b010-122">没有通用提供程序，如 OleDb 和 ODBC，以及专门设计用于特定的数据库系统的提供程序。</span><span class="sxs-lookup"><span data-stu-id="2b010-122">There are generalized providers, like OleDb and ODBC, as well as providers that are specially designed for a particular database system.</span></span> <span data-ttu-id="2b010-123">例如，可能会连接到使用 OleDb 访问接口的 Microsoft SQL Server 数据库时，SqlClient 提供程序是高效得多因为它的设计和优化专门用于 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="2b010-123">For example, while it is possible to connect to a Microsoft SQL Server database using the OleDb provider, the SqlClient provider is much more efficient as it was designed and optimized specifically for SQL Server.</span></span>

<span data-ttu-id="2b010-124">当以编程方式访问数据时，通常使用以下模式：</span><span class="sxs-lookup"><span data-stu-id="2b010-124">When programmatically accessing data, the following pattern is commonly used:</span></span>

1. <span data-ttu-id="2b010-125">建立到数据库的连接。</span><span class="sxs-lookup"><span data-stu-id="2b010-125">Establish a connection to the database.</span></span>
2. <span data-ttu-id="2b010-126">发出命令。</span><span class="sxs-lookup"><span data-stu-id="2b010-126">Issue a command.</span></span>
3. <span data-ttu-id="2b010-127">有关`SELECT`查询，处理生成的记录。</span><span class="sxs-lookup"><span data-stu-id="2b010-127">For `SELECT` queries, work with the resulting records.</span></span>

<span data-ttu-id="2b010-128">有单独的 ADO.NET 类来执行每个步骤。</span><span class="sxs-lookup"><span data-stu-id="2b010-128">There are separate ADO.NET classes for performing each of these steps.</span></span> <span data-ttu-id="2b010-129">若要连接到使用 SqlClient 提供程序的数据库，例如，使用[`SqlConnection`类](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="2b010-129">To connect to a database using the SqlClient provider, for example, use the [`SqlConnection` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx).</span></span> <span data-ttu-id="2b010-130">颁发`INSERT`， `UPDATE`， `DELETE`，或`SELECT`命令到数据库，请参考[`SqlCommand`类](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="2b010-130">To issue an `INSERT`, `UPDATE`, `DELETE`, or `SELECT` command to the database, use the [`SqlCommand` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx).</span></span>

<span data-ttu-id="2b010-131">除[包装事务内的数据库修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)教程中，我们不不得不编写任何低级别的 ADO.NET 代码，我们自己因为 Tableadapter 自动生成的代码包括到所需的功能连接到数据库、 发出命令，检索数据和该数据填充到数据表。</span><span class="sxs-lookup"><span data-stu-id="2b010-131">Except for the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, we have not had to write any low-level ADO.NET code ourselves because the TableAdapters auto-generated code includes the functionality needed to connect to the database, issue commands, retrieve data, and populate that data into DataTables.</span></span> <span data-ttu-id="2b010-132">但是，可能是我们需要自定义这些低级别的设置。</span><span class="sxs-lookup"><span data-stu-id="2b010-132">However, there may be times when we need to customize these low-level settings.</span></span> <span data-ttu-id="2b010-133">通过以下几个步骤中，我们将说明如何利用在内部使用 Tableadapter 的 ADO.NET 对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-133">Over the next few steps we will examine how to tap into the ADO.NET objects used internally by the TableAdapters.</span></span>

## <a name="step-1-examining-with-the-connection-property"></a><span data-ttu-id="2b010-134">第 1 步： 检查连接属性</span><span class="sxs-lookup"><span data-stu-id="2b010-134">Step 1: Examining with the Connection Property</span></span>

<span data-ttu-id="2b010-135">每个 TableAdapter 类具有`Connection`属性，用于指定数据库连接信息。</span><span class="sxs-lookup"><span data-stu-id="2b010-135">Each TableAdapter class has a `Connection` property that specifies database connection information.</span></span> <span data-ttu-id="2b010-136">此属性的数据类型和`ConnectionString`值由 TableAdapter 配置向导中所做的选择。</span><span class="sxs-lookup"><span data-stu-id="2b010-136">This property s data type and `ConnectionString` value are determined by the selections made in the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="2b010-137">回想一下，我们首先将 TableAdapter 添加到类型化数据集时此向导将询问我们数据库源 （请参阅图 1）。</span><span class="sxs-lookup"><span data-stu-id="2b010-137">Recall that when we first add a TableAdapter to a Typed DataSet this wizard asks us for the database source (see Figure 1).</span></span> <span data-ttu-id="2b010-138">此第一步中的下拉列表包括这些配置文件，以及在服务器资源管理器的数据连接中的任何其他数据库中指定的数据库。</span><span class="sxs-lookup"><span data-stu-id="2b010-138">The drop-down list in this first step includes those databases specified in the configuration file as well as any other databases in the Server Explorer s Data Connections.</span></span> <span data-ttu-id="2b010-139">如果下拉列表中，我们想要使用的数据库不存在，则可以通过单击新建连接按钮并提供所需的连接信息指定新的数据库连接。</span><span class="sxs-lookup"><span data-stu-id="2b010-139">If the database we want to use does not exist in the drop-down list, a new database connection can be specified by clicking the New Connection button and providing the needed connection information.</span></span>


<span data-ttu-id="2b010-140">[![TableAdapter 配置向导第一步](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2b010-140">[![The First Step of the TableAdapter Configuration Wizard](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)</span></span>

<span data-ttu-id="2b010-141">**图 1**: 第一步的 TableAdapter 配置向导 ([单击以查看实际尺寸的图像](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="2b010-141">**Figure 1**: The First Step of the TableAdapter Configuration Wizard ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span></span>


<span data-ttu-id="2b010-142">允许 s 花点时间检查 TableAdapter s 代码`Connection`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-142">Let s take a moment to inspect the code for the TableAdapter s `Connection` property.</span></span> <span data-ttu-id="2b010-143">如中所述[创建数据访问层](../introduction/creating-a-data-access-layer-vb.md)教程中，我们可以转到类视图窗口中，向下合适的类，钻取，然后双击成员名称查看自动生成的 TableAdapter 代码。</span><span class="sxs-lookup"><span data-stu-id="2b010-143">As noted in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we can view the auto-generated TableAdapter code by going to the Class View window, drilling down to the appropriate class, and then double-clicking the member name.</span></span>

<span data-ttu-id="2b010-144">通过转到视图菜单并选择类视图 （或通过键入 Ctrl + Shift + C），请导航到类视图窗口。</span><span class="sxs-lookup"><span data-stu-id="2b010-144">Navigate to the Class View window by going to the View menu and choosing Class View (or by typing Ctrl+Shift+C).</span></span> <span data-ttu-id="2b010-145">从类视图窗口的上半部分，向下钻取`NorthwindTableAdapters`命名空间，然后选择`ProductsTableAdapter`类。</span><span class="sxs-lookup"><span data-stu-id="2b010-145">From the top half of the Class View window, drill down to the `NorthwindTableAdapters` namespace and select the `ProductsTableAdapter` class.</span></span> <span data-ttu-id="2b010-146">这将显示`ProductsTableAdapter`的成员在类视图，如图 2 中所示的下半部分。</span><span class="sxs-lookup"><span data-stu-id="2b010-146">This will display the `ProductsTableAdapter` s members in the bottom half of the Class View, as shown in Figure 2.</span></span> <span data-ttu-id="2b010-147">双击`Connection`属性以查看其代码。</span><span class="sxs-lookup"><span data-stu-id="2b010-147">Double-click the `Connection` property to see its code.</span></span>


![双击要查看其自动生成的代码的类视图中的连接属性](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image4.png)

<span data-ttu-id="2b010-149">**图 2**： 双击要查看其自动生成的代码的类视图中的连接属性</span><span class="sxs-lookup"><span data-stu-id="2b010-149">**Figure 2**: Double-Click the Connection Property in the Class View to View Its Auto-Generated Code</span></span>


<span data-ttu-id="2b010-150">TableAdapter 的`Connection`属性和其他与连接相关的代码如下所示：</span><span class="sxs-lookup"><span data-stu-id="2b010-150">The TableAdapter s `Connection` property and other connection-related code follows:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample1.vb)]

<span data-ttu-id="2b010-151">TableAdapter 类实例化时，成员变量`_connection`等同于`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="2b010-151">When the TableAdapter class is instantiated, the member variable `_connection` is equal to `Nothing`.</span></span> <span data-ttu-id="2b010-152">当`Connection`访问属性时，它首先检查以查看是否`_connection`已实例化成员变量。</span><span class="sxs-lookup"><span data-stu-id="2b010-152">When the `Connection` property is accessed, it first checks to see if the `_connection` member variable has been instantiated.</span></span> <span data-ttu-id="2b010-153">如果没有，`InitConnection`调用方法时，实例化`_connection`，并设置其`ConnectionString`TableAdapter 配置向导 s 第一个步骤中指定的连接字符串值的属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-153">If it has not, the `InitConnection` method is invoked, which instantiates `_connection` and sets its `ConnectionString` property to the connection string value specified from the TableAdapter Configuration wizard s first step.</span></span>

<span data-ttu-id="2b010-154">`Connection`还可以将属性分配给`SqlConnection`对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-154">The `Connection` property can also be assigned to a `SqlConnection` object.</span></span> <span data-ttu-id="2b010-155">执行此操作将相关联的新`SqlConnection`对象与每个 TableAdapter 的`SqlCommand`对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-155">Doing so associates the new `SqlConnection` object with each of the TableAdapter s `SqlCommand` objects.</span></span>

## <a name="step-2-exposing-connection-level-settings"></a><span data-ttu-id="2b010-156">步骤 2： 公开连接级别的设置</span><span class="sxs-lookup"><span data-stu-id="2b010-156">Step 2: Exposing Connection-Level Settings</span></span>

<span data-ttu-id="2b010-157">连接信息应保持在 TableAdapter 中封装和无法访问应用程序体系结构中其他层。</span><span class="sxs-lookup"><span data-stu-id="2b010-157">The connection information should remain encapsulated within the TableAdapter and not be accessible to other layers in the application architecture.</span></span> <span data-ttu-id="2b010-158">但是，可能有的方案必须是可访问或进行自定义查询、 用户或 ASP.NET 页面的 TableAdapter 的连接级别信息。</span><span class="sxs-lookup"><span data-stu-id="2b010-158">However, there may be scenarios when the TableAdapter s connection-level information needs to be accessible or customizable for a query, user, or ASP.NET page.</span></span>

<span data-ttu-id="2b010-159">让我们来扩展`ProductsTableAdapter`中`Northwind`要包括数据集`ConnectionString`业务逻辑层可以使用用于读取或更改所用的 TableAdapter 的连接字符串属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-159">Let s extend the `ProductsTableAdapter` in the `Northwind` DataSet to include a `ConnectionString` property that can be used by the Business Logic Layer to read or change the connection string used by the TableAdapter.</span></span>

> [!NOTE]
> <span data-ttu-id="2b010-160">一个*连接字符串*是一个字符串，指定数据库连接信息，如要使用的数据库、 身份验证凭据和其他与数据库相关的设置的位置的提供程序。</span><span class="sxs-lookup"><span data-stu-id="2b010-160">A *connection string* is a string that specifies database connection information, such as the provider to use, the location of the database, authentication credentials, and other database-related settings.</span></span> <span data-ttu-id="2b010-161">使用的各种数据存储和提供程序的连接字符串模式的列表，请参阅[ConnectionStrings.com](http://www.connectionstrings.com/)。</span><span class="sxs-lookup"><span data-stu-id="2b010-161">For a list of connection string patterns used by a variety of data stores and providers, see [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


<span data-ttu-id="2b010-162">如中所述[创建数据访问层](../introduction/creating-a-data-access-layer-vb.md)教程中，可以通过使用分部类扩展类型数据集的自动生成的类。</span><span class="sxs-lookup"><span data-stu-id="2b010-162">As discussed in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, the Typed DataSet s auto-generated classes can be extended through the use of partial classes.</span></span> <span data-ttu-id="2b010-163">首先，创建新的子文件夹中名为的项目`ConnectionAndCommandSettings`下方`~/App_Code/DAL`文件夹。</span><span class="sxs-lookup"><span data-stu-id="2b010-163">First, create a new subfolder in the project named `ConnectionAndCommandSettings` underneath the `~/App_Code/DAL` folder.</span></span>


![添加一个名为 ConnectionAndCommandSettings 子](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image5.png)

<span data-ttu-id="2b010-165">**图 3**： 添加名为的子文件夹 `ConnectionAndCommandSettings`</span><span class="sxs-lookup"><span data-stu-id="2b010-165">**Figure 3**: Add a Subfolder Named `ConnectionAndCommandSettings`</span></span>


<span data-ttu-id="2b010-166">添加名为的新类文件`ProductsTableAdapter.ConnectionAndCommandSettings.vb`并输入以下代码：</span><span class="sxs-lookup"><span data-stu-id="2b010-166">Add a new class file named `ProductsTableAdapter.ConnectionAndCommandSettings.vb` and enter the following code:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample2.vb)]

<span data-ttu-id="2b010-167">此分部类添加`Public`名为属性`ConnectionString`到`ProductsTableAdapter`类，该类允许读取或更新基础连接的 TableAdapter s 的连接字符串的任何层。</span><span class="sxs-lookup"><span data-stu-id="2b010-167">This partial class adds a `Public` property named `ConnectionString` to the `ProductsTableAdapter` class that allows any layer to read or update the connection string for the TableAdapter s underlying connection.</span></span>

<span data-ttu-id="2b010-168">与此分部类创建 （和保存），打开`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="2b010-168">With this partial class created (and saved), open the `ProductsBLL` class.</span></span> <span data-ttu-id="2b010-169">请转到现有的方法之一，然后键入`Adapter`然后按句点键来打开智能感知。</span><span class="sxs-lookup"><span data-stu-id="2b010-169">Go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="2b010-170">你应看到新`ConnectionString`提供 IntelliSense，这意味着您可以以编程方式读取或调整此值从 BLL 中的属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-170">You should see the new `ConnectionString` property available in IntelliSense, meaning that you can programmatically read or adjust this value from the BLL.</span></span>

## <a name="exposing-the-entire-connection-object"></a><span data-ttu-id="2b010-171">公开整个连接对象</span><span class="sxs-lookup"><span data-stu-id="2b010-171">Exposing the Entire Connection Object</span></span>

<span data-ttu-id="2b010-172">此部分的类公开基础连接对象的一个属性： `ConnectionString`。</span><span class="sxs-lookup"><span data-stu-id="2b010-172">This partial class exposes just one property of the underlying connection object: `ConnectionString`.</span></span> <span data-ttu-id="2b010-173">如果你想要使整个连接对象由于篇幅所限 TableAdapter 的更高版本，或者可以更改`Connection`属性的保护级别。</span><span class="sxs-lookup"><span data-stu-id="2b010-173">If you want to make the entire connection object available beyond the confines of the TableAdapter, you can alternatively change the `Connection` property s protection level.</span></span> <span data-ttu-id="2b010-174">我们在步骤 1 中检查自动生成的代码演示的 TableAdapter s`Connection`属性标记为`Friend`，这意味着，它只能访问由在同一程序集中的类。</span><span class="sxs-lookup"><span data-stu-id="2b010-174">The auto-generated code we examined in Step 1 showed that the TableAdapter s `Connection` property is marked as `Friend`, meaning that it can only be accessed by classes in the same assembly.</span></span> <span data-ttu-id="2b010-175">这可以更改，但是，通过 TableAdapter 的`ConnectionModifier`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-175">This can be changed, however, via the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="2b010-176">打开`Northwind`数据集，单击`ProductsTableAdatper`在设计器并导航到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="2b010-176">Open the `Northwind` DataSet, click on the `ProductsTableAdatper` in the Designer, and navigate to the Properties window.</span></span> <span data-ttu-id="2b010-177">您会看见`ConnectionModifier`设置为其默认值， `Assembly`。</span><span class="sxs-lookup"><span data-stu-id="2b010-177">There you will see the `ConnectionModifier` set to its default value, `Assembly`.</span></span> <span data-ttu-id="2b010-178">若要使`Connection`属性的类型化数据集 s 程序集，更改外部可用`ConnectionModifier`属性设置为`Public`。</span><span class="sxs-lookup"><span data-stu-id="2b010-178">To make the `Connection` property available outside of the Typed DataSet s assembly, change the `ConnectionModifier` property to `Public`.</span></span>


<span data-ttu-id="2b010-179">[![可通过 ConnectionModifier 属性配置连接属性 s 可访问性级别](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="2b010-179">[![The Connection Property s Accessibility Level Can Be Configured via the ConnectionModifier Property](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)</span></span>

<span data-ttu-id="2b010-180">**图 4**:`Connection`通过属性可访问性级别可配置的 s`ConnectionModifier`属性 ([单击以查看实际尺寸的图像](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2b010-180">**Figure 4**: The `Connection` Property s Accessibility Level Can Be Configured via the `ConnectionModifier` Property ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span></span>


<span data-ttu-id="2b010-181">保存的数据集，然后返回到`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="2b010-181">Save the DataSet and then return to the `ProductsBLL` class.</span></span> <span data-ttu-id="2b010-182">如之前，请转到现有的方法之一，然后键入`Adapter`然后按句点键来打开智能感知。</span><span class="sxs-lookup"><span data-stu-id="2b010-182">As before, go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="2b010-183">此列表应包括`Connection`属性; 也就是说，现在可以以编程方式读取或从 BLL 分配任何连接级别的设置。</span><span class="sxs-lookup"><span data-stu-id="2b010-183">The list should include a `Connection` property, meaning that you can now programmatically read or assign any connection-level settings from the BLL.</span></span>

## <a name="step-3-examining-the-command-related-properties"></a><span data-ttu-id="2b010-184">第 3 步： 检查与命令相关的属性</span><span class="sxs-lookup"><span data-stu-id="2b010-184">Step 3: Examining the Command-Related Properties</span></span>

<span data-ttu-id="2b010-185">包含的主查询，默认情况下，具有自动生成的 TableAdapter `INSERT`， `UPDATE`，和`DELETE`语句。</span><span class="sxs-lookup"><span data-stu-id="2b010-185">A TableAdapter consists of a main query that, by default, has auto-generated `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="2b010-186">此主查询 s `INSERT`， `UPDATE`，并`DELETE`语句中的 TableAdapter 的代码实现作为 ADO.NET 数据适配器对象通过`Adapter`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-186">This main query s `INSERT`, `UPDATE`, and `DELETE` statements are implemented in the TableAdapter s code as an ADO.NET data adapter object via the `Adapter` property.</span></span> <span data-ttu-id="2b010-187">喜欢使用其`Connection`属性，`Adapter`属性的数据类型由使用的数据提供程序。</span><span class="sxs-lookup"><span data-stu-id="2b010-187">Like with its `Connection` property, the `Adapter` property s data type is determined by the data provider used.</span></span> <span data-ttu-id="2b010-188">这些教程使用 SqlClient 提供程序，因为`Adapter`属性属于类型[ `SqlDataAdapter` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="2b010-188">Since these tutorials use the SqlClient provider, the `Adapter` property is of type [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx).</span></span>

<span data-ttu-id="2b010-189">TableAdapter s`Adapter`属性具有三个属性的类型`SqlCommand`，它使用到问题`INSERT`， `UPDATE`，和`DELETE`语句：</span><span class="sxs-lookup"><span data-stu-id="2b010-189">The TableAdapter s `Adapter` property has three properties of type `SqlCommand` that it uses to issue the `INSERT`, `UPDATE`, and `DELETE` statements:</span></span>

- `InsertCommand`
- `UpdateCommand`
- `DeleteCommand`

<span data-ttu-id="2b010-190">一个`SqlCommand`对象负责将特定的查询发送到数据库，而且属性，例如： [ `CommandText` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx)，其中包含的临时 SQL 语句或存储的过程来执行; 和[ `Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx)，这是一系列`SqlParameter`对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-190">A `SqlCommand` object is responsible for sending a particular query to the database and has properties like: [`CommandText`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx), which contains the ad-hoc SQL statement or stored procedure to execute; and [`Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx), which is a collection of `SqlParameter` objects.</span></span> <span data-ttu-id="2b010-191">返回中可以看到[创建数据访问层](../introduction/creating-a-data-access-layer-vb.md)教程中，这些命令通过属性窗口可以自定义对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-191">As we saw back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, these command objects can be customized through the Properties window.</span></span>

<span data-ttu-id="2b010-192">除了其主查询，TableAdapter 还可以包含数目可变的方法，调用时，调度到的数据库指定的命令。</span><span class="sxs-lookup"><span data-stu-id="2b010-192">In addition to its main query, the TableAdapter can include a variable number of methods that, when invoked, dispatch a specified command to the database.</span></span> <span data-ttu-id="2b010-193">主查询的命令对象和所有其他方法的命令对象存储在 TableAdapter 的`CommandCollection`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-193">The main query s command object and the command objects for all additional methods are stored in the TableAdapter s `CommandCollection` property.</span></span>

<span data-ttu-id="2b010-194">允许 s 花点时间查看生成的代码`ProductsTableAdapter`在`Northwind`这两个属性及其支持的成员变量和帮助器方法的数据集：</span><span class="sxs-lookup"><span data-stu-id="2b010-194">Let s take a moment to look at the code generated by the `ProductsTableAdapter` in the `Northwind` DataSet for these two properties and their supporting member variables and helper methods:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample3.vb)]

<span data-ttu-id="2b010-195">代码`Adapter`并`CommandCollection`属性精确模拟的`Connection`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-195">The code for the `Adapter` and `CommandCollection` properties closely mimics that of the `Connection` property.</span></span> <span data-ttu-id="2b010-196">有保存的属性使用的对象的成员变量。</span><span class="sxs-lookup"><span data-stu-id="2b010-196">There are member variables that hold the objects used by the properties.</span></span> <span data-ttu-id="2b010-197">属性`Get`访问器首先检查是否有相应的成员变量`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="2b010-197">The properties `Get` accessors start by checking to see if the corresponding member variable is `Nothing`.</span></span> <span data-ttu-id="2b010-198">如果是这样，它创建成员变量的实例并将核心分配与命令相关的属性调用初始化方法。</span><span class="sxs-lookup"><span data-stu-id="2b010-198">If so, an initialization method is called which creates an instance of the member variable and assigns the core command-related properties.</span></span>

## <a name="step-4-exposing-command-level-settings"></a><span data-ttu-id="2b010-199">步骤 4： 公开命令级别的设置</span><span class="sxs-lookup"><span data-stu-id="2b010-199">Step 4: Exposing Command-Level Settings</span></span>

<span data-ttu-id="2b010-200">理想情况下，命令级别信息应保持不封装内数据访问层。</span><span class="sxs-lookup"><span data-stu-id="2b010-200">Ideally, the command-level information should remain encapsulated within the Data Access Layer.</span></span> <span data-ttu-id="2b010-201">应体系结构的其他层级中需要此信息，但是，它可以通过公开一个分部类，就像使用连接级设置。</span><span class="sxs-lookup"><span data-stu-id="2b010-201">Should this information be needed in other layers of the architecture, however, it can be exposed through a partial class, just like with the connection-level settings.</span></span>

<span data-ttu-id="2b010-202">因为 TableAdapter 仅具有单个`Connection`属性，用于公开连接级设置的代码是非常简单。</span><span class="sxs-lookup"><span data-stu-id="2b010-202">Since the TableAdapter only has a single `Connection` property, the code for exposing connection-level settings is fairly straightforward.</span></span> <span data-ttu-id="2b010-203">以下事项的更复杂时修改命令级别的设置，因为 TableAdapter 可以有多个命令对象的`InsertCommand`， `UpdateCommand`，并`DeleteCommand`，以及变量中的命令对象数目`CommandCollection`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-203">Things are a bit more complicated when modifying command-level settings because the TableAdapter can have multiple command objects - an `InsertCommand`, `UpdateCommand`, and `DeleteCommand`, along with a variable number of command objects in the `CommandCollection` property.</span></span> <span data-ttu-id="2b010-204">当更新命令级别的设置，这些设置将需要传播到所有命令对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-204">When updating command-level settings, these settings will need to be propagated to all of the command objects.</span></span>

<span data-ttu-id="2b010-205">例如，假设已发生的某些查询中所需执行特别长时间的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="2b010-205">For example, imagine that there were certain queries in the TableAdapter that took an extraordinary long time to execute.</span></span> <span data-ttu-id="2b010-206">在使用 TableAdapter 执行其中一个查询，我们可能想要增加命令对象 s [ `CommandTimeout`属性](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx)。</span><span class="sxs-lookup"><span data-stu-id="2b010-206">When using the TableAdapter to execute one of those queries, we might want to increase the command object s [`CommandTimeout` property](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx).</span></span> <span data-ttu-id="2b010-207">此属性指定要等待的时间要执行的命令的秒数，默认为 30。</span><span class="sxs-lookup"><span data-stu-id="2b010-207">This property specifies the number of seconds to wait for the command to execute and defaults to 30.</span></span>

<span data-ttu-id="2b010-208">若要允许`CommandTimeout`属性来进行调整的 BLL，添加以下`Public`方法`ProductsDataTable`步骤 2 中使用分部类文件创建 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span><span class="sxs-lookup"><span data-stu-id="2b010-208">To allow the `CommandTimeout` property to be adjusted by the BLL, add the following `Public` method to the `ProductsDataTable` using the partial class file created in Step 2 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample4.vb)]

<span data-ttu-id="2b010-209">无法从设置命令的所有问题的命令超时的 BLL 或表示层调用此方法，通过该 TableAdapter 实例。</span><span class="sxs-lookup"><span data-stu-id="2b010-209">This method could be invoked from the BLL or Presentation Layer to set the command timeout for all commands issues by that TableAdapter instance.</span></span>

> [!NOTE]
> <span data-ttu-id="2b010-210">`Adapter`并`CommandCollection`属性标记为`Private`，这意味着它们只能访问从 TableAdapter 中的代码。</span><span class="sxs-lookup"><span data-stu-id="2b010-210">The `Adapter` and `CommandCollection` properties are marked as `Private`, meaning they can only be accessed from code within the TableAdapter.</span></span> <span data-ttu-id="2b010-211">与不同`Connection`属性，这些访问修饰符不能配置。</span><span class="sxs-lookup"><span data-stu-id="2b010-211">Unlike the `Connection` property, these access modifiers are not configurable.</span></span> <span data-ttu-id="2b010-212">因此，如果您需要公开其他层体系结构中的命令级别属性必须使用以提供上文所述的分部类方法`Public`方法或属性，可读取或写入`Private`命令对象。</span><span class="sxs-lookup"><span data-stu-id="2b010-212">Therefore, if you need to expose command-level properties to other layers in the architecture you must use the partial class approach discussed above to provide a `Public` method or property that reads or writes to the `Private` command objects.</span></span>


## <a name="summary"></a><span data-ttu-id="2b010-213">总结</span><span class="sxs-lookup"><span data-stu-id="2b010-213">Summary</span></span>

<span data-ttu-id="2b010-214">类型化数据集内的 Tableadapter 用于封装数据的访问细节和复杂性。</span><span class="sxs-lookup"><span data-stu-id="2b010-214">The TableAdapters within a Typed DataSet serve to encapsulate data access details and complexity.</span></span> <span data-ttu-id="2b010-215">使用 Tableadapter，我们无需担心如何编写 ADO.NET 代码，以便连接到数据库中，发出命令，或填充到 DataTable 的结果。</span><span class="sxs-lookup"><span data-stu-id="2b010-215">Using TableAdapters, we do not have to worry about writing ADO.NET code to connect to the database, issue a command, or populate the results into a DataTable.</span></span> <span data-ttu-id="2b010-216">它是所有处理自动为我们。</span><span class="sxs-lookup"><span data-stu-id="2b010-216">It is all handled automatically for us.</span></span>

<span data-ttu-id="2b010-217">但是，可能是我们需要自定义的低级别的 ADO.NET 细节，例如，更改连接字符串值或默认连接或命令超时值。</span><span class="sxs-lookup"><span data-stu-id="2b010-217">However, there may be times when we need to customize the low-level ADO.NET specifics, such as changing the connection string or the default connection or command timeout values.</span></span> <span data-ttu-id="2b010-218">TableAdapter 具有自动生成`Connection`， `Adapter`，并`CommandCollection`属性，但这些是`Friend`或`Private`，默认情况下。</span><span class="sxs-lookup"><span data-stu-id="2b010-218">The TableAdapter has auto-generated `Connection`, `Adapter`, and `CommandCollection` properties, but these are either `Friend` or `Private`, by default.</span></span> <span data-ttu-id="2b010-219">可以通过扩展 TableAdapter 使用分部类包含公开此内部信息`Public`方法或属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-219">This internal information can be exposed by extending the TableAdapter using partial classes to include `Public` methods or properties.</span></span> <span data-ttu-id="2b010-220">或者，TableAdapter s`Connection`属性访问修饰符可以配置通过 TableAdapter 的`ConnectionModifier`属性。</span><span class="sxs-lookup"><span data-stu-id="2b010-220">Alternatively, the TableAdapter s `Connection` property access modifier can be configured through the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="2b010-221">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="2b010-221">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="2b010-222">关于作者</span><span class="sxs-lookup"><span data-stu-id="2b010-222">About the Author</span></span>

<span data-ttu-id="2b010-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="2b010-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2b010-224">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="2b010-224">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2b010-225">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="2b010-225">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2b010-226">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2b010-226">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="2b010-227">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="2b010-227">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2b010-228">特别感谢</span><span class="sxs-lookup"><span data-stu-id="2b010-228">Special Thanks To</span></span>

<span data-ttu-id="2b010-229">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="2b010-229">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2b010-230">本教程中的潜在顾客审阅者已 Burnadette Leigh，S ren Jacob Lauritsen Teresa Murphy 和 Hilton Geisenow。</span><span class="sxs-lookup"><span data-stu-id="2b010-230">Lead reviewers for this tutorial were Burnadette Leigh, S ren Jacob Lauritsen, Teresa Murphy, and Hilton Geisenow.</span></span> <span data-ttu-id="2b010-231">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="2b010-231">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2b010-232">如果是这样，给我在行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2b010-232">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2b010-233">[上一页](working-with-computed-columns-vb.md)
> [下一页](protecting-connection-strings-and-other-configuration-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2b010-233">[Previous](working-with-computed-columns-vb.md)
[Next](protecting-connection-strings-and-other-configuration-information-vb.md)</span></span>
