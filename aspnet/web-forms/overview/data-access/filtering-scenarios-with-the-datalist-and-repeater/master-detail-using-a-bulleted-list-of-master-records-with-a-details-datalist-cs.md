---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: 母版/详细信息的母版记录项目符号列表通过 DataList 使用母详细信息 (C#) |Microsoft Docs
author: rick-anderson
description: 在本教程中我们将压缩上一教程两页母版/详细信息的报告到单个页面，t 上显示类别名称的项目符号列表...
ms.author: riande
ms.date: 10/17/2006
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 3a7c7494a58fa7941924145805f32aa67164fac3
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/16/2018
ms.locfileid: "41832943"
---
<a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="ae3be-103">母版/详细信息的母版记录项目符号列表通过 DataList 使用母详细信息 (C#)</span><span class="sxs-lookup"><span data-stu-id="ae3be-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>
====================
<span data-ttu-id="ae3be-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ae3be-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ae3be-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe)或[下载 PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ae3be-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="ae3be-106">在本教程中我们将压缩上一教程两页母版/详细信息的报告到单个页面，显示在左侧和右侧的屏幕，并在屏幕右侧的所选的类别的产品类别名称的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ae3be-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>


## <a name="introduction"></a><span data-ttu-id="ae3be-107">介绍</span><span class="sxs-lookup"><span data-stu-id="ae3be-107">Introduction</span></span>

<span data-ttu-id="ae3be-108">在中[前面的教程](master-detail-filtering-acess-two-pages-datalist-cs.md)我们介绍了如何单独跨两个页面的母版/详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="ae3be-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="ae3be-109">主页面中我们使用 Repeater 控件来呈现项目符号列表的类别。</span><span class="sxs-lookup"><span data-stu-id="ae3be-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="ae3be-110">每个类别名称为超链接，单击时，将采用指向详细信息页，其中两列 DataList 介绍了这些产品的用户属于所选的类别。</span><span class="sxs-lookup"><span data-stu-id="ae3be-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="ae3be-111">在本教程中我们将压缩两页教程到单个页面，每个类别名称作为 LinkButton 呈现在屏幕的左侧显示类别名称的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ae3be-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="ae3be-112">单击其中一个类别名称 Linkbutton 引发回发，并将所选的类别的产品绑定到屏幕的右侧两列 DataList。</span><span class="sxs-lookup"><span data-stu-id="ae3be-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="ae3be-113">除了显示每个类别的名称，在左侧 Repeater 显示有多少总产品是给定的类别 （请参阅图 1）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>


<span data-ttu-id="ae3be-114">[![在左侧显示的类别名称和产品的总计数](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="ae3be-115">**图 1**： 在左侧显示类别的名称和产品总计数 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>


## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="ae3be-116">步骤 1： 在屏幕的左侧部分中显示 Repeater</span><span class="sxs-lookup"><span data-stu-id="ae3be-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="ae3be-117">本教程中，我们需要能够显示所选的类别产品的左侧的类别项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ae3be-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="ae3be-118">可使用标准 HTML 元素段落标记，非换行空格，定位到 web 页中的内容`<table>`s，依次类推或通过级联样式表 (CSS) 技术。</span><span class="sxs-lookup"><span data-stu-id="ae3be-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="ae3be-119">我们的教程到目前为止已使用所有 CSS 技术用于定位。</span><span class="sxs-lookup"><span data-stu-id="ae3be-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="ae3be-120">当我们构建我们在母版页中的导航用户界面[母版页和站点导航](../introduction/master-pages-and-site-navigation-cs.md)教程中我们使用了*绝对定位*，指示精确像素偏移量的导航列表和主要内容。</span><span class="sxs-lookup"><span data-stu-id="ae3be-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="ae3be-121">或者，使用 CSS 来定位一个元素到另一个通过左或向右*浮动*。</span><span class="sxs-lookup"><span data-stu-id="ae3be-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="ae3be-122">我们可以通过浮点左侧的 DataList Repeater 显示所选的类别产品的左侧的类别项目符号列表</span><span class="sxs-lookup"><span data-stu-id="ae3be-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="ae3be-123">打开`CategoriesAndProducts.aspx`页上从`DataListRepeaterFiltering`文件夹并添加到页面 Repeater 和 DataList。</span><span class="sxs-lookup"><span data-stu-id="ae3be-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="ae3be-124">设置 Repeater s`ID`到`Categories`和到 DataList 的`CategoryProducts`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="ae3be-125">转到源视图，并将其自身的 Repeater 和 DataList 控件放`<div>`元素。</span><span class="sxs-lookup"><span data-stu-id="ae3be-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="ae3be-126">也就是说，将括在 Repeater`<div>`元素第一个，然后在自己 DataList `<div>` Repeater 之后紧邻的元素。</span><span class="sxs-lookup"><span data-stu-id="ae3be-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="ae3be-127">您的标记现在应类似于下面：</span><span class="sxs-lookup"><span data-stu-id="ae3be-127">Your markup at this point should look similar to the following:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="ae3be-128">若要 float 左侧的 DataList Repeater，我们需要使用`float`CSS 样式属性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="ae3be-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>


[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="ae3be-129">`float: left;`浮动第一个`<div>`左侧的第二个元素。</span><span class="sxs-lookup"><span data-stu-id="ae3be-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="ae3be-130">`width`并`padding-right`设置指示第一个`<div>`s`width`之间添加填充量和`<div>`元素的内容和其右边距。</span><span class="sxs-lookup"><span data-stu-id="ae3be-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="ae3be-131">有关浮点 CSS 中的元素的详细信息，请查看[Floatutorial](http://css.maxdesign.com.au/floatutorial/)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="ae3be-132">而不是指定的样式设置直接通过第一个`<p>`元素 s`style`属性，请让改为创建一个新的 CSS 类中的 s`Styles.css`名为`FloatLeft`:</span><span class="sxs-lookup"><span data-stu-id="ae3be-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>


[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="ae3be-133">然后我们可以替换`<div>`与`<div class="FloatLeft">`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="ae3be-134">添加 CSS 类和配置中的标记后`CategoriesAndProducts.aspx`页上，转到设计器。</span><span class="sxs-lookup"><span data-stu-id="ae3be-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="ae3be-135">应会看到 Repeater 浮点到左侧的 DataList （尽管右现在这两项只是出现如以来我们 ve 尚未若要配置其数据源或模板灰色框）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>


<span data-ttu-id="ae3be-136">[![向 DataList 左浮动 Repeater](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="ae3be-137">**图 2**： 向 DataList 左浮动 Repeater ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>


## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="ae3be-138">步骤 2： 确定每个类别的产品数量</span><span class="sxs-lookup"><span data-stu-id="ae3be-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="ae3be-139">Repeater 和 DataList s 周围标记完成，我们准备就绪后，若要将类别数据绑定到 Repeater 控件。</span><span class="sxs-lookup"><span data-stu-id="ae3be-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="ae3be-140">但是，如图 1 中的类别的项目符号列表所示，除了每个类别的名我们还需要显示与类别关联的产品数量。</span><span class="sxs-lookup"><span data-stu-id="ae3be-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="ae3be-141">若要访问此信息，我们可以：</span><span class="sxs-lookup"><span data-stu-id="ae3be-141">To access this information we can either:</span></span>

- <span data-ttu-id="ae3be-142">**确定此信息从 ASP.NET page s 代码隐藏类。**</span><span class="sxs-lookup"><span data-stu-id="ae3be-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="ae3be-143">给定的特定*`categoryID`* 我们可以通过调用确定关联的产品数量`ProductsBLL`类的`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="ae3be-144">此方法返回`ProductsDataTable`对象，其`Count`属性指示多少`ProductsRow`s 存在，这是个指定的产品数量*`categoryID`*。</span><span class="sxs-lookup"><span data-stu-id="ae3be-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="ae3be-145">我们可以创建`ItemDataBound`Repeater，对于绑定到 Repeater，每个类别的调用的事件处理程序`ProductsBLL`类的`GetProductsByCategoryID(categoryID)`方法并在输出中包含其计数。</span><span class="sxs-lookup"><span data-stu-id="ae3be-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="ae3be-146">**更新`CategoriesDataTable`中要包括的类型化数据集`NumberOfProducts`列。**</span><span class="sxs-lookup"><span data-stu-id="ae3be-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="ae3be-147">然后，我们可以更新`GetCategories()`中的方法`CategoriesDataTable`若要包括此信息或，或者，将保留`GetCategories()`作为-并且创建一个新`CategoriesDataTable`调用方法`GetCategoriesAndNumberOfProducts()`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="ae3be-148">让我们来了解这两种方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="ae3be-149">第一种方法更容易实现的因为我们不需要更新数据访问层;但是，它需要多个与数据库通信。</span><span class="sxs-lookup"><span data-stu-id="ae3be-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="ae3be-150">在调用`ProductsBLL`类 s`GetProductsByCategoryID(categoryID)`中的方法`ItemDataBound`事件处理程序会添加用于显示中继器中每个类别的额外数据库调用。</span><span class="sxs-lookup"><span data-stu-id="ae3be-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="ae3be-151">使用此技术有*N* + 1 个数据库调用，其中*N*是显示中继器中的类别数。</span><span class="sxs-lookup"><span data-stu-id="ae3be-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="ae3be-152">第二种方法，产品计数会返回有关从每个类别的信息`CategoriesBLL`类 s `GetCategories()` (或`GetCategoriesAndNumberOfProducts()`) 方法，因而只需一次访问数据库。</span><span class="sxs-lookup"><span data-stu-id="ae3be-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="ae3be-153">确定 ItemDataBound 事件处理程序中的产品数量</span><span class="sxs-lookup"><span data-stu-id="ae3be-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="ae3be-154">确定对于 Repeater s 中的每个类别的产品数量`ItemDataBound`事件处理程序不需要对现有数据访问层进行任何修改。</span><span class="sxs-lookup"><span data-stu-id="ae3be-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="ae3be-155">可以直接在进行所有修改`CategoriesAndProducts.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="ae3be-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="ae3be-156">首先，通过添加名为新 ObjectDataSource`CategoriesDataSource`通过 Repeater s 智能标记。</span><span class="sxs-lookup"><span data-stu-id="ae3be-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="ae3be-157">接下来，配置`CategoriesDataSource`以便其检索从其数据的 ObjectDataSource`CategoriesBLL`类的`GetCategories()`方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>


<span data-ttu-id="ae3be-158">[![配置对象数据源以使用 CategoriesBLL 类的 GetCategories() 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="ae3be-159">**图 3**： 配置为使用 ObjectDataSource`CategoriesBLL`类 s`GetCategories()`方法 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>


<span data-ttu-id="ae3be-160">中的每项`Categories`Repeater 需要是可单击，并单击时，会导致`CategoryProducts`DataList 以显示所选类别产品。</span><span class="sxs-lookup"><span data-stu-id="ae3be-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="ae3be-161">这可以通过发出一个超链接，链接回此同一页面的每个类别 (`CategoriesAndProducts.aspx`)，但传递`CategoryID`通过查询字符串，就像我们在上一教程中看到。</span><span class="sxs-lookup"><span data-stu-id="ae3be-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="ae3be-162">此方法的优点是可以添加书签和搜索引擎编制索引显示特定类别的产品页面。</span><span class="sxs-lookup"><span data-stu-id="ae3be-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="ae3be-163">或者，我们可以使每个类别 LinkButton，这是我们将在本教程使用的方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="ae3be-164">LinkButton 呈现为超链接在 s 用户浏览器中，但单击时，引发一个回发;在回发时，DataList 的 ObjectDataSource 需要刷新以显示属于所选类别的那些产品。</span><span class="sxs-lookup"><span data-stu-id="ae3be-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="ae3be-165">对于本教程，使用超链接更有意义比使用 LinkButton;但是，可能有其他场景中，使用 LinkButton 是更为有利。</span><span class="sxs-lookup"><span data-stu-id="ae3be-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="ae3be-166">尽管超链接方法是适用于此示例中，使改为尝试使用 LinkButton 的 s。</span><span class="sxs-lookup"><span data-stu-id="ae3be-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="ae3be-167">我们将看到，使用 LinkButton 引入了一些挑战，否则不会出现与超链接。</span><span class="sxs-lookup"><span data-stu-id="ae3be-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="ae3be-168">因此，在本教程中使用 LinkButton 将突出显示这些挑战并帮助我们可能想要使用 LinkButton 而不是一个超链接的情况下提供解决方案。</span><span class="sxs-lookup"><span data-stu-id="ae3be-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="ae3be-169">建议重复本教程中使用超链接控件或`<a>`而非 LinkButton 的元素。</span><span class="sxs-lookup"><span data-stu-id="ae3be-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>


<span data-ttu-id="ae3be-170">以下标记显示了 Repeater 和 ObjectDataSource 的声明性语法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="ae3be-171">请注意 Repeater 的模板呈现 LinkButton 作为每个项的项目符号列表：</span><span class="sxs-lookup"><span data-stu-id="ae3be-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="ae3be-172">对于本教程 Repeater 必须具有启用了其视图状态 (请注意省略`EnableViewState="False"`Repeater s 声明性语法中)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="ae3be-173">在步骤 3 中我们将创建一个事件处理程序为 Repeater s`ItemCommand`事件在其中我们将更新 DataList 的 ObjectDataSource 的`SelectParameters`集合。</span><span class="sxs-lookup"><span data-stu-id="ae3be-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="ae3be-174">Repeater 的`ItemCommand`，但是，如果禁用视图状态赢得 t 激发。</span><span class="sxs-lookup"><span data-stu-id="ae3be-174">The Repeater s `ItemCommand`, however, won t fire if view state is disabled.</span></span> <span data-ttu-id="ae3be-175">请参阅[ASP.NET 问题的问题贴](http://scottonwriting.net/sowblog/posts/1263.aspx)并[其解决方案](http://scottonwriting.net/sowBlog/posts/1268.aspx)的原因的详细信息必须为 Repeater s 启用视图状态`ItemCommand`激发的事件。</span><span class="sxs-lookup"><span data-stu-id="ae3be-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>


<span data-ttu-id="ae3be-176">使用 LinkButton`ID`属性值为`ViewCategory`不具有其`Text`属性集。</span><span class="sxs-lookup"><span data-stu-id="ae3be-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="ae3be-177">如果我们只需有想要显示的类别名称，我们将具有设置的 Text 属性以声明方式，通过数据绑定语法如下所示：</span><span class="sxs-lookup"><span data-stu-id="ae3be-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="ae3be-178">但是，我们想要显示这两个类别的名称*和*属于该类别的产品数量。</span><span class="sxs-lookup"><span data-stu-id="ae3be-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="ae3be-179">可以检索此信息从 Repeater s`ItemDataBound`事件处理程序，方法调用`ProductBLL`类 s`GetCategoriesByProductID(categoryID)`方法，并确定在生成返回多少条记录`ProductsDataTable`，如以下代码说明：</span><span class="sxs-lookup"><span data-stu-id="ae3be-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="ae3be-180">首先，确保我们重新使用数据项 (一个其`ItemType`是`Item`或`AlternatingItem`)，然后引用`CategoriesRow`只绑定到当前实例`RepeaterItem`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="ae3be-181">接下来，我们通过创建的实例来确定此类别的产品数量`ProductsBLL`类，调用其`GetCategoriesByProductID(categoryID)`方法，并确定使用返回的记录数`Count`属性。</span><span class="sxs-lookup"><span data-stu-id="ae3be-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="ae3be-182">最后， `ViewCategory` LinkButton 的 ItemTemplate 中是引用并将其`Text`属性设置为*CategoryName* (*NumberOfProductsInCategory*)，其中*NumberOfProductsInCategory*格式化为带小数位数为零的数字。</span><span class="sxs-lookup"><span data-stu-id="ae3be-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="ae3be-183">或者，可以添加我们*格式设置函数*到 ASP.NET 页面 + s 代码隐藏类接受类别 s`CategoryName`并`CategoryID`值，并返回`CategoryName`加上的数字产品类别中的 (由调用`GetCategoriesByProductID(categoryID)`方法)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="ae3be-184">此类格式设置函数的结果无法以声明方式分配给 Text 属性替换为要使用的 LinkButton s`ItemDataBound`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae3be-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="ae3be-185">请参阅[GridView 控件中使用 Templatefield](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)或[设置 DataList 和 Repeater 基于数据的格式](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md)教程有关使用格式设置函数的详细信息。</span><span class="sxs-lookup"><span data-stu-id="ae3be-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>


<span data-ttu-id="ae3be-186">添加后此事件处理程序，请花费片刻时间来测试通过浏览器页面。</span><span class="sxs-lookup"><span data-stu-id="ae3be-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="ae3be-187">请注意如何在项目符号列表中，显示类别的名称和与类别关联的产品数列出每个类别 （请参阅图 4）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>


<span data-ttu-id="ae3be-188">[![显示每个类别名称和数量的产品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="ae3be-189">**图 4**： 显示每个类别名称和数量的产品 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>


## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="ae3be-190">正在更新`CategoriesDataTable`和`CategoriesTableAdapter`中要包含的每个类别的产品数量</span><span class="sxs-lookup"><span data-stu-id="ae3be-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="ae3be-191">而不是确定的每个类别的产品数 s 绑定到 Repeater 中，我们可以简化此过程通过调整`CategoriesDataTable`和`CategoriesTableAdapter`中数据访问层为本机包含此信息。</span><span class="sxs-lookup"><span data-stu-id="ae3be-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="ae3be-192">若要实现此目的，我们必须添加到一个新列`CategoriesDataTable`来保存关联的产品数量。</span><span class="sxs-lookup"><span data-stu-id="ae3be-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="ae3be-193">若要将新列添加到数据表中，打开类型化数据集 (`App_Code\DAL\Northwind.xsd`)，右键单击 DataTable，若要修改，然后选择添加 / 列。</span><span class="sxs-lookup"><span data-stu-id="ae3be-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="ae3be-194">添加到一个新列`CategoriesDataTable`（请参见图 5）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>


<span data-ttu-id="ae3be-195">[![将新列添加到 CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="ae3be-196">**图 5**： 添加到一个新列`CategoriesDataSource`([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>


<span data-ttu-id="ae3be-197">这将添加一个名为的新列`Column1`，你可以通过只需键入其他名称。</span><span class="sxs-lookup"><span data-stu-id="ae3be-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="ae3be-198">为此新列重命名`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="ae3be-199">接下来，我们需要配置此列的属性。</span><span class="sxs-lookup"><span data-stu-id="ae3be-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="ae3be-200">单击新列，并转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="ae3be-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="ae3be-201">更改列 s`DataType`属性从`System.String`到`System.Int32`并设置`ReadOnly`属性设置为`True`，如图 6 中所示。</span><span class="sxs-lookup"><span data-stu-id="ae3be-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>


![设置数据类型和新的列的 ReadOnly 属性](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="ae3be-203">**图 6**： 设置`DataType`和`ReadOnly`新列的属性</span><span class="sxs-lookup"><span data-stu-id="ae3be-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>


<span data-ttu-id="ae3be-204">虽然`CategoriesDataTable`现在具有`NumberOfProducts`列中，未设置任何相应的 TableAdapter 的查询它的值。</span><span class="sxs-lookup"><span data-stu-id="ae3be-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="ae3be-205">我们可以更新`GetCategories()`方法以返回此信息，如果我们希望此类信息返回每次检索类别信息。</span><span class="sxs-lookup"><span data-stu-id="ae3be-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="ae3be-206">如果，但是，我们只需获取中极少数情况下 （例如，对于本教程，只需），类别相关联的产品数，则我们可以保留`GetCategories()`作为-并且创建一个返回此信息的新方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="ae3be-207">允许 s 使用此后一种方法，创建一个名为的新方法`GetCategoriesAndNumberOfProducts()`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="ae3be-208">若要添加此新`GetCategoriesAndNumberOfProducts()`方法中，右键单击`CategoriesTableAdapter`，然后选择新查询。</span><span class="sxs-lookup"><span data-stu-id="ae3be-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="ae3be-209">此时将显示最多 TableAdapter 查询配置向导中，哪些我们已在前面的教程中多次使用。</span><span class="sxs-lookup"><span data-stu-id="ae3be-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="ae3be-210">此方法，该值指示该查询使用返回的行的临时 SQL 语句启动向导。</span><span class="sxs-lookup"><span data-stu-id="ae3be-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>


<span data-ttu-id="ae3be-211">[![创建使用的临时 SQL 语句的方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="ae3be-212">**图 7**： 创建方法使用一个临时 SQL 语句 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>


<span data-ttu-id="ae3be-213">[![SQL 语句返回的行](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="ae3be-214">**图 8**: SQL 语句返回行 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>


<span data-ttu-id="ae3be-215">下一步的向导屏幕提示我们要使用的查询。</span><span class="sxs-lookup"><span data-stu-id="ae3be-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="ae3be-216">若要返回每个类别 s `CategoryID`， `CategoryName`，并`Description`字段，以及数量的类别，与关联的产品使用以下`SELECT`语句：</span><span class="sxs-lookup"><span data-stu-id="ae3be-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>


[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]


<span data-ttu-id="ae3be-217">[![指定要使用的查询](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="ae3be-218">**图 9**： 指定使用的查询 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>


<span data-ttu-id="ae3be-219">请注意，用于计算与类别关联的产品数量的子查询的别名为`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="ae3be-220">此命名的匹配项会使关联此子查询返回的值`CategoriesDataTable`s`NumberOfProducts`列。</span><span class="sxs-lookup"><span data-stu-id="ae3be-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="ae3be-221">输入此查询后, 的最后一步是选择新的方法的名称。</span><span class="sxs-lookup"><span data-stu-id="ae3be-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="ae3be-222">使用`FillWithNumberOfProducts`和`GetCategoriesAndNumberOfProducts`填充 DataTable 并返回数据表模式，分别。</span><span class="sxs-lookup"><span data-stu-id="ae3be-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>


<span data-ttu-id="ae3be-223">[![新的 TableAdapter 的方法 FillWithNumberOfProducts 名称和 GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="ae3be-224">**图 10**： 命名新的 TableAdapter s 方法`FillWithNumberOfProducts`并`GetCategoriesAndNumberOfProducts`([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>


<span data-ttu-id="ae3be-225">此时数据访问层已扩展为包含的每个类别的产品数目。</span><span class="sxs-lookup"><span data-stu-id="ae3be-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="ae3be-226">由于我们所有的表示层将路由到单独的业务逻辑层通过 DAL 的所有调用，因此我们需要添加相应`GetCategoriesAndNumberOfProducts`方法`CategoriesBLL`类：</span><span class="sxs-lookup"><span data-stu-id="ae3be-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="ae3be-227">DAL 和 BLL 完成后，我们重新准备要绑定到此数据`Categories`Repeater 中的`CategoriesAndProducts.aspx`！</span><span class="sxs-lookup"><span data-stu-id="ae3be-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="ae3be-228">如果你已创建 ObjectDataSource 用于确定从 Repeater 中的产品数量`ItemDataBound`事件处理程序部分中，删除此对象数据源，并删除 Repeater 的`DataSourceID`属性设置; 还无线免缠绕Repeater s`ItemDataBound`通过删除事件处理程序中的事件`Handles Categories.OnItemDataBound`ASP.NET 代码隐藏类中的语法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="ae3be-229">返回在其原始状态 Repeater，添加名为新 ObjectDataSource`CategoriesDataSource`通过 Repeater s 智能标记。</span><span class="sxs-lookup"><span data-stu-id="ae3be-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="ae3be-230">配置要使用 ObjectDataSource`CategoriesBLL`类，而不是让它使用，但`GetCategories()`方法中，具有其使用`GetCategoriesAndNumberOfProducts()`改为 （请参阅图 11）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>


<span data-ttu-id="ae3be-231">[![配置对象数据源使用 GetCategoriesAndNumberOfProducts 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="ae3be-232">**图 11**： 配置为使用 ObjectDataSource`GetCategoriesAndNumberOfProducts`方法 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>


<span data-ttu-id="ae3be-233">接下来，更新`ItemTemplate`，以便 LinkButton s`Text`属性以声明方式分配使用数据绑定语法，并且同时包含`CategoryName`和`NumberOfProducts`数据字段。</span><span class="sxs-lookup"><span data-stu-id="ae3be-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="ae3be-234">中继器的完整声明性标记和`CategoriesDataSource`ObjectDataSource 按照：</span><span class="sxs-lookup"><span data-stu-id="ae3be-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="ae3be-235">通过更新 DAL 包含呈现的输出`NumberOfProducts`列是使用相同`ItemDataBound`事件处理程序方法 (回头查看图 4，请参阅屏幕截图： 显示的类别名称和产品数量中继器)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="ae3be-236">步骤 3： 显示所选的类别的产品</span><span class="sxs-lookup"><span data-stu-id="ae3be-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="ae3be-237">现在我们有`Categories`Repeater 中每个类别中显示的类别以及数量的产品列表。</span><span class="sxs-lookup"><span data-stu-id="ae3be-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="ae3be-238">中继器的每个类别，单击时，会导致将回发时，在该点我们使用 LinkButton 需要显示在所选类别产品`CategoryProducts`DataList。</span><span class="sxs-lookup"><span data-stu-id="ae3be-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="ae3be-239">我们面临的难题之一是如何通过 DataList 显示只是这些所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="ae3be-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="ae3be-240">在中[母版/详细信息的详细信息说明如何通过使用可选择的母版 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)可以选择的教程，我们已了解如何生成 GridView 中的行、 与所选行 s 的详细信息显示在同一页面上 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="ae3be-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="ae3be-241">GridView 的 ObjectDataSource 返回有关使用的所有产品的信息`ProductsBLL`s`GetProducts()`方法，同时 DetailsView s 对象数据源中检索有关所选的产品使用信息`GetProductsByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="ae3be-242">*`productID`* 通过将它与 GridView s 的值相关联以声明方式提供参数值`SelectedValue`属性。</span><span class="sxs-lookup"><span data-stu-id="ae3be-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="ae3be-243">遗憾的是，Repeater 没有`SelectedValue`属性并不能用作参数源。</span><span class="sxs-lookup"><span data-stu-id="ae3be-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="ae3be-244">这是显示在 Repeater 中使用 LinkButton 时这些挑战之一。</span><span class="sxs-lookup"><span data-stu-id="ae3be-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="ae3be-245">我们使用超链接以传入`CategoryID`通过在查询字符串相反，我们可以使用该查询字符串字段作为源参数 s 值。</span><span class="sxs-lookup"><span data-stu-id="ae3be-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>


<span data-ttu-id="ae3be-246">之前我们担心缺乏`SelectedValue`Repeater 的属性，让我们来首先将 DataList 绑定到对象数据源并指定其`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="ae3be-247">通过 DataList s 智能标记，选择要添加名为新 ObjectDataSource`CategoryProductsDataSource`并将其配置为使用`ProductsBLL`类的`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ae3be-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="ae3be-248">在本教程中 DataList 提供了一个只读的接口，因为随意设置下拉列表中插入、 更新、 以及删除选项卡添加到 （无）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="ae3be-249">[![配置对象数据源使用 ProductsBLL 类的 GetProductsByCategoryID(categoryID) 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="ae3be-250">**图 12**： 配置为使用 ObjectDataSource`ProductsBLL`类 s`GetProductsByCategoryID(categoryID)`方法 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>


<span data-ttu-id="ae3be-251">由于`GetProductsByCategoryID(categoryID)`方法需要一个输入的参数 (*`categoryID`*)，配置数据源向导可用于指定参数的源。</span><span class="sxs-lookup"><span data-stu-id="ae3be-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="ae3be-252">必须已在 GridView 或 DataList 中列出的类别，d 我们设置参数源下拉列表控件和到 ControlID`ID`的数据 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="ae3be-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="ae3be-253">但是，由于 Repeater 缺少`SelectedValue`不能用作参数源属性。</span><span class="sxs-lookup"><span data-stu-id="ae3be-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="ae3be-254">如果选中，您会发现 ControlID 下拉列表仅包含一个控件`ID``CategoryProducts`，则`ID`的 DataList。</span><span class="sxs-lookup"><span data-stu-id="ae3be-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="ae3be-255">现在，为无设置参数源下拉列表。</span><span class="sxs-lookup"><span data-stu-id="ae3be-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="ae3be-256">我们将得到以编程方式指定此参数值时中继器中单击 LinkButton 的类别。</span><span class="sxs-lookup"><span data-stu-id="ae3be-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>


<span data-ttu-id="ae3be-257">[![执行不指定参数的 categoryID 参数源](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="ae3be-258">**图 13**： 未指定的参数源*`categoryID`* 参数 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>


<span data-ttu-id="ae3be-259">完成配置数据源向导后，Visual Studio 会自动生成 DataList 的`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="ae3be-260">替换此默认值`ItemTemplate`模板与我们在前面的教程中使用; 此外，还要设置 DataList 的`RepeatColumns`属性设置为 2。</span><span class="sxs-lookup"><span data-stu-id="ae3be-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="ae3be-261">进行这些更改后你 DataList 和其关联的 ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="ae3be-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="ae3be-262">目前， `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* 永远不会设置参数，以便查看网页时不显示任何产品。</span><span class="sxs-lookup"><span data-stu-id="ae3be-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="ae3be-263">我们需要做是有基于上设置此参数值`CategoryID`中继器中的被单击类别。</span><span class="sxs-lookup"><span data-stu-id="ae3be-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="ae3be-264">这就引入了两个质询： 首先，如何我们确定当中继器 s 中 LinkButton`ItemTemplate`已被单击; 和第二个，我们如何才能确定`CategoryID`其 LinkButton 被单击的相应类别的？</span><span class="sxs-lookup"><span data-stu-id="ae3be-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="ae3be-265">如按钮和 ImageButton 控件 LinkButton 已`Click`事件和一个[`Command`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="ae3be-266">`Click`事件被设计为只需注意到已单击 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="ae3be-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="ae3be-267">有时，但是，除了注意已单击 LinkButton 我们还需要将一些额外信息传递给事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae3be-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="ae3be-268">如果出现这种情况，LinkButton s [ `CommandName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx)并[ `CommandArgument` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)可以分配此额外信息的属性。</span><span class="sxs-lookup"><span data-stu-id="ae3be-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="ae3be-269">然后，当单击 LinkButton，其`Command`触发事件 (而不是其`Click`事件) 和事件处理程序传递的值`CommandName`和`CommandArgument`属性。</span><span class="sxs-lookup"><span data-stu-id="ae3be-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="ae3be-270">时`Command`中继器 Repeater s 中的模板内从引发事件[`ItemCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx)触发，并传递`CommandName`和`CommandArgument`单击 LinkButton 的值 (或按钮或ImageButton)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="ae3be-271">因此，若要确定已单击 LinkButton 中继器中的类别时，我们需要执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="ae3be-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="ae3be-272">设置`CommandName`属性中 Repeater 的 LinkButton`ItemTemplate`为某个值 (我已使用 ListProducts)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="ae3be-273">此值设置`CommandName`值，LinkButton 的`Command`单击 LinkButton 时激发的事件。</span><span class="sxs-lookup"><span data-stu-id="ae3be-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="ae3be-274">设置 LinkButton s`CommandArgument`属性的值的当前项的`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="ae3be-275">为 Repeater s 创建事件处理程序`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="ae3be-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="ae3be-276">在事件处理程序中，集中`CategoryProductsDataSource`ObjectDataSource s`CategoryID`参数的值的传入的`CommandArgument`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="ae3be-277">以下`ItemTemplate`标记类别 Repeater 实现步骤 1 和 2。</span><span class="sxs-lookup"><span data-stu-id="ae3be-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="ae3be-278">请注意如何`CommandArgument`值分配数据项的`CategoryID`使用数据绑定语法：</span><span class="sxs-lookup"><span data-stu-id="ae3be-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="ae3be-279">每当创建`ItemCommand`事件处理程序是比较明智的做法始终首先检查传入`CommandName`值，因为*任何*`Command`引发事件*任何*按钮、 LinkButton，或ImageButton Repeater 中的将导致`ItemCommand`激发的事件。</span><span class="sxs-lookup"><span data-stu-id="ae3be-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="ae3be-280">尽管我们当前仅有一个此类 LinkButton 现在，将来我们 （或我们的团队的其他开发人员） 可能会附加按钮 Web 将控件添加到 Repeater，单击时，将引发相同`ItemCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae3be-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="ae3be-281">因此，它最好始终确保选中 s`CommandName`属性，如果它都匹配到预期的值，即可继续进行编程逻辑。</span><span class="sxs-lookup"><span data-stu-id="ae3be-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="ae3be-282">之后，确保传入的`CommandName`值等于 ListProducts，事件处理程序然后将分配`CategoryProductsDataSource`ObjectDataSource s`CategoryID`参数的值的传入的`CommandArgument`。</span><span class="sxs-lookup"><span data-stu-id="ae3be-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="ae3be-283">这种修改为 ObjectDataSource 的`SelectParameters`会自动导致 DataList 重新本身绑定到数据源，显示新选择的类别的产品。</span><span class="sxs-lookup"><span data-stu-id="ae3be-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="ae3be-284">使用这些新功能，在本教程中已完成 ！</span><span class="sxs-lookup"><span data-stu-id="ae3be-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="ae3be-285">请花费片刻时间进行测试的浏览器中。</span><span class="sxs-lookup"><span data-stu-id="ae3be-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="ae3be-286">图 14 显示了在屏幕首次访问页面时。</span><span class="sxs-lookup"><span data-stu-id="ae3be-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="ae3be-287">由于类别具有尚未被选中，将不显示任何产品。</span><span class="sxs-lookup"><span data-stu-id="ae3be-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="ae3be-288">单击一个类别，如生成，显示这些产品的产品类别中的两个列视图 （请参阅图 15）。</span><span class="sxs-lookup"><span data-stu-id="ae3be-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>


<span data-ttu-id="ae3be-289">[![无产品的显示时第一个访问的页面](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="ae3be-290">**图 14**： 否产品的显示时第一个访问的页面 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>


<span data-ttu-id="ae3be-291">[![单击生成类别列表右侧的匹配产品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="ae3be-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="ae3be-292">**图 15**： 单击生成类别列出右侧的匹配产品 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="ae3be-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>


## <a name="summary"></a><span data-ttu-id="ae3be-293">总结</span><span class="sxs-lookup"><span data-stu-id="ae3be-293">Summary</span></span>

<span data-ttu-id="ae3be-294">正如我们看到在本教程并前一次，母版/详细信息报告可以分散到两个页面，或上一个合并。</span><span class="sxs-lookup"><span data-stu-id="ae3be-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="ae3be-295">在单页上显示母版/详细信息报表，但是，引入了一些挑战如何最到母版布局和页面上的详细信息记录。</span><span class="sxs-lookup"><span data-stu-id="ae3be-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="ae3be-296">在中*母版/详细信息的详细信息说明如何通过使用可选择的母版 GridView*我们上方的主记录的详细信息记录; 在本教程中我们使用 CSS 技术具有的主记录浮点型教程左侧的详细信息。</span><span class="sxs-lookup"><span data-stu-id="ae3be-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="ae3be-297">以及显示母版/详细信息报表，我们还必须有机会了解如何检索如何执行服务器端逻辑时，LinkButton （或按钮或 ImageButton） 单击内与以及每个类别相关联的产品数量Repeater。</span><span class="sxs-lookup"><span data-stu-id="ae3be-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="ae3be-298">本教程中完成我们的母版/详细信息报表使用 DataList 和 Repeater 的检查。</span><span class="sxs-lookup"><span data-stu-id="ae3be-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="ae3be-299">我们接下来的教程将说明如何添加编辑和删除 DataList 控件的功能。</span><span class="sxs-lookup"><span data-stu-id="ae3be-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="ae3be-300">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="ae3be-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="ae3be-301">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="ae3be-301">Further Reading</span></span>

<span data-ttu-id="ae3be-302">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="ae3be-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="ae3be-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/)浮点 CSS 元素使用 CSS 的教程</span><span class="sxs-lookup"><span data-stu-id="ae3be-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="ae3be-304">[CSS 定位](http://www.brainjar.com/css/positioning/)定位的元素使用 CSS 的详细信息</span><span class="sxs-lookup"><span data-stu-id="ae3be-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="ae3be-305">[对进行布局出内容与 HTML](http://www.w3schools.com/html/html_layout.asp)使用`<table>`s 和用于定位其他 HTML 元素</span><span class="sxs-lookup"><span data-stu-id="ae3be-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ae3be-306">关于作者</span><span class="sxs-lookup"><span data-stu-id="ae3be-306">About the Author</span></span>

<span data-ttu-id="ae3be-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="ae3be-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ae3be-308">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="ae3be-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ae3be-309">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ae3be-310">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ae3be-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ae3be-311">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="ae3be-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ae3be-312">特别感谢</span><span class="sxs-lookup"><span data-stu-id="ae3be-312">Special Thanks To</span></span>

<span data-ttu-id="ae3be-313">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="ae3be-313">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ae3be-314">本教程中的潜在顾客审阅者已 Zack Jones。</span><span class="sxs-lookup"><span data-stu-id="ae3be-314">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="ae3be-315">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="ae3be-315">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ae3be-316">如果是这样，给我在行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ae3be-316">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ae3be-317">[上一页](master-detail-filtering-acess-two-pages-datalist-cs.md)
> [下一页](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ae3be-317">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
