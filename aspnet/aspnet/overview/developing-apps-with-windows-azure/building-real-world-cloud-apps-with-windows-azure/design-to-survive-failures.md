---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: 设计来克服的故障 （使用 Azure 构建实际云应用） |Microsoft Docs
author: MikeWasson
description: 构建真实世界云应用与 Azure 的电子书基于由 Scott Guthrie 开发的演示文稿。 它还说明了 13 模式和实践可以他...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 72b26fd58866df1296d06bd9e3bc695900cfbf65
ms.sourcegitcommit: 7b4e3936feacb1a8fcea7802aab3e2ea9c8af5b4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/04/2018
ms.locfileid: "48578466"
---
<a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="aa77f-104">设计来克服的故障 （使用 Azure 构建实际云应用）</span><span class="sxs-lookup"><span data-stu-id="aa77f-104">Design to Survive Failures (Building Real-World Cloud Apps with Azure)</span></span>
====================
<span data-ttu-id="aa77f-105">通过[Mike Wasson](https://github.com/MikeWasson)， [Rick Anderson]((https://twitter.com/RickAndMSFT))， [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="aa77f-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="aa77f-106">[下载修复此错误项目](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)或[下载电子书](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span><span class="sxs-lookup"><span data-stu-id="aa77f-106">[Download Fix It Project](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="aa77f-107">**构建真实世界云应用，使用 Azure**电子书基于由 Scott Guthrie 开发的演示文稿。</span><span class="sxs-lookup"><span data-stu-id="aa77f-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="aa77f-108">它还说明了 13 模式和实践，从而帮助您获得成功开发适用于在云中的 web 应用。</span><span class="sxs-lookup"><span data-stu-id="aa77f-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="aa77f-109">有关电子书的信息，请参阅[的第一章](introduction.md)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>


<span data-ttu-id="aa77f-110">您不必考虑任何类型的应用程序，但尤其是将其中很多人将使用它，在云中运行的生成时的项目之一是如何设计应用程序，以便它可以适当地处理故障并继续提供的价值高达可能。</span><span class="sxs-lookup"><span data-stu-id="aa77f-110">One of the things you have to think about when you build any type of application, but especially one that will run in the cloud where lots of people will be using it, is how to design the app so that it can gracefully handle failures and continue to deliver value as much as possible.</span></span> <span data-ttu-id="aa77f-111">只要有足够的时间，操作将会在任何环境或任何软件系统中出错。</span><span class="sxs-lookup"><span data-stu-id="aa77f-111">Given enough time, things are going to go wrong in any environment or any software system.</span></span> <span data-ttu-id="aa77f-112">您的应用程序如何处理这些情况下确定你的客户将获得如何不安和多长时间需要花费分析和解决问题。</span><span class="sxs-lookup"><span data-stu-id="aa77f-112">How your app handles those situations determines how upset your customers will get and how much time you have to spend analyzing and fixing problems.</span></span>

## <a name="types-of-failures"></a><span data-ttu-id="aa77f-113">类型的故障</span><span class="sxs-lookup"><span data-stu-id="aa77f-113">Types of failures</span></span>

<span data-ttu-id="aa77f-114">有两种基本类别的故障，你将想要以不同方式处理：</span><span class="sxs-lookup"><span data-stu-id="aa77f-114">There are two basic categories of failures that you'll want to handle differently:</span></span>

- <span data-ttu-id="aa77f-115">暂时性故障，自愈如间歇性网络连接问题的故障。</span><span class="sxs-lookup"><span data-stu-id="aa77f-115">Transient, self-healing failures such as intermittent network connectivity issues.</span></span>
- <span data-ttu-id="aa77f-116">需要干预的辩论失败。</span><span class="sxs-lookup"><span data-stu-id="aa77f-116">Enduring failures that require intervention.</span></span>

<span data-ttu-id="aa77f-117">对于暂时性故障，可以实现重试策略来确保该最快速和自动恢复应用程序的时间。</span><span class="sxs-lookup"><span data-stu-id="aa77f-117">For transient failures, you can implement a retry policy to ensure that most of the time the app recovers quickly and automatically.</span></span> <span data-ttu-id="aa77f-118">你的客户可能会注意到稍长的响应时间，但否则它们不会受到影响。</span><span class="sxs-lookup"><span data-stu-id="aa77f-118">Your customers might notice slightly longer response time, but otherwise they won't be affected.</span></span> <span data-ttu-id="aa77f-119">我们将介绍一些方法来处理这些错误中的[暂时性故障处理一章](transient-fault-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-119">We'll show some ways to handle these errors in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

<span data-ttu-id="aa77f-120">对于持久故障，可以实现监视和日志记录功能，当出现问题并促进根本原因分析时立即通知你。</span><span class="sxs-lookup"><span data-stu-id="aa77f-120">For enduring failures, you can implement monitoring and logging functionality that notifies you promptly when issues arise and that facilitates root cause analysis.</span></span> <span data-ttu-id="aa77f-121">我们将介绍一些方法可帮助您掌握这些类型中的错误[监视和遥测章](monitoring-and-telemetry.md)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-121">We'll show some ways to help you stay on top of these kinds of errors in the [Monitoring and Telemetry chapter](monitoring-and-telemetry.md).</span></span>

## <a name="failure-scope"></a><span data-ttu-id="aa77f-122">故障范围</span><span class="sxs-lookup"><span data-stu-id="aa77f-122">Failure scope</span></span>

<span data-ttu-id="aa77f-123">您还必须考虑失败作用域 – 是否会影响一台计算机，例如 SQL 数据库或存储或整个区域的整个服务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-123">You also have to think about failure scope – whether a single machine is affected, a whole service such as SQL Database or Storage, or an entire region.</span></span>

![故障范围](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a><span data-ttu-id="aa77f-125">计算机故障</span><span class="sxs-lookup"><span data-stu-id="aa77f-125">Machine failures</span></span>

<span data-ttu-id="aa77f-126">在 Azure 中，一个新自动替换为出现故障的服务器和设计良好的云应用程序自动快速地从这种类型的故障恢复。</span><span class="sxs-lookup"><span data-stu-id="aa77f-126">In Azure, a failed server is automatically replaced by a new one, and a well-designed cloud app recovers from this kind of failure automatically and quickly.</span></span> <span data-ttu-id="aa77f-127">前面我们强调无状态 web 层的可伸缩性优势和易用性从发生故障的服务器恢复是无状态的另一个好处。</span><span class="sxs-lookup"><span data-stu-id="aa77f-127">Earlier we stressed the scalability benefits of a stateless web tier, and ease of recovery from a failed server is another benefit of statelessness.</span></span> <span data-ttu-id="aa77f-128">易用性恢复也是平台即服务 (PaaS) 功能，例如 SQL 数据库和 Azure 应用服务 Web 应用的优势之一。</span><span class="sxs-lookup"><span data-stu-id="aa77f-128">Ease of recovery is also one of the benefits of platform-as-a-service (PaaS) features such as SQL Database and Azure App Service Web Apps.</span></span> <span data-ttu-id="aa77f-129">硬件故障很少见，但当它们出现的这些服务处理它们自动保存功能。您甚至无需编写代码来处理计算机失败时要使用其中一种服务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-129">Hardware failures are rare, but when they occur these services handle them automatically; you don't even have to write code to handle machine failures when you're using one of these services.</span></span>

### <a name="service-failures"></a><span data-ttu-id="aa77f-130">服务故障</span><span class="sxs-lookup"><span data-stu-id="aa77f-130">Service failures</span></span>

<span data-ttu-id="aa77f-131">云应用程序通常使用多个服务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-131">Cloud apps typically use multiple services.</span></span> <span data-ttu-id="aa77f-132">例如，修复其应用程序使用 SQL 数据库服务，存储服务和 web 应用部署到 Azure 应用服务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-132">For example, the Fix It app uses the SQL Database service, the Storage service, and the web app is deployed to Azure App Service.</span></span> <span data-ttu-id="aa77f-133">有什么将您的应用程序？ 如果你依赖的服务之一出现故障</span><span class="sxs-lookup"><span data-stu-id="aa77f-133">What will your app do if one of the services you depend on fails?</span></span> <span data-ttu-id="aa77f-134">某些服务失败友好"很抱歉，稍后重试"消息可能是的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="aa77f-134">For some service failures a friendly "sorry, try again later" message might be the best you can do.</span></span> <span data-ttu-id="aa77f-135">但在许多情况下会更好。</span><span class="sxs-lookup"><span data-stu-id="aa77f-135">But in many scenarios you can do better.</span></span> <span data-ttu-id="aa77f-136">例如，当后端数据存储区已关闭，你可以接受用户输入、 显示"你的请求已收到，"和存储其他任何位置的输入暂时;如果您需要的服务再次正常运行，然后可以检索输入，并对其进行处理。</span><span class="sxs-lookup"><span data-stu-id="aa77f-136">For example, when your back-end data store is down, you can accept user input, display "your request has been received," and store the input someplace else temporarily; then when the service you need is operational again, you can retrieve the input and process it.</span></span>

<span data-ttu-id="aa77f-137">[以队列为中心的工作模式](queue-centric-work-pattern.md)章演示一种方法来处理这种情况。</span><span class="sxs-lookup"><span data-stu-id="aa77f-137">The [Queue-centric Work Pattern](queue-centric-work-pattern.md) chapter shows one way to handle this scenario.</span></span> <span data-ttu-id="aa77f-138">Fix It 应用将任务存储在 SQL 数据库中，但它无需退出工作时 SQL 数据库已关闭。</span><span class="sxs-lookup"><span data-stu-id="aa77f-138">The Fix It app stores tasks in SQL Database, but it doesn't have to quit working when SQL Database is down.</span></span> <span data-ttu-id="aa77f-139">这一章中我们将了解如何将用户输入任务存储在队列中，并使用工作进程队列中读取和更新任务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-139">In that chapter we'll see how to store user input for a task in a queue, and use a worker process to read the queue and update the task.</span></span> <span data-ttu-id="aa77f-140">如果 SQL 已关闭，创建 Fix It 任务的能力会受到影响;工作进程可以等待和 SQL 数据库可用时处理新的任务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-140">If SQL is down, the ability to create Fix It tasks is unaffected; the worker process can wait and process new tasks when SQL Database is available.</span></span>

### <a name="region-failures"></a><span data-ttu-id="aa77f-141">区域故障</span><span class="sxs-lookup"><span data-stu-id="aa77f-141">Region failures</span></span>

<span data-ttu-id="aa77f-142">整个区域可能会失败。</span><span class="sxs-lookup"><span data-stu-id="aa77f-142">Entire regions may fail.</span></span> <span data-ttu-id="aa77f-143">自然灾难可能会破坏数据中心，它可能被 meteor 获取压扁，trunk 行到数据中心可能会中断通过 burying backhoe 等 cow farmer。如果您的应用程序托管在 stricken 数据中心要怎么做？</span><span class="sxs-lookup"><span data-stu-id="aa77f-143">A natural disaster might destroy a data center, it might get flattened by a meteor, the trunk line into the datacenter could be cut by a farmer burying a cow with a backhoe, etc. If your app is hosted in the stricken datacenter what do you do?</span></span> <span data-ttu-id="aa77f-144">可以将您的应用程序在 Azure 中设置多个区域中同时运行，以便如果在一个灾难，继续在另一个区域中运行它。</span><span class="sxs-lookup"><span data-stu-id="aa77f-144">It's possible to set up your app in Azure to run in multiple regions simultaneously so that if there's a disaster in one, you continue running in another region.</span></span> <span data-ttu-id="aa77f-145">此类故障是极少发生，并通过将无需确保不间断的服务，通过这种故障，大多数应用程序不跳转。</span><span class="sxs-lookup"><span data-stu-id="aa77f-145">Such failures are extremely rare occurrences, and most apps don't jump through the hoops necessary to ensure uninterrupted service through failures of this sort.</span></span> <span data-ttu-id="aa77f-146">请参阅有关如何使您的应用程序甚至通过区域故障的信息的一章末尾处的资源部分。</span><span class="sxs-lookup"><span data-stu-id="aa77f-146">See the Resources section at the end of the chapter for information about how to keep your app available even through a region failure.</span></span>

<span data-ttu-id="aa77f-147">Azure 的目标是使处理所有的故障更容易，这些类型，将看到我们所执行的以下章节中的一些示例。</span><span class="sxs-lookup"><span data-stu-id="aa77f-147">A goal of Azure is to make handling all of these kinds of failures a lot easier, and you'll see some examples of how we're doing that in the following chapters.</span></span>

## <a name="slas"></a><span data-ttu-id="aa77f-148">服务级别协议</span><span class="sxs-lookup"><span data-stu-id="aa77f-148">SLAs</span></span>

<span data-ttu-id="aa77f-149">人们经常听到有关云环境中的服务级别协议 (Sla)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-149">People often hear about service-level agreements (SLAs) in the cloud environment.</span></span> <span data-ttu-id="aa77f-150">基本上，这些都是如何可靠其服务的公司所做的承诺。</span><span class="sxs-lookup"><span data-stu-id="aa77f-150">Basically these are promises that companies make about how reliable their service is.</span></span> <span data-ttu-id="aa77f-151">99.9 %sla 意味着你应该会正常 99.9%的时间运行的服务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-151">A 99.9% SLA means you should expect the service to be working correctly 99.9% of the time.</span></span> <span data-ttu-id="aa77f-152">这个功能 SLA 的相当典型值，这听起来像数目很大，但是可能不知道多少停机时间。 1%实际上相当于。</span><span class="sxs-lookup"><span data-stu-id="aa77f-152">That's a fairly typical value for an SLA and it sounds like a very high number, but you might not realize how much down time .1% actually amounts to.</span></span> <span data-ttu-id="aa77f-153">下面是表显示了各种 SLA 百分比通过一年、 月和每周金额为多少停机时间。</span><span class="sxs-lookup"><span data-stu-id="aa77f-153">Here's a table that shows how much downtime various SLA percentages amount to over a year, a month, and a week.</span></span>

![SLA 表](design-to-survive-failures/_static/image2.png)

<span data-ttu-id="aa77f-155">因此 99.9 %sla 意味着你的服务可能向 8.76 小时下一年或每个月的 43.2 分钟。</span><span class="sxs-lookup"><span data-stu-id="aa77f-155">So a 99.9% SLA means your service could be down 8.76 hours a year or 43.2 minutes a month.</span></span> <span data-ttu-id="aa77f-156">这是更多的停机时间不是大多数人都知道。</span><span class="sxs-lookup"><span data-stu-id="aa77f-156">That's more down time than most people realize.</span></span> <span data-ttu-id="aa77f-157">作为开发人员，因此你想要了解一定的停机时间，有可能，并妥善的方式对其进行处理。</span><span class="sxs-lookup"><span data-stu-id="aa77f-157">So as a developer you want to be aware that a certain amount of down time is possible and handle it in a graceful way.</span></span> <span data-ttu-id="aa77f-158">在某一时刻人想要使用您的应用程序和服务将会关闭，并且想要最大程度减少的负面影响的客户。</span><span class="sxs-lookup"><span data-stu-id="aa77f-158">At some point someone is going to be using your app, and a service is going to be down, and you want to minimize the negative impact of that on the customer.</span></span>

<span data-ttu-id="aa77f-159">您应该了解的 SLA 的一点是它为引用的哪个时间段： 时钟重置每周、 每个月或每年？</span><span class="sxs-lookup"><span data-stu-id="aa77f-159">One thing you should know about an SLA is what time-frame it refers to: does the clock get reset every week, every month, or every year?</span></span> <span data-ttu-id="aa77f-160">在 Azure 中我们将时钟重置每个月，这是比每年的 SLA，为您好，因为每年 SLA 可以通过一系列的很好的几个月偏移它们隐藏错误几个月。</span><span class="sxs-lookup"><span data-stu-id="aa77f-160">In Azure we reset the clock every month, which is better for you than a yearly SLA, since a yearly SLA could hide bad months by offsetting them with a series of good months.</span></span>

<span data-ttu-id="aa77f-161">当然我们始终能够以合理方式做得更好 SLA;通常，您可以在下比这少得多。</span><span class="sxs-lookup"><span data-stu-id="aa77f-161">Of course we always aspire to do better than the SLA; usually you'll be down much less than that.</span></span> <span data-ttu-id="aa77f-162">承诺是，如果这就是不断失败的时间超过最大停机时间则可以要求退款。</span><span class="sxs-lookup"><span data-stu-id="aa77f-162">The promise is that if we're ever down for longer than the maximum down time you can ask for money back.</span></span> <span data-ttu-id="aa77f-163">您得到可能的金额不会完全弥补您的业务影响的停机时间，过多，但该方面的 SLA 充当强制策略，并让你知道，我们执行它非常重视。</span><span class="sxs-lookup"><span data-stu-id="aa77f-163">The amount of money you get back probably wouldn't fully compensate you for the business impact of the excess down time, but that aspect of the SLA acts as an enforcement policy and lets you know that we do take it very seriously.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="aa77f-164">复合 Sla</span><span class="sxs-lookup"><span data-stu-id="aa77f-164">Composite SLAs</span></span>

<span data-ttu-id="aa77f-165">考虑时还需考虑服务级别协议的一个重点是在应用中，每个具有单独的 SLA 服务上使用多个服务的影响。</span><span class="sxs-lookup"><span data-stu-id="aa77f-165">An important thing to think about when you're looking at SLAs is the impact of using multiple services in an app, with each service having a separate SLA.</span></span> <span data-ttu-id="aa77f-166">例如，修复其应用使用 Azure 应用服务 Web 应用、 Azure 存储和 SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="aa77f-166">For example, the Fix It app uses Azure App Service Web Apps, Azure Storage, and SQL Database.</span></span> <span data-ttu-id="aa77f-167">以下是截至日期在 2013 年 12 月，编写这本电子书其 SLA 号码：</span><span class="sxs-lookup"><span data-stu-id="aa77f-167">Here are their SLA numbers as of the date this e-book is being written in December, 2013:</span></span>

![SLA 网站、 存储、 SQL 数据库](design-to-survive-failures/_static/image3.png)

<span data-ttu-id="aa77f-169">停机时间你所期望的应用程序中基于这些服务 Sla 的最大值是什么？</span><span class="sxs-lookup"><span data-stu-id="aa77f-169">What is the maximum down time you would expect for the app based on these service SLAs?</span></span> <span data-ttu-id="aa77f-170">您可能认为，停机时间将等于最差的 SLA 百分比或 99.9%在这种情况下。</span><span class="sxs-lookup"><span data-stu-id="aa77f-170">You might think that your down time would be equal to the worst SLA percentage, or 99.9% in this case.</span></span> <span data-ttu-id="aa77f-171">这将是 true，如果所有三个服务始终失败一次，但这并不是一定究竟发生了什么。</span><span class="sxs-lookup"><span data-stu-id="aa77f-171">That would be true if all three services always failed at the same time, but that isn't necessarily what actually happens.</span></span> <span data-ttu-id="aa77f-172">每个服务可能会失败独立地在不同的时间，因此您必须将单独的 SLA 数字相乘来计算的复合 SLA。</span><span class="sxs-lookup"><span data-stu-id="aa77f-172">Each service may fail independently at different times, so you have to calculate the composite SLA by multiplying the individual SLA numbers.</span></span>

![复合 SLA](design-to-survive-failures/_static/image4.png)

<span data-ttu-id="aa77f-174">因此您的应用程序是停机 43.2 分钟不只是一个月，但该 3 倍数量，每个月 – 108 分钟，仍是 Azure SLA 限制范围内。</span><span class="sxs-lookup"><span data-stu-id="aa77f-174">So your app could be down not just 43.2 minutes a month but 3 times that amount, 108 minutes a month – and still be within the Azure SLA limits.</span></span>

<span data-ttu-id="aa77f-175">此问题不是唯一的 Azure。</span><span class="sxs-lookup"><span data-stu-id="aa77f-175">This issue is not unique to Azure.</span></span> <span data-ttu-id="aa77f-176">我们实际提供最佳云服务级别协议的任何云服务可用，并且你将有类似的问题，如果你使用任何供应商的云服务处理。</span><span class="sxs-lookup"><span data-stu-id="aa77f-176">We actually provide the best cloud SLAs of any cloud service available, and you'll have similar issues to deal with if you use any vendor's cloud services.</span></span> <span data-ttu-id="aa77f-177">这突出显示是想法的关于如何可以设计您的应用程序正确地，处理不可避免地存在服务失败，因为它们可能会发生频率不够高，以影响会客户或用户的重要性。</span><span class="sxs-lookup"><span data-stu-id="aa77f-177">What this highlights is the importance of thinking about how you can design your app to handle the inevitable service failures gracefully, because they might happen often enough to impact your customers or users.</span></span>

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a><span data-ttu-id="aa77f-178">云与企业停机的情况下体验相比的 Sla</span><span class="sxs-lookup"><span data-stu-id="aa77f-178">Cloud SLAs compared to enterprise down-time experience</span></span>

<span data-ttu-id="aa77f-179">人们有时说，"我的企业应用程序中我永远不会有这些问题。"</span><span class="sxs-lookup"><span data-stu-id="aa77f-179">People sometimes say, "In my enterprise app I never have these problems."</span></span> <span data-ttu-id="aa77f-180">如果需要多大停机时间是每月他们实际上有，他们通常所说，"嗯，它会发生情况有时。"</span><span class="sxs-lookup"><span data-stu-id="aa77f-180">If you ask how much down time a month they actually have, they usually say, "Well, it happens occasionally."</span></span> <span data-ttu-id="aa77f-181">如果需要何种频率，它们的承认"有时我们需要备份或安装新的服务器或更新软件。"</span><span class="sxs-lookup"><span data-stu-id="aa77f-181">And if you ask how often, they admit that "Sometimes we do need to back up or install a new server or update software."</span></span> <span data-ttu-id="aa77f-182">当然的计数为停机时间。</span><span class="sxs-lookup"><span data-stu-id="aa77f-182">Of course, that counts as down time.</span></span> <span data-ttu-id="aa77f-183">大多数企业应用除非它们是特别是关键任务都已实际关闭对多个通过我们的服务的 Sla 所允许的时间量。</span><span class="sxs-lookup"><span data-stu-id="aa77f-183">Most enterprise apps unless they are especially mission-critical are actually down for more than the amount of time allowed by our service SLAs.</span></span> <span data-ttu-id="aa77f-184">但你的服务器和基础结构，并且你要负责为它和它的控件中，往往会更少反响感受下降时间。</span><span class="sxs-lookup"><span data-stu-id="aa77f-184">But when it's your server and your infrastructure and you're responsible for it and in control of it, you tend to feel less angst about down times.</span></span> <span data-ttu-id="aa77f-185">在云环境中，你是依赖于其他人并不知道正在运行的内容，因此可能往往容易变得更关注它。</span><span class="sxs-lookup"><span data-stu-id="aa77f-185">In a cloud environment you're dependent on someone else and you don't know what's going on, so you might tend to get more worried about it.</span></span>

<span data-ttu-id="aa77f-186">当企业可实现更高版本的运行时间百分比不是从云 SLA 获取时，他们可以执行该操作在硬件上花费更多资金。</span><span class="sxs-lookup"><span data-stu-id="aa77f-186">When an enterprise achieves a greater up-time percentage than you get from a cloud SLA, they do it by spending a lot more money on hardware.</span></span> <span data-ttu-id="aa77f-187">云服务可以做到这一点，但必须从其服务的更多收取相关费用。</span><span class="sxs-lookup"><span data-stu-id="aa77f-187">A cloud service could do that but would have to charge much more for its services.</span></span> <span data-ttu-id="aa77f-188">不过，您可以利用经济高效的服务，设计您的软件，以便不可避免故障导致最小中断到你的客户。</span><span class="sxs-lookup"><span data-stu-id="aa77f-188">Instead, you take advantage of a cost-effective service and design your software so that the inevitable failures cause minimum disruption to your customers.</span></span> <span data-ttu-id="aa77f-189">为云应用程序设计器作业不这么多需要避免为了避免灾难，失败，则执行该操作通过侧重于软件，不在硬件上。</span><span class="sxs-lookup"><span data-stu-id="aa77f-189">Your job as a cloud app designer is not so much to avoid failure as to avoid catastrophe, and you do that by focusing on software, not on hardware.</span></span> <span data-ttu-id="aa77f-190">企业应用程序尽量以最大化平均无故障时间，而云应用程序尽可能最小化平均恢复时间。</span><span class="sxs-lookup"><span data-stu-id="aa77f-190">Whereas enterprise apps strive to maximize mean time between failures, cloud apps strive to minimize mean time to recover.</span></span>

### <a name="not-all-cloud-services-have-slas"></a><span data-ttu-id="aa77f-191">并非所有云服务都具有服务级别协议</span><span class="sxs-lookup"><span data-stu-id="aa77f-191">Not all cloud services have SLAs</span></span>

<span data-ttu-id="aa77f-192">注意还不是每个云服务甚至提供 SLA。</span><span class="sxs-lookup"><span data-stu-id="aa77f-192">Be aware also that not every cloud service even has an SLA.</span></span> <span data-ttu-id="aa77f-193">如果您的应用程序依赖于没有正常运行时间保证的服务，你可能关闭比您想象的更长。</span><span class="sxs-lookup"><span data-stu-id="aa77f-193">If your app is dependent on a service with no up-time guarantee, you could be down far longer than you might imagine.</span></span> <span data-ttu-id="aa77f-194">例如，如果您启用到你的站点使用 Facebook 或 Twitter 等社交提供程序日志中，检查与服务提供商，以找出，是否没有 SLA，而且您会发现有根本没有连接。</span><span class="sxs-lookup"><span data-stu-id="aa77f-194">For example, if you enable log-in to your site using a social provider such as Facebook or Twitter, check with the service provider to find out if there is an SLA, and you might find out there isn't one.</span></span> <span data-ttu-id="aa77f-195">但是，如果身份验证服务出现故障或无法支持你的请求数量，客户被锁定之外，您的应用程序。</span><span class="sxs-lookup"><span data-stu-id="aa77f-195">But if the authentication service goes down or is unable to support the volume of requests you throw at it, your customers are locked out of your app.</span></span> <span data-ttu-id="aa77f-196">天或更长时间，可能已关闭。</span><span class="sxs-lookup"><span data-stu-id="aa77f-196">You could be down for days or longer.</span></span> <span data-ttu-id="aa77f-197">一个新的应用程序的创建者应数以亿计的下载内容和依赖于 Facebook 身份验证 – 但不太迟将实时和发现之前与 Facebook 联系，没有为该服务没有 SLA。</span><span class="sxs-lookup"><span data-stu-id="aa77f-197">The creators of one new app expected hundreds of millions of downloads and took a dependency on Facebook authentication – but didn't talk to Facebook before going live and discovered too late that there was no SLA for that service.</span></span>

### <a name="not-all-downtime-counts-toward-slas"></a><span data-ttu-id="aa77f-198">并非所有的停机时间将计入 Sla</span><span class="sxs-lookup"><span data-stu-id="aa77f-198">Not all downtime counts toward SLAs</span></span>

<span data-ttu-id="aa77f-199">如果您的应用程序过度使用这些，一些云服务可能会有意拒绝服务。</span><span class="sxs-lookup"><span data-stu-id="aa77f-199">Some cloud services may deliberately deny service if your app over-uses them.</span></span> <span data-ttu-id="aa77f-200">这称为*限制*。</span><span class="sxs-lookup"><span data-stu-id="aa77f-200">This is called *throttling*.</span></span> <span data-ttu-id="aa77f-201">如果服务提供 SLA，应说明条件，在其下您可能会受到限制，以及应用程序设计应避免出现这些情况并作出正确反应受到限制，如果发生这种情况。</span><span class="sxs-lookup"><span data-stu-id="aa77f-201">If a service has an SLA, it should state the conditions under which you might be throttled, and your app design should avoid those conditions and react appropriately to the throttling if it happens.</span></span> <span data-ttu-id="aa77f-202">例如，如果对服务发出请求开始时超过一定数量每秒失败时，你想要确保自动重试不发生如此之快，它们会导致限制以继续。</span><span class="sxs-lookup"><span data-stu-id="aa77f-202">For example, if requests to a service start to fail when you exceed a certain number per second, you want to make sure automatic retries don't happen so fast that they cause the throttling to continue.</span></span> <span data-ttu-id="aa77f-203">我们将更详细说明了中的阻止行为[暂时性故障处理一章](transient-fault-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-203">We'll have more to say about throttling in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

## <a name="summary"></a><span data-ttu-id="aa77f-204">总结</span><span class="sxs-lookup"><span data-stu-id="aa77f-204">Summary</span></span>

<span data-ttu-id="aa77f-205">这一章已尝试帮助您实现具有真实世界云应用程序设计为从故障中恢复正常的原因。</span><span class="sxs-lookup"><span data-stu-id="aa77f-205">This chapter has tried to help you realize why a real world cloud app has to be designed to survive failures gracefully.</span></span> <span data-ttu-id="aa77f-206">从开始[接下来的章节](monitoring-and-telemetry.md)，本系列教程的其余模式转到更详细地介绍一些策略可用于执行此操作：</span><span class="sxs-lookup"><span data-stu-id="aa77f-206">Starting with the [next chapter](monitoring-and-telemetry.md), the remaining patterns in this series go into more detail about some strategies you can use to do that:</span></span>

- <span data-ttu-id="aa77f-207">有好[监视和遥测](monitoring-and-telemetry.md)，以便您快速查明故障需要干预，并具有足够的信息来解决这些问题。</span><span class="sxs-lookup"><span data-stu-id="aa77f-207">Have good [monitoring and telemetry](monitoring-and-telemetry.md), so that you find out quickly about failures that require intervention, and you have sufficient information to resolve them.</span></span>
- <span data-ttu-id="aa77f-208">[处理暂时性故障](transient-fault-handling.md)通过实现智能重试逻辑，以便您的应用程序将自动恢复时可以并会返回到[断路器](transient-fault-handling.md#circuitbreakers)逻辑时它不能。</span><span class="sxs-lookup"><span data-stu-id="aa77f-208">[Handle transient faults](transient-fault-handling.md) by implementing intelligent retry logic, so that your app recovers automatically when it can and falls back to [circuit breaker](transient-fault-handling.md#circuitbreakers) logic when it can't.</span></span>
- <span data-ttu-id="aa77f-209">使用[分布式缓存](distributed-caching.md)以尽可能减少吞吐量、 延迟和连接问题的数据库访问权限。</span><span class="sxs-lookup"><span data-stu-id="aa77f-209">Use [distributed caching](distributed-caching.md) in order to minimize throughput, latency, and connection problems with database access.</span></span>
- <span data-ttu-id="aa77f-210">实现松散耦合通过[以队列为中心的工作模式](queue-centric-work-pattern.md)，以便应用前端可以继续工作时后端已关闭。</span><span class="sxs-lookup"><span data-stu-id="aa77f-210">Implement loose coupling via the [queue-centric work pattern](queue-centric-work-pattern.md), so that your app front end can continue to work when the back end is down.</span></span>

## <a name="resources"></a><span data-ttu-id="aa77f-211">资源</span><span class="sxs-lookup"><span data-stu-id="aa77f-211">Resources</span></span>

<span data-ttu-id="aa77f-212">有关详细信息，请参阅后面的章节中这本电子书和以下资源。</span><span class="sxs-lookup"><span data-stu-id="aa77f-212">For more information, see later chapters in this e-book and the following resources.</span></span>

<span data-ttu-id="aa77f-213">文档：</span><span class="sxs-lookup"><span data-stu-id="aa77f-213">Documentation:</span></span>

- <span data-ttu-id="aa77f-214">[防故障： 弹性云体系结构指南](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-214">[Failsafe: Guidance for Resilient Cloud Architectures](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span></span> <span data-ttu-id="aa77f-215">Marc Mercuri、 Ulrich Homann 和 Andrew Townhill 白皮书。</span><span class="sxs-lookup"><span data-stu-id="aa77f-215">White paper by Marc Mercuri, Ulrich Homann, and Andrew Townhill.</span></span> <span data-ttu-id="aa77f-216">防故障系列视频的 web 页面版本。</span><span class="sxs-lookup"><span data-stu-id="aa77f-216">Web page version of the FailSafe video series.</span></span>
- <span data-ttu-id="aa77f-217">[Azure 云服务上的大规模服务的设计的最佳实践](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-217">[Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span></span> <span data-ttu-id="aa77f-218">Mark Simms 和 Michael Thomassy 白皮书。</span><span class="sxs-lookup"><span data-stu-id="aa77f-218">White paper by Mark Simms and Michael Thomassy.</span></span>
- <span data-ttu-id="aa77f-219">[Azure 业务连续性技术指南](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-219">[Azure Business Continuity Technical Guidance](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span></span> <span data-ttu-id="aa77f-220">Patrick Wickline 和 Jason Roth 白皮书。</span><span class="sxs-lookup"><span data-stu-id="aa77f-220">White paper by Patrick Wickline and Jason Roth.</span></span>
- <span data-ttu-id="aa77f-221">[灾难恢复和高可用性 Azure 应用程序的](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-221">[Disaster Recovery and High Availability for Azure Applications](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span></span> <span data-ttu-id="aa77f-222">由 Michael McKeown、 Hanu Kommalapati 和 Jason Roth 白皮书。</span><span class="sxs-lookup"><span data-stu-id="aa77f-222">White paper by Michael McKeown, Hanu Kommalapati, and Jason Roth.</span></span>
- <span data-ttu-id="aa77f-223">[Microsoft 模式和做法-Azure 指南](https://msdn.microsoft.com/library/dn568099.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-223">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="aa77f-224">请参阅多数据中心部署指南，断路器模式。</span><span class="sxs-lookup"><span data-stu-id="aa77f-224">See Multi Data Center Deployment guidance, Circuit breaker pattern.</span></span>
- <span data-ttu-id="aa77f-225">[Azure 支持-服务级别协议](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-225">[Azure Support - Service Level Agreements](https://azure.microsoft.com/support/legal/sla/).</span></span>
- <span data-ttu-id="aa77f-226">[Azure SQL 数据库中的业务连续性](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-226">[Business Continuity in Azure SQL Database](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span></span> <span data-ttu-id="aa77f-227">有关 SQL 数据库高可用性和灾难恢复功能的文档。</span><span class="sxs-lookup"><span data-stu-id="aa77f-227">Documentation about SQL Database high availability and disaster recovery features.</span></span>
- <span data-ttu-id="aa77f-228">[高可用性和灾难恢复 Azure 虚拟机中 SQL Server 的](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-228">[High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span></span>

<span data-ttu-id="aa77f-229">视频：</span><span class="sxs-lookup"><span data-stu-id="aa77f-229">Videos:</span></span>

- <span data-ttu-id="aa77f-230">[防故障： 构建可缩放、 可复原的云服务](https://channel9.msdn.com/Series/FailSafe)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-230">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="aa77f-231">包含 9 个部分组成的系列 Ulrich Homann、 Marc Mercuri 和 Mark Simms。</span><span class="sxs-lookup"><span data-stu-id="aa77f-231">Nine-part series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="aa77f-232">提供高级概念和体系结构原则非常可访问且有趣的方式，来自 Microsoft 客户咨询团队 (CAT) 实际客户体验的情景。</span><span class="sxs-lookup"><span data-stu-id="aa77f-232">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="aa77f-233">剧集 1 和 8 进入中进行深入设计云应用程序以从故障中恢复的原因。</span><span class="sxs-lookup"><span data-stu-id="aa77f-233">Episodes 1 and 8 go in depth into the reasons for designing cloud apps to survive failures.</span></span> <span data-ttu-id="aa77f-234">另请参阅第 2 节开始 49:57、 故障点和在第 2 节开始 56:05，故障模式的讨论和断路器在段 3 开始 40:55 的讨论中的阻止行为跟进的讨论。</span><span class="sxs-lookup"><span data-stu-id="aa77f-234">See also the follow-up discussion of throttling in episode 2 starting at 49:57, the discussion of failure points and failure modes in episode 2 starting at 56:05, and the discussion of circuit breakers in episode 3 starting at 40:55.</span></span>
- <span data-ttu-id="aa77f-235">[构建大型： 从 Azure 客户的第 ii 部分到的经验教训](https://channel9.msdn.com/Events/Build/2012/3-030)。</span><span class="sxs-lookup"><span data-stu-id="aa77f-235">[Building Big: Lessons learned from Azure customers - Part II](https://channel9.msdn.com/Events/Build/2012/3-030).</span></span> <span data-ttu-id="aa77f-236">Mark Simms 介绍了设计失败以及检测所有内容。</span><span class="sxs-lookup"><span data-stu-id="aa77f-236">Mark Simms talks about designing for failure and instrumenting everything.</span></span> <span data-ttu-id="aa77f-237">类似于防故障系列但进入操作方法的更多详细信息。</span><span class="sxs-lookup"><span data-stu-id="aa77f-237">Similar to the Failsafe series but goes into more how-to details.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="aa77f-238">[上一页](unstructured-blob-storage.md)
> [下一页](monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="aa77f-238">[Previous](unstructured-blob-storage.md)
[Next](monitoring-and-telemetry.md)</span></span>
